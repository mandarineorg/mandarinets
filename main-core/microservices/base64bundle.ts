// Copyright 2020-2020 The Mandarine.TS Framework authors. All rights reserved. MIT license.

// deno bundle --no-check -c tsconfig.json main-core/microservices/microserviceWorker.ts main-core/microservices/microserviceWorker.js
export const microserviceWorkerBase64Bundle = `data:application/javascript;base64,ZnVuY3Rpb24gY29weShzcmMsIGRzdCwgb2ZmID0gMCkgewogICAgb2ZmID0gTWF0aC5tYXgoMCwgTWF0aC5taW4ob2ZmLCBkc3QuYnl0ZUxlbmd0aCkpOwogICAgY29uc3QgZHN0Qnl0ZXNBdmFpbGFibGUgPSBkc3QuYnl0ZUxlbmd0aCAtIG9mZjsKICAgIGlmIChzcmMuYnl0ZUxlbmd0aCA+IGRzdEJ5dGVzQXZhaWxhYmxlKSB7CiAgICAgICAgc3JjID0gc3JjLnN1YmFycmF5KDAsIGRzdEJ5dGVzQXZhaWxhYmxlKTsKICAgIH0KICAgIGRzdC5zZXQoc3JjLCBvZmYpOwogICAgcmV0dXJuIHNyYy5ieXRlTGVuZ3RoOwp9CmNsYXNzIERlbm9TdGRJbnRlcm5hbEVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgY29uc3RydWN0b3IobWVzc2FnZTIpewogICAgICAgIHN1cGVyKG1lc3NhZ2UyKTsKICAgICAgICB0aGlzLm5hbWUgPSAiRGVub1N0ZEludGVybmFsRXJyb3IiOwogICAgfQp9CmZ1bmN0aW9uIGFzc2VydChleHByLCBtc2cgPSAiIikgewogICAgaWYgKCFleHByKSB7CiAgICAgICAgdGhyb3cgbmV3IERlbm9TdGRJbnRlcm5hbEVycm9yKG1zZyk7CiAgICB9Cn0KY29uc3QgREVGQVVMVF9CVUZfU0laRSA9IDQwOTY7CmNvbnN0IE1JTl9CVUZfU0laRSA9IDE2Owpjb25zdCBDUiA9ICJcciIuY2hhckNvZGVBdCgwKTsKY29uc3QgTEYgPSAiXG4iLmNoYXJDb2RlQXQoMCk7CmNsYXNzIEJ1ZmZlckZ1bGxFcnJvciBleHRlbmRzIEVycm9yIHsKICAgIHBhcnRpYWw7CiAgICBuYW1lID0gIkJ1ZmZlckZ1bGxFcnJvciI7CiAgICBjb25zdHJ1Y3RvcihwYXJ0aWFsMSl7CiAgICAgICAgc3VwZXIoIkJ1ZmZlciBmdWxsIik7CiAgICAgICAgdGhpcy5wYXJ0aWFsID0gcGFydGlhbDE7CiAgICB9Cn0KY2xhc3MgUGFydGlhbFJlYWRFcnJvciBleHRlbmRzIERlbm8uZXJyb3JzLlVuZXhwZWN0ZWRFb2YgewogICAgbmFtZSA9ICJQYXJ0aWFsUmVhZEVycm9yIjsKICAgIHBhcnRpYWw7CiAgICBjb25zdHJ1Y3RvcigpewogICAgICAgIHN1cGVyKCJFbmNvdW50ZXJlZCBVbmV4cGVjdGVkRW9mLCBkYXRhIG9ubHkgcGFydGlhbGx5IHJlYWQiKTsKICAgIH0KfQpjbGFzcyBCdWZSZWFkZXIgewogICAgYnVmOwogICAgcmQ7CiAgICByID0gMDsKICAgIHcgPSAwOwogICAgZW9mID0gZmFsc2U7CiAgICBzdGF0aWMgY3JlYXRlKHIsIHNpemUgPSA0MDk2KSB7CiAgICAgICAgcmV0dXJuIHIgaW5zdGFuY2VvZiBCdWZSZWFkZXIgPyByIDogbmV3IEJ1ZlJlYWRlcihyLCBzaXplKTsKICAgIH0KICAgIGNvbnN0cnVjdG9yKHJkMSwgc2l6ZTEgPSA0MDk2KXsKICAgICAgICBpZiAoc2l6ZTEgPCAxNikgewogICAgICAgICAgICBzaXplMSA9IE1JTl9CVUZfU0laRTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fcmVzZXQobmV3IFVpbnQ4QXJyYXkoc2l6ZTEpLCByZDEpOwogICAgfQogICAgc2l6ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5idWYuYnl0ZUxlbmd0aDsKICAgIH0KICAgIGJ1ZmZlcmVkKCkgewogICAgICAgIHJldHVybiB0aGlzLncgLSB0aGlzLnI7CiAgICB9CiAgICBhc3luYyBfZmlsbCgpIHsKICAgICAgICBpZiAodGhpcy5yID4gMCkgewogICAgICAgICAgICB0aGlzLmJ1Zi5jb3B5V2l0aGluKDAsIHRoaXMuciwgdGhpcy53KTsKICAgICAgICAgICAgdGhpcy53IC09IHRoaXMucjsKICAgICAgICAgICAgdGhpcy5yID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMudyA+PSB0aGlzLmJ1Zi5ieXRlTGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCJidWZpbzogdHJpZWQgdG8gZmlsbCBmdWxsIGJ1ZmZlciIpOwogICAgICAgIH0KICAgICAgICBmb3IobGV0IGkgPSAxMDA7IGkgPiAwOyBpLS0pewogICAgICAgICAgICBjb25zdCByciA9IGF3YWl0IHRoaXMucmQucmVhZCh0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLncpKTsKICAgICAgICAgICAgaWYgKHJyID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNzZXJ0KHJyID49IDAsICJuZWdhdGl2ZSByZWFkIik7CiAgICAgICAgICAgIHRoaXMudyArPSBycjsKICAgICAgICAgICAgaWYgKHJyID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gcHJvZ3Jlc3MgYWZ0ZXIgJHsxMDB9IHJlYWQoKSBjYWxsc2ApOwogICAgfQogICAgcmVzZXQocikgewogICAgICAgIHRoaXMuX3Jlc2V0KHRoaXMuYnVmLCByKTsKICAgIH0KICAgIF9yZXNldChidWYsIHJkKSB7CiAgICAgICAgdGhpcy5idWYgPSBidWY7CiAgICAgICAgdGhpcy5yZCA9IHJkOwogICAgICAgIHRoaXMuZW9mID0gZmFsc2U7CiAgICB9CiAgICBhc3luYyByZWFkKHApIHsKICAgICAgICBsZXQgcnIgPSBwLmJ5dGVMZW5ndGg7CiAgICAgICAgaWYgKHAuYnl0ZUxlbmd0aCA9PT0gMCkgcmV0dXJuIHJyOwogICAgICAgIGlmICh0aGlzLnIgPT09IHRoaXMudykgewogICAgICAgICAgICBpZiAocC5ieXRlTGVuZ3RoID49IHRoaXMuYnVmLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJyMSA9IGF3YWl0IHRoaXMucmQucmVhZChwKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5yZWFkID0gcnIxID8/IDA7CiAgICAgICAgICAgICAgICBhc3NlcnQobnJlYWQgPj0gMCwgIm5lZ2F0aXZlIHJlYWQiKTsKICAgICAgICAgICAgICAgIHJldHVybiBycjE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5yID0gMDsKICAgICAgICAgICAgdGhpcy53ID0gMDsKICAgICAgICAgICAgcnIgPSBhd2FpdCB0aGlzLnJkLnJlYWQodGhpcy5idWYpOwogICAgICAgICAgICBpZiAocnIgPT09IDAgfHwgcnIgPT09IG51bGwpIHJldHVybiBycjsKICAgICAgICAgICAgYXNzZXJ0KHJyID49IDAsICJuZWdhdGl2ZSByZWFkIik7CiAgICAgICAgICAgIHRoaXMudyArPSBycjsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29waWVkID0gY29weSh0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMudyksIHAsIDApOwogICAgICAgIHRoaXMuciArPSBjb3BpZWQ7CiAgICAgICAgcmV0dXJuIGNvcGllZDsKICAgIH0KICAgIGFzeW5jIHJlYWRGdWxsKHApIHsKICAgICAgICBsZXQgYnl0ZXNSZWFkID0gMDsKICAgICAgICB3aGlsZShieXRlc1JlYWQgPCBwLmxlbmd0aCl7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCByciA9IGF3YWl0IHRoaXMucmVhZChwLnN1YmFycmF5KGJ5dGVzUmVhZCkpOwogICAgICAgICAgICAgICAgaWYgKHJyID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJ5dGVzUmVhZCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGFydGlhbFJlYWRFcnJvcigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJ5dGVzUmVhZCArPSBycjsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBlcnIucGFydGlhbCA9IHAuc3ViYXJyYXkoMCwgYnl0ZXNSZWFkKTsKICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcDsKICAgIH0KICAgIGFzeW5jIHJlYWRCeXRlKCkgewogICAgICAgIHdoaWxlKHRoaXMuciA9PT0gdGhpcy53KXsKICAgICAgICAgICAgaWYgKHRoaXMuZW9mKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fZmlsbCgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjID0gdGhpcy5idWZbdGhpcy5yXTsKICAgICAgICB0aGlzLnIrKzsKICAgICAgICByZXR1cm4gYzsKICAgIH0KICAgIGFzeW5jIHJlYWRTdHJpbmcoZGVsaW0pIHsKICAgICAgICBpZiAoZGVsaW0ubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRGVsaW1pdGVyIHNob3VsZCBiZSBhIHNpbmdsZSBjaGFyYWN0ZXIiKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYnVmZmVyID0gYXdhaXQgdGhpcy5yZWFkU2xpY2UoZGVsaW0uY2hhckNvZGVBdCgwKSk7CiAgICAgICAgaWYgKGJ1ZmZlciA9PT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShidWZmZXIpOwogICAgfQogICAgYXN5bmMgcmVhZExpbmUoKSB7CiAgICAgICAgbGV0IGxpbmU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGluZSA9IGF3YWl0IHRoaXMucmVhZFNsaWNlKExGKTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgbGV0IHsgcGFydGlhbDogcGFydGlhbDIgIH0gPSBlcnI7CiAgICAgICAgICAgIGFzc2VydChwYXJ0aWFsMiBpbnN0YW5jZW9mIFVpbnQ4QXJyYXksICJidWZpbzogY2F1Z2h0IGVycm9yIGZyb20gYHJlYWRTbGljZSgpYCB3aXRob3V0IGBwYXJ0aWFsYCBwcm9wZXJ0eSIpOwogICAgICAgICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBCdWZmZXJGdWxsRXJyb3IpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLmVvZiAmJiBwYXJ0aWFsMi5ieXRlTGVuZ3RoID4gMCAmJiBwYXJ0aWFsMltwYXJ0aWFsMi5ieXRlTGVuZ3RoIC0gMV0gPT09IENSKSB7CiAgICAgICAgICAgICAgICBhc3NlcnQodGhpcy5yID4gMCwgImJ1ZmlvOiB0cmllZCB0byByZXdpbmQgcGFzdCBzdGFydCBvZiBidWZmZXIiKTsKICAgICAgICAgICAgICAgIHRoaXMuci0tOwogICAgICAgICAgICAgICAgcGFydGlhbDIgPSBwYXJ0aWFsMi5zdWJhcnJheSgwLCBwYXJ0aWFsMi5ieXRlTGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGxpbmU6IHBhcnRpYWwyLAogICAgICAgICAgICAgICAgbW9yZTogIXRoaXMuZW9mCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmIChsaW5lID09PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAobGluZS5ieXRlTGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBsaW5lLAogICAgICAgICAgICAgICAgbW9yZTogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKGxpbmVbbGluZS5ieXRlTGVuZ3RoIC0gMV0gPT0gTEYpIHsKICAgICAgICAgICAgbGV0IGRyb3AgPSAxOwogICAgICAgICAgICBpZiAobGluZS5ieXRlTGVuZ3RoID4gMSAmJiBsaW5lW2xpbmUuYnl0ZUxlbmd0aCAtIDJdID09PSBDUikgewogICAgICAgICAgICAgICAgZHJvcCA9IDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZSA9IGxpbmUuc3ViYXJyYXkoMCwgbGluZS5ieXRlTGVuZ3RoIC0gZHJvcCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbmUsCiAgICAgICAgICAgIG1vcmU6IGZhbHNlCiAgICAgICAgfTsKICAgIH0KICAgIGFzeW5jIHJlYWRTbGljZShkZWxpbSkgewogICAgICAgIGxldCBzID0gMDsKICAgICAgICBsZXQgc2xpY2U7CiAgICAgICAgd2hpbGUodHJ1ZSl7CiAgICAgICAgICAgIGxldCBpID0gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yICsgcywgdGhpcy53KS5pbmRleE9mKGRlbGltKTsKICAgICAgICAgICAgaWYgKGkgPj0gMCkgewogICAgICAgICAgICAgICAgaSArPSBzOwogICAgICAgICAgICAgICAgc2xpY2UgPSB0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMuciArIGkgKyAxKTsKICAgICAgICAgICAgICAgIHRoaXMuciArPSBpICsgMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuciA9PT0gdGhpcy53KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzbGljZSA9IHRoaXMuYnVmLnN1YmFycmF5KHRoaXMuciwgdGhpcy53KTsKICAgICAgICAgICAgICAgIHRoaXMuciA9IHRoaXMudzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZlcmVkKCkgPj0gdGhpcy5idWYuYnl0ZUxlbmd0aCkgewogICAgICAgICAgICAgICAgdGhpcy5yID0gdGhpcy53OwogICAgICAgICAgICAgICAgY29uc3Qgb2xkYnVmID0gdGhpcy5idWY7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdidWYgPSB0aGlzLmJ1Zi5zbGljZSgwKTsKICAgICAgICAgICAgICAgIHRoaXMuYnVmID0gbmV3YnVmOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJ1ZmZlckZ1bGxFcnJvcihvbGRidWYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHMgPSB0aGlzLncgLSB0aGlzLnI7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9maWxsKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgZXJyLnBhcnRpYWwgPSBzbGljZTsKICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2xpY2U7CiAgICB9CiAgICBhc3luYyBwZWVrKG4pIHsKICAgICAgICBpZiAobiA8IDApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoIm5lZ2F0aXZlIGNvdW50Iik7CiAgICAgICAgfQogICAgICAgIGxldCBhdmFpbCA9IHRoaXMudyAtIHRoaXMucjsKICAgICAgICB3aGlsZShhdmFpbCA8IG4gJiYgYXZhaWwgPCB0aGlzLmJ1Zi5ieXRlTGVuZ3RoICYmICF0aGlzLmVvZil7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9maWxsKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgZXJyLnBhcnRpYWwgPSB0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMudyk7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXZhaWwgPSB0aGlzLncgLSB0aGlzLnI7CiAgICAgICAgfQogICAgICAgIGlmIChhdmFpbCA9PT0gMCAmJiB0aGlzLmVvZikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9IGVsc2UgaWYgKGF2YWlsIDwgbiAmJiB0aGlzLmVvZikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yLCB0aGlzLnIgKyBhdmFpbCk7CiAgICAgICAgfSBlbHNlIGlmIChhdmFpbCA8IG4pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEJ1ZmZlckZ1bGxFcnJvcih0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMudykpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yLCB0aGlzLnIgKyBuKTsKICAgIH0KfQpjbGFzcyBBYnN0cmFjdEJ1ZkJhc2UgewogICAgYnVmOwogICAgdXNlZEJ1ZmZlckJ5dGVzID0gMDsKICAgIGVyciA9IG51bGw7CiAgICBzaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLmJ1Zi5ieXRlTGVuZ3RoOwogICAgfQogICAgYXZhaWxhYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLmJ1Zi5ieXRlTGVuZ3RoIC0gdGhpcy51c2VkQnVmZmVyQnl0ZXM7CiAgICB9CiAgICBidWZmZXJlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy51c2VkQnVmZmVyQnl0ZXM7CiAgICB9Cn0KY2xhc3MgQnVmV3JpdGVyIGV4dGVuZHMgQWJzdHJhY3RCdWZCYXNlIHsKICAgIHdyaXRlcjsKICAgIHN0YXRpYyBjcmVhdGUod3JpdGVyLCBzaXplID0gNDA5NikgewogICAgICAgIHJldHVybiB3cml0ZXIgaW5zdGFuY2VvZiBCdWZXcml0ZXIgPyB3cml0ZXIgOiBuZXcgQnVmV3JpdGVyKHdyaXRlciwgc2l6ZSk7CiAgICB9CiAgICBjb25zdHJ1Y3Rvcih3cml0ZXIxLCBzaXplMiA9IDQwOTYpewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy53cml0ZXIgPSB3cml0ZXIxOwogICAgICAgIGlmIChzaXplMiA8PSAwKSB7CiAgICAgICAgICAgIHNpemUyID0gREVGQVVMVF9CVUZfU0laRTsKICAgICAgICB9CiAgICAgICAgdGhpcy5idWYgPSBuZXcgVWludDhBcnJheShzaXplMik7CiAgICB9CiAgICByZXNldCh3KSB7CiAgICAgICAgdGhpcy5lcnIgPSBudWxsOwogICAgICAgIHRoaXMudXNlZEJ1ZmZlckJ5dGVzID0gMDsKICAgICAgICB0aGlzLndyaXRlciA9IHc7CiAgICB9CiAgICBhc3luYyBmbHVzaCgpIHsKICAgICAgICBpZiAodGhpcy5lcnIgIT09IG51bGwpIHRocm93IHRoaXMuZXJyOwogICAgICAgIGlmICh0aGlzLnVzZWRCdWZmZXJCeXRlcyA9PT0gMCkgcmV0dXJuOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IERlbm8ud3JpdGVBbGwodGhpcy53cml0ZXIsIHRoaXMuYnVmLnN1YmFycmF5KDAsIHRoaXMudXNlZEJ1ZmZlckJ5dGVzKSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICB0aGlzLmVyciA9IGU7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICAgIHRoaXMuYnVmID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWYubGVuZ3RoKTsKICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyA9IDA7CiAgICB9CiAgICBhc3luYyB3cml0ZShkYXRhKSB7CiAgICAgICAgaWYgKHRoaXMuZXJyICE9PSBudWxsKSB0aHJvdyB0aGlzLmVycjsKICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDApIHJldHVybiAwOwogICAgICAgIGxldCB0b3RhbEJ5dGVzV3JpdHRlbiA9IDA7CiAgICAgICAgbGV0IG51bUJ5dGVzV3JpdHRlbiA9IDA7CiAgICAgICAgd2hpbGUoZGF0YS5ieXRlTGVuZ3RoID4gdGhpcy5hdmFpbGFibGUoKSl7CiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZlcmVkKCkgPT09IDApIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbnVtQnl0ZXNXcml0dGVuID0gYXdhaXQgdGhpcy53cml0ZXIud3JpdGUoZGF0YSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnIgPSBlOwogICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5KGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmZsdXNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG90YWxCeXRlc1dyaXR0ZW4gKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgICAgICBkYXRhID0gZGF0YS5zdWJhcnJheShudW1CeXRlc1dyaXR0ZW4pOwogICAgICAgIH0KICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5KGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgIHRvdGFsQnl0ZXNXcml0dGVuICs9IG51bUJ5dGVzV3JpdHRlbjsKICAgICAgICByZXR1cm4gdG90YWxCeXRlc1dyaXR0ZW47CiAgICB9Cn0KY2xhc3MgQnVmV3JpdGVyU3luYyBleHRlbmRzIEFic3RyYWN0QnVmQmFzZSB7CiAgICB3cml0ZXI7CiAgICBzdGF0aWMgY3JlYXRlKHdyaXRlciwgc2l6ZSA9IDQwOTYpIHsKICAgICAgICByZXR1cm4gd3JpdGVyIGluc3RhbmNlb2YgQnVmV3JpdGVyU3luYyA/IHdyaXRlciA6IG5ldyBCdWZXcml0ZXJTeW5jKHdyaXRlciwgc2l6ZSk7CiAgICB9CiAgICBjb25zdHJ1Y3Rvcih3cml0ZXIyLCBzaXplMyA9IDQwOTYpewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy53cml0ZXIgPSB3cml0ZXIyOwogICAgICAgIGlmIChzaXplMyA8PSAwKSB7CiAgICAgICAgICAgIHNpemUzID0gREVGQVVMVF9CVUZfU0laRTsKICAgICAgICB9CiAgICAgICAgdGhpcy5idWYgPSBuZXcgVWludDhBcnJheShzaXplMyk7CiAgICB9CiAgICByZXNldCh3KSB7CiAgICAgICAgdGhpcy5lcnIgPSBudWxsOwogICAgICAgIHRoaXMudXNlZEJ1ZmZlckJ5dGVzID0gMDsKICAgICAgICB0aGlzLndyaXRlciA9IHc7CiAgICB9CiAgICBmbHVzaCgpIHsKICAgICAgICBpZiAodGhpcy5lcnIgIT09IG51bGwpIHRocm93IHRoaXMuZXJyOwogICAgICAgIGlmICh0aGlzLnVzZWRCdWZmZXJCeXRlcyA9PT0gMCkgcmV0dXJuOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIERlbm8ud3JpdGVBbGxTeW5jKHRoaXMud3JpdGVyLCB0aGlzLmJ1Zi5zdWJhcnJheSgwLCB0aGlzLnVzZWRCdWZmZXJCeXRlcykpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdGhpcy5lcnIgPSBlOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgICAgICB0aGlzLmJ1ZiA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmLmxlbmd0aCk7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgPSAwOwogICAgfQogICAgd3JpdGVTeW5jKGRhdGEpIHsKICAgICAgICBpZiAodGhpcy5lcnIgIT09IG51bGwpIHRocm93IHRoaXMuZXJyOwogICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7CiAgICAgICAgbGV0IHRvdGFsQnl0ZXNXcml0dGVuID0gMDsKICAgICAgICBsZXQgbnVtQnl0ZXNXcml0dGVuID0gMDsKICAgICAgICB3aGlsZShkYXRhLmJ5dGVMZW5ndGggPiB0aGlzLmF2YWlsYWJsZSgpKXsKICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyZWQoKSA9PT0gMCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSB0aGlzLndyaXRlci53cml0ZVN5bmMoZGF0YSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnIgPSBlOwogICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5KGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgICAgICAgICB0aGlzLmZsdXNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG90YWxCeXRlc1dyaXR0ZW4gKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgICAgICBkYXRhID0gZGF0YS5zdWJhcnJheShudW1CeXRlc1dyaXR0ZW4pOwogICAgICAgIH0KICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5KGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgIHRvdGFsQnl0ZXNXcml0dGVuICs9IG51bUJ5dGVzV3JpdHRlbjsKICAgICAgICByZXR1cm4gdG90YWxCeXRlc1dyaXR0ZW47CiAgICB9Cn0KY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpOwpjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7CmNsYXNzIENsaWVudFV0aWwgewogICAgc3RhdGljIGdldERlZmF1bHRQb3J0KHRyYW5zcG9ydGVyVHlwZSkgewogICAgICAgIHN3aXRjaCh0cmFuc3BvcnRlclR5cGUpewogICAgICAgICAgICBjYXNlICJUQ1AiOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUcmFuc3BvcnRlciBUQ1AgcmVxdWlyZXMgcG9ydCB0byBiZSBhc3NpZ25lZCIpOwogICAgICAgICAgICBjYXNlICJSRURJUyI6CiAgICAgICAgICAgICAgICByZXR1cm4gNjM3OTsKICAgICAgICAgICAgY2FzZSAiQU1RUCI6CiAgICAgICAgICAgICAgICByZXR1cm4gNTY3MjsKICAgICAgICAgICAgY2FzZSAiTkFUUyI6CiAgICAgICAgICAgICAgICByZXR1cm4gNDIyMjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRGVmYXVsdCBwb3J0IGNhbm5vdCBiZSByZWFkIGJlY2F1c2UgdHJhbnNwb3J0ZXIgaXMgbm90IHBhcnQgb2YgdGhlIGJ1aWx0LWluIGNsaWVudHMiKTsKICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgcmVzaXplVHlwZWRBcnJheShiYXNlQXJyYXlCdWZmZXIsIG5ld0J5dGVTaXplKSB7CiAgICAgICAgdmFyIHJlc2l6ZWRBcnJheUJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihuZXdCeXRlU2l6ZSksIGxlbiA9IGJhc2VBcnJheUJ1ZmZlci5ieXRlTGVuZ3RoLCByZXNpemVMZW4gPSBsZW4gPiBuZXdCeXRlU2l6ZSA/IG5ld0J5dGVTaXplIDogbGVuOwogICAgICAgIG5ldyBVaW50OEFycmF5KHJlc2l6ZWRBcnJheUJ1ZmZlciwgMCwgcmVzaXplTGVuKS5zZXQobmV3IFVpbnQ4QXJyYXkoYmFzZUFycmF5QnVmZmVyLCAwLCByZXNpemVMZW4pKTsKICAgICAgICByZXR1cm4gcmVzaXplZEFycmF5QnVmZmVyOwogICAgfQp9CmZ1bmN0aW9uIGNoYXJDb2RlKHR5cGUpIHsKICAgIHJldHVybiB0eXBlLmNoYXJDb2RlQXQoMCk7Cn0KZnVuY3Rpb24gZnJvbUNoYXJDb2RlKGNvZGUpIHsKICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoWwogICAgICAgIGNvZGUKICAgIF0pKTsKfQp2YXIgVGFibGVGaWVsZFR5cGU7CihmdW5jdGlvbihUYWJsZUZpZWxkVHlwZTEpIHsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkJvb2xlYW4iXSA9IGNoYXJDb2RlKCJ0IildID0gIkJvb2xlYW4iOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiU2hvcnRTaG9ydEludCJdID0gY2hhckNvZGUoImIiKV0gPSAiU2hvcnRTaG9ydEludCI7CiAgICBUYWJsZUZpZWxkVHlwZTFbVGFibGVGaWVsZFR5cGUxWyJTaG9ydFNob3J0VUludCJdID0gY2hhckNvZGUoIkIiKV0gPSAiU2hvcnRTaG9ydFVJbnQiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiU2hvcnRJbnQiXSA9IGNoYXJDb2RlKCJzIildID0gIlNob3J0SW50IjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIlNob3J0VUludCJdID0gY2hhckNvZGUoInUiKV0gPSAiU2hvcnRVSW50IjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkxvbmdJbnQiXSA9IGNoYXJDb2RlKCJJIildID0gIkxvbmdJbnQiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiTG9uZ1VJbnQiXSA9IGNoYXJDb2RlKCJpIildID0gIkxvbmdVSW50IjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkxvbmdMb25nSW50Il0gPSBjaGFyQ29kZSgibCIpXSA9ICJMb25nTG9uZ0ludCI7CiAgICBUYWJsZUZpZWxkVHlwZTFbVGFibGVGaWVsZFR5cGUxWyJGbG9hdCJdID0gY2hhckNvZGUoImYiKV0gPSAiRmxvYXQiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiRG91YmxlIl0gPSBjaGFyQ29kZSgiZCIpXSA9ICJEb3VibGUiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiRGVjaW1hbCJdID0gY2hhckNvZGUoIkQiKV0gPSAiRGVjaW1hbCI7CiAgICBUYWJsZUZpZWxkVHlwZTFbVGFibGVGaWVsZFR5cGUxWyJMb25nU3RyIl0gPSBjaGFyQ29kZSgiUyIpXSA9ICJMb25nU3RyIjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkZpZWxkQXJyYXkiXSA9IGNoYXJDb2RlKCJBIildID0gIkZpZWxkQXJyYXkiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiVGltZXN0YW1wIl0gPSBjaGFyQ29kZSgiVCIpXSA9ICJUaW1lc3RhbXAiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiRmllbGRUYWJsZSJdID0gY2hhckNvZGUoIkYiKV0gPSAiRmllbGRUYWJsZSI7CiAgICBUYWJsZUZpZWxkVHlwZTFbVGFibGVGaWVsZFR5cGUxWyJOb1ZhbHVlIl0gPSBjaGFyQ29kZSgiViIpXSA9ICJOb1ZhbHVlIjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkJ5dGVBcnJheSJdID0gY2hhckNvZGUoIngiKV0gPSAiQnl0ZUFycmF5IjsKfSkoVGFibGVGaWVsZFR5cGUgfHwgKFRhYmxlRmllbGRUeXBlID0gewp9KSk7CmZ1bmN0aW9uIHBhZEFycmF5KGFycmF5LCBzaXplNCwgdmFsdWUpIHsKICAgIGNvbnN0IHBhZGRpbmcgPSBBcnJheS5mcm9tKHsKICAgICAgICBsZW5ndGg6IHNpemU0IC0gYXJyYXkubGVuZ3RoCiAgICB9KS5maWxsKHZhbHVlKTsKICAgIHJldHVybiBhcnJheS5jb25jYXQoLi4ucGFkZGluZyk7Cn0KZnVuY3Rpb24gY2hhckNvZGUxKHR5cGUpIHsKICAgIHJldHVybiB0eXBlLmNoYXJDb2RlQXQoMCk7Cn0KZnVuY3Rpb24gYXNzZXJ0VW5yZWFjaGFibGUoX3gpIHsKICAgIHRocm93IG5ldyBFcnJvcihgVW5yZWFjaGFibGUgY29kZSBleGVjdXRlZGApOwp9CmNsYXNzIEFtcXBEZWNvZGVyIHsKICAgICNkYXRhOwogICAgI29mZnNldCA9IDA7CiAgICAjdmlldzsKICAgICN0ZXh0RGVjb2RlcjsKICAgICNiaXRGaWVsZCA9IG51bGw7CiAgICAjYml0UG9pbnRlciA9IDc7CiAgICBjb25zdHJ1Y3RvcihkYXRhMSl7CiAgICAgICAgdGhpcy4jZGF0YSA9IGRhdGExOwogICAgICAgIHRoaXMuI3ZpZXcgPSBuZXcgRGF0YVZpZXcoZGF0YTEuYnVmZmVyKTsKICAgICAgICB0aGlzLiN0ZXh0RGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOwogICAgfQogICAgI2ZvcndhcmQgPSAobik9PnsKICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy4jb2Zmc2V0OwogICAgICAgIHRoaXMuI29mZnNldCArPSBuOwogICAgICAgIGlmICh0aGlzLiNvZmZzZXQgPiB0aGlzLiNkYXRhLmxlbmd0aCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBlbm91Z2ggZGF0YSBpbiBkZWNvZGVyIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjdXJyZW50OwogICAgfTsKICAgICN1aW50OCA9ICgpPT50aGlzLiN2aWV3LmdldFVpbnQ4KHRoaXMuI2ZvcndhcmQoMSkpCiAgICA7CiAgICAjdWludDE2ID0gKCk9PnRoaXMuI3ZpZXcuZ2V0VWludDE2KHRoaXMuI2ZvcndhcmQoMikpCiAgICA7CiAgICAjdWludDMyID0gKCk9PnRoaXMuI3ZpZXcuZ2V0VWludDMyKHRoaXMuI2ZvcndhcmQoNCkpCiAgICA7CiAgICAjdWludDY0ID0gKCk9PnsKICAgICAgICBjb25zdCByZXN1bHQgPSBOdW1iZXIodGhpcy4jdmlldy5nZXRCaWdVaW50NjQodGhpcy4jZm9yd2FyZCg4KSkpOwogICAgICAgIGlmICghTnVtYmVyLmlzU2FmZUludGVnZXIocmVzdWx0KSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRyaWVkIHRvIGRlY29kZSB1bnNhZmUgaW50ZWdlcmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgICNpbnQ4ID0gKCk9PnRoaXMuI3ZpZXcuZ2V0SW50OCh0aGlzLiNmb3J3YXJkKDEpKQogICAgOwogICAgI2ludDE2ID0gKCk9PnRoaXMuI3ZpZXcuZ2V0SW50MTYodGhpcy4jZm9yd2FyZCgyKSkKICAgIDsKICAgICNpbnQzMiA9ICgpPT50aGlzLiN2aWV3LmdldEludDMyKHRoaXMuI2ZvcndhcmQoNCkpCiAgICA7CiAgICAjaW50NjQgPSAoKT0+ewogICAgICAgIGNvbnN0IG51bSA9IE51bWJlcih0aGlzLiN2aWV3LmdldEJpZ0ludDY0KHRoaXMuI2ZvcndhcmQoOCkpKTsKICAgICAgICBpZiAoIU51bWJlci5pc1NhZmVJbnRlZ2VyKG51bSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZWNlaXZlZCB1bnNhZmUgaW50ZWdlcmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVtOwogICAgfTsKICAgICNmbG9hdDMyID0gKCk9PnsKICAgICAgICByZXR1cm4gdGhpcy4jdmlldy5nZXRGbG9hdDMyKHRoaXMuI2ZvcndhcmQoNCkpOwogICAgfTsKICAgICNmbG9hdDY0ID0gKCk9PnsKICAgICAgICByZXR1cm4gdGhpcy4jdmlldy5nZXRGbG9hdDY0KHRoaXMuI2ZvcndhcmQoOCkpOwogICAgfTsKICAgICNieXRlcyA9IChsZW5ndGgpPT57CiAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLiNmb3J3YXJkKGxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHRoaXMuI2RhdGEuc2xpY2Uoc3RhcnQsIHRoaXMuI29mZnNldCk7CiAgICB9OwogICAgI3RleHQgPSAobGVuZ3RoKT0+ewogICAgICAgIHJldHVybiB0aGlzLiN0ZXh0RGVjb2Rlci5kZWNvZGUodGhpcy4jYnl0ZXMobGVuZ3RoKSk7CiAgICB9OwogICAgI3Nob3J0c3RyID0gKCk9PnsKICAgICAgICBjb25zdCBzaXplNCA9IHRoaXMuI3VpbnQ4KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuI3RleHQoc2l6ZTQpOwogICAgfTsKICAgICNsb25nc3RyID0gKCk9PnsKICAgICAgICBjb25zdCBzaXplNCA9IHRoaXMuI3VpbnQzMigpOwogICAgICAgIHJldHVybiB0aGlzLiN0ZXh0KHNpemU0KTsKICAgIH07CiAgICAjYml0ID0gKCk9PnsKICAgICAgICBpZiAodGhpcy4jYml0RmllbGQgPT09IG51bGwgfHwgdGhpcy4jYml0UG9pbnRlciA8IDApIHsKICAgICAgICAgICAgdGhpcy4jYml0RmllbGQgPSB0aGlzLiN1aW50OCgpOwogICAgICAgICAgICB0aGlzLiNiaXRQb2ludGVyID0gNzsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmFsdWUgPSAhISh0aGlzLiNiaXRGaWVsZCAmIDEgPDwgdGhpcy4jYml0UG9pbnRlci0tKTsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9OwogICAgI3RhYmxlID0gKCk9PnsKICAgICAgICBjb25zdCBsZW5ndGggPSB0aGlzLiN1aW50MzIoKTsKICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLiNvZmZzZXQgKyBsZW5ndGg7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gewogICAgICAgIH07CiAgICAgICAgd2hpbGUodGhpcy4jb2Zmc2V0IDwgdGFyZ2V0KXsKICAgICAgICAgICAgY29uc3QgZmllbGROYW1lID0gdGhpcy4jc2hvcnRzdHIoKTsKICAgICAgICAgICAgY29uc3QgZmllbGRWYWx1ZSA9IHRoaXMuI3RhYmxlRmllbGQoKTsKICAgICAgICAgICAgcmVzdWx0W2ZpZWxkTmFtZV0gPSBmaWVsZFZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgICN0YWJsZUZpZWxkID0gKCk9PnsKICAgICAgICBjb25zdCB0eXBlID0gdGhpcy4jdWludDgoKTsKICAgICAgICBzd2l0Y2godHlwZSl7CiAgICAgICAgICAgIGNhc2UgVGFibGVGaWVsZFR5cGUuQm9vbGVhbjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN1aW50OCgpID4gMDsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5TaG9ydFNob3J0VUludDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN1aW50OCgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLlNob3J0U2hvcnRJbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jaW50OCgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLlNob3J0VUludDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN1aW50MTYoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5TaG9ydEludDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNpbnQxNigpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLkxvbmdVSW50OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3VpbnQzMigpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLkxvbmdJbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jaW50MzIoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5Mb25nTG9uZ0ludDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNpbnQ2NCgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLkZsb2F0OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2Zsb2F0MzIoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5Eb3VibGU6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jZmxvYXQ2NCgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLkRlY2ltYWw6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbnQgZGVjb2RlIGRlY2ltYWwiKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5Mb25nU3RyOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2xvbmdzdHIoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5GaWVsZEFycmF5OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3RhYmxlQXJyYXkoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5UaW1lc3RhbXA6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDY0KCk7CiAgICAgICAgICAgIGNhc2UgVGFibGVGaWVsZFR5cGUuRmllbGRUYWJsZToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN0YWJsZSgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLk5vVmFsdWU6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5CeXRlQXJyYXk6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdGFibGVCeXRlcygpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHRhYmxlIGZpZWxkIHR5cGUgJHtmcm9tQ2hhckNvZGUodHlwZSl9YCk7CiAgICAgICAgfQogICAgfTsKICAgICN0YWJsZUFycmF5ID0gKCk9PnsKICAgICAgICBjb25zdCBsZW5ndGggPSB0aGlzLiN1aW50MzIoKTsKICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLiNvZmZzZXQgKyBsZW5ndGg7CiAgICAgICAgY29uc3QgYXJyYXkgPSBbXTsKICAgICAgICB3aGlsZSh0aGlzLiNvZmZzZXQgPCB0YXJnZXQpewogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuI3RhYmxlRmllbGQoKTsKICAgICAgICAgICAgYXJyYXkucHVzaCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheTsKICAgIH07CiAgICAjdGFibGVCeXRlcyA9ICgpPT57CiAgICAgICAgY29uc3QgbGVuZ3RoID0gdGhpcy4jdWludDMyKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuI2J5dGVzKGxlbmd0aCk7CiAgICB9OwogICAgI2ZsYWdzID0gKCk9PnsKICAgICAgICBjb25zdCBmbGFncyA9IFtdOwogICAgICAgIGxldCBiaXRzID0gW107CiAgICAgICAgd2hpbGUoIWZsYWdzLmxlbmd0aCB8fCBiaXRzW2JpdHMubGVuZ3RoIC0gMV0pewogICAgICAgICAgICBjb25zdCBmaWVsZCA9IHRoaXMuI3VpbnQxNigpOwogICAgICAgICAgICBiaXRzID0gW107CiAgICAgICAgICAgIGZvcihsZXQgaSA9IDE1OyBpID49IDA7IC0taSl7CiAgICAgICAgICAgICAgICBiaXRzLnB1c2goISEoZmllbGQgJiAxIDw8IGkpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbGFncy5wdXNoKC4uLmJpdHMuc2xpY2UoMCwgMTUpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZsYWdzOwogICAgfTsKICAgIHJlYWQodHlwZSkgewogICAgICAgIHN3aXRjaCh0eXBlKXsKICAgICAgICAgICAgY2FzZSAidWludDgiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3VpbnQ4KCk7CiAgICAgICAgICAgIGNhc2UgInVpbnQxNiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDE2KCk7CiAgICAgICAgICAgIGNhc2UgInVpbnQzMiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDMyKCk7CiAgICAgICAgICAgIGNhc2UgInVpbnQ2NCI6CiAgICAgICAgICAgIGNhc2UgInRpbWVzdGFtcCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDY0KCk7CiAgICAgICAgICAgIGNhc2UgImludDgiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ludDgoKTsKICAgICAgICAgICAgY2FzZSAiaW50MTYiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ludDE2KCk7CiAgICAgICAgICAgIGNhc2UgImludDMyIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNpbnQzMigpOwogICAgICAgICAgICBjYXNlICJpbnQ2NCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jaW50NjQoKTsKICAgICAgICAgICAgY2FzZSAiZmxvYXQzMiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jZmxvYXQzMigpOwogICAgICAgICAgICBjYXNlICJmbG9hdDY0IjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNmbG9hdDY0KCk7CiAgICAgICAgICAgIGNhc2UgImJpdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jYml0KCk7CiAgICAgICAgICAgIGNhc2UgImZsYWdzIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNmbGFncygpOwogICAgICAgICAgICBjYXNlICJ0YWJsZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdGFibGUoKTsKICAgICAgICAgICAgY2FzZSAic2hvcnRzdHIiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3Nob3J0c3RyKCk7CiAgICAgICAgICAgIGNhc2UgImxvbmdzdHIiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2xvbmdzdHIoKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGFzc2VydFVucmVhY2hhYmxlKHR5cGUpOwogICAgICAgIH0KICAgIH0KfQpjb25zdCBDSEFSQ09ERV9BID0gY2hhckNvZGUxKCJBIik7CmNvbnN0IENIQVJDT0RFX1ogPSBjaGFyQ29kZTEoIloiKTsKY29uc3QgQ0hBUkNPREVfYSA9IGNoYXJDb2RlMSgiYSIpOwpjb25zdCBDSEFSQ09ERV96ID0gY2hhckNvZGUxKCJ6Iik7CmNvbnN0IENIQVJDT0RFX3VuZGVyc2NvcmUgPSBjaGFyQ29kZTEoIl8iKTsKY29uc3QgQ0hBUkNPREVfZG9sbGFyID0gY2hhckNvZGUxKCIkIik7CmNvbnN0IENIQVJDT0RFX2hhc2ggPSBjaGFyQ29kZTEoIiMiKTsKY29uc3QgdmFsaWRDaGFycyA9IFsKICAgIENIQVJDT0RFX2RvbGxhciwKICAgIENIQVJDT0RFX2hhc2gsCiAgICBDSEFSQ09ERV91bmRlcnNjb3JlCl07CmZ1bmN0aW9uIGlzQWxwaGEoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPj0gQ0hBUkNPREVfQSAmJiBjb2RlIDw9IENIQVJDT0RFX1ogfHwgY29kZSA+PSBDSEFSQ09ERV9hICYmIGNvZGUgPD0gQ0hBUkNPREVfejsKfQpmdW5jdGlvbiBpc051bWVyaWMoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPj0gNDcgJiYgY29kZSA8PSA1ODsKfQpmdW5jdGlvbiBpc0FsbG93ZWRDaGFyYXRhY3Rlcihjb2RlKSB7CiAgICByZXR1cm4gaXNBbHBoYShjb2RlKSB8fCBpc051bWVyaWMoY29kZSkgfHwgdmFsaWRDaGFycy5pbmNsdWRlcyhjb2RlKTsKfQpmdW5jdGlvbiBhc3NlcnRWYWxpZEZpZWxkTmFtZShuYW1lKSB7CiAgICBpZiAoIWlzQWxwaGEobmFtZS5jaGFyQ29kZUF0KDApKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBmaWVsZCBuYW1lICcke25hbWV9J2ApOwogICAgfQogICAgZm9yKGxldCBpID0gMTsgaSA8IG5hbWUubGVuZ3RoOyBpKyspewogICAgICAgIGlmICghaXNBbGxvd2VkQ2hhcmF0YWN0ZXIobmFtZS5jaGFyQ29kZUF0KGkpKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZmllbGQgbmFtZSAnJHtuYW1lfSdgKTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gc3BsaXRBcnJheShhcnIsIHNpemU0KSB7CiAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgIGxldCBpbmRleCA9IDA7CiAgICB3aGlsZShpbmRleCA8IGFyci5sZW5ndGgpewogICAgICAgIGNodW5rcy5wdXNoKGFyci5zbGljZShpbmRleCwgc2l6ZTQgKyBpbmRleCkpOwogICAgICAgIGluZGV4ICs9IHNpemU0OwogICAgfQogICAgcmV0dXJuIGNodW5rczsKfQpmdW5jdGlvbiB3cml0ZUJpdEZpZWxkKGJpdHMpIHsKICAgIGlmIChiaXRzLmxlbmd0aCA+IDgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvbyBtYW55IGJpdHMgdG8gZml0IGluIG9uZSBieXRlYCk7CiAgICB9CiAgICBjb25zdCBmaWVsZCA9IChiaXRzWzddID8gMTI4IDogMCkgfCAoYml0c1s2XSA/IDY0IDogMCkgfCAoYml0c1s1XSA/IDMyIDogMCkgfCAoYml0c1s0XSA/IDE2IDogMCkgfCAoYml0c1szXSA/IDggOiAwKSB8IChiaXRzWzJdID8gNCA6IDApIHwgKGJpdHNbMV0gPyAyIDogMCkgfCAoYml0c1swXSA/IDEgOiAwKTsKICAgIHJldHVybiBmaWVsZDsKfQpmdW5jdGlvbiBvdXRPZlJhbmdlKHR5cGUsIHZhbHVlKSB7CiAgICByZXR1cm4gYHZhbHVlICcke3ZhbHVlfScgaXMgb3V0IG9mIHJhbmdlIGZvciB0eXBlICcke3R5cGV9J2A7Cn0KY2xhc3MgQW1xcEVuY29kZXIgewogICAgI2J1ZjsKICAgICN2aWV3OwogICAgI29mZnNldCA9IDA7CiAgICAjaW5jcmVtZW50OwogICAgI3RleHRFbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7CiAgICAjcGVuZGluZ0JpdHMgPSBbXTsKICAgIGNvbnN0cnVjdG9yKHNpemU0ID0gNDA5Nil7CiAgICAgICAgdGhpcy4jaW5jcmVtZW50ID0gc2l6ZTQ7CiAgICAgICAgdGhpcy4jYnVmID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZTQpOwogICAgICAgIHRoaXMuI3ZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy4jYnVmLmJ1ZmZlcik7CiAgICB9CiAgICAjZm9yd2FyZCA9IChzaXplNSk9PnsKICAgICAgICBjb25zdCBzdGFydCA9IHRoaXMuI29mZnNldDsKICAgICAgICB0aGlzLiNvZmZzZXQgPSB0aGlzLiNvZmZzZXQgKyBzaXplNTsKICAgICAgICBpZiAodGhpcy4jYnVmLmxlbmd0aCA8IHRoaXMuI29mZnNldCkgewogICAgICAgICAgICBjb25zdCBidWYgPSBuZXcgVWludDhBcnJheSh0aGlzLiNidWYubGVuZ3RoICsgdGhpcy4jaW5jcmVtZW50KTsKICAgICAgICAgICAgYnVmLnNldCh0aGlzLiNidWYsIDApOwogICAgICAgICAgICB0aGlzLiNidWYgPSBidWY7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdGFydDsKICAgIH07CiAgICAjZmx1c2hCaXRzID0gKCk9PnsKICAgICAgICBpZiAodGhpcy4jcGVuZGluZ0JpdHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMuI2JpdHModGhpcy4jcGVuZGluZ0JpdHMpOwogICAgICAgICAgICB0aGlzLiNwZW5kaW5nQml0cy5zcGxpY2UoMCwgdGhpcy4jcGVuZGluZ0JpdHMubGVuZ3RoKTsKICAgICAgICB9CiAgICB9OwogICAgI3VpbnQ4ID0gKHZhbHVlKT0+ewogICAgICAgIGlmICh2YWx1ZSA8IDAgfHwgdmFsdWUgPiAyNTUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG91dE9mUmFuZ2UoInVpbnQ4IiwgdmFsdWUpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4jdmlldy5zZXRVaW50OCh0aGlzLiNmb3J3YXJkKDEpLCB2YWx1ZSk7CiAgICB9OwogICAgI3VpbnQxNiA9ICh2YWx1ZSk9PnsKICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID4gNjU1MzUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG91dE9mUmFuZ2UoInVpbnQxNiIsIHZhbHVlKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuI3ZpZXcuc2V0VWludDE2KHRoaXMuI2ZvcndhcmQoMiksIHZhbHVlKTsKICAgIH07CiAgICAjdWludDMyID0gKHZhbHVlKT0+ewogICAgICAgIGlmICh2YWx1ZSA8IDAgfHwgdmFsdWUgPiA0Mjk0OTY3Mjk1KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvdXRPZlJhbmdlKCJ1aW50MzIiLCB2YWx1ZSkpOwogICAgICAgIH0KICAgICAgICB0aGlzLiN2aWV3LnNldFVpbnQzMih0aGlzLiNmb3J3YXJkKDQpLCB2YWx1ZSk7CiAgICB9OwogICAgI3VpbnQ2NCA9ICh2YWx1ZSk9PnsKICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG91dE9mUmFuZ2UoInVpbnQzMiIsIHZhbHVlKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuI3ZpZXcuc2V0QmlnVWludDY0KHRoaXMuI2ZvcndhcmQoOCksIEJpZ0ludCh2YWx1ZSkpOwogICAgfTsKICAgICNpbnQ4ID0gKHZhbHVlKT0+ewogICAgICAgIHRoaXMuI3ZpZXcuc2V0SW50OCh0aGlzLiNmb3J3YXJkKDEpLCB2YWx1ZSk7CiAgICB9OwogICAgI2ludDE2ID0gKHZhbHVlKT0+ewogICAgICAgIHRoaXMuI3ZpZXcuc2V0SW50MTYodGhpcy4jZm9yd2FyZCgyKSwgdmFsdWUpOwogICAgfTsKICAgICNpbnQzMiA9ICh2YWx1ZSk9PnsKICAgICAgICB0aGlzLiN2aWV3LnNldEludDMyKHRoaXMuI2ZvcndhcmQoNCksIHZhbHVlKTsKICAgIH07CiAgICAjaW50NjQgPSAodmFsdWUpPT57CiAgICAgICAgdGhpcy4jdmlldy5zZXRCaWdJbnQ2NCh0aGlzLiNmb3J3YXJkKDgpLCBCaWdJbnQodmFsdWUpKTsKICAgIH07CiAgICAjZmxvYXQzMiA9ICh2YWx1ZSk9PnsKICAgICAgICB0aGlzLiN2aWV3LnNldEZsb2F0MzIodGhpcy4jZm9yd2FyZCg0KSwgdmFsdWUpOwogICAgfTsKICAgICNmbG9hdDY0ID0gKHZhbHVlKT0+ewogICAgICAgIHRoaXMuI3ZpZXcuc2V0RmxvYXQ2NCh0aGlzLiNmb3J3YXJkKDgpLCB2YWx1ZSk7CiAgICB9OwogICAgI2J5dGVzID0gKGRhdGExKT0+ewogICAgICAgIHRoaXMuI2J1Zi5zZXQoZGF0YTEsIHRoaXMuI2ZvcndhcmQoZGF0YTEubGVuZ3RoKSk7CiAgICB9OwogICAgI3Nob3J0U3RyaW5nID0gKHR4dCk9PnsKICAgICAgICBjb25zdCBkYXRhMSA9IHRoaXMuI3RleHRFbmNvZGVyLmVuY29kZSh0eHQpOwogICAgICAgIGlmIChkYXRhMS5sZW5ndGggPiAyNTUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTdHJpbmcgdG9vIGxvbmcgZm9yIHNob3J0c3RyaW5nYCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuI3VpbnQ4KGRhdGExLmxlbmd0aCk7CiAgICAgICAgdGhpcy4jYnl0ZXMoZGF0YTEpOwogICAgfTsKICAgICNsb25nU3RyaW5nID0gKHR4dCk9PnsKICAgICAgICBjb25zdCBkYXRhMSA9IHRoaXMuI3RleHRFbmNvZGVyLmVuY29kZSh0eHQpOwogICAgICAgIHRoaXMuI3VpbnQzMihkYXRhMS5sZW5ndGgpOwogICAgICAgIHRoaXMuI2J5dGVzKGRhdGExKTsKICAgIH07CiAgICAjYml0cyA9ICh2YWx1ZXMpPT57CiAgICAgICAgY29uc3QgYnl0ZXMgPSBzcGxpdEFycmF5KHZhbHVlcywgOCkubWFwKChzKT0+cGFkQXJyYXkocywgOCwgZmFsc2UpCiAgICAgICAgKS5mbGF0TWFwKHdyaXRlQml0RmllbGQpOwogICAgICAgIHRoaXMuI2J5dGVzKGJ5dGVzKTsKICAgIH07CiAgICAjYml0ID0gKHZhbHVlKT0+ewogICAgICAgIHRoaXMuI3BlbmRpbmdCaXRzLnB1c2godmFsdWUpOwogICAgfTsKICAgICN0YWJsZSA9ICh0YWJsZSk9PnsKICAgICAgICBjb25zdCBzdGFydCA9IHRoaXMuI2ZvcndhcmQoNCk7CiAgICAgICAgZm9yIChjb25zdCBmaWVsZE5hbWUgb2YgT2JqZWN0LmtleXModGFibGUpKXsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0YWJsZVtmaWVsZE5hbWVdOwogICAgICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgYXNzZXJ0VmFsaWRGaWVsZE5hbWUoZmllbGROYW1lKTsKICAgICAgICAgICAgICAgIHRoaXMud3JpdGUoInNob3J0c3RyIiwgZmllbGROYW1lKTsKICAgICAgICAgICAgICAgIHRoaXMuI3R5cGVkRmllbGQodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuI3ZpZXcuc2V0VWludDMyKHN0YXJ0LCB0aGlzLiNvZmZzZXQgLSBzdGFydCAtIDQpOwogICAgfTsKICAgICN0eXBlZEZpZWxkID0gKHZhbHVlKT0+ewogICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHsKICAgICAgICAgICAgdGhpcy4jdWludDgoVGFibGVGaWVsZFR5cGUuQnl0ZUFycmF5KTsKICAgICAgICAgICAgdGhpcy4jdWludDMyKHZhbHVlLmxlbmd0aCk7CiAgICAgICAgICAgIHRoaXMuI2J5dGVzKHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy4jdWludDgoVGFibGVGaWVsZFR5cGUuTm9WYWx1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgaWYgKE1hdGgucm91bmQodmFsdWUpICE9PSB2YWx1ZSB8fCAhTnVtYmVyLmlzU2FmZUludGVnZXIodmFsdWUpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiN1aW50OChUYWJsZUZpZWxkVHlwZS5Eb3VibGUpOwogICAgICAgICAgICAgICAgdGhpcy4jZmxvYXQ2NCh2YWx1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHZhbHVlID49IC0xMjggJiYgdmFsdWUgPCAxMjgpIHsKICAgICAgICAgICAgICAgIHRoaXMuI3VpbnQ4KFRhYmxlRmllbGRUeXBlLlNob3J0U2hvcnRJbnQpOwogICAgICAgICAgICAgICAgdGhpcy4jaW50OCh2YWx1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHZhbHVlID49IC0zMjc2OCAmJiB2YWx1ZSA8IDMyNzY4KSB7CiAgICAgICAgICAgICAgICB0aGlzLiN1aW50OChUYWJsZUZpZWxkVHlwZS5TaG9ydEludCk7CiAgICAgICAgICAgICAgICB0aGlzLiNpbnQxNih2YWx1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHZhbHVlID49IC0yMTQ3NDgzNjQ4ICYmIHZhbHVlIDwgMjE0NzQ4MzY0OCkgewogICAgICAgICAgICAgICAgdGhpcy4jdWludDgoVGFibGVGaWVsZFR5cGUuTG9uZ0ludCk7CiAgICAgICAgICAgICAgICB0aGlzLiNpbnQzMih2YWx1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy4jdWludDgoVGFibGVGaWVsZFR5cGUuTG9uZ0ludCk7CiAgICAgICAgICAgIHRoaXMuI2ludDY0KHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIikgewogICAgICAgICAgICB0aGlzLiN1aW50OChUYWJsZUZpZWxkVHlwZS5Mb25nU3RyKTsKICAgICAgICAgICAgdGhpcy4jbG9uZ1N0cmluZyh2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgICAgIHRoaXMuI3VpbnQ4KFRhYmxlRmllbGRUeXBlLkZpZWxkQXJyYXkpOwogICAgICAgICAgICBjb25zdCBzID0gdGhpcy4jZm9yd2FyZCg0KTsKICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIHZhbHVlKXsKICAgICAgICAgICAgICAgIHRoaXMuI3R5cGVkRmllbGQodik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy4jdmlldy5zZXRVaW50MzIocywgdGhpcy4jb2Zmc2V0IC0gcyAtIDQpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIHRoaXMuI3VpbnQ4KFRhYmxlRmllbGRUeXBlLkZpZWxkVGFibGUpOwogICAgICAgICAgICB0aGlzLiN0YWJsZSh2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHRoaXMuI3VpbnQ4KFRhYmxlRmllbGRUeXBlLkJvb2xlYW4pOwogICAgICAgICAgICB0aGlzLiN1aW50OCgxKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYERvbid0IGtub3cgaG93IHRvIGVuY29kZSBmaWVsZCBvZiB0eXBlICR7dHlwZW9mIHZhbHVlfSB5ZXRgKTsKICAgIH07CiAgICAjZmxhZ3MgPSAoZmxhZ3MpPT57CiAgICAgICAgY29uc3QgY2h1bmtzID0gc3BsaXRBcnJheShmbGFncywgMTUpOwogICAgICAgIGNodW5rcy5mb3JFYWNoKChjaHVuaywgaW5kZXgpPT57CiAgICAgICAgICAgIGNvbnN0IGJpdHMgPSBbCiAgICAgICAgICAgICAgICAuLi5jaHVuaywKICAgICAgICAgICAgICAgIGluZGV4IDwgY2h1bmtzLmxlbmd0aCAtIDEKICAgICAgICAgICAgXTsKICAgICAgICAgICAgY29uc3QgZmllbGQgPSAoYml0c1swXSA/IDMyNzY4IDogMCkgfCAoYml0c1sxXSA/IDE2Mzg0IDogMCkgfCAoYml0c1syXSA/IDgxOTIgOiAwKSB8IChiaXRzWzNdID8gNDA5NiA6IDApIHwgKGJpdHNbNF0gPyAyMDQ4IDogMCkgfCAoYml0c1s1XSA/IDEwMjQgOiAwKSB8IChiaXRzWzZdID8gNTEyIDogMCkgfCAoYml0c1s3XSA/IDI1NiA6IDApIHwgKGJpdHNbOF0gPyAxMjggOiAwKSB8IChiaXRzWzldID8gNjQgOiAwKSB8IChiaXRzWzEwXSA/IDMyIDogMCkgfCAoYml0c1sxMV0gPyAxNiA6IDApIHwgKGJpdHNbMTJdID8gOCA6IDApIHwgKGJpdHNbMTNdID8gNCA6IDApIHwgKGJpdHNbMTRdID8gMiA6IDApIHwgKGJpdHNbMTVdID8gMSA6IDApOwogICAgICAgICAgICB0aGlzLiN1aW50MTYoZmllbGQpOwogICAgICAgIH0pOwogICAgfTsKICAgIHdyaXRlKHR5cGUsIHZhbHVlKSB7CiAgICAgICAgY29uc3QgZmllbGQgPSB7CiAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgIHZhbHVlCiAgICAgICAgfTsKICAgICAgICBpZiAoZmllbGQudHlwZSAhPT0gImJpdCIpIHsKICAgICAgICAgICAgdGhpcy4jZmx1c2hCaXRzKCk7CiAgICAgICAgfQogICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgc3dpdGNoKGZpZWxkLnR5cGUpewogICAgICAgICAgICBjYXNlICJ1aW50OCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDgoZmllbGQudmFsdWUpOwogICAgICAgICAgICBjYXNlICJ1aW50MTYiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3VpbnQxNihmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgInVpbnQzMiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDMyKGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAidWludDY0IjoKICAgICAgICAgICAgY2FzZSAidGltZXN0YW1wIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN1aW50NjQoZmllbGQudmFsdWUpOwogICAgICAgICAgICBjYXNlICJpbnQ4IjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNpbnQ4KGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAiaW50MTYiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ludDE2KGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAiaW50MzIiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ludDMyKGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAiaW50NjQiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ludDY0KGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAiZmxvYXQzMiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jZmxvYXQzMihmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgImZsb2F0NjQiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2Zsb2F0NjQoZmllbGQudmFsdWUpOwogICAgICAgICAgICBjYXNlICJiaXQiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2JpdChmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgImZsYWdzIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNmbGFncyhmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgInRhYmxlIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN0YWJsZShmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgInNob3J0c3RyIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNzaG9ydFN0cmluZyhmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgImxvbmdzdHIiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2xvbmdTdHJpbmcoZmllbGQudmFsdWUpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgYXNzZXJ0VW5yZWFjaGFibGUoZmllbGQpOwogICAgICAgIH0KICAgIH0KICAgIHJlc3VsdCgpIHsKICAgICAgICB0aGlzLiNmbHVzaEJpdHMoKTsKICAgICAgICByZXR1cm4gdGhpcy4jYnVmLnNsaWNlKDAsIHRoaXMuI29mZnNldCk7CiAgICB9Cn0KY29uc3QgbWV0aG9kTmFtZXMgPSB7CiAgICBbMTBdOiB7CiAgICAgICAgWzEwXTogImNvbm5lY3Rpb24uc3RhcnQiLAogICAgICAgIFsxMV06ICJjb25uZWN0aW9uLnN0YXJ0LW9rIiwKICAgICAgICBbMjBdOiAiY29ubmVjdGlvbi5zZWN1cmUiLAogICAgICAgIFsyMV06ICJjb25uZWN0aW9uLnNlY3VyZS1vayIsCiAgICAgICAgWzMwXTogImNvbm5lY3Rpb24udHVuZSIsCiAgICAgICAgWzMxXTogImNvbm5lY3Rpb24udHVuZS1vayIsCiAgICAgICAgWzQwXTogImNvbm5lY3Rpb24ub3BlbiIsCiAgICAgICAgWzQxXTogImNvbm5lY3Rpb24ub3Blbi1vayIsCiAgICAgICAgWzUwXTogImNvbm5lY3Rpb24uY2xvc2UiLAogICAgICAgIFs1MV06ICJjb25uZWN0aW9uLmNsb3NlLW9rIiwKICAgICAgICBbNjBdOiAiY29ubmVjdGlvbi5ibG9ja2VkIiwKICAgICAgICBbNjFdOiAiY29ubmVjdGlvbi51bmJsb2NrZWQiLAogICAgICAgIFs3MF06ICJjb25uZWN0aW9uLnVwZGF0ZS1zZWNyZXQiLAogICAgICAgIFs3MV06ICJjb25uZWN0aW9uLnVwZGF0ZS1zZWNyZXQtb2siCiAgICB9LAogICAgWzIwXTogewogICAgICAgIFsxMF06ICJjaGFubmVsLm9wZW4iLAogICAgICAgIFsxMV06ICJjaGFubmVsLm9wZW4tb2siLAogICAgICAgIFsyMF06ICJjaGFubmVsLmZsb3ciLAogICAgICAgIFsyMV06ICJjaGFubmVsLmZsb3ctb2siLAogICAgICAgIFs0MF06ICJjaGFubmVsLmNsb3NlIiwKICAgICAgICBbNDFdOiAiY2hhbm5lbC5jbG9zZS1vayIKICAgIH0sCiAgICBbMzBdOiB7CiAgICAgICAgWzEwXTogImFjY2Vzcy5yZXF1ZXN0IiwKICAgICAgICBbMTFdOiAiYWNjZXNzLnJlcXVlc3Qtb2siCiAgICB9LAogICAgWzQwXTogewogICAgICAgIFsxMF06ICJleGNoYW5nZS5kZWNsYXJlIiwKICAgICAgICBbMTFdOiAiZXhjaGFuZ2UuZGVjbGFyZS1vayIsCiAgICAgICAgWzIwXTogImV4Y2hhbmdlLmRlbGV0ZSIsCiAgICAgICAgWzIxXTogImV4Y2hhbmdlLmRlbGV0ZS1vayIsCiAgICAgICAgWzMwXTogImV4Y2hhbmdlLmJpbmQiLAogICAgICAgIFszMV06ICJleGNoYW5nZS5iaW5kLW9rIiwKICAgICAgICBbNDBdOiAiZXhjaGFuZ2UudW5iaW5kIiwKICAgICAgICBbNTFdOiAiZXhjaGFuZ2UudW5iaW5kLW9rIgogICAgfSwKICAgIFs1MF06IHsKICAgICAgICBbMTBdOiAicXVldWUuZGVjbGFyZSIsCiAgICAgICAgWzExXTogInF1ZXVlLmRlY2xhcmUtb2siLAogICAgICAgIFsyMF06ICJxdWV1ZS5iaW5kIiwKICAgICAgICBbMjFdOiAicXVldWUuYmluZC1vayIsCiAgICAgICAgWzMwXTogInF1ZXVlLnB1cmdlIiwKICAgICAgICBbMzFdOiAicXVldWUucHVyZ2Utb2siLAogICAgICAgIFs0MF06ICJxdWV1ZS5kZWxldGUiLAogICAgICAgIFs0MV06ICJxdWV1ZS5kZWxldGUtb2siLAogICAgICAgIFs1MF06ICJxdWV1ZS51bmJpbmQiLAogICAgICAgIFs1MV06ICJxdWV1ZS51bmJpbmQtb2siCiAgICB9LAogICAgWzYwXTogewogICAgICAgIFsxMF06ICJiYXNpYy5xb3MiLAogICAgICAgIFsxMV06ICJiYXNpYy5xb3Mtb2siLAogICAgICAgIFsyMF06ICJiYXNpYy5jb25zdW1lIiwKICAgICAgICBbMjFdOiAiYmFzaWMuY29uc3VtZS1vayIsCiAgICAgICAgWzMwXTogImJhc2ljLmNhbmNlbCIsCiAgICAgICAgWzMxXTogImJhc2ljLmNhbmNlbC1vayIsCiAgICAgICAgWzQwXTogImJhc2ljLnB1Ymxpc2giLAogICAgICAgIFs1MF06ICJiYXNpYy5yZXR1cm4iLAogICAgICAgIFs2MF06ICJiYXNpYy5kZWxpdmVyIiwKICAgICAgICBbNzBdOiAiYmFzaWMuZ2V0IiwKICAgICAgICBbNzFdOiAiYmFzaWMuZ2V0LW9rIiwKICAgICAgICBbNzJdOiAiYmFzaWMuZ2V0LWVtcHR5IiwKICAgICAgICBbODBdOiAiYmFzaWMuYWNrIiwKICAgICAgICBbOTBdOiAiYmFzaWMucmVqZWN0IiwKICAgICAgICBbMTAwXTogImJhc2ljLnJlY292ZXItYXN5bmMiLAogICAgICAgIFsxMTBdOiAiYmFzaWMucmVjb3ZlciIsCiAgICAgICAgWzExMV06ICJiYXNpYy5yZWNvdmVyLW9rIiwKICAgICAgICBbMTIwXTogImJhc2ljLm5hY2siCiAgICB9LAogICAgWzkwXTogewogICAgICAgIFsxMF06ICJ0eC5zZWxlY3QiLAogICAgICAgIFsxMV06ICJ0eC5zZWxlY3Qtb2siLAogICAgICAgIFsyMF06ICJ0eC5jb21taXQiLAogICAgICAgIFsyMV06ICJ0eC5jb21taXQtb2siLAogICAgICAgIFszMF06ICJ0eC5yb2xsYmFjayIsCiAgICAgICAgWzMxXTogInR4LnJvbGxiYWNrLW9rIgogICAgfSwKICAgIFs4NV06IHsKICAgICAgICBbMTBdOiAiY29uZmlybS5zZWxlY3QiLAogICAgICAgIFsxMV06ICJjb25maXJtLnNlbGVjdC1vayIKICAgIH0KfTsKZnVuY3Rpb24gZ2V0TWV0aG9kTmFtZShjbGFzc0lkLCBtZXRob2RJZCkgewogICAgcmV0dXJuIG1ldGhvZE5hbWVzW2NsYXNzSWRdICYmIG1ldGhvZE5hbWVzW2NsYXNzSWRdW21ldGhvZElkXTsKfQpmdW5jdGlvbiBkZWNvZGVNZXRob2QoZGF0YTEpIHsKICAgIGNvbnN0IGRlY29kZXIxID0gbmV3IEFtcXBEZWNvZGVyKGRhdGExKTsKICAgIGNvbnN0IGNsYXNzSWQgPSBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKTsKICAgIGNvbnN0IG1ldGhvZElkID0gZGVjb2RlcjEucmVhZCgidWludDE2Iik7CiAgICBzd2l0Y2goY2xhc3NJZCl7CiAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb25NYWpvcjogZGVjb2RlcjEucmVhZCgidWludDgiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uTWlub3I6IGRlY29kZXIxLnJlYWQoInVpbnQ4IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyUHJvcGVydGllczogZGVjb2RlcjEucmVhZCgidGFibGUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWNoYW5pc21zOiBkZWNvZGVyMS5yZWFkKCJsb25nc3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxlczogZGVjb2RlcjEucmVhZCgibG9uZ3N0ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRQcm9wZXJ0aWVzOiBkZWNvZGVyMS5yZWFkKCJ0YWJsZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lY2hhbmlzbTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZTogZGVjb2RlcjEucmVhZCgibG9uZ3N0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbGxlbmdlOiBkZWNvZGVyMS5yZWFkKCJsb25nc3RyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlOiBkZWNvZGVyMS5yZWFkKCJsb25nc3RyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5uZWxNYXg6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lTWF4OiBkZWNvZGVyMS5yZWFkKCJ1aW50MzIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFydGJlYXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsTWF4OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZU1heDogZGVjb2RlcjEucmVhZCgidWludDMyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhcnRiZWF0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlydHVhbEhvc3Q6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwYWJpbGl0aWVzOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2lzdDogZGVjb2RlcjEucmVhZCgiYml0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtub3duSG9zdHM6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDUwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5Q29kZTogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlUZXh0OiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkOiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFzb246IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDYxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2VjcmV0OiBkZWNvZGVyMS5yZWFkKCJsb25nc3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2RJZCArICIgZm9yIGNsYXNzICdjb25uZWN0aW9uJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dE9mQmFuZDogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbElkOiBkZWNvZGVyMS5yZWFkKCJsb25nc3RyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogZGVjb2RlcjEucmVhZCgiYml0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogZGVjb2RlcjEucmVhZCgiYml0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5Q29kZTogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlUZXh0OiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkOiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kSWQgKyAiIGZvciBjbGFzcyAnY2hhbm5lbCciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2RJZCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFsbTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNsdXNpdmU6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3NpdmU6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGU6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQ6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrZXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kSWQgKyAiIGZvciBjbGFzcyAnYWNjZXNzJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tldDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2U6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzaXZlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhYmxlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvRGVsZXRlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbDogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93YWl0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGRlY29kZXIxLnJlYWQoInRhYmxlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZlVudXNlZDogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93YWl0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrZXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0aW5nS2V5OiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vd2FpdDogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiBkZWNvZGVyMS5yZWFkKCJ0YWJsZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tldDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb246IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRpbmdLZXk6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93YWl0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGRlY29kZXIxLnJlYWQoInRhYmxlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDUxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBtZXRob2QgIiArIG1ldGhvZElkICsgIiBmb3IgY2xhc3MgJ2V4Y2hhbmdlJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tldDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc2l2ZTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYWJsZTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjbHVzaXZlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvRGVsZXRlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dhaXQ6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogZGVjb2RlcjEucmVhZCgidGFibGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUNvdW50OiBkZWNvZGVyMS5yZWFkKCJ1aW50MzIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lckNvdW50OiBkZWNvZGVyMS5yZWFkKCJ1aW50MzIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0aW5nS2V5OiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vd2FpdDogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiBkZWNvZGVyMS5yZWFkKCJ0YWJsZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tldDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93YWl0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUNvdW50OiBkZWNvZGVyMS5yZWFkKCJ1aW50MzIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZlVudXNlZDogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZFbXB0eTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93YWl0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUNvdW50OiBkZWNvZGVyMS5yZWFkKCJ1aW50MzIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0aW5nS2V5OiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogZGVjb2RlcjEucmVhZCgidGFibGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kSWQgKyAiIGZvciBjbGFzcyAncXVldWUnIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDYwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZmV0Y2hTaXplOiBkZWNvZGVyMS5yZWFkKCJ1aW50MzIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmZXRjaENvdW50OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWw6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tldDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZXJUYWc6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9Mb2NhbDogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9BY2s6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1c2l2ZTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93YWl0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGRlY29kZXIxLnJlYWQoInRhYmxlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVyVGFnOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lclRhZzogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dhaXQ6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lclRhZzogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0aW5nS2V5OiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbmRhdG9yeTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1tZWRpYXRlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlDb2RlOiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBseVRleHQ6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2U6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGluZ0tleTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZXJUYWc6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlUYWc6IGRlY29kZXIxLnJlYWQoInVpbnQ2NCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZGVsaXZlcmVkOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0aW5nS2V5OiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrZXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vQWNrOiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlUYWc6IGRlY29kZXIxLnJlYWQoInVpbnQ2NCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZGVsaXZlcmVkOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0aW5nS2V5OiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VDb3VudDogZGVjb2RlcjEucmVhZCgidWludDMyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcyOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsdXN0ZXJJZDogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgODA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlUYWc6IGRlY29kZXIxLnJlYWQoInVpbnQ2NCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgOTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlUYWc6IGRlY29kZXIxLnJlYWQoInVpbnQ2NCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVldWU6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWV1ZTogZGVjb2RlcjEucmVhZCgiYml0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXVlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTExOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTIwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGl2ZXJ5VGFnOiBkZWNvZGVyMS5yZWFkKCJ1aW50NjQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWV1ZTogZGVjb2RlcjEucmVhZCgiYml0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2RJZCArICIgZm9yIGNsYXNzICdiYXNpYyciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIGNhc2UgOTA6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2RJZCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kSWQgKyAiIGZvciBjbGFzcyAndHgnIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDg1OgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93YWl0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kSWQgKyAiIGZvciBjbGFzcyAnY29uZmlybSciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBjbGFzcyAiICsgY2xhc3NJZCk7CiAgICB9Cn0KZnVuY3Rpb24gZW5jb2RlTWV0aG9kKG1ldGhvZCkgewogICAgY29uc3QgZW5jb2RlcjEgPSBuZXcgQW1xcEVuY29kZXIoKTsKICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuY2xhc3NJZCk7CiAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLm1ldGhvZElkKTsKICAgIHN3aXRjaChtZXRob2QuY2xhc3NJZCl7CiAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZC5tZXRob2RJZCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQ4IiwgbWV0aG9kLmFyZ3MudmVyc2lvbk1ham9yICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy52ZXJzaW9uTWFqb3IgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQ4IiwgbWV0aG9kLmFyZ3MudmVyc2lvbk1pbm9yICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy52ZXJzaW9uTWlub3IgOiA5KTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInRhYmxlIiwgbWV0aG9kLmFyZ3Muc2VydmVyUHJvcGVydGllcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJsb25nc3RyIiwgbWV0aG9kLmFyZ3MubWVjaGFuaXNtcyAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MubWVjaGFuaXNtcyA6ICJQTEFJTiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgibG9uZ3N0ciIsIG1ldGhvZC5hcmdzLmxvY2FsZXMgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmxvY2FsZXMgOiAiZW5fVVMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInRhYmxlIiwgbWV0aG9kLmFyZ3MuY2xpZW50UHJvcGVydGllcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLm1lY2hhbmlzbSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MubWVjaGFuaXNtIDogIlBMQUlOIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJsb25nc3RyIiwgbWV0aG9kLmFyZ3MucmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5sb2NhbGUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmxvY2FsZSA6ICJlbl9VUyIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgibG9uZ3N0ciIsIG1ldGhvZC5hcmdzLmNoYWxsZW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJsb25nc3RyIiwgbWV0aG9kLmFyZ3MucmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MuY2hhbm5lbE1heCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuY2hhbm5lbE1heCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDMyIiwgbWV0aG9kLmFyZ3MuZnJhbWVNYXggIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmZyYW1lTWF4IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy5oZWFydGJlYXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmhlYXJ0YmVhdCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MuY2hhbm5lbE1heCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuY2hhbm5lbE1heCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDMyIiwgbWV0aG9kLmFyZ3MuZnJhbWVNYXggIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmZyYW1lTWF4IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy5oZWFydGJlYXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmhlYXJ0YmVhdCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy52aXJ0dWFsSG9zdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudmlydHVhbEhvc3QgOiAiLyIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmNhcGFiaWxpdGllcyA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmluc2lzdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuaW5zaXN0IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQxOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5rbm93bkhvc3RzICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5rbm93bkhvc3RzIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDUwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MucmVwbHlDb2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MucmVwbHlUZXh0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yZXBseVRleHQgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy5jbGFzc0lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLm1ldGhvZElkKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MTogYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2MDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MucmVhc29uICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yZWFzb24gOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJsb25nc3RyIiwgbWV0aG9kLmFyZ3MubmV3U2VjcmV0KTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MucmVhc29uKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MTogYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kLm1ldGhvZElkICsgIiBmb3IgY2xhc3MgJ2Nvbm5lY3Rpb24nIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2QubWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLm91dE9mQmFuZCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mub3V0T2ZCYW5kIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgibG9uZ3N0ciIsIG1ldGhvZC5hcmdzLmNoYW5uZWxJZCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuY2hhbm5lbElkIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuYWN0aXZlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmFjdGl2ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy5yZXBseUNvZGUpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yZXBseVRleHQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlcGx5VGV4dCA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLmNsYXNzSWQpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MubWV0aG9kSWQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQxOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2QubWV0aG9kSWQgKyAiIGZvciBjbGFzcyAnY2hhbm5lbCciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZC5tZXRob2RJZCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MucmVhbG0gIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlYWxtIDogIi9kYXRhIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5leGNsdXNpdmUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmV4Y2x1c2l2ZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLnBhc3NpdmUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnBhc3NpdmUgOiB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmFjdGl2ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuYWN0aXZlIDogdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy53cml0ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mud3JpdGUgOiB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLnJlYWQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlYWQgOiB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnRpY2tldCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudGlja2V0IDogMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBtZXRob2QgIiArIG1ldGhvZC5tZXRob2RJZCArICIgZm9yIGNsYXNzICdhY2Nlc3MnIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2QubWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5leGNoYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnR5cGUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnR5cGUgOiAiZGlyZWN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5wYXNzaXZlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5wYXNzaXZlIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuZHVyYWJsZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZHVyYWJsZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmF1dG9EZWxldGUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmF1dG9EZWxldGUgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5pbnRlcm5hbCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuaW50ZXJuYWwgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub3dhaXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vd2FpdCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInRhYmxlIiwgbWV0aG9kLmFyZ3MuYXJndW1lbnRzICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5hcmd1bWVudHMgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MudGlja2V0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy50aWNrZXQgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MuZXhjaGFuZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuaWZVbnVzZWQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmlmVW51c2VkIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3Mubm93YWl0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5ub3dhaXQgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5kZXN0aW5hdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnNvdXJjZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub3dhaXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vd2FpdCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInRhYmxlIiwgbWV0aG9kLmFyZ3MuYXJndW1lbnRzICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5hcmd1bWVudHMgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MudGlja2V0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy50aWNrZXQgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MuZGVzdGluYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5zb3VyY2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yb3V0aW5nS2V5ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yb3V0aW5nS2V5IDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3Mubm93YWl0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5ub3dhaXQgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ0YWJsZSIsIG1ldGhvZC5hcmdzLmFyZ3VtZW50cyAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuYXJndW1lbnRzIDogewogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MTogYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kLm1ldGhvZElkICsgIiBmb3IgY2xhc3MgJ2V4Y2hhbmdlJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDUwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kLm1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MudGlja2V0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy50aWNrZXQgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MucXVldWUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnF1ZXVlIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MucGFzc2l2ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucGFzc2l2ZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmR1cmFibGUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmR1cmFibGUgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5leGNsdXNpdmUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmV4Y2x1c2l2ZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmF1dG9EZWxldGUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmF1dG9EZWxldGUgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub3dhaXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vd2FpdCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInRhYmxlIiwgbWV0aG9kLmFyZ3MuYXJndW1lbnRzICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5hcmd1bWVudHMgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5xdWV1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MzIiLCBtZXRob2QuYXJncy5tZXNzYWdlQ291bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDMyIiwgbWV0aG9kLmFyZ3MuY29uc3VtZXJDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5xdWV1ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucXVldWUgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmV4Y2hhbmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3Mucm91dGluZ0tleSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mucm91dGluZ0tleSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vd2FpdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mubm93YWl0IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidGFibGUiLCBtZXRob2QuYXJncy5hcmd1bWVudHMgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmFyZ3VtZW50cyA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5xdWV1ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucXVldWUgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub3dhaXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vd2FpdCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQzMiIsIG1ldGhvZC5hcmdzLm1lc3NhZ2VDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5xdWV1ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucXVldWUgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5pZlVudXNlZCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuaWZVbnVzZWQgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5pZkVtcHR5ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5pZkVtcHR5IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3Mubm93YWl0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5ub3dhaXQgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDE6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MzIiLCBtZXRob2QuYXJncy5tZXNzYWdlQ291bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDUwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MudGlja2V0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy50aWNrZXQgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MucXVldWUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnF1ZXVlIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5leGNoYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ0YWJsZSIsIG1ldGhvZC5hcmdzLmFyZ3VtZW50cyAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuYXJndW1lbnRzIDogewogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MTogYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kLm1ldGhvZElkICsgIiBmb3IgY2xhc3MgJ3F1ZXVlJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDYwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kLm1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDMyIiwgbWV0aG9kLmFyZ3MucHJlZmV0Y2hTaXplICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5wcmVmZXRjaFNpemUgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnByZWZldGNoQ291bnQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnByZWZldGNoQ291bnQgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmdsb2JhbCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZ2xvYmFsIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MudGlja2V0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy50aWNrZXQgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MucXVldWUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnF1ZXVlIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5jb25zdW1lclRhZyAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuY29uc3VtZXJUYWcgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub0xvY2FsICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5ub0xvY2FsIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3Mubm9BY2sgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vQWNrIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuZXhjbHVzaXZlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5leGNsdXNpdmUgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub3dhaXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vd2FpdCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInRhYmxlIiwgbWV0aG9kLmFyZ3MuYXJndW1lbnRzICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5hcmd1bWVudHMgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5jb25zdW1lclRhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmNvbnN1bWVyVGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vd2FpdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mubm93YWl0IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5jb25zdW1lclRhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5leGNoYW5nZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZXhjaGFuZ2UgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5tYW5kYXRvcnkgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm1hbmRhdG9yeSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmltbWVkaWF0ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuaW1tZWRpYXRlIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDUwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MucmVwbHlDb2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MucmVwbHlUZXh0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yZXBseVRleHQgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmV4Y2hhbmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3Mucm91dGluZ0tleSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmNvbnN1bWVyVGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQ2NCIsIG1ldGhvZC5hcmdzLmRlbGl2ZXJ5VGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLnJlZGVsaXZlcmVkICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yZWRlbGl2ZXJlZCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MuZXhjaGFuZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yb3V0aW5nS2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnRpY2tldCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudGlja2V0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnF1ZXVlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5xdWV1ZSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vQWNrICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5ub0FjayA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MToKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQ2NCIsIG1ldGhvZC5hcmdzLmRlbGl2ZXJ5VGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLnJlZGVsaXZlcmVkICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yZWRlbGl2ZXJlZCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MuZXhjaGFuZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yb3V0aW5nS2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQzMiIsIG1ldGhvZC5hcmdzLm1lc3NhZ2VDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzI6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmNsdXN0ZXJJZCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuY2x1c3RlcklkIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDgwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDY0IiwgbWV0aG9kLmFyZ3MuZGVsaXZlcnlUYWcgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmRlbGl2ZXJ5VGFnIDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5tdWx0aXBsZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MubXVsdGlwbGUgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgOTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50NjQiLCBtZXRob2QuYXJncy5kZWxpdmVyeVRhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5yZXF1ZXVlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yZXF1ZXVlIDogdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTAwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MucmVxdWV1ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucmVxdWV1ZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5yZXF1ZXVlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yZXF1ZXVlIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExMTogYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50NjQiLCBtZXRob2QuYXJncy5kZWxpdmVyeVRhZyAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZGVsaXZlcnlUYWcgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm11bHRpcGxlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5tdWx0aXBsZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLnJlcXVldWUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlcXVldWUgOiB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kLm1ldGhvZElkICsgIiBmb3IgY2xhc3MgJ2Jhc2ljJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDkwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kLm1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2QubWV0aG9kSWQgKyAiIGZvciBjbGFzcyAndHgnIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIGNhc2UgODU6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2QubWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub3dhaXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vd2FpdCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTogYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kLm1ldGhvZElkICsgIiBmb3IgY2xhc3MgJ2NvbmZpcm0nIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBjbGFzcyAiICsgbWV0aG9kLmNsYXNzSWQpOwogICAgfQogICAgcmV0dXJuIGVuY29kZXIxLnJlc3VsdCgpOwp9CmZ1bmN0aW9uIGRlY29kZUhlYWRlcihkYXRhMSkgewogICAgY29uc3QgZGVjb2RlcjEgPSBuZXcgQW1xcERlY29kZXIoZGF0YTEpOwogICAgY29uc3QgY2xhc3NJZCA9IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpOwogICAgZGVjb2RlcjEucmVhZCgidWludDE2Iik7CiAgICBjb25zdCBzaXplNSA9IGRlY29kZXIxLnJlYWQoInVpbnQ2NCIpOwogICAgY29uc3QgZmxhZ3MgPSBkZWNvZGVyMS5yZWFkKCJmbGFncyIpOwogICAgc3dpdGNoKGNsYXNzSWQpewogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgc2l6ZTogc2l6ZTUsCiAgICAgICAgICAgICAgICBwcm9wczogewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgc2l6ZTogc2l6ZTUsCiAgICAgICAgICAgICAgICBwcm9wczogewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgc2l6ZTogc2l6ZTUsCiAgICAgICAgICAgICAgICBwcm9wczogewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgc2l6ZTogc2l6ZTUsCiAgICAgICAgICAgICAgICBwcm9wczogewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgc2l6ZTogc2l6ZTUsCiAgICAgICAgICAgICAgICBwcm9wczogewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIGNhc2UgNjA6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgc2l6ZTogc2l6ZTUsCiAgICAgICAgICAgICAgICBwcm9wczogewogICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmbGFnc1swXSA/IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgY29udGVudEVuY29kaW5nOiBmbGFnc1sxXSA/IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogZmxhZ3NbMl0gPyBkZWNvZGVyMS5yZWFkKCJ0YWJsZSIpIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIGRlbGl2ZXJ5TW9kZTogZmxhZ3NbM10gPyBkZWNvZGVyMS5yZWFkKCJ1aW50OCIpIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiBmbGFnc1s0XSA/IGRlY29kZXIxLnJlYWQoInVpbnQ4IikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgY29ycmVsYXRpb25JZDogZmxhZ3NbNV0gPyBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIHJlcGx5VG86IGZsYWdzWzZdID8gZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBleHBpcmF0aW9uOiBmbGFnc1s3XSA/IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUlkOiBmbGFnc1s4XSA/IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBmbGFnc1s5XSA/IGRlY29kZXIxLnJlYWQoInVpbnQ2NCIpIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IGZsYWdzWzEwXSA/IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBmbGFnc1sxMV0gPyBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIGFwcElkOiBmbGFnc1sxMl0gPyBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIGNsdXN0ZXJJZDogZmxhZ3NbMTNdID8gZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSA6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIGNhc2UgOTA6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgc2l6ZTogc2l6ZTUsCiAgICAgICAgICAgICAgICBwcm9wczogewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIGNhc2UgODU6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgc2l6ZTogc2l6ZTUsCiAgICAgICAgICAgICAgICBwcm9wczogewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBjbGFzcyAiICsgY2xhc3NJZCk7CiAgICB9Cn0KZnVuY3Rpb24gZW5jb2RlSGVhZGVyKGhlYWRlcikgewogICAgY29uc3QgZW5jb2RlcjEgPSBuZXcgQW1xcEVuY29kZXIoKTsKICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBoZWFkZXIuY2xhc3NJZCk7CiAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgMCk7CiAgICBlbmNvZGVyMS53cml0ZSgidWludDY0IiwgaGVhZGVyLnNpemUpOwogICAgc3dpdGNoKGhlYWRlci5jbGFzc0lkKXsKICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiZmxhZ3MiLCBbXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJmbGFncyIsIFtdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImZsYWdzIiwgW10pOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiZmxhZ3MiLCBbXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJmbGFncyIsIFtdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA2MDoKICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImZsYWdzIiwgWwogICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLmNvbnRlbnRUeXBlICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMuY29udGVudEVuY29kaW5nICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMuaGVhZGVycyAhPT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLmRlbGl2ZXJ5TW9kZSAhPT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLnByaW9yaXR5ICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMuY29ycmVsYXRpb25JZCAhPT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLnJlcGx5VG8gIT09IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGhlYWRlci5wcm9wcy5leHBpcmF0aW9uICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMubWVzc2FnZUlkICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMudGltZXN0YW1wICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMudHlwZSAhPT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLnVzZXJJZCAhPT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLmFwcElkICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMuY2x1c3RlcklkICE9PSB1bmRlZmluZWQsIAogICAgICAgICAgICBdKTsKICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy5jb250ZW50VHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBoZWFkZXIucHJvcHMuY29udGVudFR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMuY29udGVudEVuY29kaW5nICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIGhlYWRlci5wcm9wcy5jb250ZW50RW5jb2RpbmcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMuaGVhZGVycyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidGFibGUiLCBoZWFkZXIucHJvcHMuaGVhZGVycyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy5kZWxpdmVyeU1vZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQ4IiwgaGVhZGVyLnByb3BzLmRlbGl2ZXJ5TW9kZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy5wcmlvcml0eSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDgiLCBoZWFkZXIucHJvcHMucHJpb3JpdHkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMuY29ycmVsYXRpb25JZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBoZWFkZXIucHJvcHMuY29ycmVsYXRpb25JZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy5yZXBseVRvICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIGhlYWRlci5wcm9wcy5yZXBseVRvKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVhZGVyLnByb3BzLmV4cGlyYXRpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgaGVhZGVyLnByb3BzLmV4cGlyYXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMubWVzc2FnZUlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIGhlYWRlci5wcm9wcy5tZXNzYWdlSWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMudGltZXN0YW1wICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50NjQiLCBoZWFkZXIucHJvcHMudGltZXN0YW1wKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVhZGVyLnByb3BzLnR5cGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgaGVhZGVyLnByb3BzLnR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMudXNlcklkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIGhlYWRlci5wcm9wcy51c2VySWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMuYXBwSWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgaGVhZGVyLnByb3BzLmFwcElkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVhZGVyLnByb3BzLmNsdXN0ZXJJZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBoZWFkZXIucHJvcHMuY2x1c3RlcklkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDkwOgogICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiZmxhZ3MiLCBbXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgODU6CiAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJmbGFncyIsIFtdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGNsYXNzICIgKyBoZWFkZXIuY2xhc3NJZCk7CiAgICB9CiAgICByZXR1cm4gZW5jb2RlcjEucmVzdWx0KCk7Cn0KZnVuY3Rpb24gY29weTEoc3JjLCBkc3QsIG9mZiA9IDApIHsKICAgIG9mZiA9IE1hdGgubWF4KDAsIE1hdGgubWluKG9mZiwgZHN0LmJ5dGVMZW5ndGgpKTsKICAgIGNvbnN0IGRzdEJ5dGVzQXZhaWxhYmxlID0gZHN0LmJ5dGVMZW5ndGggLSBvZmY7CiAgICBpZiAoc3JjLmJ5dGVMZW5ndGggPiBkc3RCeXRlc0F2YWlsYWJsZSkgewogICAgICAgIHNyYyA9IHNyYy5zdWJhcnJheSgwLCBkc3RCeXRlc0F2YWlsYWJsZSk7CiAgICB9CiAgICBkc3Quc2V0KHNyYywgb2ZmKTsKICAgIHJldHVybiBzcmMuYnl0ZUxlbmd0aDsKfQpjbGFzcyBEZW5vU3RkSW50ZXJuYWxFcnJvcjEgZXh0ZW5kcyBFcnJvciB7CiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlMSl7CiAgICAgICAgc3VwZXIobWVzc2FnZTEpOwogICAgICAgIHRoaXMubmFtZSA9ICJEZW5vU3RkSW50ZXJuYWxFcnJvciI7CiAgICB9Cn0KZnVuY3Rpb24gYXNzZXJ0MShleHByLCBtc2cgPSAiIikgewogICAgaWYgKCFleHByKSB7CiAgICAgICAgdGhyb3cgbmV3IERlbm9TdGRJbnRlcm5hbEVycm9yMShtc2cpOwogICAgfQp9CmNvbnN0IERFRkFVTFRfQlVGX1NJWkUxID0gNDA5NjsKY29uc3QgTUlOX0JVRl9TSVpFMSA9IDE2Owpjb25zdCBDUjEgPSAiXHIiLmNoYXJDb2RlQXQoMCk7CmNvbnN0IExGMSA9ICJcbiIuY2hhckNvZGVBdCgwKTsKY2xhc3MgQnVmZmVyRnVsbEVycm9yMSBleHRlbmRzIEVycm9yIHsKICAgIHBhcnRpYWw7CiAgICBuYW1lID0gIkJ1ZmZlckZ1bGxFcnJvciI7CiAgICBjb25zdHJ1Y3RvcihwYXJ0aWFsMil7CiAgICAgICAgc3VwZXIoIkJ1ZmZlciBmdWxsIik7CiAgICAgICAgdGhpcy5wYXJ0aWFsID0gcGFydGlhbDI7CiAgICB9Cn0KY2xhc3MgUGFydGlhbFJlYWRFcnJvcjEgZXh0ZW5kcyBEZW5vLmVycm9ycy5VbmV4cGVjdGVkRW9mIHsKICAgIG5hbWUgPSAiUGFydGlhbFJlYWRFcnJvciI7CiAgICBwYXJ0aWFsOwogICAgY29uc3RydWN0b3IoKXsKICAgICAgICBzdXBlcigiRW5jb3VudGVyZWQgVW5leHBlY3RlZEVvZiwgZGF0YSBvbmx5IHBhcnRpYWxseSByZWFkIik7CiAgICB9Cn0KY2xhc3MgQnVmUmVhZGVyMSB7CiAgICBidWY7CiAgICByZDsKICAgIHIgPSAwOwogICAgdyA9IDA7CiAgICBlb2YgPSBmYWxzZTsKICAgIHN0YXRpYyBjcmVhdGUociwgc2l6ZSA9IDQwOTYpIHsKICAgICAgICByZXR1cm4gciBpbnN0YW5jZW9mIEJ1ZlJlYWRlcjEgPyByIDogbmV3IEJ1ZlJlYWRlcjEociwgc2l6ZSk7CiAgICB9CiAgICBjb25zdHJ1Y3RvcihyZDIsIHNpemU1ID0gNDA5Nil7CiAgICAgICAgaWYgKHNpemU1IDwgMTYpIHsKICAgICAgICAgICAgc2l6ZTUgPSBNSU5fQlVGX1NJWkUxOwogICAgICAgIH0KICAgICAgICB0aGlzLl9yZXNldChuZXcgVWludDhBcnJheShzaXplNSksIHJkMik7CiAgICB9CiAgICBzaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLmJ1Zi5ieXRlTGVuZ3RoOwogICAgfQogICAgYnVmZmVyZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudyAtIHRoaXMucjsKICAgIH0KICAgIGFzeW5jIF9maWxsKCkgewogICAgICAgIGlmICh0aGlzLnIgPiAwKSB7CiAgICAgICAgICAgIHRoaXMuYnVmLmNvcHlXaXRoaW4oMCwgdGhpcy5yLCB0aGlzLncpOwogICAgICAgICAgICB0aGlzLncgLT0gdGhpcy5yOwogICAgICAgICAgICB0aGlzLnIgPSAwOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy53ID49IHRoaXMuYnVmLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoImJ1ZmlvOiB0cmllZCB0byBmaWxsIGZ1bGwgYnVmZmVyIik7CiAgICAgICAgfQogICAgICAgIGZvcihsZXQgaSA9IDEwMDsgaSA+IDA7IGktLSl7CiAgICAgICAgICAgIGNvbnN0IHJyID0gYXdhaXQgdGhpcy5yZC5yZWFkKHRoaXMuYnVmLnN1YmFycmF5KHRoaXMudykpOwogICAgICAgICAgICBpZiAocnIgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBhc3NlcnQxKHJyID49IDAsICJuZWdhdGl2ZSByZWFkIik7CiAgICAgICAgICAgIHRoaXMudyArPSBycjsKICAgICAgICAgICAgaWYgKHJyID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gcHJvZ3Jlc3MgYWZ0ZXIgJHsxMDB9IHJlYWQoKSBjYWxsc2ApOwogICAgfQogICAgcmVzZXQocikgewogICAgICAgIHRoaXMuX3Jlc2V0KHRoaXMuYnVmLCByKTsKICAgIH0KICAgIF9yZXNldChidWYsIHJkKSB7CiAgICAgICAgdGhpcy5idWYgPSBidWY7CiAgICAgICAgdGhpcy5yZCA9IHJkOwogICAgICAgIHRoaXMuZW9mID0gZmFsc2U7CiAgICB9CiAgICBhc3luYyByZWFkKHApIHsKICAgICAgICBsZXQgcnIgPSBwLmJ5dGVMZW5ndGg7CiAgICAgICAgaWYgKHAuYnl0ZUxlbmd0aCA9PT0gMCkgcmV0dXJuIHJyOwogICAgICAgIGlmICh0aGlzLnIgPT09IHRoaXMudykgewogICAgICAgICAgICBpZiAocC5ieXRlTGVuZ3RoID49IHRoaXMuYnVmLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJyMSA9IGF3YWl0IHRoaXMucmQucmVhZChwKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5yZWFkID0gcnIxID8/IDA7CiAgICAgICAgICAgICAgICBhc3NlcnQxKG5yZWFkID49IDAsICJuZWdhdGl2ZSByZWFkIik7CiAgICAgICAgICAgICAgICByZXR1cm4gcnIxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuciA9IDA7CiAgICAgICAgICAgIHRoaXMudyA9IDA7CiAgICAgICAgICAgIHJyID0gYXdhaXQgdGhpcy5yZC5yZWFkKHRoaXMuYnVmKTsKICAgICAgICAgICAgaWYgKHJyID09PSAwIHx8IHJyID09PSBudWxsKSByZXR1cm4gcnI7CiAgICAgICAgICAgIGFzc2VydDEocnIgPj0gMCwgIm5lZ2F0aXZlIHJlYWQiKTsKICAgICAgICAgICAgdGhpcy53ICs9IHJyOwogICAgICAgIH0KICAgICAgICBjb25zdCBjb3BpZWQgPSBjb3B5MSh0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMudyksIHAsIDApOwogICAgICAgIHRoaXMuciArPSBjb3BpZWQ7CiAgICAgICAgcmV0dXJuIGNvcGllZDsKICAgIH0KICAgIGFzeW5jIHJlYWRGdWxsKHApIHsKICAgICAgICBsZXQgYnl0ZXNSZWFkID0gMDsKICAgICAgICB3aGlsZShieXRlc1JlYWQgPCBwLmxlbmd0aCl7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCByciA9IGF3YWl0IHRoaXMucmVhZChwLnN1YmFycmF5KGJ5dGVzUmVhZCkpOwogICAgICAgICAgICAgICAgaWYgKHJyID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJ5dGVzUmVhZCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGFydGlhbFJlYWRFcnJvcjEoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBieXRlc1JlYWQgKz0gcnI7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgZXJyLnBhcnRpYWwgPSBwLnN1YmFycmF5KDAsIGJ5dGVzUmVhZCk7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHA7CiAgICB9CiAgICBhc3luYyByZWFkQnl0ZSgpIHsKICAgICAgICB3aGlsZSh0aGlzLnIgPT09IHRoaXMudyl7CiAgICAgICAgICAgIGlmICh0aGlzLmVvZikgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2ZpbGwoKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYyA9IHRoaXMuYnVmW3RoaXMucl07CiAgICAgICAgdGhpcy5yKys7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CiAgICBhc3luYyByZWFkU3RyaW5nKGRlbGltKSB7CiAgICAgICAgaWYgKGRlbGltLmxlbmd0aCAhPT0gMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkRlbGltaXRlciBzaG91bGQgYmUgYSBzaW5nbGUgY2hhcmFjdGVyIik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IHRoaXMucmVhZFNsaWNlKGRlbGltLmNoYXJDb2RlQXQoMCkpOwogICAgICAgIGlmIChidWZmZXIgPT09IG51bGwpIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoYnVmZmVyKTsKICAgIH0KICAgIGFzeW5jIHJlYWRMaW5lKCkgewogICAgICAgIGxldCBsaW5lOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxpbmUgPSBhd2FpdCB0aGlzLnJlYWRTbGljZShMRjEpOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBsZXQgeyBwYXJ0aWFsOiBwYXJ0aWFsMyAgfSA9IGVycjsKICAgICAgICAgICAgYXNzZXJ0MShwYXJ0aWFsMyBpbnN0YW5jZW9mIFVpbnQ4QXJyYXksICJidWZpbzogY2F1Z2h0IGVycm9yIGZyb20gYHJlYWRTbGljZSgpYCB3aXRob3V0IGBwYXJ0aWFsYCBwcm9wZXJ0eSIpOwogICAgICAgICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBCdWZmZXJGdWxsRXJyb3IxKSkgewogICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5lb2YgJiYgcGFydGlhbDMuYnl0ZUxlbmd0aCA+IDAgJiYgcGFydGlhbDNbcGFydGlhbDMuYnl0ZUxlbmd0aCAtIDFdID09PSBDUjEpIHsKICAgICAgICAgICAgICAgIGFzc2VydDEodGhpcy5yID4gMCwgImJ1ZmlvOiB0cmllZCB0byByZXdpbmQgcGFzdCBzdGFydCBvZiBidWZmZXIiKTsKICAgICAgICAgICAgICAgIHRoaXMuci0tOwogICAgICAgICAgICAgICAgcGFydGlhbDMgPSBwYXJ0aWFsMy5zdWJhcnJheSgwLCBwYXJ0aWFsMy5ieXRlTGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGxpbmU6IHBhcnRpYWwzLAogICAgICAgICAgICAgICAgbW9yZTogIXRoaXMuZW9mCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmIChsaW5lID09PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAobGluZS5ieXRlTGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBsaW5lLAogICAgICAgICAgICAgICAgbW9yZTogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKGxpbmVbbGluZS5ieXRlTGVuZ3RoIC0gMV0gPT0gTEYxKSB7CiAgICAgICAgICAgIGxldCBkcm9wID0gMTsKICAgICAgICAgICAgaWYgKGxpbmUuYnl0ZUxlbmd0aCA+IDEgJiYgbGluZVtsaW5lLmJ5dGVMZW5ndGggLSAyXSA9PT0gQ1IxKSB7CiAgICAgICAgICAgICAgICBkcm9wID0gMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsaW5lID0gbGluZS5zdWJhcnJheSgwLCBsaW5lLmJ5dGVMZW5ndGggLSBkcm9wKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGluZSwKICAgICAgICAgICAgbW9yZTogZmFsc2UKICAgICAgICB9OwogICAgfQogICAgYXN5bmMgcmVhZFNsaWNlKGRlbGltKSB7CiAgICAgICAgbGV0IHMgPSAwOwogICAgICAgIGxldCBzbGljZTsKICAgICAgICB3aGlsZSh0cnVlKXsKICAgICAgICAgICAgbGV0IGkgPSB0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIgKyBzLCB0aGlzLncpLmluZGV4T2YoZGVsaW0pOwogICAgICAgICAgICBpZiAoaSA+PSAwKSB7CiAgICAgICAgICAgICAgICBpICs9IHM7CiAgICAgICAgICAgICAgICBzbGljZSA9IHRoaXMuYnVmLnN1YmFycmF5KHRoaXMuciwgdGhpcy5yICsgaSArIDEpOwogICAgICAgICAgICAgICAgdGhpcy5yICs9IGkgKyAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5yID09PSB0aGlzLncpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNsaWNlID0gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yLCB0aGlzLncpOwogICAgICAgICAgICAgICAgdGhpcy5yID0gdGhpcy53OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyZWQoKSA+PSB0aGlzLmJ1Zi5ieXRlTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnIgPSB0aGlzLnc7CiAgICAgICAgICAgICAgICBjb25zdCBvbGRidWYgPSB0aGlzLmJ1ZjsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld2J1ZiA9IHRoaXMuYnVmLnNsaWNlKDApOwogICAgICAgICAgICAgICAgdGhpcy5idWYgPSBuZXdidWY7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQnVmZmVyRnVsbEVycm9yMShvbGRidWYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHMgPSB0aGlzLncgLSB0aGlzLnI7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9maWxsKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgZXJyLnBhcnRpYWwgPSBzbGljZTsKICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2xpY2U7CiAgICB9CiAgICBhc3luYyBwZWVrKG4pIHsKICAgICAgICBpZiAobiA8IDApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoIm5lZ2F0aXZlIGNvdW50Iik7CiAgICAgICAgfQogICAgICAgIGxldCBhdmFpbCA9IHRoaXMudyAtIHRoaXMucjsKICAgICAgICB3aGlsZShhdmFpbCA8IG4gJiYgYXZhaWwgPCB0aGlzLmJ1Zi5ieXRlTGVuZ3RoICYmICF0aGlzLmVvZil7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9maWxsKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgZXJyLnBhcnRpYWwgPSB0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMudyk7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXZhaWwgPSB0aGlzLncgLSB0aGlzLnI7CiAgICAgICAgfQogICAgICAgIGlmIChhdmFpbCA9PT0gMCAmJiB0aGlzLmVvZikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9IGVsc2UgaWYgKGF2YWlsIDwgbiAmJiB0aGlzLmVvZikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yLCB0aGlzLnIgKyBhdmFpbCk7CiAgICAgICAgfSBlbHNlIGlmIChhdmFpbCA8IG4pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEJ1ZmZlckZ1bGxFcnJvcjEodGhpcy5idWYuc3ViYXJyYXkodGhpcy5yLCB0aGlzLncpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuYnVmLnN1YmFycmF5KHRoaXMuciwgdGhpcy5yICsgbik7CiAgICB9Cn0KY2xhc3MgQWJzdHJhY3RCdWZCYXNlMSB7CiAgICBidWY7CiAgICB1c2VkQnVmZmVyQnl0ZXMgPSAwOwogICAgZXJyID0gbnVsbDsKICAgIHNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYnVmLmJ5dGVMZW5ndGg7CiAgICB9CiAgICBhdmFpbGFibGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYnVmLmJ5dGVMZW5ndGggLSB0aGlzLnVzZWRCdWZmZXJCeXRlczsKICAgIH0KICAgIGJ1ZmZlcmVkKCkgewogICAgICAgIHJldHVybiB0aGlzLnVzZWRCdWZmZXJCeXRlczsKICAgIH0KfQpjbGFzcyBCdWZXcml0ZXIxIGV4dGVuZHMgQWJzdHJhY3RCdWZCYXNlMSB7CiAgICB3cml0ZXI7CiAgICBzdGF0aWMgY3JlYXRlKHdyaXRlciwgc2l6ZSA9IDQwOTYpIHsKICAgICAgICByZXR1cm4gd3JpdGVyIGluc3RhbmNlb2YgQnVmV3JpdGVyMSA/IHdyaXRlciA6IG5ldyBCdWZXcml0ZXIxKHdyaXRlciwgc2l6ZSk7CiAgICB9CiAgICBjb25zdHJ1Y3Rvcih3cml0ZXIzLCBzaXplNiA9IDQwOTYpewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy53cml0ZXIgPSB3cml0ZXIzOwogICAgICAgIGlmIChzaXplNiA8PSAwKSB7CiAgICAgICAgICAgIHNpemU2ID0gREVGQVVMVF9CVUZfU0laRTE7CiAgICAgICAgfQogICAgICAgIHRoaXMuYnVmID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZTYpOwogICAgfQogICAgcmVzZXQodykgewogICAgICAgIHRoaXMuZXJyID0gbnVsbDsKICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyA9IDA7CiAgICAgICAgdGhpcy53cml0ZXIgPSB3OwogICAgfQogICAgYXN5bmMgZmx1c2goKSB7CiAgICAgICAgaWYgKHRoaXMuZXJyICE9PSBudWxsKSB0aHJvdyB0aGlzLmVycjsKICAgICAgICBpZiAodGhpcy51c2VkQnVmZmVyQnl0ZXMgPT09IDApIHJldHVybjsKICAgICAgICB0cnkgewogICAgICAgICAgICBhd2FpdCBEZW5vLndyaXRlQWxsKHRoaXMud3JpdGVyLCB0aGlzLmJ1Zi5zdWJhcnJheSgwLCB0aGlzLnVzZWRCdWZmZXJCeXRlcykpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdGhpcy5lcnIgPSBlOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgICAgICB0aGlzLmJ1ZiA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmLmxlbmd0aCk7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgPSAwOwogICAgfQogICAgYXN5bmMgd3JpdGUoZGF0YSkgewogICAgICAgIGlmICh0aGlzLmVyciAhPT0gbnVsbCkgdGhyb3cgdGhpcy5lcnI7CiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSAwKSByZXR1cm4gMDsKICAgICAgICBsZXQgdG90YWxCeXRlc1dyaXR0ZW4gPSAwOwogICAgICAgIGxldCBudW1CeXRlc1dyaXR0ZW4gPSAwOwogICAgICAgIHdoaWxlKGRhdGEuYnl0ZUxlbmd0aCA+IHRoaXMuYXZhaWxhYmxlKCkpewogICAgICAgICAgICBpZiAodGhpcy5idWZmZXJlZCgpID09PSAwKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIG51bUJ5dGVzV3JpdHRlbiA9IGF3YWl0IHRoaXMud3JpdGVyLndyaXRlKGRhdGEpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyID0gZTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbnVtQnl0ZXNXcml0dGVuID0gY29weTEoZGF0YSwgdGhpcy5idWYsIHRoaXMudXNlZEJ1ZmZlckJ5dGVzKTsKICAgICAgICAgICAgICAgIHRoaXMudXNlZEJ1ZmZlckJ5dGVzICs9IG51bUJ5dGVzV3JpdHRlbjsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZmx1c2goKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0b3RhbEJ5dGVzV3JpdHRlbiArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgICAgIGRhdGEgPSBkYXRhLnN1YmFycmF5KG51bUJ5dGVzV3JpdHRlbik7CiAgICAgICAgfQogICAgICAgIG51bUJ5dGVzV3JpdHRlbiA9IGNvcHkxKGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgIHRvdGFsQnl0ZXNXcml0dGVuICs9IG51bUJ5dGVzV3JpdHRlbjsKICAgICAgICByZXR1cm4gdG90YWxCeXRlc1dyaXR0ZW47CiAgICB9Cn0KY2xhc3MgQnVmV3JpdGVyU3luYzEgZXh0ZW5kcyBBYnN0cmFjdEJ1ZkJhc2UxIHsKICAgIHdyaXRlcjsKICAgIHN0YXRpYyBjcmVhdGUod3JpdGVyLCBzaXplID0gNDA5NikgewogICAgICAgIHJldHVybiB3cml0ZXIgaW5zdGFuY2VvZiBCdWZXcml0ZXJTeW5jMSA/IHdyaXRlciA6IG5ldyBCdWZXcml0ZXJTeW5jMSh3cml0ZXIsIHNpemUpOwogICAgfQogICAgY29uc3RydWN0b3Iod3JpdGVyNCwgc2l6ZTcgPSA0MDk2KXsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMud3JpdGVyID0gd3JpdGVyNDsKICAgICAgICBpZiAoc2l6ZTcgPD0gMCkgewogICAgICAgICAgICBzaXplNyA9IERFRkFVTFRfQlVGX1NJWkUxOwogICAgICAgIH0KICAgICAgICB0aGlzLmJ1ZiA9IG5ldyBVaW50OEFycmF5KHNpemU3KTsKICAgIH0KICAgIHJlc2V0KHcpIHsKICAgICAgICB0aGlzLmVyciA9IG51bGw7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgPSAwOwogICAgICAgIHRoaXMud3JpdGVyID0gdzsKICAgIH0KICAgIGZsdXNoKCkgewogICAgICAgIGlmICh0aGlzLmVyciAhPT0gbnVsbCkgdGhyb3cgdGhpcy5lcnI7CiAgICAgICAgaWYgKHRoaXMudXNlZEJ1ZmZlckJ5dGVzID09PSAwKSByZXR1cm47CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgRGVuby53cml0ZUFsbFN5bmModGhpcy53cml0ZXIsIHRoaXMuYnVmLnN1YmFycmF5KDAsIHRoaXMudXNlZEJ1ZmZlckJ5dGVzKSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICB0aGlzLmVyciA9IGU7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICAgIHRoaXMuYnVmID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWYubGVuZ3RoKTsKICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyA9IDA7CiAgICB9CiAgICB3cml0ZVN5bmMoZGF0YSkgewogICAgICAgIGlmICh0aGlzLmVyciAhPT0gbnVsbCkgdGhyb3cgdGhpcy5lcnI7CiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSAwKSByZXR1cm4gMDsKICAgICAgICBsZXQgdG90YWxCeXRlc1dyaXR0ZW4gPSAwOwogICAgICAgIGxldCBudW1CeXRlc1dyaXR0ZW4gPSAwOwogICAgICAgIHdoaWxlKGRhdGEuYnl0ZUxlbmd0aCA+IHRoaXMuYXZhaWxhYmxlKCkpewogICAgICAgICAgICBpZiAodGhpcy5idWZmZXJlZCgpID09PSAwKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIG51bUJ5dGVzV3JpdHRlbiA9IHRoaXMud3JpdGVyLndyaXRlU3luYyhkYXRhKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVyciA9IGU7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG51bUJ5dGVzV3JpdHRlbiA9IGNvcHkxKGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgICAgICAgICB0aGlzLmZsdXNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG90YWxCeXRlc1dyaXR0ZW4gKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgICAgICBkYXRhID0gZGF0YS5zdWJhcnJheShudW1CeXRlc1dyaXR0ZW4pOwogICAgICAgIH0KICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5MShkYXRhLCB0aGlzLmJ1ZiwgdGhpcy51c2VkQnVmZmVyQnl0ZXMpOwogICAgICAgIHRoaXMudXNlZEJ1ZmZlckJ5dGVzICs9IG51bUJ5dGVzV3JpdHRlbjsKICAgICAgICB0b3RhbEJ5dGVzV3JpdHRlbiArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgcmV0dXJuIHRvdGFsQnl0ZXNXcml0dGVuOwogICAgfQp9CmZ1bmN0aW9uIGZvcm1hdChjb2RlLCBtc2cpIHsKICAgIGlmICghbXNnKSB7CiAgICAgICAgcmV0dXJuIGNvZGU7CiAgICB9CiAgICByZXR1cm4gYCR7Y29kZX0gLSAke21zZ31gOwp9CmNsYXNzIEZyYW1lRXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgICBjb2RlOwogICAgY29uc3RydWN0b3IoY29kZSwgbXNnKXsKICAgICAgICBzdXBlcihmb3JtYXQoY29kZSwgbXNnKSk7CiAgICAgICAgdGhpcy5jb2RlID0gY29kZTsKICAgIH0KfQpjbGFzcyBBbXFwRnJhbWVSZWFkZXIgewogICAgI3RpbWVyID0gbnVsbDsKICAgICNyZWFkZXI7CiAgICBjb25zdHJ1Y3RvcihyKXsKICAgICAgICB0aGlzLiNyZWFkZXIgPSBCdWZSZWFkZXIxLmNyZWF0ZShyKTsKICAgIH0KICAgICNyZWFkQnl0ZXMgPSBhc3luYyAobGVuZ3RoKT0+ewogICAgICAgIGNvbnN0IG4gPSBhd2FpdCB0aGlzLiNyZWFkZXIucmVhZEZ1bGwobmV3IFVpbnQ4QXJyYXkobGVuZ3RoKSk7CiAgICAgICAgaWYgKG4gPT09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZyYW1lRXJyb3IoIkVPRiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbjsKICAgIH07CiAgICAjcmVhZEZyYW1lID0gYXN5bmMgKCk9PnsKICAgICAgICBjb25zdCBwcmVmaXggPSBhd2FpdCB0aGlzLiNyZWFkQnl0ZXMoNyk7CiAgICAgICAgY29uc3QgcHJlZml4VmlldyA9IG5ldyBEYXRhVmlldyhwcmVmaXguYnVmZmVyKTsKICAgICAgICBjb25zdCB0eXBlID0gcHJlZml4Vmlldy5nZXRVaW50OCgwKTsKICAgICAgICBjb25zdCBjaGFubmVsID0gcHJlZml4Vmlldy5nZXRVaW50MTYoMSk7CiAgICAgICAgY29uc3QgbGVuZ3RoID0gcHJlZml4Vmlldy5nZXRVaW50MzIoMyk7CiAgICAgICAgY29uc3QgcmVzdCA9IGF3YWl0IHRoaXMuI3JlYWRCeXRlcyhsZW5ndGggKyAxKTsKICAgICAgICBjb25zdCBlbmRCeXRlID0gcmVzdFtyZXN0Lmxlbmd0aCAtIDFdOwogICAgICAgIGlmIChlbmRCeXRlICE9PSAyMDYpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZyYW1lRXJyb3IoIkJBRF9GUkFNRSIsIGB1bmV4cGVjdGVkIEZSQU1FX0VORCAnJHtlbmRCeXRlfSdgKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcGF5bG9hZCA9IHJlc3Quc2xpY2UoMCwgcmVzdC5sZW5ndGggLSAxKTsKICAgICAgICBpZiAodHlwZSA9PT0gMSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdHlwZTogIm1ldGhvZCIsCiAgICAgICAgICAgICAgICBjaGFubmVsOiBjaGFubmVsLAogICAgICAgICAgICAgICAgcGF5bG9hZDogZGVjb2RlTWV0aG9kKHBheWxvYWQpCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlID09PSAyKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiaGVhZGVyIiwKICAgICAgICAgICAgICAgIGNoYW5uZWwsCiAgICAgICAgICAgICAgICBwYXlsb2FkOiBkZWNvZGVIZWFkZXIocGF5bG9hZCkKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGUgPT09IDMpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6ICJjb250ZW50IiwKICAgICAgICAgICAgICAgIGNoYW5uZWwsCiAgICAgICAgICAgICAgICBwYXlsb2FkCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlID09PSA4KSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiaGVhcnRiZWF0IiwKICAgICAgICAgICAgICAgIGNoYW5uZWwsCiAgICAgICAgICAgICAgICBwYXlsb2FkCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBGcmFtZUVycm9yKCJCQURfRlJBTUUiLCBgdW5leHBlY3RlZCBmcmFtZSB0eXBlICcke3R5cGV9J2ApOwogICAgfTsKICAgIGFzeW5jIGFib3J0KCkgewogICAgICAgIGlmICh0aGlzLiN0aW1lciAhPT0gbnVsbCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy4jdGltZXIpOwogICAgICAgIH0KICAgIH0KICAgIHJlYWQodGltZW91dCkgewogICAgICAgIHRoaXMuYWJvcnQoKTsKICAgICAgICBpZiAodGltZW91dCA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiNyZWFkRnJhbWUoKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdGltZW91dE1lc3NhZ2UgPSBgc2VydmVyIGhlYXJ0YmVhdCB0aW1lb3V0ICR7dGltZW91dH1tc2A7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpPT57CiAgICAgICAgICAgIHRoaXMuI3RpbWVyID0gc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcih0aW1lb3V0TWVzc2FnZSkpOwogICAgICAgICAgICB9LCB0aW1lb3V0KTsKICAgICAgICAgICAgdGhpcy4jcmVhZEZyYW1lKCkudGhlbihyZXNvbHZlKS5jYXRjaChyZWplY3QpLmZpbmFsbHkoKCk9PnRoaXMuYWJvcnQoKQogICAgICAgICAgICApOwogICAgICAgIH0pOwogICAgfQp9CmNvbnN0IFRZUEVTID0gewogICAgbWV0aG9kOiAxLAogICAgaGVhZGVyOiAyLAogICAgY29udGVudDogMywKICAgIGhlYXJ0YmVhdDogOAp9OwpmdW5jdGlvbiBlbmNvZGVGcmFtZShmcmFtZSkgewogICAgbGV0IHBheWxvYWQ7CiAgICBzd2l0Y2goZnJhbWUudHlwZSl7CiAgICAgICAgY2FzZSAibWV0aG9kIjoKICAgICAgICAgICAgcGF5bG9hZCA9IGVuY29kZU1ldGhvZChmcmFtZS5wYXlsb2FkKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiaGVhZGVyIjoKICAgICAgICAgICAgcGF5bG9hZCA9IGVuY29kZUhlYWRlcihmcmFtZS5wYXlsb2FkKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcGF5bG9hZCA9IGZyYW1lLnBheWxvYWQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgfQogICAgY29uc3QgZGF0YTIgPSBuZXcgVWludDhBcnJheSg3ICsgcGF5bG9hZC5sZW5ndGggKyAxKTsKICAgIGNvbnN0IHZpZXcgPSBuZXcgRGF0YVZpZXcoZGF0YTIuYnVmZmVyKTsKICAgIGNvbnN0IHR5cGUgPSBUWVBFU1tmcmFtZS50eXBlXTsKICAgIHZpZXcuc2V0VWludDgoMCwgdHlwZSk7CiAgICB2aWV3LnNldFVpbnQxNigxLCBmcmFtZS5jaGFubmVsKTsKICAgIHZpZXcuc2V0VWludDMyKDMsIHBheWxvYWQubGVuZ3RoKTsKICAgIGRhdGEyLnNldChwYXlsb2FkLCA3KTsKICAgIHZpZXcuc2V0VWludDgoNyArIHBheWxvYWQubGVuZ3RoLCAyMDYpOwogICAgcmV0dXJuIGRhdGEyOwp9CmNvbnN0IEhFQVJUQkVBVF9GUkFNRSA9IG5ldyBVaW50OEFycmF5KFsKICAgIDgsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAyMDYsIApdKTsKZnVuY3Rpb24gc3BsaXRBcnJheTEoYXJyLCBzaXplOCkgewogICAgY29uc3QgY2h1bmtzID0gW107CiAgICBsZXQgaW5kZXggPSAwOwogICAgd2hpbGUoaW5kZXggPCBhcnIubGVuZ3RoKXsKICAgICAgICBjaHVua3MucHVzaChhcnIuc2xpY2UoaW5kZXgsIHNpemU4ICsgaW5kZXgpKTsKICAgICAgICBpbmRleCArPSBzaXplODsKICAgIH0KICAgIHJldHVybiBjaHVua3M7Cn0KY2xhc3MgQW1xcFNvY2tldCB7CiAgICAjY29ubjsKICAgICNyZWFkZXI7CiAgICAjc2VuZFRpbWVyID0gbnVsbDsKICAgICNzZW5kVGltZW91dCA9IDA7CiAgICAjcmVhZFRpbWVvdXQgPSAwOwogICAgI2ZyYW1lTWF4ID0gLTE7CiAgICBjb25zdHJ1Y3Rvcihjb25uKXsKICAgICAgICB0aGlzLiNjb25uID0gY29ubjsKICAgICAgICB0aGlzLiNyZWFkZXIgPSBuZXcgQW1xcEZyYW1lUmVhZGVyKGNvbm4pOwogICAgfQogICAgI3Jlc2V0U2VuZFRpbWVyID0gKCk9PnsKICAgICAgICBpZiAodGhpcy4jc2VuZFRpbWVyICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLiNzZW5kVGltZXIpOwogICAgICAgICAgICB0aGlzLiNzZW5kVGltZXIgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy4jc2VuZFRpbWVvdXQgPiAwKSB7CiAgICAgICAgICAgIHRoaXMuI3NlbmRUaW1lciA9IHNldFRpbWVvdXQoKCk9PnsKICAgICAgICAgICAgICAgIHRoaXMuI2Nvbm4ud3JpdGUoSEVBUlRCRUFUX0ZSQU1FKTsKICAgICAgICAgICAgICAgIHRoaXMuI3Jlc2V0U2VuZFRpbWVyKCk7CiAgICAgICAgICAgIH0sIHRoaXMuI3NlbmRUaW1lb3V0KTsKICAgICAgICB9CiAgICB9OwogICAgdHVuZShvcHRpb25zKSB7CiAgICAgICAgdGhpcy4jcmVhZFRpbWVvdXQgPSBvcHRpb25zLnJlYWRUaW1lb3V0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnJlYWRUaW1lb3V0IDogdGhpcy4jcmVhZFRpbWVvdXQ7CiAgICAgICAgdGhpcy4jc2VuZFRpbWVvdXQgPSBvcHRpb25zLnNlbmRUaW1lb3V0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnNlbmRUaW1lb3V0IDogdGhpcy4jc2VuZFRpbWVvdXQ7CiAgICAgICAgdGhpcy4jZnJhbWVNYXggPSBvcHRpb25zLmZyYW1lTWF4ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmZyYW1lTWF4IDogdGhpcy4jZnJhbWVNYXg7CiAgICAgICAgdGhpcy4jcmVzZXRTZW5kVGltZXIoKTsKICAgIH0KICAgIGFzeW5jIHN0YXJ0KCkgewogICAgICAgIGF3YWl0IHRoaXMuI2Nvbm4ud3JpdGUobmV3IFVpbnQ4QXJyYXkoWwogICAgICAgICAgICAuLi5uZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoIkFNUVAiKSwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgOSwKICAgICAgICAgICAgMQogICAgICAgIF0pKTsKICAgIH0KICAgIGFzeW5jIHdyaXRlKGZyYW1lKSB7CiAgICAgICAgdGhpcy4jcmVzZXRTZW5kVGltZXIoKTsKICAgICAgICBpZiAoZnJhbWUudHlwZSA9PT0gImNvbnRlbnQiICYmIHRoaXMuI2ZyYW1lTWF4ID4gOCAmJiBmcmFtZS5wYXlsb2FkLmxlbmd0aCA+IHRoaXMuI2ZyYW1lTWF4IC0gOCkgewogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChzcGxpdEFycmF5MShmcmFtZS5wYXlsb2FkLCB0aGlzLiNmcmFtZU1heCAtIDgpLm1hcCgoY2h1bmspPT57CiAgICAgICAgICAgICAgICB0aGlzLiNjb25uLndyaXRlKGVuY29kZUZyYW1lKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiY29udGVudCIsCiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbDogZnJhbWUuY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiBjaHVuawogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYXdhaXQgdGhpcy4jY29ubi53cml0ZShlbmNvZGVGcmFtZShmcmFtZSkpOwogICAgfQogICAgI2NsZWFyID0gKCk9PnsKICAgICAgICB0aGlzLiNyZWFkVGltZW91dCA9IDA7CiAgICAgICAgdGhpcy4jc2VuZFRpbWVvdXQgPSAwOwogICAgICAgIHRoaXMuI3JlYWRlci5hYm9ydCgpOwogICAgICAgIHRoaXMuI3Jlc2V0U2VuZFRpbWVyKCk7CiAgICB9OwogICAgYXN5bmMgcmVhZCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy4jcmVhZGVyLnJlYWQodGhpcy4jcmVhZFRpbWVvdXQpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgfQogICAgfQogICAgY2xvc2UoKSB7CiAgICAgICAgdGhpcy4jY2xlYXIoKTsKICAgICAgICB0aGlzLiNjb25uLmNsb3NlKCk7CiAgICB9Cn0KZnVuY3Rpb24gY3JlYXRlUmVzb2x2YWJsZSgpIHsKICAgIGxldCByZXNvbHZlRnVuOwogICAgbGV0IHJlamVjdEZ1bjsKICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+ewogICAgICAgIHJlc29sdmVGdW4gPSByZXNvbHZlOwogICAgICAgIHJlamVjdEZ1biA9IHJlamVjdDsKICAgIH0pOwogICAgcHJvbWlzZS5jYXRjaCgoKT0+ewogICAgfSk7CiAgICByZXR1cm4gewogICAgICAgIHRoZW46IHByb21pc2UudGhlbi5iaW5kKHByb21pc2UpLAogICAgICAgIHJlc29sdmUgKHZhbHVlKSB7CiAgICAgICAgICAgIHJlc29sdmVGdW4odmFsdWUpOwogICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICB9LAogICAgICAgIHJlamVjdCAocmVhc29uKSB7CiAgICAgICAgICAgIHJlamVjdEZ1bihyZWFzb24pOwogICAgICAgIH0KICAgIH07Cn0KZnVuY3Rpb24gc2VyaWFsaXplQ2hhbm5lbEVycm9yKGNoYW5uZWwsIGFyZ3MpIHsKICAgIGNvbnN0IGNhdXNlZEJ5ID0gZ2V0TWV0aG9kTmFtZShhcmdzLmNsYXNzSWQsIGFyZ3MubWV0aG9kSWQpOwogICAgcmV0dXJuIGBDaGFubmVsICR7Y2hhbm5lbH0gY2xvc2VkIGJ5IHNlcnZlciAtICR7YXJncy5yZXBseUNvZGV9ICR7YXJncy5yZXBseVRleHQgfHwgIiJ9JHtjYXVzZWRCeSA/IGAgLSBjYXVzZWQgYnkgJyR7Y2F1c2VkQnl9J2AgOiAiIn1gOwp9CmZ1bmN0aW9uIHNlcmlhbGl6ZUNvbm5lY3Rpb25FcnJvcihhcmdzKSB7CiAgICBjb25zdCBjYXVzZWRCeSA9IGdldE1ldGhvZE5hbWUoYXJncy5jbGFzc0lkLCBhcmdzLm1ldGhvZElkKTsKICAgIHJldHVybiBgQ29ubmVjdGlvbiBjbG9zZWQgYnkgc2VydmVyIC0gJHthcmdzLnJlcGx5Q29kZX0gJHthcmdzLnJlcGx5VGV4dCB8fCAiIn0ke2NhdXNlZEJ5ID8gYCAtIGNhdXNlZCBieSAnJHtjYXVzZWRCeX0nYCA6ICIifWA7Cn0KY2xhc3MgQW1xcENoYW5uZWwgewogICAgI2NhbmNlbERlbGl2ZXJTdWJzY3JpcHRpb247CiAgICAjY2FuY2VsUmV0dXJuU3Vic2NyaXB0aW9uOwogICAgI3N1YnNjcmliZXJzID0gW107CiAgICAjY2hhbm5lbE51bWJlcjsKICAgICNwcm90b2NvbDsKICAgICNjbG9zZWRQcm9taXNlID0gY3JlYXRlUmVzb2x2YWJsZSgpOwogICAgI2lzT3BlbiA9IHRydWU7CiAgICBjb25zdHJ1Y3RvcihjaGFubmVsTnVtYmVyLCBwcm90b2NvbCl7CiAgICAgICAgdGhpcy4jcHJvdG9jb2wgPSBwcm90b2NvbDsKICAgICAgICB0aGlzLiNjaGFubmVsTnVtYmVyID0gY2hhbm5lbE51bWJlcjsKICAgICAgICB0aGlzLiNjYW5jZWxEZWxpdmVyU3Vic2NyaXB0aW9uID0gcHJvdG9jb2wuc3Vic2NyaWJlQmFzaWNEZWxpdmVyKGNoYW5uZWxOdW1iZXIsIHRoaXMuI2hhbmRsZURlbGl2ZXIpOwogICAgICAgIHRoaXMuI2NhbmNlbFJldHVyblN1YnNjcmlwdGlvbiA9IHByb3RvY29sLnN1YnNjcmliZUJhc2ljUmV0dXJuKGNoYW5uZWxOdW1iZXIsIHRoaXMuI2hhbmRsZVJldHVybik7CiAgICAgICAgcHJvdG9jb2wucmVjZWl2ZUNoYW5uZWxDbG9zZShjaGFubmVsTnVtYmVyKS50aGVuKHRoaXMuI2hhbmRsZUNsb3NlKS5jYXRjaCh0aGlzLiNoYW5kbGVDbG9zZUVycm9yKS5maW5hbGx5KCgpPT57CiAgICAgICAgICAgIHRoaXMuI2lzT3BlbiA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICAgIHByb3RvY29sLnJlY2VpdmVDb25uZWN0aW9uQ2xvc2UoMCkudGhlbih0aGlzLiNoYW5kbGVDb25uZWN0aW9uQ2xvc2UpLmNhdGNoKHRoaXMuI2hhbmRsZUNsb3NlRXJyb3IpLmZpbmFsbHkoKCk9PnsKICAgICAgICAgICAgdGhpcy4jaXNPcGVuID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9CiAgICAjaGFuZGxlQ2xvc2VFcnJvciA9IGFzeW5jIChlcnJvcik9PnsKICAgICAgICB0aGlzLiNjbGVhbnVwKCk7CiAgICAgICAgdGhpcy4jY2xvc2VkUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogICAgfTsKICAgICNoYW5kbGVDbG9zZSA9IGFzeW5jIChhcmdzKT0+ewogICAgICAgIGlmICh0aGlzLiNpc09wZW4pIHsKICAgICAgICAgICAgYXdhaXQgdGhpcy4jcHJvdG9jb2wuc2VuZENoYW5uZWxDbG9zZU9rKHRoaXMuI2NoYW5uZWxOdW1iZXIsIHsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuI2NsZWFudXAoKTsKICAgICAgICAgICAgdGhpcy4jY2xvc2VkUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKHNlcmlhbGl6ZUNoYW5uZWxFcnJvcih0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKSkpOwogICAgICAgIH0KICAgIH07CiAgICAjaGFuZGxlQ29ubmVjdGlvbkNsb3NlID0gYXN5bmMgKGFyZ3MpPT57CiAgICAgICAgaWYgKHRoaXMuI2lzT3BlbikgewogICAgICAgICAgICB0aGlzLiNjbGVhbnVwKCk7CiAgICAgICAgICAgIHRoaXMuI2Nsb3NlZFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihzZXJpYWxpemVDb25uZWN0aW9uRXJyb3IoYXJncykpKTsKICAgICAgICB9CiAgICB9OwogICAgI2hhbmRsZURlbGl2ZXIgPSAoYXJncywgcHJvcHMsIGRhdGEyKT0+ewogICAgICAgIHRoaXMuI3N1YnNjcmliZXJzLmZvckVhY2goKHN1YnNjcmliZXIpPT57CiAgICAgICAgICAgIGlmIChzdWJzY3JpYmVyLnR5cGUgPT09ICJkZWxpdmVyIiAmJiBzdWJzY3JpYmVyLnRhZyA9PT0gYXJncy5jb25zdW1lclRhZykgewogICAgICAgICAgICAgICAgc3Vic2NyaWJlci5oYW5kbGVyKGFyZ3MsIHByb3BzLCBkYXRhMik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CiAgICAjaGFuZGxlUmV0dXJuID0gKGFyZ3MsIHByb3BzLCBkYXRhMik9PnsKICAgICAgICB0aGlzLiNzdWJzY3JpYmVycy5mb3JFYWNoKChzdWJzY3JpYmVyKT0+ewogICAgICAgICAgICBpZiAoc3Vic2NyaWJlci50eXBlID09PSAicmV0dXJuIikgewogICAgICAgICAgICAgICAgc3Vic2NyaWJlci5oYW5kbGVyKGFyZ3MsIHByb3BzLCBkYXRhMik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CiAgICAjY2xlYW51cCA9ICgpPT57CiAgICAgICAgdGhpcy4jY2FuY2VsRGVsaXZlclN1YnNjcmlwdGlvbigpOwogICAgICAgIHRoaXMuI2NhbmNlbFJldHVyblN1YnNjcmlwdGlvbigpOwogICAgICAgIHRoaXMuI3N1YnNjcmliZXJzLnNwbGljZSgwLCB0aGlzLiNzdWJzY3JpYmVycy5sZW5ndGgpOwogICAgfTsKICAgIGFzeW5jIGNsb3NlZCgpIHsKICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy4jY2xvc2VkUHJvbWlzZTsKICAgIH0KICAgIGFzeW5jIGNsb3NlKCkgewogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDaGFubmVsQ2xvc2UodGhpcy4jY2hhbm5lbE51bWJlciwgewogICAgICAgICAgICBjbGFzc0lkOiAwLAogICAgICAgICAgICBtZXRob2RJZDogMCwKICAgICAgICAgICAgcmVwbHlDb2RlOiAzMjAsCiAgICAgICAgICAgIHJlcGx5VGV4dDogIkNoYW5uZWwgY2xvc2VkIGJ5IGNsaWVudCIKICAgICAgICB9KTsKICAgICAgICB0aGlzLiNjbGVhbnVwKCk7CiAgICAgICAgdGhpcy4jY2xvc2VkUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgdGhpcy4jaXNPcGVuID0gZmFsc2U7CiAgICB9CiAgICBhc3luYyBxb3MoYXJncykgewogICAgICAgIHJldHVybiB0aGlzLiNwcm90b2NvbC5zZW5kQmFzaWNRb3ModGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyBhY2soYXJncykgewogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRCYXNpY0Fjayh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIG5hY2soYXJncykgewogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRCYXNpY05hY2sodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyBjb25zdW1lKGFyZ3MsIGhhbmRsZXIpIHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRCYXNpY0NvbnN1bWUodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICAgICAgdGhpcy4jc3Vic2NyaWJlcnMucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICJkZWxpdmVyIiwKICAgICAgICAgICAgdGFnOiByZXNwb25zZS5jb25zdW1lclRhZywKICAgICAgICAgICAgaGFuZGxlcgogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KICAgIGFzeW5jIGNhbmNlbChhcmdzKSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLiNwcm90b2NvbC5zZW5kQmFzaWNDYW5jZWwodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLiNzdWJzY3JpYmVycy5maW5kSW5kZXgoKHN1Yik9PnN1Yi50eXBlID09PSAiZGVsaXZlciIgJiYgc3ViLnRhZyA9PT0gYXJncy5jb25zdW1lclRhZwogICAgICAgICk7CiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgICB0aGlzLiNzdWJzY3JpYmVycy5zcGxpY2UoaW5kZXgsIGluZGV4ICsgMSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KICAgIGFzeW5jIHB1Ymxpc2goYXJncywgcHJvcHMsIGRhdGEpIHsKICAgICAgICBhd2FpdCB0aGlzLiNwcm90b2NvbC5zZW5kQmFzaWNQdWJsaXNoKHRoaXMuI2NoYW5uZWxOdW1iZXIsIGFyZ3MsIHByb3BzLCBkYXRhKTsKICAgIH0KICAgIGFzeW5jIGRlY2xhcmVRdWV1ZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRRdWV1ZURlY2xhcmUodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyBkZWxldGVRdWV1ZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRRdWV1ZURlbGV0ZSh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIGJpbmRRdWV1ZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRRdWV1ZUJpbmQodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyB1bmJpbmRRdWV1ZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRRdWV1ZVVuYmluZCh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHB1cmdlUXVldWUoYXJncykgewogICAgICAgIHJldHVybiB0aGlzLiNwcm90b2NvbC5zZW5kUXVldWVQdXJnZSh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIGRlbGV0ZUV4Y2hhbmdlKGFyZ3MpIHsKICAgICAgICByZXR1cm4gdGhpcy4jcHJvdG9jb2wuc2VuZEV4Y2hhbmdlRGVsZXRlKHRoaXMuI2NoYW5uZWxOdW1iZXIsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgZGVjbGFyZUV4Y2hhbmdlKGFyZ3MpIHsKICAgICAgICByZXR1cm4gdGhpcy4jcHJvdG9jb2wuc2VuZEV4Y2hhbmdlRGVjbGFyZSh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIGJpbmRFeGNoYW5nZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRFeGNoYW5nZUJpbmQodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyB1bmJpbmRFeGNoYW5nZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRFeGNoYW5nZVVuYmluZCh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIG9uKGV2ZW50LCBoYW5kbGVyKSB7CiAgICAgICAgc3dpdGNoKGV2ZW50KXsKICAgICAgICAgICAgY2FzZSAicmV0dXJuIjoKICAgICAgICAgICAgICAgIHRoaXMuI3N1YnNjcmliZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImRlbGl2ZXIiOgogICAgICAgICAgICAgICAgdGhpcy4jc3Vic2NyaWJlcnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogImRlbGl2ZXIiLAogICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gZXZlbnQgJyR7ZXZlbnR9J2ApOwogICAgICAgIH0KICAgIH0KICAgIG9mZihldmVudCwgaGFuZGxlcikgewogICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy4jc3Vic2NyaWJlcnMuZmluZEluZGV4KChzdWIpPT5zdWIudHlwZSA9PT0gZXZlbnQgJiYgc3ViLmhhbmRsZXIgPT09IGhhbmRsZXIKICAgICAgICApOwogICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgdGhpcy4jc3Vic2NyaWJlcnMuc3BsaWNlKGluZGV4LCBpbmRleCArIDEpOwogICAgICAgIH0KICAgIH0KfQpjbGFzcyBBbXFwUHJvdG9jb2wgewogICAgbXV4OwogICAgY29uc3RydWN0b3IobXV4KXsKICAgICAgICB0aGlzLm11eCA9IG11eDsKICAgIH0KICAgIGFzeW5jIHNlbmRDb25uZWN0aW9uU3RhcnRPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAxMCwgMTEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZENvbm5lY3Rpb25TZWN1cmVPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAxMCwgMjEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZENvbm5lY3Rpb25UdW5lT2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgMTAsIDMxLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRDb25uZWN0aW9uT3BlbihjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAxMCwgNDAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDEwLCA0MSk7CiAgICB9CiAgICBhc3luYyBzZW5kQ29ubmVjdGlvbkNsb3NlKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDEwLCA1MCwgYXJncyk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgMTAsIDUxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRDb25uZWN0aW9uQ2xvc2VPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAxMCwgNTEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZENoYW5uZWxPcGVuKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDIwLCAxMCwgYXJncyk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgMjAsIDExKTsKICAgIH0KICAgIGFzeW5jIHNlbmRDaGFubmVsRmxvdyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAyMCwgMjAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDIwLCAyMSk7CiAgICB9CiAgICBhc3luYyBzZW5kQ2hhbm5lbENsb3NlKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDIwLCA0MCwgYXJncyk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgMjAsIDQxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRDaGFubmVsQ2xvc2VPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAyMCwgNDEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlRGVjbGFyZUFzeW5jKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCAxMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IHRydWUKICAgICAgICB9KTsKICAgIH0KICAgIGFzeW5jIHNlbmRFeGNoYW5nZURlY2xhcmUoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNDAsIDEwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA0MCwgMTEpOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlRGVjbGFyZU9rKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCAxMSwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kRXhjaGFuZ2VEZWxldGVBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA0MCwgMjAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kRXhjaGFuZ2VEZWxldGUoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNDAsIDIwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA0MCwgMjEpOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlRGVsZXRlT2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNDAsIDIxLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRFeGNoYW5nZUJpbmRBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA0MCwgMzAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kRXhjaGFuZ2VCaW5kKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCAzMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNDAsIDMxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRFeGNoYW5nZUJpbmRPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA0MCwgMzEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlVW5iaW5kQXN5bmMoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNDAsIDQwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogdHJ1ZQogICAgICAgIH0pOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlVW5iaW5kKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCA0MCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNDAsIDUxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRFeGNoYW5nZVVuYmluZE9rKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCA1MSwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVEZWNsYXJlQXN5bmMoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNTAsIDEwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogdHJ1ZQogICAgICAgIH0pOwogICAgfQogICAgYXN5bmMgc2VuZFF1ZXVlRGVjbGFyZShjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMTAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDUwLCAxMSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVEZWNsYXJlT2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNTAsIDExLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRRdWV1ZUJpbmRBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMjAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVCaW5kKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDUwLCAyMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNTAsIDIxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRRdWV1ZUJpbmRPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMjEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZFF1ZXVlUHVyZ2VBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMzAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVQdXJnZShjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMzAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDUwLCAzMSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVQdXJnZU9rKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDUwLCAzMSwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVEZWxldGVBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgNDAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVEZWxldGUoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNTAsIDQwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA1MCwgNDEpOwogICAgfQogICAgYXN5bmMgc2VuZFF1ZXVlRGVsZXRlT2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNTAsIDQxLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRRdWV1ZVVuYmluZChjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgNTAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDUwLCA1MSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVVbmJpbmRPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgNTEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZEJhc2ljUW9zKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCAxMCwgYXJncyk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNjAsIDExKTsKICAgIH0KICAgIGFzeW5jIHNlbmRCYXNpY0NvbnN1bWVBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA2MCwgMjAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kQmFzaWNDb25zdW1lKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCAyMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNjAsIDIxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRCYXNpY0NhbmNlbEFzeW5jKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCAzMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IHRydWUKICAgICAgICB9KTsKICAgIH0KICAgIGFzeW5jIHNlbmRCYXNpY0NhbmNlbChjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA2MCwgMzAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDYwLCAzMSk7CiAgICB9CiAgICBhc3luYyBzZW5kQmFzaWNQdWJsaXNoKGNoYW5uZWwsIGFyZ3MsIHByb3BzLCBkYXRhKSB7CiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoWwogICAgICAgICAgICB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCA0MCwgYXJncyksCiAgICAgICAgICAgIHRoaXMubXV4LnNlbmRDb250ZW50KGNoYW5uZWwsIDYwLCBwcm9wcywgZGF0YSksIAogICAgICAgIF0pOwogICAgfQogICAgYXN5bmMgc2VuZEJhc2ljR2V0KGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCA3MCwgYXJncyk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmFjZShbCiAgICAgICAgICAgIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNjAsIDcxKSwKICAgICAgICAgICAgdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA2MCwgNzIpLCAKICAgICAgICBdKTsKICAgIH0KICAgIGFzeW5jIHNlbmRCYXNpY0FjayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA2MCwgODAsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZEJhc2ljUmVqZWN0KGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCA5MCwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kQmFzaWNSZWNvdmVyQXN5bmMoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNjAsIDEwMCwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kQmFzaWNSZWNvdmVyKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCAxMTAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDYwLCAxMTEpOwogICAgfQogICAgYXN5bmMgc2VuZEJhc2ljTmFjayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA2MCwgMTIwLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRUeFNlbGVjdChjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA5MCwgMTAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDkwLCAxMSk7CiAgICB9CiAgICBhc3luYyBzZW5kVHhDb21taXQoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgOTAsIDIwLCBhcmdzKTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA5MCwgMjEpOwogICAgfQogICAgYXN5bmMgc2VuZFR4Um9sbGJhY2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgOTAsIDMwLCBhcmdzKTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA5MCwgMzEpOwogICAgfQogICAgYXN5bmMgc2VuZENvbmZpcm1TZWxlY3RBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA4NSwgMTAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kQ29uZmlybVNlbGVjdChjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA4NSwgMTAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDg1LCAxMSk7CiAgICB9CiAgICBhc3luYyByZWNlaXZlQ29ubmVjdGlvblN0YXJ0KGNoYW5uZWwpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCAxMCwgMTApOwogICAgfQogICAgYXN5bmMgcmVjZWl2ZUNvbm5lY3Rpb25TZWN1cmUoY2hhbm5lbCkgewogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDEwLCAyMCk7CiAgICB9CiAgICBhc3luYyByZWNlaXZlQ29ubmVjdGlvblR1bmUoY2hhbm5lbCkgewogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDEwLCAzMCk7CiAgICB9CiAgICBhc3luYyByZWNlaXZlQ29ubmVjdGlvbkNsb3NlKGNoYW5uZWwpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCAxMCwgNTApOwogICAgfQogICAgYXN5bmMgcmVjZWl2ZUNoYW5uZWxGbG93KGNoYW5uZWwpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCAyMCwgMjApOwogICAgfQogICAgYXN5bmMgcmVjZWl2ZUNoYW5uZWxDbG9zZShjaGFubmVsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgMjAsIDQwKTsKICAgIH0KICAgIGFzeW5jIHJlY2VpdmVCYXNpY0FjayhjaGFubmVsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNjAsIDgwKTsKICAgIH0KICAgIGFzeW5jIHJlY2VpdmVCYXNpY05hY2soY2hhbm5lbCkgewogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDYwLCAxMjApOwogICAgfQogICAgc3Vic2NyaWJlQ29ubmVjdGlvblN0YXJ0KGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDEwLCAxMCwgaGFuZGxlcik7CiAgICB9CiAgICBzdWJzY3JpYmVDb25uZWN0aW9uU2VjdXJlKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDEwLCAyMCwgaGFuZGxlcik7CiAgICB9CiAgICBzdWJzY3JpYmVDb25uZWN0aW9uVHVuZShjaGFubmVsLCBoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnN1YnNjcmliZShjaGFubmVsLCAxMCwgMzAsIGhhbmRsZXIpOwogICAgfQogICAgc3Vic2NyaWJlQ29ubmVjdGlvbkNsb3NlKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDEwLCA1MCwgaGFuZGxlcik7CiAgICB9CiAgICBzdWJzY3JpYmVDaGFubmVsRmxvdyhjaGFubmVsLCBoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnN1YnNjcmliZShjaGFubmVsLCAyMCwgMjAsIGhhbmRsZXIpOwogICAgfQogICAgc3Vic2NyaWJlQ2hhbm5lbENsb3NlKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDIwLCA0MCwgaGFuZGxlcik7CiAgICB9CiAgICBzdWJzY3JpYmVCYXNpY1JldHVybihjaGFubmVsLCBoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnN1YnNjcmliZShjaGFubmVsLCA2MCwgNTAsIGFzeW5jIChtZXRob2QpPT57CiAgICAgICAgICAgIGNvbnN0IFtwcm9wcywgY29udGVudF0gPSBhd2FpdCB0aGlzLm11eC5yZWNlaXZlQ29udGVudChjaGFubmVsLCA2MCk7CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVyKG1ldGhvZCwgcHJvcHMsIGNvbnRlbnQpOwogICAgICAgIH0pOwogICAgfQogICAgc3Vic2NyaWJlQmFzaWNEZWxpdmVyKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDYwLCA2MCwgYXN5bmMgKG1ldGhvZCk9PnsKICAgICAgICAgICAgY29uc3QgW3Byb3BzLCBjb250ZW50XSA9IGF3YWl0IHRoaXMubXV4LnJlY2VpdmVDb250ZW50KGNoYW5uZWwsIDYwKTsKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIobWV0aG9kLCBwcm9wcywgY29udGVudCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBzdWJzY3JpYmVCYXNpY0FjayhjaGFubmVsLCBoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnN1YnNjcmliZShjaGFubmVsLCA2MCwgODAsIGhhbmRsZXIpOwogICAgfQogICAgc3Vic2NyaWJlQmFzaWNOYWNrKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDYwLCAxMjAsIGhhbmRsZXIpOwogICAgfQp9CmZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmliZXIoaGFuZGxlLCBvbkVycm9yKSB7CiAgICByZXR1cm4gewogICAgICAgIGhhbmRsZSwKICAgICAgICBlcnJvcjogb25FcnJvcgogICAgfTsKfQpmdW5jdGlvbiBhc3NlcnROb3RDbG9zZWQoY2hhbm5lbCwgZnJhbWUpIHsKICAgIGlmIChmcmFtZS50eXBlID09PSAibWV0aG9kIikgewogICAgICAgIGlmIChmcmFtZS5jaGFubmVsID09PSBjaGFubmVsICYmIGZyYW1lLnBheWxvYWQuY2xhc3NJZCA9PT0gMjAgJiYgZnJhbWUucGF5bG9hZC5tZXRob2RJZCA9PT0gNDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHNlcmlhbGl6ZUNoYW5uZWxFcnJvcihjaGFubmVsLCBmcmFtZS5wYXlsb2FkLmFyZ3MpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGZyYW1lLnBheWxvYWQuY2xhc3NJZCA9PT0gMTAgJiYgZnJhbWUucGF5bG9hZC5tZXRob2RJZCA9PT0gNTApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHNlcmlhbGl6ZUNvbm5lY3Rpb25FcnJvcihmcmFtZS5wYXlsb2FkLmFyZ3MpKTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gY3JlYXRlU29ja2V0RGVtdXgocmVhZGVyLCBzdWJzY3JpYmVycykgewogICAgbGlzdGVuKCk7CiAgICBhc3luYyBmdW5jdGlvbiBsaXN0ZW4oKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2hpbGUodHJ1ZSl7CiAgICAgICAgICAgICAgICBjb25zdCBmcmFtZSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICBlbWl0KGZyYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGhhbmRsZUVycm9yKGVycm9yKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZW1vdmVTdWJzY3JpYmVyKHN1YnNjcmliZXIpIHsKICAgICAgICBjb25zdCBpbmRleCA9IHN1YnNjcmliZXJzLmluZGV4T2Yoc3Vic2NyaWJlcik7CiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgICBzdWJzY3JpYmVycy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGhhbmRsZUVycm9yKGVycm9yKSB7CiAgICAgICAgZm9yIChjb25zdCBzdWJzY3JpYmVyIG9mIFsKICAgICAgICAgICAgLi4uc3Vic2NyaWJlcnMKICAgICAgICBdKXsKICAgICAgICAgICAgc3Vic2NyaWJlci5lcnJvcihlcnJvcik7CiAgICAgICAgICAgIHJlbW92ZVN1YnNjcmliZXIoc3Vic2NyaWJlcik7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZW1pdChmcmFtZSkgewogICAgICAgIGZvciAoY29uc3Qgc3Vic2NyaWJlciBvZiBbCiAgICAgICAgICAgIC4uLnN1YnNjcmliZXJzCiAgICAgICAgXSl7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoc3Vic2NyaWJlci5oYW5kbGUoZnJhbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlU3Vic2NyaWJlcihzdWJzY3JpYmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIHN1YnNjcmliZXIuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICAgICAgcmVtb3ZlU3Vic2NyaWJlcihzdWJzY3JpYmVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGFkZFN1YnNjcmliZXIoc3Vic2NyaWJlcikgewogICAgICAgIHN1YnNjcmliZXJzLnB1c2goc3Vic2NyaWJlcik7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiByZWNlaXZlKGNoYW5uZWwsIGNsYXNzSWQsIG1ldGhvZElkKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57CiAgICAgICAgICAgIGFkZFN1YnNjcmliZXIoY3JlYXRlU3Vic2NyaWJlcigoZnJhbWUpPT57CiAgICAgICAgICAgICAgICBpZiAoZnJhbWUudHlwZSA9PT0gIm1ldGhvZCIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJhbWUuY2hhbm5lbCA9PT0gY2hhbm5lbCAmJiBmcmFtZS5wYXlsb2FkLmNsYXNzSWQgPT09IGNsYXNzSWQgJiYgZnJhbWUucGF5bG9hZC5tZXRob2RJZCA9PT0gbWV0aG9kSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmcmFtZS5wYXlsb2FkLmFyZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhc3NlcnROb3RDbG9zZWQoY2hhbm5lbCwgZnJhbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9LCByZWplY3QpKTsKICAgICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIHN1YnNjcmliZShjaGFubmVsLCBjbGFzc0lkLCBtZXRob2RJZCwgaGFuZGxlcikgewogICAgICAgIGNvbnN0IHN1YnNjcmliZXIgPSBjcmVhdGVTdWJzY3JpYmVyKChmcmFtZSk9PnsKICAgICAgICAgICAgaWYgKGZyYW1lLnR5cGUgPT09ICJtZXRob2QiKSB7CiAgICAgICAgICAgICAgICBpZiAoZnJhbWUuY2hhbm5lbCA9PT0gY2hhbm5lbCAmJiBmcmFtZS5wYXlsb2FkLmNsYXNzSWQgPT09IGNsYXNzSWQgJiYgZnJhbWUucGF5bG9hZC5tZXRob2RJZCA9PT0gbWV0aG9kSWQpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyKGZyYW1lLnBheWxvYWQuYXJncyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0sICgpPT57CiAgICAgICAgfSk7CiAgICAgICAgYWRkU3Vic2NyaWJlcihzdWJzY3JpYmVyKTsKICAgICAgICByZXR1cm4gKCk9PnJlbW92ZVN1YnNjcmliZXIoc3Vic2NyaWJlcikKICAgICAgICA7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiByZWNlaXZlSGVhZGVyKGNoYW5uZWwsIGNsYXNzSWQpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PnsKICAgICAgICAgICAgYWRkU3Vic2NyaWJlcihjcmVhdGVTdWJzY3JpYmVyKChmcmFtZSk9PnsKICAgICAgICAgICAgICAgIGlmIChmcmFtZS5jaGFubmVsID09PSBjaGFubmVsICYmIGZyYW1lLnR5cGUgPT09ICJoZWFkZXIiICYmIGZyYW1lLnBheWxvYWQuY2xhc3NJZCA9PT0gY2xhc3NJZCkgewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZnJhbWUucGF5bG9hZCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhc3NlcnROb3RDbG9zZWQoY2hhbm5lbCwgZnJhbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9LCByZWplY3QpKTsKICAgICAgICB9KTsKICAgIH0KICAgIGFzeW5jIGZ1bmN0aW9uIHJlY2VpdmVDb250ZW50KGNoYW5uZWwsIGNsYXNzSWQpIHsKICAgICAgICBjb25zdCBoZWFkZXIgPSBhd2FpdCByZWNlaXZlSGVhZGVyKGNoYW5uZWwsIGNsYXNzSWQpOwogICAgICAgIGlmIChoZWFkZXIuc2l6ZSA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLAogICAgICAgICAgICAgICAgbmV3IFVpbnQ4QXJyYXkoMCkKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYnVmZmVyID0gbmV3IERlbm8uQnVmZmVyKCk7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57CiAgICAgICAgICAgIGFkZFN1YnNjcmliZXIoY3JlYXRlU3Vic2NyaWJlcigoZnJhbWUpPT57CiAgICAgICAgICAgICAgICBpZiAoZnJhbWUuY2hhbm5lbCA9PT0gY2hhbm5lbCAmJiBmcmFtZS50eXBlID09PSAiY29udGVudCIpIHsKICAgICAgICAgICAgICAgICAgICBidWZmZXIud3JpdGVTeW5jKGZyYW1lLnBheWxvYWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChidWZmZXIubGVuZ3RoID49IGhlYWRlci5zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyLmJ5dGVzKCkKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZnJhbWUuY2hhbm5lbCA9PT0gY2hhbm5lbCAmJiBmcmFtZS50eXBlICE9PSAiY29udGVudCIpIHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFsKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLAogICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIuYnl0ZXMoKQogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYXNzZXJ0Tm90Q2xvc2VkKGNoYW5uZWwsIGZyYW1lKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSwgcmVqZWN0KSk7CiAgICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIHJlY2VpdmU6IHJlY2VpdmUsCiAgICAgICAgcmVjZWl2ZUNvbnRlbnQ6IHJlY2VpdmVDb250ZW50LAogICAgICAgIHN1YnNjcmliZTogc3Vic2NyaWJlCiAgICB9Owp9CmZ1bmN0aW9uIGNyZWF0ZVNvY2tldE11eCh3cml0ZXI1KSB7CiAgICBhc3luYyBmdW5jdGlvbiBzZW5kKGNoYW5uZWwsIGNsYXNzSWQsIG1ldGhvZElkLCBhcmdzKSB7CiAgICAgICAgcmV0dXJuIHdyaXRlcjUud3JpdGUoewogICAgICAgICAgICB0eXBlOiAibWV0aG9kIiwKICAgICAgICAgICAgY2hhbm5lbCwKICAgICAgICAgICAgcGF5bG9hZDogewogICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgYXJncwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiBzZW5kQ29udGVudChjaGFubmVsLCBjbGFzc0lkLCBwcm9wcywgZGF0YTIpIHsKICAgICAgICBjb25zdCBzaXplOCA9IGRhdGEyLmxlbmd0aDsKICAgICAgICBpZiAoc2l6ZTggPT09IDApIHsKICAgICAgICAgICAgYXdhaXQgd3JpdGVyNS53cml0ZSh7CiAgICAgICAgICAgICAgICB0eXBlOiAiaGVhZGVyIiwKICAgICAgICAgICAgICAgIGNoYW5uZWwsCiAgICAgICAgICAgICAgICBwYXlsb2FkOiB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICBwcm9wcywKICAgICAgICAgICAgICAgICAgICBzaXplOiBzaXplOAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICAgICAgICB3cml0ZXI1LndyaXRlKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiaGVhZGVyIiwKICAgICAgICAgICAgICAgICAgICBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHMsCiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IHNpemU4CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB3cml0ZXI1LndyaXRlKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiY29udGVudCIsCiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiBkYXRhMgogICAgICAgICAgICAgICAgfSksIAogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIHNlbmQsCiAgICAgICAgc2VuZENvbnRlbnQKICAgIH07Cn0KZnVuY3Rpb24gY3JlYXRlQW1xcE11eChzb2NrZXQpIHsKICAgIGNvbnN0IHN1YnNjcmliZXJzID0gW107CiAgICBjb25zdCBkZW11eCA9IGNyZWF0ZVNvY2tldERlbXV4KHNvY2tldCwgc3Vic2NyaWJlcnMpOwogICAgY29uc3QgbXV4MSA9IGNyZWF0ZVNvY2tldE11eChzb2NrZXQpOwogICAgcmV0dXJuIHsKICAgICAgICAuLi5kZW11eCwKICAgICAgICAuLi5tdXgxCiAgICB9Owp9CmNvbnN0IE5VTExfQ0hBUiA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMCk7CmZ1bmN0aW9uIGNyZWRlbnRpYWxzKHVzZXJuYW1lLCBwYXNzd29yZCkgewogICAgcmV0dXJuIGAke05VTExfQ0hBUn0ke3VzZXJuYW1lfSR7TlVMTF9DSEFSfSR7cGFzc3dvcmR9YDsKfQpjb25zdCBjbGllbnRQcm9wZXJ0aWVzID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBwcm9kdWN0OiAiZGVuby1hbXFwIiwKICAgIHBsYXRmb3JtOiBgRGVubyAke0Rlbm8udmVyc2lvbi5kZW5vfSBodHRwczovL2Rlbm8ubGFuZGAsCiAgICB2ZXJzaW9uOiAiMCIsCiAgICBpbmZvcm1hdGlvbjogImh0dHBzOi8vZGVuby5sYW5kL3gvYW1xcC8iCn0pOwpmdW5jdGlvbiB0dW5lKG91cnMsIHRoZWlycykgewogICAgaWYgKG91cnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGVpcnM7CiAgICB9CiAgICBpZiAob3VycyA9PT0gMCkgewogICAgICAgIHJldHVybiBNYXRoLm1heChvdXJzLCB0aGVpcnMpOwogICAgfQogICAgcmV0dXJuIE1hdGgubWluKG91cnMsIHRoZWlycyk7Cn0KY2xhc3MgQW1xcENvbm5lY3Rpb24gewogICAgI2NoYW5uZWxNYXggPSAtMTsKICAgICNpc09wZW4gPSBmYWxzZTsKICAgICNwcm90b2NvbDsKICAgICNjaGFubmVsTnVtYmVycyA9IFtdOwogICAgI3VzZXJuYW1lOwogICAgI3Bhc3N3b3JkOwogICAgI3Zob3N0OwogICAgI2Nsb3NlZFByb21pc2U7CiAgICAjb3B0aW9uczsKICAgICNzb2NrZXQ7CiAgICBjb25zdHJ1Y3Rvcihzb2NrZXQsIG9wdGlvbnMxKXsKICAgICAgICB0aGlzLiNvcHRpb25zID0gb3B0aW9uczE7CiAgICAgICAgdGhpcy4jc29ja2V0ID0gc29ja2V0OwogICAgICAgIHRoaXMuI3Byb3RvY29sID0gbmV3IEFtcXBQcm90b2NvbChjcmVhdGVBbXFwTXV4KHRoaXMuI3NvY2tldCkpOwogICAgICAgIHRoaXMuI3VzZXJuYW1lID0gb3B0aW9uczEudXNlcm5hbWU7CiAgICAgICAgdGhpcy4jcGFzc3dvcmQgPSBvcHRpb25zMS5wYXNzd29yZDsKICAgICAgICB0aGlzLiN2aG9zdCA9IG9wdGlvbnMxLnZob3N0IHx8ICIvIjsKICAgICAgICB0aGlzLiNjbG9zZWRQcm9taXNlID0gY3JlYXRlUmVzb2x2YWJsZSgpOwogICAgICAgIHRoaXMuI3Byb3RvY29sLnJlY2VpdmVDb25uZWN0aW9uQ2xvc2UoMCkudGhlbih0aGlzLiNoYW5kbGVDbG9zZSkuY2F0Y2godGhpcy4jY2xvc2VkUHJvbWlzZS5yZWplY3QpLmZpbmFsbHkoKCk9PnsKICAgICAgICAgICAgdGhpcy4jaXNPcGVuID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9CiAgICAjaGFuZGxlQ2xvc2UgPSBhc3luYyAoYXJncyk9PnsKICAgICAgICB0aGlzLiNpc09wZW4gPSBmYWxzZTsKICAgICAgICBhd2FpdCB0aGlzLiNwcm90b2NvbC5zZW5kQ29ubmVjdGlvbkNsb3NlT2soMCwgewogICAgICAgIH0pOwogICAgICAgIHRoaXMuI2Nsb3NlZFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihzZXJpYWxpemVDb25uZWN0aW9uRXJyb3IoYXJncykpKTsKICAgICAgICB0aGlzLiNzb2NrZXQuY2xvc2UoKTsKICAgIH07CiAgICAjaGFuZGxlU3RhcnQgPSBhc3luYyAoYXJncyk9PnsKICAgICAgICBhd2FpdCB0aGlzLiNwcm90b2NvbC5zZW5kQ29ubmVjdGlvblN0YXJ0T2soMCwgewogICAgICAgICAgICBjbGllbnRQcm9wZXJ0aWVzLAogICAgICAgICAgICByZXNwb25zZTogY3JlZGVudGlhbHModGhpcy4jdXNlcm5hbWUsIHRoaXMuI3Bhc3N3b3JkKQogICAgICAgIH0pOwogICAgfTsKICAgICNoYW5kbGVUdW5lID0gYXN5bmMgKGFyZ3MpPT57CiAgICAgICAgY29uc3QgaGVhcnRiZWF0SW50ZXJ2YWwgPSB0dW5lKHRoaXMuI29wdGlvbnMuaGVhcnRiZWF0SW50ZXJ2YWwsIGFyZ3MuaGVhcnRiZWF0KTsKICAgICAgICB0aGlzLiNjaGFubmVsTWF4ID0gdHVuZSh1bmRlZmluZWQsIGFyZ3MuY2hhbm5lbE1heCk7CiAgICAgICAgY29uc3QgZnJhbWVNYXggPSB0dW5lKHRoaXMuI29wdGlvbnMuZnJhbWVNYXgsIGFyZ3MuZnJhbWVNYXgpOwogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDb25uZWN0aW9uVHVuZU9rKDAsIHsKICAgICAgICAgICAgaGVhcnRiZWF0OiBoZWFydGJlYXRJbnRlcnZhbCwKICAgICAgICAgICAgY2hhbm5lbE1heDogdGhpcy4jY2hhbm5lbE1heCwKICAgICAgICAgICAgZnJhbWVNYXgKICAgICAgICB9KTsKICAgICAgICB0aGlzLiNzb2NrZXQudHVuZSh7CiAgICAgICAgICAgIGZyYW1lTWF4LAogICAgICAgICAgICBzZW5kVGltZW91dDogaGVhcnRiZWF0SW50ZXJ2YWwgKiAxMDAwLAogICAgICAgICAgICByZWFkVGltZW91dDogaGVhcnRiZWF0SW50ZXJ2YWwgKiAxMDAwICogMgogICAgICAgIH0pOwogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDb25uZWN0aW9uT3BlbigwLCB7CiAgICAgICAgICAgIHZpcnR1YWxIb3N0OiB0aGlzLiN2aG9zdAogICAgICAgIH0pOwogICAgfTsKICAgIGFzeW5jIG9wZW4oKSB7CiAgICAgICAgYXdhaXQgdGhpcy4jc29ja2V0LnN0YXJ0KCk7CiAgICAgICAgYXdhaXQgdGhpcy4jcHJvdG9jb2wucmVjZWl2ZUNvbm5lY3Rpb25TdGFydCgwKS50aGVuKHRoaXMuI2hhbmRsZVN0YXJ0KTsKICAgICAgICBhd2FpdCB0aGlzLiNwcm90b2NvbC5yZWNlaXZlQ29ubmVjdGlvblR1bmUoMCkudGhlbih0aGlzLiNoYW5kbGVUdW5lKTsKICAgICAgICB0aGlzLiNpc09wZW4gPSB0cnVlOwogICAgfQogICAgYXN5bmMgb3BlbkNoYW5uZWwoKSB7CiAgICAgICAgZm9yKGxldCBjaGFubmVsTnVtYmVyMSA9IDE7IGNoYW5uZWxOdW1iZXIxIDwgdGhpcy4jY2hhbm5lbE1heDsgKytjaGFubmVsTnVtYmVyMSl7CiAgICAgICAgICAgIGlmICghdGhpcy4jY2hhbm5lbE51bWJlcnMuZmluZCgobnVtKT0+bnVtID09PSBjaGFubmVsTnVtYmVyMQogICAgICAgICAgICApKSB7CiAgICAgICAgICAgICAgICB0aGlzLiNjaGFubmVsTnVtYmVycy5wdXNoKGNoYW5uZWxOdW1iZXIxKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDaGFubmVsT3BlbihjaGFubmVsTnVtYmVyMSwgewogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb25zdCBjaGFubmVsID0gbmV3IEFtcXBDaGFubmVsKGNoYW5uZWxOdW1iZXIxLCB0aGlzLiNwcm90b2NvbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2hhbm5lbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1heGltdW0gY2hhbm5lbHMgJHt0aGlzLiNjaGFubmVsTWF4fSByZWFjaGVkYCk7CiAgICB9CiAgICBhc3luYyBjbG9zZSgpIHsKICAgICAgICBpZiAodGhpcy4jaXNPcGVuKSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDb25uZWN0aW9uQ2xvc2UoMCwgewogICAgICAgICAgICAgICAgY2xhc3NJZDogMCwKICAgICAgICAgICAgICAgIG1ldGhvZElkOiAwLAogICAgICAgICAgICAgICAgcmVwbHlDb2RlOiAzMjAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuI3NvY2tldC5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICB0aGlzLiNpc09wZW4gPSBmYWxzZTsKICAgICAgICB0aGlzLiNjbG9zZWRQcm9taXNlLnJlc29sdmUoKTsKICAgIH0KICAgIGFzeW5jIGNsb3NlZCgpIHsKICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy4jY2xvc2VkUHJvbWlzZTsKICAgIH0KfQpjbGFzcyBBbXFwQ2xpZW50IHsKICAgIGNvbm5lY3Rpb247CiAgICBhbXFwQ29ubmVjdGlvbjsKICAgIGdlbmVyYWxPcHRpb25zOwogICAgZnVsbENsaWVudE9wdGlvbnM7CiAgICByZWFkZXI7CiAgICB3cml0ZXI7CiAgICBjb25uZWN0ZWQ7CiAgICBjbG9zZWQ7CiAgICBjaGFubmVsOwogICAgYXN5bmMgY29ubmVjdChvcHRpb25zKSB7CiAgICAgICAgdGhpcy5nZW5lcmFsT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oewogICAgICAgIH0sIHsKICAgICAgICAgICAgdHJhbnNwb3J0OiBvcHRpb25zLnRyYW5zcG9ydCwKICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgaG9zdDogb3B0aW9ucy5vcHRpb25zLmhvc3QsCiAgICAgICAgICAgICAgICBwb3J0OiBvcHRpb25zLm9wdGlvbnMucG9ydCwKICAgICAgICAgICAgICAgIHJldHJ5QXR0ZW1wdHM6IG9wdGlvbnMub3B0aW9ucy5yZXRyeUF0dGVtcHRzLAogICAgICAgICAgICAgICAgcmV0cnlEZWxheTogb3B0aW9ucy5vcHRpb25zLnJldHJ5RGVsYXkKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZnVsbENsaWVudE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsKICAgICAgICB9LCBvcHRpb25zKTsKICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBhd2FpdCBEZW5vLmNvbm5lY3QoewogICAgICAgICAgICBwb3J0OiB0aGlzLmdlbmVyYWxPcHRpb25zLm9wdGlvbnMucG9ydCB8fCBDbGllbnRVdGlsLmdldERlZmF1bHRQb3J0KHRoaXMuZ2VuZXJhbE9wdGlvbnMudHJhbnNwb3J0KSwKICAgICAgICAgICAgaG9zdG5hbWU6IHRoaXMuZ2VuZXJhbE9wdGlvbnMub3B0aW9ucy5ob3N0CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5yZWFkZXIgPSBuZXcgQnVmUmVhZGVyKHRoaXMuY29ubmVjdGlvbik7CiAgICAgICAgdGhpcy53cml0ZXIgPSBuZXcgQnVmV3JpdGVyKHRoaXMuY29ubmVjdGlvbik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRoZW50aWNhdGUob3B0aW9ucy5vcHRpb25zKTsKICAgICAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLmNsb3NlZCA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgICAgIHRoaXMuY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIGF1dGhlbnRpY2F0ZShkYXRhKSB7CiAgICAgICAgY29uc3QgeyB1c2VybmFtZSAsIHBhc3N3b3JkICwgaGVhcnRiZWF0SW50ZXJ2YWwgLCBmcmFtZU1heCAsIGxvZ2xldmVsICwgdmhvc3QgIH0gPSBkYXRhOwogICAgICAgIGNvbnN0IHNvY2tldDEgPSBuZXcgQW1xcFNvY2tldCh0aGlzLmdldENvbm5lY3Rpb24oKSk7CiAgICAgICAgY29uc3QgY29ubmVjdGlvbiA9IG5ldyBBbXFwQ29ubmVjdGlvbihzb2NrZXQxLCB7CiAgICAgICAgICAgIHVzZXJuYW1lLAogICAgICAgICAgICBwYXNzd29yZCwKICAgICAgICAgICAgaGVhcnRiZWF0SW50ZXJ2YWwsCiAgICAgICAgICAgIGZyYW1lTWF4LAogICAgICAgICAgICBsb2dsZXZlbCwKICAgICAgICAgICAgdmhvc3QKICAgICAgICB9KTsKICAgICAgICBhd2FpdCBjb25uZWN0aW9uLm9wZW4oKTsKICAgICAgICB0aGlzLmFtcXBDb25uZWN0aW9uID0gY29ubmVjdGlvbjsKICAgIH0KICAgIHJlY29ubmVjdCgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuIik7CiAgICB9CiAgICBnZXRDb25uZWN0aW9uT3B0aW9ucygpIHsKICAgICAgICByZXR1cm4gdGhpcy5mdWxsQ2xpZW50T3B0aW9uczsKICAgIH0KICAgIGdldFJlYWRlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZWFkZXI7CiAgICB9CiAgICBnZXRXcml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMud3JpdGVyOwogICAgfQogICAgZ2V0Q29ubmVjdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0aW9uOwogICAgfQogICAgY2xvc2VDb25uZWN0aW9uKCkgewogICAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTsKICAgICAgICB0aGlzLmNvbm5lY3Rpb24uY2xvc2UoKTsKICAgIH0KICAgIGdldFJldHJ5QXR0ZW1wcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlBdHRlbXB0cyB8fCAzOwogICAgfQogICAgZ2V0UmV0cnlEZWxheSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlEZWxheSB8fCAxMDAwOwogICAgfQogICAgaXNDb25uZWN0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkOwogICAgfQogICAgaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VkOwogICAgfQogICAgZ2V0QXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXRTdWJzY3JpYmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLmFtcXBDb25uZWN0aW9uOwogICAgfQogICAgYXN5bmMgKnJlY2VpdmUocXVldWVOYW1lKSB7CiAgICAgICAgaWYgKCF0aGlzLmNoYW5uZWwpIHsKICAgICAgICAgICAgdGhpcy5jaGFubmVsID0gYXdhaXQgdGhpcy5nZXRTdWJzY3JpYmVyKCkub3BlbkNoYW5uZWwoKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5jaGFubmVsLmRlY2xhcmVRdWV1ZSh7CiAgICAgICAgICAgICAgICBxdWV1ZTogcXVldWVOYW1lCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB3aGlsZSh0aGlzLmlzQ29ubmVjdGVkKCkpewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzb2x2YWJsZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFubmVsLmNvbnN1bWUoewogICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogcXVldWVOYW1lCiAgICAgICAgICAgICAgICAgICAgfSwgYXN5bmMgKGFyZ3MsIHByb3BzLCBkYXRhMik9PnsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jaGFubmVsLmFjayh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlUYWc6IGFyZ3MuZGVsaXZlcnlUYWcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNvbHZhYmxlOwogICAgICAgICAgICAgICAgeWllbGQgcmVzdWx0OwogICAgICAgICAgICB9IGNhdGNoICB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBnZXREZWZhdWx0UG9ydCgpIHsKICAgICAgICByZXR1cm4gNTY3MjsKICAgIH0KfQpjbGFzcyBFT0ZFcnJvciBleHRlbmRzIEVycm9yIHsKfQpjbGFzcyBFcnJvclJlcGx5RXJyb3IgZXh0ZW5kcyBFcnJvciB7Cn0KY2xhc3MgSW52YWxpZFN0YXRlRXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgICBjb25zdHJ1Y3RvcigpewogICAgICAgIHN1cGVyKCJJbnZhbGlkIHN0YXRlIik7CiAgICB9Cn0KY29uc3QgSW50ZWdlclJlcGx5Q29kZSA9ICI6Ii5jaGFyQ29kZUF0KDApOwpjb25zdCBCdWxrUmVwbHlDb2RlID0gIiQiLmNoYXJDb2RlQXQoMCk7CmNvbnN0IFNpbXBsZVN0cmluZ0NvZGUgPSAiKyIuY2hhckNvZGVBdCgwKTsKY29uc3QgQXJyYXlSZXBseUNvZGUgPSAiKiIuY2hhckNvZGVBdCgwKTsKY29uc3QgRXJyb3JSZXBseUNvZGUgPSAiLSIuY2hhckNvZGVBdCgwKTsKY2xhc3MgUmVkaXNVdGlsIHsKICAgIHN0YXRpYyBhc3luYyByZWFkTGluZShyZWFkZXIpIHsKICAgICAgICBjb25zdCBidWYgPSBuZXcgVWludDhBcnJheSgxMDI0KTsKICAgICAgICBsZXQgbG9jID0gMDsKICAgICAgICBsZXQgZCA9IG51bGw7CiAgICAgICAgd2hpbGUoKGQgPSBhd2FpdCByZWFkZXIucmVhZEJ5dGUoKSkgJiYgZCAhPT0gbnVsbCl7CiAgICAgICAgICAgIGlmIChkID09PSAiXHIiLmNoYXJDb2RlQXQoMCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGQxID0gYXdhaXQgcmVhZGVyLnJlYWRCeXRlKCk7CiAgICAgICAgICAgICAgICBpZiAoZDEgPT09ICJcbiIuY2hhckNvZGVBdCgwKSkgewogICAgICAgICAgICAgICAgICAgIGJ1Zltsb2MrK10gPSBkOwogICAgICAgICAgICAgICAgICAgIGJ1Zltsb2MrK10gPSBkMTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2Rlci5kZWNvZGUobmV3IERlbm8uQnVmZmVyKGJ1Zi5zdWJhcnJheSgwLCBsb2MpKS5ieXRlcygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBidWZbbG9jKytdID0gZDsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7CiAgICB9CiAgICBzdGF0aWMgYXN5bmMgcmVhZFJlcGx5KHJlYWRlcikgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlYWRlci5wZWVrKDEpOwogICAgICAgIGlmIChyZXMgPT09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVPRkVycm9yKCk7CiAgICAgICAgfQogICAgICAgIHN3aXRjaChyZXNbMF0pewogICAgICAgICAgICBjYXNlIEludGVnZXJSZXBseUNvZGU6CiAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICJpbnRlZ2VyIiwKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlYWRJbnRlZ2VyUmVwbHkocmVhZGVyKQogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgY2FzZSBTaW1wbGVTdHJpbmdDb2RlOgogICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIiwKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlYWRTdGF0dXNSZXBseShyZWFkZXIpCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICBjYXNlIEJ1bGtSZXBseUNvZGU6CiAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICJidWxrIiwKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlYWRCdWxrUmVwbHkocmVhZGVyKQogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgY2FzZSBBcnJheVJlcGx5Q29kZToKICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgImFycmF5IiwKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlYWRBcnJheVJlcGx5KHJlYWRlcikKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIGNhc2UgRXJyb3JSZXBseUNvZGU6CiAgICAgICAgICAgICAgICB0aGlzLnRyeVBhcnNlRXJyb3JSZXBseShhd2FpdCB0aGlzLnJlYWRMaW5lKHJlYWRlcikpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXJyb3IoKTsKICAgIH0KICAgIHN0YXRpYyBjcmVhdGVSZXF1ZXN0KGNvbW1hbmQsIGFyZ3MpIHsKICAgICAgICBjb25zdCBfYXJncyA9IGFyZ3MuZmlsdGVyKCh2KT0+diAhPT0gdm9pZCAwICYmIHYgIT09IG51bGwKICAgICAgICApOwogICAgICAgIGxldCBtc2cxID0gIiI7CiAgICAgICAgbXNnMSArPSBgKiR7MSArIF9hcmdzLmxlbmd0aH1cclxuYDsKICAgICAgICBtc2cxICs9IGAkJHtjb21tYW5kLmxlbmd0aH1cclxuYDsKICAgICAgICBtc2cxICs9IGAke2NvbW1hbmR9XHJcbmA7CiAgICAgICAgZm9yIChjb25zdCBhcmcgb2YgX2FyZ3MpewogICAgICAgICAgICBjb25zdCB2YWwgPSBTdHJpbmcoYXJnKTsKICAgICAgICAgICAgY29uc3QgYnl0ZXNMZW4gPSBlbmNvZGVyLmVuY29kZSh2YWwpLmJ5dGVMZW5ndGg7CiAgICAgICAgICAgIG1zZzEgKz0gYCQke2J5dGVzTGVufVxyXG5gOwogICAgICAgICAgICBtc2cxICs9IGAke3ZhbH1cclxuYDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1zZzE7CiAgICB9CiAgICBzdGF0aWMgYXN5bmMgc2VuZENvbW1hbmQod3JpdGVyLCByZWFkZXIsIGNvbW1hbmQsIC4uLmFyZ3MpIHsKICAgICAgICBjb25zdCBtc2cxID0gdGhpcy5jcmVhdGVSZXF1ZXN0KGNvbW1hbmQsIGFyZ3MpOwogICAgICAgIGF3YWl0IHdyaXRlci53cml0ZShlbmNvZGVyLmVuY29kZShtc2cxKSk7CiAgICAgICAgYXdhaXQgd3JpdGVyLmZsdXNoKCk7CiAgICAgICAgcmV0dXJuIHRoaXMucmVhZFJlcGx5KHJlYWRlcik7CiAgICB9CiAgICBzdGF0aWMgYXN5bmMgcmVhZFN0YXR1c1JlcGx5KHJlYWRlcikgewogICAgICAgIGNvbnN0IGxpbmUgPSBhd2FpdCB0aGlzLnJlYWRMaW5lKHJlYWRlcik7CiAgICAgICAgaWYgKGxpbmVbMF0gPT09ICIrIikgewogICAgICAgICAgICByZXR1cm4gbGluZS5zdWJzdHIoMSwgbGluZS5sZW5ndGggLSAzKTsKICAgICAgICB9CiAgICAgICAgdGhpcy50cnlQYXJzZUVycm9yUmVwbHkobGluZSk7CiAgICB9CiAgICBzdGF0aWMgYXN5bmMgcmVhZEludGVnZXJSZXBseShyZWFkZXIpIHsKICAgICAgICBjb25zdCBsaW5lID0gYXdhaXQgdGhpcy5yZWFkTGluZShyZWFkZXIpOwogICAgICAgIGlmIChsaW5lWzBdID09PSAiOiIpIHsKICAgICAgICAgICAgY29uc3Qgc3RyID0gbGluZS5zdWJzdHIoMSwgbGluZS5sZW5ndGggLSAzKTsKICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHN0cik7CiAgICAgICAgfQogICAgICAgIHRoaXMudHJ5UGFyc2VFcnJvclJlcGx5KGxpbmUpOwogICAgfQogICAgc3RhdGljIGFzeW5jIHJlYWRCdWxrUmVwbHkocmVhZGVyKSB7CiAgICAgICAgY29uc3QgbGluZSA9IGF3YWl0IHRoaXMucmVhZExpbmUocmVhZGVyKTsKICAgICAgICBpZiAobGluZVswXSAhPT0gIiQiKSB7CiAgICAgICAgICAgIHRoaXMudHJ5UGFyc2VFcnJvclJlcGx5KGxpbmUpOwogICAgICAgIH0KICAgICAgICBjb25zdCBzaXplU3RyID0gbGluZS5zdWJzdHIoMSwgbGluZS5sZW5ndGggLSAzKTsKICAgICAgICBjb25zdCBzaXplOCA9IHBhcnNlSW50KHNpemVTdHIpOwogICAgICAgIGlmIChzaXplOCA8IDApIHsKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgY29uc3QgZGVzdCA9IG5ldyBVaW50OEFycmF5KHNpemU4ICsgMik7CiAgICAgICAgYXdhaXQgcmVhZGVyLnJlYWRGdWxsKGRlc3QpOwogICAgICAgIHJldHVybiBkZWNvZGVyLmRlY29kZShuZXcgRGVuby5CdWZmZXIoZGVzdC5zdWJhcnJheSgwLCBkZXN0Lmxlbmd0aCAtIDIpKS5ieXRlcygpKTsKICAgIH0KICAgIHN0YXRpYyBhc3luYyByZWFkQXJyYXlSZXBseShyZWFkZXIpIHsKICAgICAgICBjb25zdCBsaW5lID0gYXdhaXQgdGhpcy5yZWFkTGluZShyZWFkZXIpOwogICAgICAgIGNvbnN0IGFyZ0NvdW50ID0gcGFyc2VJbnQobGluZS5zdWJzdHIoMSwgbGluZS5sZW5ndGggLSAzKSk7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGFyZ0NvdW50OyBpKyspewogICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZWFkZXIucGVlaygxKTsKICAgICAgICAgICAgaWYgKHJlcyA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVPRkVycm9yKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3dpdGNoKHJlc1swXSl7CiAgICAgICAgICAgICAgICBjYXNlIFNpbXBsZVN0cmluZ0NvZGU6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYXdhaXQgdGhpcy5yZWFkU3RhdHVzUmVwbHkocmVhZGVyKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEJ1bGtSZXBseUNvZGU6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYXdhaXQgdGhpcy5yZWFkQnVsa1JlcGx5KHJlYWRlcikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJbnRlZ2VyUmVwbHlDb2RlOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGF3YWl0IHRoaXMucmVhZEludGVnZXJSZXBseShyZWFkZXIpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQXJyYXlSZXBseUNvZGU6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYXdhaXQgdGhpcy5yZWFkQXJyYXlSZXBseShyZWFkZXIpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgc3RhdGljIHRyeVBhcnNlRXJyb3JSZXBseShsaW5lKSB7CiAgICAgICAgY29uc3QgY29kZTEgPSBsaW5lWzBdOwogICAgICAgIGlmIChjb2RlMSA9PT0gIi0iKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvclJlcGx5RXJyb3IobGluZSk7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZCBsaW5lOiAke2xpbmV9YCk7CiAgICB9Cn0KY2xhc3MgUmVkaXNTdWJzY3JpcHRpb24gewogICAgcmVkaXNDbGllbnQ7CiAgICBwYXR0ZXJucyA9IHsKICAgIH07CiAgICBjaGFubmVscyA9IHsKICAgIH07CiAgICBjb25zdHJ1Y3RvcihyZWRpc0NsaWVudCl7CiAgICAgICAgdGhpcy5yZWRpc0NsaWVudCA9IHJlZGlzQ2xpZW50OwogICAgfQogICAgYXN5bmMgcGF0dGVyblN1YnNjcmliZSguLi5wYXR0ZXJucykgewogICAgICAgIGF3YWl0IFJlZGlzVXRpbC5zZW5kQ29tbWFuZCh0aGlzLnJlZGlzQ2xpZW50LmdldFdyaXRlcigpLCB0aGlzLnJlZGlzQ2xpZW50LmdldFJlYWRlcigpLCAiUFNVQlNDUklCRSIsIC4uLnBhdHRlcm5zKTsKICAgICAgICBmb3IgKGNvbnN0IHBhdCBvZiBwYXR0ZXJucyl7CiAgICAgICAgICAgIHRoaXMucGF0dGVybnNbcGF0XSA9IHRydWU7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgcGF0dGVyblVuc3Vic2NyaWJlKC4uLnBhdHRlcm5zKSB7CiAgICAgICAgYXdhaXQgUmVkaXNVdGlsLnNlbmRDb21tYW5kKHRoaXMucmVkaXNDbGllbnQuZ2V0V3JpdGVyKCksIHRoaXMucmVkaXNDbGllbnQuZ2V0UmVhZGVyKCksICJQVU5TVUJTQ1JJQkUiLCAuLi5wYXR0ZXJucyk7CiAgICAgICAgZm9yIChjb25zdCBwYXQgb2YgcGF0dGVybnMpewogICAgICAgICAgICBkZWxldGUgdGhpcy5wYXR0ZXJuc1twYXRdOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIGNoYW5uZWxTdWJzY3JpYmUoLi4uY2hhbm5lbHMpIHsKICAgICAgICBhd2FpdCBSZWRpc1V0aWwuc2VuZENvbW1hbmQodGhpcy5yZWRpc0NsaWVudC5nZXRXcml0ZXIoKSwgdGhpcy5yZWRpc0NsaWVudC5nZXRSZWFkZXIoKSwgIlNVQlNDUklCRSIsIC4uLmNoYW5uZWxzKTsKICAgICAgICBmb3IgKGNvbnN0IGNoYW4gb2YgY2hhbm5lbHMpewogICAgICAgICAgICB0aGlzLmNoYW5uZWxzW2NoYW5dID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBhc3luYyBjaGFubmVsVW5zdWJzY3JpYmUoLi4uY2hhbm5lbHMpIHsKICAgICAgICBhd2FpdCBSZWRpc1V0aWwuc2VuZENvbW1hbmQodGhpcy5yZWRpc0NsaWVudC5nZXRXcml0ZXIoKSwgdGhpcy5yZWRpc0NsaWVudC5nZXRSZWFkZXIoKSwgIlVOU1VCU0NSSUJFIiwgLi4uY2hhbm5lbHMpOwogICAgICAgIGZvciAoY29uc3QgY2hhbiBvZiBjaGFubmVscyl7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNoYW5uZWxzW2NoYW5dOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFzeW5jICpyZWNlaXZlKCkgewogICAgICAgIGxldCBmb3JjZVJlY29ubmVjdCA9IGZhbHNlOwogICAgICAgIHdoaWxlKHRoaXMucmVkaXNDbGllbnQuaXNDb25uZWN0ZWQoKSl7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsZXQgcmVwOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXAgPSBhd2FpdCBSZWRpc1V0aWwucmVhZEFycmF5UmVwbHkodGhpcy5yZWRpc0NsaWVudC5nZXRSZWFkZXIoKSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgRGVuby5lcnJvcnMuQmFkUmVzb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWRpc0NsaWVudC5jbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGV2ID0gcmVwWzBdOwogICAgICAgICAgICAgICAgaWYgKGV2ID09PSAibWVzc2FnZSIgJiYgcmVwLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICAgIHlpZWxkIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbDogcmVwWzFdLAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXBbMl0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldiA9PT0gInBtZXNzYWdlIiAmJiByZXAubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICAgICAgICAgICAgeWllbGQgewogICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuOiByZXBbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5uZWw6IHJlcFsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogcmVwWzNdCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEludmFsaWRTdGF0ZUVycm9yIHx8IGVycm9yIGluc3RhbmNlb2YgRGVuby5lcnJvcnMuQmFkUmVzb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgICBmb3JjZVJlY29ubmVjdCA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgdGhyb3cgZXJyb3I7CiAgICAgICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZWRpc0NsaWVudC5pc0Nsb3NlZCgpICYmICF0aGlzLnJlZGlzQ2xpZW50LmlzQ29ubmVjdGVkKCkgfHwgZm9yY2VSZWNvbm5lY3QpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlzQ2xpZW50LnJlY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICAgIGZvcmNlUmVjb25uZWN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuY2hhbm5lbHMpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jaGFubmVsU3Vic2NyaWJlKC4uLk9iamVjdC5rZXlzKHRoaXMuY2hhbm5lbHMpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMucGF0dGVybnMpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wYXR0ZXJuU3Vic2NyaWJlKC4uLk9iamVjdC5rZXlzKHRoaXMucGF0dGVybnMpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBhc3luYyBjbG9zZSgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBhd2FpdCB0aGlzLmNoYW5uZWxVbnN1YnNjcmliZSguLi5PYmplY3Qua2V5cyh0aGlzLmNoYW5uZWxzKSk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMucGF0dGVyblVuc3Vic2NyaWJlKC4uLk9iamVjdC5rZXlzKHRoaXMucGF0dGVybnMpKTsKICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgIHRoaXMucmVkaXNDbGllbnQuY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgfQogICAgfQp9CmNsYXNzIFJlZGlzQ2xpZW50IHsKICAgIGNvbm5lY3Rpb247CiAgICBnZW5lcmFsT3B0aW9uczsKICAgIGZ1bGxDbGllbnRPcHRpb25zOwogICAgcmVhZGVyOwogICAgd3JpdGVyOwogICAgY29ubmVjdGVkOwogICAgY2xvc2VkOwogICAgcmVkaXNTdWJzY3JpcHRpb247CiAgICBhc3luYyBjb25uZWN0KG9wdGlvbnMpIHsKICAgICAgICB0aGlzLmdlbmVyYWxPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7CiAgICAgICAgfSwgewogICAgICAgICAgICB0cmFuc3BvcnQ6IG9wdGlvbnMudHJhbnNwb3J0LAogICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICBob3N0OiBvcHRpb25zLm9wdGlvbnMuaG9zdCwKICAgICAgICAgICAgICAgIHBvcnQ6IG9wdGlvbnMub3B0aW9ucy5wb3J0LAogICAgICAgICAgICAgICAgcmV0cnlBdHRlbXB0czogb3B0aW9ucy5vcHRpb25zLnJldHJ5QXR0ZW1wdHMsCiAgICAgICAgICAgICAgICByZXRyeURlbGF5OiBvcHRpb25zLm9wdGlvbnMucmV0cnlEZWxheQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5mdWxsQ2xpZW50T3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oewogICAgICAgIH0sIG9wdGlvbnMpOwogICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IGF3YWl0IERlbm8uY29ubmVjdCh7CiAgICAgICAgICAgIHBvcnQ6IHRoaXMuZ2VuZXJhbE9wdGlvbnMub3B0aW9ucy5wb3J0IHx8IENsaWVudFV0aWwuZ2V0RGVmYXVsdFBvcnQodGhpcy5nZW5lcmFsT3B0aW9ucy50cmFuc3BvcnQpLAogICAgICAgICAgICBob3N0bmFtZTogdGhpcy5nZW5lcmFsT3B0aW9ucy5vcHRpb25zLmhvc3QKICAgICAgICB9KTsKICAgICAgICB0aGlzLnJlYWRlciA9IG5ldyBCdWZSZWFkZXIodGhpcy5jb25uZWN0aW9uKTsKICAgICAgICB0aGlzLndyaXRlciA9IG5ldyBCdWZXcml0ZXIodGhpcy5jb25uZWN0aW9uKTsKICAgICAgICBjb25zdCB7IHVzZXJuYW1lICwgcGFzc3dvcmQgIH0gPSBvcHRpb25zLm9wdGlvbnM7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRoZW50aWNhdGUoewogICAgICAgICAgICAgICAgdXNlcm5hbWUsCiAgICAgICAgICAgICAgICBwYXNzd29yZAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLmNsb3NlZCA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICB0aGlzLmNsb3NlQ29ubmVjdGlvbigpOwogICAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9CiAgICB9CiAgICBhc3luYyBhdXRoZW50aWNhdGUoZGF0YSkgewogICAgICAgIGNvbnN0IHsgdXNlcm5hbWUgLCBwYXNzd29yZCAgfSA9IGRhdGE7CiAgICAgICAgaWYgKHBhc3N3b3JkICYmICF1c2VybmFtZSkgewogICAgICAgICAgICByZXR1cm4gUmVkaXNVdGlsLnNlbmRDb21tYW5kKHRoaXMud3JpdGVyLCB0aGlzLnJlYWRlciwgIkFVVEgiLCBwYXNzd29yZCk7CiAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZCAmJiB1c2VybmFtZSkgewogICAgICAgICAgICByZXR1cm4gUmVkaXNVdGlsLnNlbmRDb21tYW5kKHRoaXMud3JpdGVyLCB0aGlzLnJlYWRlciwgIkFVVEgiLCB1c2VybmFtZSwgcGFzc3dvcmQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIHJlY29ubmVjdCgpIHsKICAgICAgICBpZiAoIXRoaXMucmVhZGVyLnBlZWsoMSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDbGllbnQgaXMgY2xvc2VkLiIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCBSZWRpc1V0aWwuc2VuZENvbW1hbmQodGhpcy53cml0ZXIsIHRoaXMucmVhZGVyLCAiUElORyIpOwogICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgbGV0IHJldHJpZXMgPSAwOwogICAgICAgICAgICAgICAgY29uc3QgcmVzb2x2YWJsZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjb25uZWN0aW9uSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKT0+ewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0cmllcyA+IHRoaXMuZ2V0UmV0cnlBdHRlbXBzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHJlY29ubmVjdGlvbkludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoIkNvdWxkIG5vdCByZS1lc3RhYmxpc2ggY29ubmVjdGlvbiIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY29ubmVjdCh0aGlzLmdldENvbm5lY3Rpb25PcHRpb25zKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgUmVkaXNVdGlsLnNlbmRDb21tYW5kKHRoaXMuZ2V0V3JpdGVyKCksIHRoaXMuZ2V0UmVhZGVyKCksICJQSU5HIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRyaWVzID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocmVjb25uZWN0aW9uSW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcjEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0cmllcyA9IHJldHJpZXMgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5nZXRSZXRyeURlbGF5KCkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBhd2FpdCByZXNvbHZhYmxlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZ2V0Q29ubmVjdGlvbk9wdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZnVsbENsaWVudE9wdGlvbnM7CiAgICB9CiAgICBnZXRSZWFkZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVhZGVyOwogICAgfQogICAgZ2V0V3JpdGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLndyaXRlcjsKICAgIH0KICAgIGdldENvbm5lY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbjsKICAgIH0KICAgIGNsb3NlQ29ubmVjdGlvbigpIHsKICAgICAgICB0aGlzLmNsb3NlZCA9IHRydWU7CiAgICAgICAgdGhpcy5jb25uZWN0aW9uLmNsb3NlKCk7CiAgICB9CiAgICBnZXRSZXRyeUF0dGVtcHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29ubmVjdGlvbk9wdGlvbnMoKS5vcHRpb25zLnJldHJ5QXR0ZW1wdHMgfHwgMzsKICAgIH0KICAgIGdldFJldHJ5RGVsYXkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29ubmVjdGlvbk9wdGlvbnMoKS5vcHRpb25zLnJldHJ5RGVsYXkgfHwgMTAwMDsKICAgIH0KICAgIGlzQ29ubmVjdGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3RlZDsKICAgIH0KICAgIGlzQ2xvc2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLmNsb3NlZDsKICAgIH0KICAgIGdldEFzKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYXN5bmMgKnJlY2VpdmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3Vic2NyaWJlcigpLnJlY2VpdmUoKTsKICAgIH0KICAgIGdldFN1YnNjcmliZXIoKSB7CiAgICAgICAgaWYgKHRoaXMucmVkaXNTdWJzY3JpcHRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLnJlZGlzU3Vic2NyaXB0aW9uID0gbmV3IFJlZGlzU3Vic2NyaXB0aW9uKHRoaXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5yZWRpc1N1YnNjcmlwdGlvbjsKICAgIH0KICAgIGV4ZWMoY29tbWFuZCwgLi4uYXJncykgewogICAgICAgIHJldHVybiBSZWRpc1V0aWwuc2VuZENvbW1hbmQodGhpcy5nZXRXcml0ZXIoKSwgdGhpcy5nZXRSZWFkZXIoKSwgY29tbWFuZCwgLi4uYXJncyk7CiAgICB9CiAgICBnZXREZWZhdWx0UG9ydCgpIHsKICAgICAgICByZXR1cm4gNjM3OTsKICAgIH0KfQpjbGFzcyBOQVRTZXJyb3IgZXh0ZW5kcyBFcnJvciB7Cn0KY2xhc3MgTmF0c1V0aWwgewogICAgc3RhdGljIGFzeW5jIHdyaXRlSW4od3JpdGVyLCBtZXNzYWdlKSB7CiAgICAgICAgYXdhaXQgd3JpdGVyLndyaXRlKGVuY29kZXIuZW5jb2RlKG1lc3NhZ2UpKTsKICAgICAgICBhd2FpdCB3cml0ZXIuZmx1c2goKTsKICAgIH0KICAgIHN0YXRpYyBhc3luYyByZWFkTGluZShyZWFkZXIpIHsKICAgICAgICBjb25zdCBidWYgPSBuZXcgVWludDhBcnJheSgxMDI0KTsKICAgICAgICBsZXQgbG9jID0gMDsKICAgICAgICBsZXQgZCA9IG51bGw7CiAgICAgICAgd2hpbGUoKGQgPSBhd2FpdCByZWFkZXIucmVhZEJ5dGUoKSkgJiYgZCAhPT0gbnVsbCl7CiAgICAgICAgICAgIGlmIChkID09PSAiXHIiLmNoYXJDb2RlQXQoMCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGQxID0gYXdhaXQgcmVhZGVyLnJlYWRCeXRlKCk7CiAgICAgICAgICAgICAgICBpZiAoZDEgPT09ICJcbiIuY2hhckNvZGVBdCgwKSkgewogICAgICAgICAgICAgICAgICAgIGJ1Zltsb2MrK10gPSBkOwogICAgICAgICAgICAgICAgICAgIGJ1Zltsb2MrK10gPSBkMTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2Rlci5kZWNvZGUobmV3IERlbm8uQnVmZmVyKGJ1Zi5zdWJhcnJheSgwLCBsb2MpKS5ieXRlcygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBidWZbbG9jKytdID0gZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICIiOwogICAgfQogICAgc3RhdGljIGNyZWF0ZVJlcXVlc3QocGF5bG9hZCkgewogICAgICAgIHJldHVybiBgJHtwYXlsb2FkfVxyXG5gOwogICAgfQogICAgc3RhdGljIGFzeW5jIHNlbmRDb21tYW5kKHdyaXRlciwgcmVhZGVyLCBwYXlsb2FkKSB7CiAgICAgICAgYXdhaXQgTmF0c1V0aWwud3JpdGVJbih3cml0ZXIsIE5hdHNVdGlsLmNyZWF0ZVJlcXVlc3QocGF5bG9hZCkpOwogICAgICAgIGNvbnN0IFttZXNzYWdlMywgc3RhdHVzXSA9IFsKICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWFkTGluZShyZWFkZXIpLAogICAgICAgICAgICBhd2FpdCB0aGlzLnJlYWRMaW5lKHJlYWRlcikKICAgICAgICBdOwogICAgICAgIGNvbnN0IGlzT2sgPSBOYXRzVXRpbC52YWxpZGF0ZVN0YXR1cyhzdGF0dXMpOwogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIG1lc3NhZ2UzLAogICAgICAgICAgICBzdGF0dXMsCiAgICAgICAgICAgIGlzT2sKICAgICAgICBdOwogICAgfQogICAgc3RhdGljIHByb2Nlc3NSZXNwb25zZShyZXNwb25zZSkgewogICAgICAgIHJldHVybiByZXNwb25zZS5sYXN0SW5kZXhPZigiXHJcbiIpOwogICAgfQogICAgc3RhdGljIGFzeW5jIGNvbm5lY3Qod3JpdGVyLCByZWFkZXIsIGRhdGEpIHsKICAgICAgICBsZXQgY29tbWFuZCA9IGBDT05ORUNUYDsKICAgICAgICBjb21tYW5kICs9IGAgJHtKU09OLnN0cmluZ2lmeShkYXRhKX1gOwogICAgICAgIGxldCBbc2VydmVyRGF0YVJlc3BvbnNlLCBlcnJvclN0YXR1cywgaXNPa10gPSBhd2FpdCB0aGlzLnNlbmRDb21tYW5kKHdyaXRlciwgcmVhZGVyLCBjb21tYW5kKTsKICAgICAgICBpZiAoc2VydmVyRGF0YVJlc3BvbnNlLmluY2x1ZGVzKCJJTkZPIikpIHsKICAgICAgICAgICAgc2VydmVyRGF0YVJlc3BvbnNlID0gc2VydmVyRGF0YVJlc3BvbnNlLnJlcGxhY2UoIklORk8gIiwgIiIpLnRyaW0oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgc2VydmVyRGF0YVJlc3BvbnNlLAogICAgICAgICAgICBlcnJvclN0YXR1cywKICAgICAgICAgICAgaXNPawogICAgICAgIF07CiAgICB9CiAgICBzdGF0aWMgdmFsaWRhdGVTdGF0dXMob2tMaW5lKSB7CiAgICAgICAgY29uc3QgaXNFcnJvciA9IG9rTGluZS5zdGFydHNXaXRoKCItRVJSIik7CiAgICAgICAgaWYgKGlzRXJyb3IpIHsKICAgICAgICAgICAgbGV0IFssIGVycm9yXSA9IG9rTGluZS5zdWJzdHIoMSkuc3BsaXQoIkVSUiAiKTsKICAgICAgICAgICAgdGhyb3cgbmV3IE5BVFNlcnJvcihgKE5BVFMpICR7ZXJyb3J9YCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgc3RhdGljIGFzeW5jIGV4ZWMod3JpdGVyLCByZWFkZXIsIHBheWxvYWQpIHsKICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kQ29tbWFuZCh3cml0ZXIsIHJlYWRlciwgcGF5bG9hZCk7CiAgICB9CiAgICBzdGF0aWMgZ2V0TWVzc2FnZVR5cGVGcm9tSGVhZGVyKGhlYWRlcikgewogICAgICAgIGlmIChoZWFkZXIuaW5jbHVkZXMoIlBJTkciKSkgewogICAgICAgICAgICByZXR1cm4gIlBJTkciOwogICAgICAgIH0gZWxzZSBpZiAoaGVhZGVyLmluY2x1ZGVzKCJQT05HIikpIHsKICAgICAgICAgICAgcmV0dXJuICJQT05HIjsKICAgICAgICB9IGVsc2UgaWYgKGhlYWRlci5pbmNsdWRlcygiTVNHIikpIHsKICAgICAgICAgICAgcmV0dXJuICJNU0ciOwogICAgICAgIH0gZWxzZSBpZiAoaGVhZGVyLmluY2x1ZGVzKCJJTkZPIikpIHsKICAgICAgICAgICAgcmV0dXJuICJJTkZPIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gIk9USEVSIjsKICAgICAgICB9CiAgICB9Cn0KY29uc3QgcmVwbGFjZUxhc3QgPSAoeCwgeSwgeik9PnsKICAgIHZhciBhID0geC5zcGxpdCgiIik7CiAgICBhW3gubGFzdEluZGV4T2YoeSldID0gejsKICAgIHJldHVybiBhLmpvaW4oIiIpOwp9OwpjbGFzcyBOYXRzU3Vic2NyaXB0aW9uIHsKICAgIG5hdHNDbGllbnQ7CiAgICBwYXR0ZXJucyA9IHsKICAgIH07CiAgICBjb25zdHJ1Y3RvcihuYXRzQ2xpZW50KXsKICAgICAgICB0aGlzLm5hdHNDbGllbnQgPSBuYXRzQ2xpZW50OwogICAgfQogICAgYXN5bmMgc3Vic2NyaWJlKHN1YmplY3QsIHF1ZXVlR3JvdXApIHsKICAgICAgICBpZiAoc3ViamVjdC5pbmNsdWRlcygiICIpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOQVRTZXJyb3IoIlRoZSBzdWJqZWN0IG9mIGEgc3Vic2NyaXB0aW9uIGNhbm5vdCBjb250YWluIHdoaXRlIHNwYWNlcyIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjbGllbnRJZCA9IHRoaXMubmF0c0NsaWVudC5nZXROYXRzU2VydmVyRGF0YSgpLmNsaWVudF9pZDsKICAgICAgICBpZiAoY2xpZW50SWQpIHsKICAgICAgICAgICAgaWYgKHF1ZXVlR3JvdXApIHsKICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLm5hdHNDbGllbnQuZXhlYyhgU1VCICR7c3ViamVjdH0gJHtxdWV1ZUdyb3VwfSAke2NsaWVudElkfWApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMubmF0c0NsaWVudC5leGVjKGBTVUIgJHtzdWJqZWN0fSAke2NsaWVudElkfWApOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5BVFNlcnJvcigiQSBzdWJzY3JpcHRpb24gcmVxdWlyZXMgYSB2YWxpZCBjbGllbnQgaWQsIG1ha2Ugc3VyZSB5b3VyIGNvbm5lY3Rpb24gaXMgZXN0YWJsaXNoZWQuIik7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgdW5TdWJzY3JpYmUobWF4TWVzc2FnZXMpIHsKICAgICAgICBjb25zdCBjbGllbnRJZCA9IHRoaXMubmF0c0NsaWVudC5nZXROYXRzU2VydmVyRGF0YSgpLmNsaWVudF9pZDsKICAgICAgICBpZiAoY2xpZW50SWQpIHsKICAgICAgICAgICAgaWYgKG1heE1lc3NhZ2VzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRzQ2xpZW50LmV4ZWMoYFVOU1VCICR7Y2xpZW50SWR9ICR7bWF4TWVzc2FnZXN9YCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRzQ2xpZW50LmV4ZWMoYFVOU1VCICR7Y2xpZW50SWR9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgTkFUU2Vycm9yKCJOQVRTIGNhbm5vdCB1bnN1YnNjcmliZSBhbiB1bmV4aXN0ZW50IGNsaWVudCIpOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIHB1Ymxpc2goc3ViamVjdCwgcGF5bG9hZCwgcmVwbHlUbykgewogICAgICAgIGNvbnN0IGZpbmFsUGF5bG9hZCA9IHR5cGVvZiBwYXlsb2FkID09PSAib2JqZWN0IiA/IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpIDogcGF5bG9hZDsKICAgICAgICBpZiAocmVwbHlUbykgewogICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRzQ2xpZW50LmV4ZWMoYFBVQiAke3N1YmplY3R9ICR7cmVwbHlUb30gJHtmaW5hbFBheWxvYWQubGVuZ3RofVxyXG4ke2ZpbmFsUGF5bG9hZH1gKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRzQ2xpZW50LmV4ZWMoYFBVQiAke3N1YmplY3R9ICR7ZmluYWxQYXlsb2FkLmxlbmd0aH1cclxuJHtmaW5hbFBheWxvYWR9YCk7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgKnJlY2VpdmUoKSB7CiAgICAgICAgbGV0IGZvcmNlUmVjb25uZWN0ID0gZmFsc2U7CiAgICAgICAgd2hpbGUodGhpcy5uYXRzQ2xpZW50LmlzQ29ubmVjdGVkKCkpewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbGV0IHN1YnNNZXNzYWdlOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBhc3luYyAoKT0+YXdhaXQgTmF0c1V0aWwucmVhZExpbmUodGhpcy5uYXRzQ2xpZW50LmdldFJlYWRlcigpKQogICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXIgPSBhd2FpdCByZWFkZXIoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gTmF0c1V0aWwuZ2V0TWVzc2FnZVR5cGVGcm9tSGVhZGVyKGhlYWRlcik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICJNU0ciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UzID0gYXdhaXQgcmVhZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZE1lc3NhZ2UgPSByZXBsYWNlTGFzdChyZXBsYWNlTGFzdChtZXNzYWdlMywgIlxyIiwgIiIpLCAiXG4iLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjbGVhbkhlYWRlciA9IHJlcGxhY2VMYXN0KHJlcGxhY2VMYXN0KGhlYWRlciwgIlxyIiwgIiIpLCAiXG4iLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBbLCBzdWJqZWN0LCBzaWQsIHJlc3BvbnNlTGVuZ3RoXSA9IGNsZWFuSGVhZGVyLnNwbGl0KCIgIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNNZXNzYWdlID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lkOiBwYXJzZUludChzaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlTGVuZ3RoOiBwYXJzZUludChyZXNwb25zZUxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBwcm9jZXNzZWRNZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3Vic01lc3NhZ2UgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiBoZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiIgogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBEZW5vLmVycm9ycy5CYWRSZXNvdXJjZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdHNDbGllbnQuY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB5aWVsZCBzdWJzTWVzc2FnZTsKICAgICAgICAgICAgfSBmaW5hbGx5ewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLm5hdHNDbGllbnQuaXNDbG9zZWQoKSAmJiAhdGhpcy5uYXRzQ2xpZW50LmlzQ29ubmVjdGVkKCkgfHwgZm9yY2VSZWNvbm5lY3QpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm5hdHNDbGllbnQucmVjb25uZWN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KY2xhc3MgTmF0c0NsaWVudCB7CiAgICBjb25uZWN0aW9uOwogICAgZ2VuZXJhbE9wdGlvbnM7CiAgICBmdWxsQ2xpZW50T3B0aW9uczsKICAgIHJlYWRlcjsKICAgIHdyaXRlcjsKICAgIGNvbm5lY3RlZDsKICAgIGNsb3NlZDsKICAgIG5hdHNTZXJ2ZXJEYXRhID0gewogICAgfTsKICAgIHN1YnNjcmliZXI7CiAgICBhc3luYyBjb25uZWN0KG9wdGlvbnMpIHsKICAgICAgICBvcHRpb25zLm9wdGlvbnNbInZlcmJvc2UiXSA9IHRydWU7CiAgICAgICAgdGhpcy5nZW5lcmFsT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oewogICAgICAgIH0sIHsKICAgICAgICAgICAgdHJhbnNwb3J0OiBvcHRpb25zLnRyYW5zcG9ydCwKICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgaG9zdDogb3B0aW9ucy5vcHRpb25zLmhvc3QsCiAgICAgICAgICAgICAgICBwb3J0OiBvcHRpb25zLm9wdGlvbnMucG9ydCwKICAgICAgICAgICAgICAgIHJldHJ5QXR0ZW1wdHM6IG9wdGlvbnMub3B0aW9ucy5yZXRyeUF0dGVtcHRzLAogICAgICAgICAgICAgICAgcmV0cnlEZWxheTogb3B0aW9ucy5vcHRpb25zLnJldHJ5RGVsYXkKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZnVsbENsaWVudE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsKICAgICAgICB9LCBvcHRpb25zKTsKICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBhd2FpdCBEZW5vLmNvbm5lY3QoewogICAgICAgICAgICBwb3J0OiB0aGlzLmdlbmVyYWxPcHRpb25zLm9wdGlvbnMucG9ydCB8fCBDbGllbnRVdGlsLmdldERlZmF1bHRQb3J0KHRoaXMuZ2VuZXJhbE9wdGlvbnMudHJhbnNwb3J0KSwKICAgICAgICAgICAgaG9zdG5hbWU6IHRoaXMuZ2VuZXJhbE9wdGlvbnMub3B0aW9ucy5ob3N0CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5yZWFkZXIgPSBuZXcgQnVmUmVhZGVyKHRoaXMuY29ubmVjdGlvbik7CiAgICAgICAgdGhpcy53cml0ZXIgPSBuZXcgQnVmV3JpdGVyKHRoaXMuY29ubmVjdGlvbik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRoZW50aWNhdGUob3B0aW9ucy5vcHRpb25zKTsKICAgICAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLmNsb3NlZCA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICB0aGlzLmNsb3NlQ29ubmVjdGlvbigpOwogICAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9CiAgICB9CiAgICBhc3luYyBhdXRoZW50aWNhdGUoZGF0YSkgewogICAgICAgIGNvbnN0IFtyZXNwb25zZSwgZXJyLCBpc09rXSA9IGF3YWl0IE5hdHNVdGlsLmNvbm5lY3QodGhpcy5nZXRXcml0ZXIoKSwgdGhpcy5nZXRSZWFkZXIoKSwgZGF0YSk7CiAgICAgICAgaWYgKGlzT2spIHsKICAgICAgICAgICAgdGhpcy5uYXRzU2VydmVyRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIHJlY29ubmVjdCgpIHsKICAgICAgICBpZiAoIXRoaXMucmVhZGVyLnBlZWsoMSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDbGllbnQgaXMgY2xvc2VkLiIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCBOYXRzVXRpbC5zZW5kQ29tbWFuZCh0aGlzLndyaXRlciwgdGhpcy5yZWFkZXIsICJQSU5HIik7CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IHRydWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBsZXQgcmV0cmllcyA9IDA7CiAgICAgICAgICAgICAgICBjb25zdCByZXNvbHZhYmxlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvbm5lY3Rpb25JbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRyaWVzID4gdGhpcy5nZXRSZXRyeUF0dGVtcHMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocmVjb25uZWN0aW9uSW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBOQVRTZXJyb3IoIkNvdWxkIG5vdCByZS1lc3RhYmxpc2ggY29ubmVjdGlvbiIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY29ubmVjdCh0aGlzLmdldENvbm5lY3Rpb25PcHRpb25zKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgTmF0c1V0aWwuc2VuZENvbW1hbmQodGhpcy5nZXRXcml0ZXIoKSwgdGhpcy5nZXRSZWFkZXIoKSwgIlBJTkciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHJpZXMgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChyZWNvbm5lY3Rpb25JbnRlcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yMSkgewogICAgICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRyaWVzID0gcmV0cmllcyArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmdldFJldHJ5RGVsYXkoKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGF3YWl0IHJlc29sdmFibGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBnZXRDb25uZWN0aW9uT3B0aW9ucygpIHsKICAgICAgICByZXR1cm4gdGhpcy5mdWxsQ2xpZW50T3B0aW9uczsKICAgIH0KICAgIGdldFJlYWRlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZWFkZXI7CiAgICB9CiAgICBnZXRXcml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMud3JpdGVyOwogICAgfQogICAgZ2V0Q29ubmVjdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0aW9uOwogICAgfQogICAgY2xvc2VDb25uZWN0aW9uKCkgewogICAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTsKICAgICAgICB0aGlzLmNvbm5lY3Rpb24uY2xvc2UoKTsKICAgIH0KICAgIGdldFJldHJ5QXR0ZW1wcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlBdHRlbXB0cyB8fCAzOwogICAgfQogICAgZ2V0UmV0cnlEZWxheSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlEZWxheSB8fCAxMDAwOwogICAgfQogICAgaXNDb25uZWN0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkOwogICAgfQogICAgaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VkOwogICAgfQogICAgZ2V0QXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXROYXRzU2VydmVyRGF0YSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5uYXRzU2VydmVyRGF0YTsKICAgIH0KICAgIGV4ZWMoZXhlY0RhdGEpIHsKICAgICAgICBpZiAoIXRoaXMuaXNDbG9zZWQoKSAmJiB0aGlzLmlzQ29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIE5hdHNVdGlsLmV4ZWModGhpcy5nZXRXcml0ZXIoKSwgdGhpcy5nZXRSZWFkZXIoKSwgZXhlY0RhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOQVRTZXJyb3IoIkNvbW1hbmQgY291bGQgbm90IGJlIGV4ZWN1dGVkIGJlY2F1c2UgY29ubmVjdGlvbiBpcyBlaXRoZXIgY2xvc2VkIG9yIG5vdCBlc3RhYmxpc2hlZCIpOwogICAgICAgIH0KICAgIH0KICAgIGdldFN1YnNjcmliZXIoKSB7CiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaWJlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlciA9IG5ldyBOYXRzU3Vic2NyaXB0aW9uKHRoaXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5zdWJzY3JpYmVyOwogICAgfQogICAgYXN5bmMgKnJlY2VpdmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3Vic2NyaWJlci5yZWNlaXZlKCk7CiAgICB9CiAgICBnZXREZWZhdWx0UG9ydCgpIHsKICAgICAgICByZXR1cm4gNDIyMjsKICAgIH0KfQp2YXIgVHJhbnNwb3J0ZXJzOwooZnVuY3Rpb24oVHJhbnNwb3J0ZXJzMSkgewogICAgVHJhbnNwb3J0ZXJzMVsiVENQIl0gPSAiVENQIjsKICAgIFRyYW5zcG9ydGVyczFbIkFNUVAiXSA9ICJBTVFQIjsKICAgIFRyYW5zcG9ydGVyczFbIlJFRElTIl0gPSAiUkVESVMiOwogICAgVHJhbnNwb3J0ZXJzMVsiTkFUUyJdID0gIk5BVFMiOwp9KShUcmFuc3BvcnRlcnMgfHwgKFRyYW5zcG9ydGVycyA9IHsKfSkpOwpjbGFzcyBUY3BDbGllbnQgewogICAgY29ubmVjdGlvbjsKICAgIGdlbmVyYWxPcHRpb25zOwogICAgcmVhZGVyOwogICAgd3JpdGVyOwogICAgY29ubmVjdGVkOwogICAgY2xvc2VkOwogICAgYXN5bmMgY29ubmVjdChvcHRpb25zKSB7CiAgICAgICAgdGhpcy5nZW5lcmFsT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oewogICAgICAgIH0sIHsKICAgICAgICAgICAgdHJhbnNwb3J0OiBvcHRpb25zLnRyYW5zcG9ydCwKICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgaG9zdDogb3B0aW9ucy5vcHRpb25zLmhvc3QsCiAgICAgICAgICAgICAgICBwb3J0OiBvcHRpb25zLm9wdGlvbnMucG9ydCwKICAgICAgICAgICAgICAgIHJldHJ5QXR0ZW1wdHM6IG9wdGlvbnMub3B0aW9ucy5yZXRyeUF0dGVtcHRzLAogICAgICAgICAgICAgICAgcmV0cnlEZWxheTogb3B0aW9ucy5vcHRpb25zLnJldHJ5RGVsYXkKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IGF3YWl0IERlbm8uY29ubmVjdCh7CiAgICAgICAgICAgIHBvcnQ6IHRoaXMuZ2VuZXJhbE9wdGlvbnMub3B0aW9ucy5wb3J0IHx8IENsaWVudFV0aWwuZ2V0RGVmYXVsdFBvcnQodGhpcy5nZW5lcmFsT3B0aW9ucy50cmFuc3BvcnQpLAogICAgICAgICAgICBob3N0bmFtZTogdGhpcy5nZW5lcmFsT3B0aW9ucy5vcHRpb25zLmhvc3QKICAgICAgICB9KTsKICAgICAgICB0aGlzLnJlYWRlciA9IG5ldyBCdWZSZWFkZXIodGhpcy5jb25uZWN0aW9uKTsKICAgICAgICB0aGlzLndyaXRlciA9IG5ldyBCdWZXcml0ZXIodGhpcy5jb25uZWN0aW9uKTsKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IHRydWU7CiAgICAgICAgdGhpcy5jbG9zZWQgPSBmYWxzZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGF1dGhlbnRpY2F0ZShkYXRhKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNZXRob2Qgbm90IGltcGxlbWVudGVkLiIpOwogICAgfQogICAgcmVjb25uZWN0KC4uLmFyZ3MpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuIik7CiAgICB9CiAgICBnZXRDb25uZWN0aW9uT3B0aW9ucygpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuIik7CiAgICB9CiAgICBnZXRSZWFkZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVhZGVyOwogICAgfQogICAgZ2V0V3JpdGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLndyaXRlcjsKICAgIH0KICAgIGdldENvbm5lY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbjsKICAgIH0KICAgIGNsb3NlQ29ubmVjdGlvbigpIHsKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTsKICAgICAgICB0aGlzLmNvbm5lY3Rpb24uY2xvc2UoKTsKICAgIH0KICAgIGdldFJldHJ5QXR0ZW1wcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlBdHRlbXB0cyB8fCAzOwogICAgfQogICAgZ2V0UmV0cnlEZWxheSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlEZWxheSB8fCAxMDAwOwogICAgfQogICAgaXNDb25uZWN0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkOwogICAgfQogICAgaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VkOwogICAgfQogICAgZ2V0U3Vic2NyaWJlciguLi5hcmdzKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNZXRob2Qgbm90IGltcGxlbWVudGVkLiIpOwogICAgfQogICAgYXN5bmMgKnJlY2VpdmUoLi4uYXJncykgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4iKTsKICAgIH0KICAgIGdldERlZmF1bHRQb3J0KCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4iKTsKICAgIH0KfQpjbGFzcyBNaWNyb2xlbW9uSW50ZXJuYWwgewogICAgc3RhdGljIGluc3RhbmNlOwogICAgVkFMSURfVFJBTlNQT1JURVJTID0gbmV3IE1hcCgpOwogICAgY29uc3RydWN0b3IoKXsKICAgICAgICB0aGlzLnJlZ2lzdGVyVHJhbnNwb3J0ZXIoIlRDUCIsIFRjcENsaWVudCk7CiAgICAgICAgdGhpcy5yZWdpc3RlclRyYW5zcG9ydGVyKCJSRURJUyIsIFJlZGlzQ2xpZW50KTsKICAgICAgICB0aGlzLnJlZ2lzdGVyVHJhbnNwb3J0ZXIoIk5BVFMiLCBOYXRzQ2xpZW50KTsKICAgICAgICB0aGlzLnJlZ2lzdGVyVHJhbnNwb3J0ZXIoIkFNUVAiLCBBbXFwQ2xpZW50KTsKICAgIH0KICAgIHJlZ2lzdGVyVHJhbnNwb3J0ZXIodHJhbnNwb3J0ZXIsIGNsYXNzT2JqKSB7CiAgICAgICAgY29uc3QgdHJhbnNwb3J0ZXJOYW1lID0gdHJhbnNwb3J0ZXIudG9VcHBlckNhc2UoKTsKICAgICAgICBpZiAoIXRoaXMuVkFMSURfVFJBTlNQT1JURVJTLmhhcyh0cmFuc3BvcnRlck5hbWUpKSB7CiAgICAgICAgICAgIHRoaXMuVkFMSURfVFJBTlNQT1JURVJTLnNldCh0cmFuc3BvcnRlci50b1VwcGVyQ2FzZSgpLCBjbGFzc09iaik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUcmFuc3BvcnRlciBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQiKTsKICAgICAgICB9CiAgICB9CiAgICBnZXRUcmFuc3BvcnRlcih0cmFuc3BvcnRlcikgewogICAgICAgIGlmICh0aGlzLlZBTElEX1RSQU5TUE9SVEVSUy5oYXModHJhbnNwb3J0ZXIpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLlZBTElEX1RSQU5TUE9SVEVSUy5nZXQodHJhbnNwb3J0ZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVHJhbnNwb3J0ZXIgJHt0cmFuc3BvcnRlcn0gZG9lcyBub3QgZXhpc3RgKTsKICAgICAgICB9CiAgICB9CiAgICB0cmFuc3BvcnRlckV4aXN0cyh0cmFuc3BvcnRlcikgewogICAgICAgIHJldHVybiB0aGlzLlZBTElEX1RSQU5TUE9SVEVSUy5oYXModHJhbnNwb3J0ZXIpOwogICAgfQogICAgc3RhdGljIGdldEluc3RhbmNlKCkgewogICAgICAgIGlmICghTWljcm9sZW1vbkludGVybmFsLmluc3RhbmNlKSB7CiAgICAgICAgICAgIE1pY3JvbGVtb25JbnRlcm5hbC5pbnN0YW5jZSA9IG5ldyBNaWNyb2xlbW9uSW50ZXJuYWwoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIE1pY3JvbGVtb25JbnRlcm5hbC5pbnN0YW5jZTsKICAgIH0KfQpjbGFzcyBNaWNyb2xlbW9uIHsKICAgIHNlbGVjdGVkQ2xpZW50OwogICAgYXN5bmMgY29ubmVjdChvcHRpb25zKSB7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRDbGllbnQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCB0cmFuc3BvcnRlciA9IG9wdGlvbnMudHJhbnNwb3J0OwogICAgICAgICAgICBjb25zdCBtaWNyb3NlcnZpY2VDbGllbnQgPSBNaWNyb2xlbW9uSW50ZXJuYWwuZ2V0SW5zdGFuY2UoKS5nZXRUcmFuc3BvcnRlcih0cmFuc3BvcnRlcik7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDbGllbnQgPSBuZXcgbWljcm9zZXJ2aWNlQ2xpZW50KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmNvbm5lY3Qob3B0aW9ucyk7CiAgICB9CiAgICBhc3luYyBhdXRoZW50aWNhdGUoZGF0YSkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmF1dGhlbnRpY2F0ZShkYXRhKTsKICAgIH0KICAgIGFzeW5jIHJlY29ubmVjdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudC5yZWNvbm5lY3QoKTsKICAgIH0KICAgIGdldENvbm5lY3Rpb25PcHRpb25zKCkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmdldENvbm5lY3Rpb25PcHRpb25zKCk7CiAgICB9CiAgICBnZXRSZWFkZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQuZ2V0UmVhZGVyKCk7CiAgICB9CiAgICBnZXRXcml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQuZ2V0V3JpdGVyKCk7CiAgICB9CiAgICBnZXRDb25uZWN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmdldENvbm5lY3Rpb24oKTsKICAgIH0KICAgIGNsb3NlQ29ubmVjdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudC5jbG9zZUNvbm5lY3Rpb24oKTsKICAgIH0KICAgIGdldFJldHJ5QXR0ZW1wcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudC5nZXRSZXRyeUF0dGVtcHMoKTsKICAgIH0KICAgIGdldFJldHJ5RGVsYXkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQuZ2V0UmV0cnlEZWxheSgpOwogICAgfQogICAgaXNDb25uZWN0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQuaXNDb25uZWN0ZWQoKTsKICAgIH0KICAgIGlzQ2xvc2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmlzQ2xvc2VkKCk7CiAgICB9CiAgICBnZXRTdWJzY3JpYmVyKC4uLmFyZ3MpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudC5nZXRTdWJzY3JpYmVyKC4uLmFyZ3MpOwogICAgfQogICAgYXN5bmMgKnJlY2VpdmUoLi4ucGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQucmVjZWl2ZSguLi5wYXJhbXMpOwogICAgfQogICAgZ2V0RGVmYXVsdFBvcnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQuZ2V0RGVmYXVsdFBvcnQoKTsKICAgIH0KICAgIGdldFNlbGVjdGVkQ2xpZW50KCkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50OwogICAgfQp9CmxldCBtaWNyb3NlcnZpY2VDb25uZWN0aW9uID0gdW5kZWZpbmVkOwpjb25zdCBidWlsZFBvc3RNZXNzYWdlID0gKGRhdGEyKT0+ewogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGRhdGEyKTsKfTsKY29uc3QgaW5pdGlhbGl6ZU1pY3Jvc2VydmljZSA9IGFzeW5jIChjb25maWd1cmF0aW9uKT0+ewogICAgaWYgKCFtaWNyb3NlcnZpY2VDb25uZWN0aW9uKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWljcm9zZXJ2aWNlQ29ubmVjdGlvbiA9IGF3YWl0IG5ldyBNaWNyb2xlbW9uKCkuY29ubmVjdChjb25maWd1cmF0aW9uKTsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShidWlsZFBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJNQU5EQVJJTkVfTUlDUk9TRVJWSUNFX1JFQURZIgogICAgICAgICAgICB9KSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShidWlsZFBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJNQU5EQVJJTkVfTUlDUk9TRVJWSUNFX0ZBSUxVUkUiLAogICAgICAgICAgICAgICAgZGF0YTogZXJyb3IKICAgICAgICAgICAgfSkpOwogICAgICAgIH0KICAgIH0KfTsKY29uc3Qgc3Vic2NyaWJlQW5kTGlzdGVuID0gYXN5bmMgKHN1YnNjcmlwdGlvbik9PnsKICAgIHRyeSB7CiAgICAgICAgaWYgKG1pY3Jvc2VydmljZUNvbm5lY3Rpb24pIHsKICAgICAgICAgICAgc3dpdGNoKHN1YnNjcmlwdGlvbi50cmFuc3BvcnRlci50b1VwcGVyQ2FzZSgpKXsKICAgICAgICAgICAgICAgIGNhc2UgVHJhbnNwb3J0ZXJzLkFNUVA6CiAgICAgICAgICAgICAgICAgICAgKGFzeW5jICgpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3QgZGF0YTIgb2YgbWljcm9zZXJ2aWNlQ29ubmVjdGlvbi5yZWNlaXZlKHN1YnNjcmlwdGlvbi5jaGFubmVsc1swXSkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShidWlsZFBvc3RNZXNzYWdlKGRhdGEyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUcmFuc3BvcnRlcnMuUkVESVM6CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Vic2NyaWJlciA9IGF3YWl0IG1pY3Jvc2VydmljZUNvbm5lY3Rpb24uZ2V0U3Vic2NyaWJlcigpLmNoYW5uZWxTdWJzY3JpYmUoLi4uc3Vic2NyaXB0aW9uLmNoYW5uZWxzKTsKICAgICAgICAgICAgICAgICAgICAoYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3QgeyBjaGFubmVsICwgbWVzc2FnZTogbWVzc2FnZTMgIH0gb2Ygc3Vic2NyaWJlci5yZWNlaXZlKCkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShidWlsZFBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsOiBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUcmFuc3BvcnRlcnMuTkFUUzoKICAgICAgICAgICAgICAgICAgICBjb25zdCBuYXRzU3Vic2NyaWJlciA9IG1pY3Jvc2VydmljZUNvbm5lY3Rpb24uZ2V0U3Vic2NyaWJlcigpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IFtjaGFubmVsVG9TdWJzY3JpYmUsIHF1ZXVlR3JvdXBdID0gc3Vic2NyaXB0aW9uLmNoYW5uZWxzOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IG5hdHNTdWJzY3JpYmVyLnN1YnNjcmliZShjaGFubmVsVG9TdWJzY3JpYmUsIHF1ZXVlR3JvdXApOwogICAgICAgICAgICAgICAgICAgIChhc3luYyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCBkYXRhMiBvZiBuYXRzU3Vic2NyaWJlci5yZWNlaXZlKCkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShidWlsZFBvc3RNZXNzYWdlKGRhdGEyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBhd2FpdCBzZWxmLnBvc3RNZXNzYWdlKGJ1aWxkUG9zdE1lc3NhZ2UoewogICAgICAgICAgICBtYW5kYXJpbmU6ICJMSVNURU5JTkctRVJST1IiLAogICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlCiAgICAgICAgfSkpOwogICAgfQp9OwpzZWxmLm9ubWVzc2FnZSA9IGFzeW5jICh7IGRhdGE6IGRhdGEyICB9KT0+ewogICAgY29uc3QgY21kT2JqZWN0ID0gZGF0YTI7CiAgICBzd2l0Y2goY21kT2JqZWN0LmNtZCl7CiAgICAgICAgY2FzZSAiSU5JVElBTElaRSI6CiAgICAgICAgICAgIGF3YWl0IGluaXRpYWxpemVNaWNyb3NlcnZpY2UoY21kT2JqZWN0LmNvbmZpZ3VyYXRpb24pOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJMSVNURU4iOgogICAgICAgICAgICBhd2FpdCBzdWJzY3JpYmVBbmRMaXN0ZW4oZGF0YTIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJIRUFMVEgiOgogICAgICAgICAgICBhd2FpdCBzZWxmLnBvc3RNZXNzYWdlKGJ1aWxkUG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgbWFuZGFyaW5lOiAiSEVBTFRILUNIRUNLIiwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJBTElWRSIKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBicmVhazsKICAgIH0KfTsK`;