export const microserviceWorkerBase64Bundle = `data:application/javascript;base64,ZnVuY3Rpb24gY29weShzcmMsIGRzdCwgb2ZmID0gMCkgewogICAgb2ZmID0gTWF0aC5tYXgoMCwgTWF0aC5taW4ob2ZmLCBkc3QuYnl0ZUxlbmd0aCkpOwogICAgY29uc3QgZHN0Qnl0ZXNBdmFpbGFibGUgPSBkc3QuYnl0ZUxlbmd0aCAtIG9mZjsKICAgIGlmIChzcmMuYnl0ZUxlbmd0aCA+IGRzdEJ5dGVzQXZhaWxhYmxlKSB7CiAgICAgICAgc3JjID0gc3JjLnN1YmFycmF5KDAsIGRzdEJ5dGVzQXZhaWxhYmxlKTsKICAgIH0KICAgIGRzdC5zZXQoc3JjLCBvZmYpOwogICAgcmV0dXJuIHNyYy5ieXRlTGVuZ3RoOwp9CmNsYXNzIERlbm9TdGRJbnRlcm5hbEVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgY29uc3RydWN0b3IobWVzc2FnZTIpewogICAgICAgIHN1cGVyKG1lc3NhZ2UyKTsKICAgICAgICB0aGlzLm5hbWUgPSAiRGVub1N0ZEludGVybmFsRXJyb3IiOwogICAgfQp9CmZ1bmN0aW9uIGFzc2VydChleHByLCBtc2cgPSAiIikgewogICAgaWYgKCFleHByKSB7CiAgICAgICAgdGhyb3cgbmV3IERlbm9TdGRJbnRlcm5hbEVycm9yKG1zZyk7CiAgICB9Cn0KY29uc3QgREVGQVVMVF9CVUZfU0laRSA9IDQwOTY7CmNvbnN0IE1JTl9CVUZfU0laRSA9IDE2Owpjb25zdCBDUiA9ICJcciIuY2hhckNvZGVBdCgwKTsKY29uc3QgTEYgPSAiXG4iLmNoYXJDb2RlQXQoMCk7CmNsYXNzIEJ1ZmZlckZ1bGxFcnJvciBleHRlbmRzIEVycm9yIHsKICAgIG5hbWUgPSAiQnVmZmVyRnVsbEVycm9yIjsKICAgIGNvbnN0cnVjdG9yKHBhcnRpYWwpewogICAgICAgIHN1cGVyKCJCdWZmZXIgZnVsbCIpOwogICAgICAgIHRoaXMucGFydGlhbCA9IHBhcnRpYWw7CiAgICB9Cn0KY2xhc3MgUGFydGlhbFJlYWRFcnJvciBleHRlbmRzIERlbm8uZXJyb3JzLlVuZXhwZWN0ZWRFb2YgewogICAgbmFtZSA9ICJQYXJ0aWFsUmVhZEVycm9yIjsKICAgIGNvbnN0cnVjdG9yKCl7CiAgICAgICAgc3VwZXIoIkVuY291bnRlcmVkIFVuZXhwZWN0ZWRFb2YsIGRhdGEgb25seSBwYXJ0aWFsbHkgcmVhZCIpOwogICAgfQp9CmNsYXNzIEJ1ZlJlYWRlciB7CiAgICByID0gMDsKICAgIHcgPSAwOwogICAgZW9mID0gZmFsc2U7CiAgICBzdGF0aWMgY3JlYXRlKHIsIHNpemUgPSA0MDk2KSB7CiAgICAgICAgcmV0dXJuIHIgaW5zdGFuY2VvZiBCdWZSZWFkZXIgPyByIDogbmV3IEJ1ZlJlYWRlcihyLCBzaXplKTsKICAgIH0KICAgIGNvbnN0cnVjdG9yKHJkMSwgc2l6ZTEgPSA0MDk2KXsKICAgICAgICBpZiAoc2l6ZTEgPCAxNikgewogICAgICAgICAgICBzaXplMSA9IE1JTl9CVUZfU0laRTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fcmVzZXQobmV3IFVpbnQ4QXJyYXkoc2l6ZTEpLCByZDEpOwogICAgfQogICAgc2l6ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5idWYuYnl0ZUxlbmd0aDsKICAgIH0KICAgIGJ1ZmZlcmVkKCkgewogICAgICAgIHJldHVybiB0aGlzLncgLSB0aGlzLnI7CiAgICB9CiAgICBhc3luYyBfZmlsbCgpIHsKICAgICAgICBpZiAodGhpcy5yID4gMCkgewogICAgICAgICAgICB0aGlzLmJ1Zi5jb3B5V2l0aGluKDAsIHRoaXMuciwgdGhpcy53KTsKICAgICAgICAgICAgdGhpcy53IC09IHRoaXMucjsKICAgICAgICAgICAgdGhpcy5yID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMudyA+PSB0aGlzLmJ1Zi5ieXRlTGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCJidWZpbzogdHJpZWQgdG8gZmlsbCBmdWxsIGJ1ZmZlciIpOwogICAgICAgIH0KICAgICAgICBmb3IobGV0IGkgPSAxMDA7IGkgPiAwOyBpLS0pewogICAgICAgICAgICBjb25zdCByciA9IGF3YWl0IHRoaXMucmQucmVhZCh0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLncpKTsKICAgICAgICAgICAgaWYgKHJyID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNzZXJ0KHJyID49IDAsICJuZWdhdGl2ZSByZWFkIik7CiAgICAgICAgICAgIHRoaXMudyArPSBycjsKICAgICAgICAgICAgaWYgKHJyID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gcHJvZ3Jlc3MgYWZ0ZXIgJHsxMDB9IHJlYWQoKSBjYWxsc2ApOwogICAgfQogICAgcmVzZXQocikgewogICAgICAgIHRoaXMuX3Jlc2V0KHRoaXMuYnVmLCByKTsKICAgIH0KICAgIF9yZXNldChidWYsIHJkKSB7CiAgICAgICAgdGhpcy5idWYgPSBidWY7CiAgICAgICAgdGhpcy5yZCA9IHJkOwogICAgICAgIHRoaXMuZW9mID0gZmFsc2U7CiAgICB9CiAgICBhc3luYyByZWFkKHApIHsKICAgICAgICBsZXQgcnIgPSBwLmJ5dGVMZW5ndGg7CiAgICAgICAgaWYgKHAuYnl0ZUxlbmd0aCA9PT0gMCkgcmV0dXJuIHJyOwogICAgICAgIGlmICh0aGlzLnIgPT09IHRoaXMudykgewogICAgICAgICAgICBpZiAocC5ieXRlTGVuZ3RoID49IHRoaXMuYnVmLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJyMSA9IGF3YWl0IHRoaXMucmQucmVhZChwKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5yZWFkID0gcnIxID8/IDA7CiAgICAgICAgICAgICAgICBhc3NlcnQobnJlYWQgPj0gMCwgIm5lZ2F0aXZlIHJlYWQiKTsKICAgICAgICAgICAgICAgIHJldHVybiBycjE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5yID0gMDsKICAgICAgICAgICAgdGhpcy53ID0gMDsKICAgICAgICAgICAgcnIgPSBhd2FpdCB0aGlzLnJkLnJlYWQodGhpcy5idWYpOwogICAgICAgICAgICBpZiAocnIgPT09IDAgfHwgcnIgPT09IG51bGwpIHJldHVybiBycjsKICAgICAgICAgICAgYXNzZXJ0KHJyID49IDAsICJuZWdhdGl2ZSByZWFkIik7CiAgICAgICAgICAgIHRoaXMudyArPSBycjsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29waWVkID0gY29weSh0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMudyksIHAsIDApOwogICAgICAgIHRoaXMuciArPSBjb3BpZWQ7CiAgICAgICAgcmV0dXJuIGNvcGllZDsKICAgIH0KICAgIGFzeW5jIHJlYWRGdWxsKHApIHsKICAgICAgICBsZXQgYnl0ZXNSZWFkID0gMDsKICAgICAgICB3aGlsZShieXRlc1JlYWQgPCBwLmxlbmd0aCl7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCByciA9IGF3YWl0IHRoaXMucmVhZChwLnN1YmFycmF5KGJ5dGVzUmVhZCkpOwogICAgICAgICAgICAgICAgaWYgKHJyID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJ5dGVzUmVhZCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGFydGlhbFJlYWRFcnJvcigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJ5dGVzUmVhZCArPSBycjsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBlcnIucGFydGlhbCA9IHAuc3ViYXJyYXkoMCwgYnl0ZXNSZWFkKTsKICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcDsKICAgIH0KICAgIGFzeW5jIHJlYWRCeXRlKCkgewogICAgICAgIHdoaWxlKHRoaXMuciA9PT0gdGhpcy53KXsKICAgICAgICAgICAgaWYgKHRoaXMuZW9mKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fZmlsbCgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjID0gdGhpcy5idWZbdGhpcy5yXTsKICAgICAgICB0aGlzLnIrKzsKICAgICAgICByZXR1cm4gYzsKICAgIH0KICAgIGFzeW5jIHJlYWRTdHJpbmcoZGVsaW0pIHsKICAgICAgICBpZiAoZGVsaW0ubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRGVsaW1pdGVyIHNob3VsZCBiZSBhIHNpbmdsZSBjaGFyYWN0ZXIiKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYnVmZmVyID0gYXdhaXQgdGhpcy5yZWFkU2xpY2UoZGVsaW0uY2hhckNvZGVBdCgwKSk7CiAgICAgICAgaWYgKGJ1ZmZlciA9PT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShidWZmZXIpOwogICAgfQogICAgYXN5bmMgcmVhZExpbmUoKSB7CiAgICAgICAgbGV0IGxpbmU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGluZSA9IGF3YWl0IHRoaXMucmVhZFNsaWNlKExGKTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgbGV0IHsgcGFydGlhbDogcGFydGlhbDEgIH0gPSBlcnI7CiAgICAgICAgICAgIGFzc2VydChwYXJ0aWFsMSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXksICJidWZpbzogY2F1Z2h0IGVycm9yIGZyb20gYHJlYWRTbGljZSgpYCB3aXRob3V0IGBwYXJ0aWFsYCBwcm9wZXJ0eSIpOwogICAgICAgICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBCdWZmZXJGdWxsRXJyb3IpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLmVvZiAmJiBwYXJ0aWFsMS5ieXRlTGVuZ3RoID4gMCAmJiBwYXJ0aWFsMVtwYXJ0aWFsMS5ieXRlTGVuZ3RoIC0gMV0gPT09IENSKSB7CiAgICAgICAgICAgICAgICBhc3NlcnQodGhpcy5yID4gMCwgImJ1ZmlvOiB0cmllZCB0byByZXdpbmQgcGFzdCBzdGFydCBvZiBidWZmZXIiKTsKICAgICAgICAgICAgICAgIHRoaXMuci0tOwogICAgICAgICAgICAgICAgcGFydGlhbDEgPSBwYXJ0aWFsMS5zdWJhcnJheSgwLCBwYXJ0aWFsMS5ieXRlTGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGxpbmU6IHBhcnRpYWwxLAogICAgICAgICAgICAgICAgbW9yZTogIXRoaXMuZW9mCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmIChsaW5lID09PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAobGluZS5ieXRlTGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBsaW5lLAogICAgICAgICAgICAgICAgbW9yZTogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKGxpbmVbbGluZS5ieXRlTGVuZ3RoIC0gMV0gPT0gTEYpIHsKICAgICAgICAgICAgbGV0IGRyb3AgPSAxOwogICAgICAgICAgICBpZiAobGluZS5ieXRlTGVuZ3RoID4gMSAmJiBsaW5lW2xpbmUuYnl0ZUxlbmd0aCAtIDJdID09PSBDUikgewogICAgICAgICAgICAgICAgZHJvcCA9IDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZSA9IGxpbmUuc3ViYXJyYXkoMCwgbGluZS5ieXRlTGVuZ3RoIC0gZHJvcCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbmUsCiAgICAgICAgICAgIG1vcmU6IGZhbHNlCiAgICAgICAgfTsKICAgIH0KICAgIGFzeW5jIHJlYWRTbGljZShkZWxpbSkgewogICAgICAgIGxldCBzID0gMDsKICAgICAgICBsZXQgc2xpY2U7CiAgICAgICAgd2hpbGUodHJ1ZSl7CiAgICAgICAgICAgIGxldCBpID0gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yICsgcywgdGhpcy53KS5pbmRleE9mKGRlbGltKTsKICAgICAgICAgICAgaWYgKGkgPj0gMCkgewogICAgICAgICAgICAgICAgaSArPSBzOwogICAgICAgICAgICAgICAgc2xpY2UgPSB0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMuciArIGkgKyAxKTsKICAgICAgICAgICAgICAgIHRoaXMuciArPSBpICsgMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuciA9PT0gdGhpcy53KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzbGljZSA9IHRoaXMuYnVmLnN1YmFycmF5KHRoaXMuciwgdGhpcy53KTsKICAgICAgICAgICAgICAgIHRoaXMuciA9IHRoaXMudzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZlcmVkKCkgPj0gdGhpcy5idWYuYnl0ZUxlbmd0aCkgewogICAgICAgICAgICAgICAgdGhpcy5yID0gdGhpcy53OwogICAgICAgICAgICAgICAgY29uc3Qgb2xkYnVmID0gdGhpcy5idWY7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdidWYgPSB0aGlzLmJ1Zi5zbGljZSgwKTsKICAgICAgICAgICAgICAgIHRoaXMuYnVmID0gbmV3YnVmOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJ1ZmZlckZ1bGxFcnJvcihvbGRidWYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHMgPSB0aGlzLncgLSB0aGlzLnI7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9maWxsKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgZXJyLnBhcnRpYWwgPSBzbGljZTsKICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2xpY2U7CiAgICB9CiAgICBhc3luYyBwZWVrKG4pIHsKICAgICAgICBpZiAobiA8IDApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoIm5lZ2F0aXZlIGNvdW50Iik7CiAgICAgICAgfQogICAgICAgIGxldCBhdmFpbCA9IHRoaXMudyAtIHRoaXMucjsKICAgICAgICB3aGlsZShhdmFpbCA8IG4gJiYgYXZhaWwgPCB0aGlzLmJ1Zi5ieXRlTGVuZ3RoICYmICF0aGlzLmVvZil7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9maWxsKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgZXJyLnBhcnRpYWwgPSB0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMudyk7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXZhaWwgPSB0aGlzLncgLSB0aGlzLnI7CiAgICAgICAgfQogICAgICAgIGlmIChhdmFpbCA9PT0gMCAmJiB0aGlzLmVvZikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9IGVsc2UgaWYgKGF2YWlsIDwgbiAmJiB0aGlzLmVvZikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yLCB0aGlzLnIgKyBhdmFpbCk7CiAgICAgICAgfSBlbHNlIGlmIChhdmFpbCA8IG4pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEJ1ZmZlckZ1bGxFcnJvcih0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMudykpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yLCB0aGlzLnIgKyBuKTsKICAgIH0KfQpjbGFzcyBBYnN0cmFjdEJ1ZkJhc2UgewogICAgdXNlZEJ1ZmZlckJ5dGVzID0gMDsKICAgIGVyciA9IG51bGw7CiAgICBzaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLmJ1Zi5ieXRlTGVuZ3RoOwogICAgfQogICAgYXZhaWxhYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLmJ1Zi5ieXRlTGVuZ3RoIC0gdGhpcy51c2VkQnVmZmVyQnl0ZXM7CiAgICB9CiAgICBidWZmZXJlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy51c2VkQnVmZmVyQnl0ZXM7CiAgICB9Cn0KY2xhc3MgQnVmV3JpdGVyIGV4dGVuZHMgQWJzdHJhY3RCdWZCYXNlIHsKICAgIHN0YXRpYyBjcmVhdGUod3JpdGVyLCBzaXplID0gNDA5NikgewogICAgICAgIHJldHVybiB3cml0ZXIgaW5zdGFuY2VvZiBCdWZXcml0ZXIgPyB3cml0ZXIgOiBuZXcgQnVmV3JpdGVyKHdyaXRlciwgc2l6ZSk7CiAgICB9CiAgICBjb25zdHJ1Y3Rvcih3cml0ZXIxLCBzaXplMiA9IDQwOTYpewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy53cml0ZXIgPSB3cml0ZXIxOwogICAgICAgIGlmIChzaXplMiA8PSAwKSB7CiAgICAgICAgICAgIHNpemUyID0gREVGQVVMVF9CVUZfU0laRTsKICAgICAgICB9CiAgICAgICAgdGhpcy5idWYgPSBuZXcgVWludDhBcnJheShzaXplMik7CiAgICB9CiAgICByZXNldCh3KSB7CiAgICAgICAgdGhpcy5lcnIgPSBudWxsOwogICAgICAgIHRoaXMudXNlZEJ1ZmZlckJ5dGVzID0gMDsKICAgICAgICB0aGlzLndyaXRlciA9IHc7CiAgICB9CiAgICBhc3luYyBmbHVzaCgpIHsKICAgICAgICBpZiAodGhpcy5lcnIgIT09IG51bGwpIHRocm93IHRoaXMuZXJyOwogICAgICAgIGlmICh0aGlzLnVzZWRCdWZmZXJCeXRlcyA9PT0gMCkgcmV0dXJuOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IERlbm8ud3JpdGVBbGwodGhpcy53cml0ZXIsIHRoaXMuYnVmLnN1YmFycmF5KDAsIHRoaXMudXNlZEJ1ZmZlckJ5dGVzKSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICB0aGlzLmVyciA9IGU7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICAgIHRoaXMuYnVmID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWYubGVuZ3RoKTsKICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyA9IDA7CiAgICB9CiAgICBhc3luYyB3cml0ZShkYXRhKSB7CiAgICAgICAgaWYgKHRoaXMuZXJyICE9PSBudWxsKSB0aHJvdyB0aGlzLmVycjsKICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDApIHJldHVybiAwOwogICAgICAgIGxldCB0b3RhbEJ5dGVzV3JpdHRlbiA9IDA7CiAgICAgICAgbGV0IG51bUJ5dGVzV3JpdHRlbiA9IDA7CiAgICAgICAgd2hpbGUoZGF0YS5ieXRlTGVuZ3RoID4gdGhpcy5hdmFpbGFibGUoKSl7CiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZlcmVkKCkgPT09IDApIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbnVtQnl0ZXNXcml0dGVuID0gYXdhaXQgdGhpcy53cml0ZXIud3JpdGUoZGF0YSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnIgPSBlOwogICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5KGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmZsdXNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG90YWxCeXRlc1dyaXR0ZW4gKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgICAgICBkYXRhID0gZGF0YS5zdWJhcnJheShudW1CeXRlc1dyaXR0ZW4pOwogICAgICAgIH0KICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5KGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgIHRvdGFsQnl0ZXNXcml0dGVuICs9IG51bUJ5dGVzV3JpdHRlbjsKICAgICAgICByZXR1cm4gdG90YWxCeXRlc1dyaXR0ZW47CiAgICB9Cn0KY2xhc3MgQnVmV3JpdGVyU3luYyBleHRlbmRzIEFic3RyYWN0QnVmQmFzZSB7CiAgICBzdGF0aWMgY3JlYXRlKHdyaXRlciwgc2l6ZSA9IDQwOTYpIHsKICAgICAgICByZXR1cm4gd3JpdGVyIGluc3RhbmNlb2YgQnVmV3JpdGVyU3luYyA/IHdyaXRlciA6IG5ldyBCdWZXcml0ZXJTeW5jKHdyaXRlciwgc2l6ZSk7CiAgICB9CiAgICBjb25zdHJ1Y3Rvcih3cml0ZXIyLCBzaXplMyA9IDQwOTYpewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy53cml0ZXIgPSB3cml0ZXIyOwogICAgICAgIGlmIChzaXplMyA8PSAwKSB7CiAgICAgICAgICAgIHNpemUzID0gREVGQVVMVF9CVUZfU0laRTsKICAgICAgICB9CiAgICAgICAgdGhpcy5idWYgPSBuZXcgVWludDhBcnJheShzaXplMyk7CiAgICB9CiAgICByZXNldCh3KSB7CiAgICAgICAgdGhpcy5lcnIgPSBudWxsOwogICAgICAgIHRoaXMudXNlZEJ1ZmZlckJ5dGVzID0gMDsKICAgICAgICB0aGlzLndyaXRlciA9IHc7CiAgICB9CiAgICBmbHVzaCgpIHsKICAgICAgICBpZiAodGhpcy5lcnIgIT09IG51bGwpIHRocm93IHRoaXMuZXJyOwogICAgICAgIGlmICh0aGlzLnVzZWRCdWZmZXJCeXRlcyA9PT0gMCkgcmV0dXJuOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIERlbm8ud3JpdGVBbGxTeW5jKHRoaXMud3JpdGVyLCB0aGlzLmJ1Zi5zdWJhcnJheSgwLCB0aGlzLnVzZWRCdWZmZXJCeXRlcykpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdGhpcy5lcnIgPSBlOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgICAgICB0aGlzLmJ1ZiA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmLmxlbmd0aCk7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgPSAwOwogICAgfQogICAgd3JpdGVTeW5jKGRhdGEpIHsKICAgICAgICBpZiAodGhpcy5lcnIgIT09IG51bGwpIHRocm93IHRoaXMuZXJyOwogICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7CiAgICAgICAgbGV0IHRvdGFsQnl0ZXNXcml0dGVuID0gMDsKICAgICAgICBsZXQgbnVtQnl0ZXNXcml0dGVuID0gMDsKICAgICAgICB3aGlsZShkYXRhLmJ5dGVMZW5ndGggPiB0aGlzLmF2YWlsYWJsZSgpKXsKICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyZWQoKSA9PT0gMCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSB0aGlzLndyaXRlci53cml0ZVN5bmMoZGF0YSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnIgPSBlOwogICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5KGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgICAgICAgICB0aGlzLmZsdXNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG90YWxCeXRlc1dyaXR0ZW4gKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgICAgICBkYXRhID0gZGF0YS5zdWJhcnJheShudW1CeXRlc1dyaXR0ZW4pOwogICAgICAgIH0KICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5KGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgIHRvdGFsQnl0ZXNXcml0dGVuICs9IG51bUJ5dGVzV3JpdHRlbjsKICAgICAgICByZXR1cm4gdG90YWxCeXRlc1dyaXR0ZW47CiAgICB9Cn0KY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpOwpjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7CmNsYXNzIENsaWVudFV0aWwgewogICAgc3RhdGljIGdldERlZmF1bHRQb3J0KHRyYW5zcG9ydGVyVHlwZSkgewogICAgICAgIHN3aXRjaCh0cmFuc3BvcnRlclR5cGUpewogICAgICAgICAgICBjYXNlICJUQ1AiOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUcmFuc3BvcnRlciBUQ1AgcmVxdWlyZXMgcG9ydCB0byBiZSBhc3NpZ25lZCIpOwogICAgICAgICAgICBjYXNlICJSRURJUyI6CiAgICAgICAgICAgICAgICByZXR1cm4gNjM3OTsKICAgICAgICAgICAgY2FzZSAiQU1RUCI6CiAgICAgICAgICAgICAgICByZXR1cm4gNTY3MjsKICAgICAgICAgICAgY2FzZSAiTkFUUyI6CiAgICAgICAgICAgICAgICByZXR1cm4gNDIyMjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRGVmYXVsdCBwb3J0IGNhbm5vdCBiZSByZWFkIGJlY2F1c2UgdHJhbnNwb3J0ZXIgaXMgbm90IHBhcnQgb2YgdGhlIGJ1aWx0LWluIGNsaWVudHMiKTsKICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgcmVzaXplVHlwZWRBcnJheShiYXNlQXJyYXlCdWZmZXIsIG5ld0J5dGVTaXplKSB7CiAgICAgICAgdmFyIHJlc2l6ZWRBcnJheUJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihuZXdCeXRlU2l6ZSksIGxlbiA9IGJhc2VBcnJheUJ1ZmZlci5ieXRlTGVuZ3RoLCByZXNpemVMZW4gPSBsZW4gPiBuZXdCeXRlU2l6ZSA/IG5ld0J5dGVTaXplIDogbGVuOwogICAgICAgIG5ldyBVaW50OEFycmF5KHJlc2l6ZWRBcnJheUJ1ZmZlciwgMCwgcmVzaXplTGVuKS5zZXQobmV3IFVpbnQ4QXJyYXkoYmFzZUFycmF5QnVmZmVyLCAwLCByZXNpemVMZW4pKTsKICAgICAgICByZXR1cm4gcmVzaXplZEFycmF5QnVmZmVyOwogICAgfQp9CmZ1bmN0aW9uIGNoYXJDb2RlKHR5cGUpIHsKICAgIHJldHVybiB0eXBlLmNoYXJDb2RlQXQoMCk7Cn0KZnVuY3Rpb24gZnJvbUNoYXJDb2RlKGNvZGUpIHsKICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoWwogICAgICAgIGNvZGUKICAgIF0pKTsKfQp2YXIgVGFibGVGaWVsZFR5cGU7CihmdW5jdGlvbihUYWJsZUZpZWxkVHlwZTEpIHsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkJvb2xlYW4iXSA9IGNoYXJDb2RlKCJ0IildID0gIkJvb2xlYW4iOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiU2hvcnRTaG9ydEludCJdID0gY2hhckNvZGUoImIiKV0gPSAiU2hvcnRTaG9ydEludCI7CiAgICBUYWJsZUZpZWxkVHlwZTFbVGFibGVGaWVsZFR5cGUxWyJTaG9ydFNob3J0VUludCJdID0gY2hhckNvZGUoIkIiKV0gPSAiU2hvcnRTaG9ydFVJbnQiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiU2hvcnRJbnQiXSA9IGNoYXJDb2RlKCJzIildID0gIlNob3J0SW50IjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIlNob3J0VUludCJdID0gY2hhckNvZGUoInUiKV0gPSAiU2hvcnRVSW50IjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkxvbmdJbnQiXSA9IGNoYXJDb2RlKCJJIildID0gIkxvbmdJbnQiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiTG9uZ1VJbnQiXSA9IGNoYXJDb2RlKCJpIildID0gIkxvbmdVSW50IjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkxvbmdMb25nSW50Il0gPSBjaGFyQ29kZSgibCIpXSA9ICJMb25nTG9uZ0ludCI7CiAgICBUYWJsZUZpZWxkVHlwZTFbVGFibGVGaWVsZFR5cGUxWyJGbG9hdCJdID0gY2hhckNvZGUoImYiKV0gPSAiRmxvYXQiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiRG91YmxlIl0gPSBjaGFyQ29kZSgiZCIpXSA9ICJEb3VibGUiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiRGVjaW1hbCJdID0gY2hhckNvZGUoIkQiKV0gPSAiRGVjaW1hbCI7CiAgICBUYWJsZUZpZWxkVHlwZTFbVGFibGVGaWVsZFR5cGUxWyJMb25nU3RyIl0gPSBjaGFyQ29kZSgiUyIpXSA9ICJMb25nU3RyIjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkZpZWxkQXJyYXkiXSA9IGNoYXJDb2RlKCJBIildID0gIkZpZWxkQXJyYXkiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiVGltZXN0YW1wIl0gPSBjaGFyQ29kZSgiVCIpXSA9ICJUaW1lc3RhbXAiOwogICAgVGFibGVGaWVsZFR5cGUxW1RhYmxlRmllbGRUeXBlMVsiRmllbGRUYWJsZSJdID0gY2hhckNvZGUoIkYiKV0gPSAiRmllbGRUYWJsZSI7CiAgICBUYWJsZUZpZWxkVHlwZTFbVGFibGVGaWVsZFR5cGUxWyJOb1ZhbHVlIl0gPSBjaGFyQ29kZSgiViIpXSA9ICJOb1ZhbHVlIjsKICAgIFRhYmxlRmllbGRUeXBlMVtUYWJsZUZpZWxkVHlwZTFbIkJ5dGVBcnJheSJdID0gY2hhckNvZGUoIngiKV0gPSAiQnl0ZUFycmF5IjsKfSkoVGFibGVGaWVsZFR5cGUgfHwgKFRhYmxlRmllbGRUeXBlID0gewp9KSk7CmZ1bmN0aW9uIHBhZEFycmF5KGFycmF5LCBzaXplNCwgdmFsdWUpIHsKICAgIGNvbnN0IHBhZGRpbmcgPSBBcnJheS5mcm9tKHsKICAgICAgICBsZW5ndGg6IHNpemU0IC0gYXJyYXkubGVuZ3RoCiAgICB9KS5maWxsKHZhbHVlKTsKICAgIHJldHVybiBhcnJheS5jb25jYXQoLi4ucGFkZGluZyk7Cn0KZnVuY3Rpb24gY2hhckNvZGUxKHR5cGUpIHsKICAgIHJldHVybiB0eXBlLmNoYXJDb2RlQXQoMCk7Cn0KZnVuY3Rpb24gYXNzZXJ0VW5yZWFjaGFibGUoX3gpIHsKICAgIHRocm93IG5ldyBFcnJvcihgVW5yZWFjaGFibGUgY29kZSBleGVjdXRlZGApOwp9CmNsYXNzIEFtcXBEZWNvZGVyIHsKICAgICNkYXRhOwogICAgI29mZnNldD0wOwogICAgI3ZpZXc7CiAgICAjdGV4dERlY29kZXI7CiAgICAjYml0RmllbGQ9bnVsbDsKICAgICNiaXRQb2ludGVyPTc7CiAgICBjb25zdHJ1Y3RvcihkYXRhMSl7CiAgICAgICAgdGhpcy4jZGF0YSA9IGRhdGExOwogICAgICAgIHRoaXMuI3ZpZXcgPSBuZXcgRGF0YVZpZXcoZGF0YTEuYnVmZmVyKTsKICAgICAgICB0aGlzLiN0ZXh0RGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOwogICAgfQogICAgI2ZvcndhcmQ9KG4pPT57CiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuI29mZnNldDsKICAgICAgICB0aGlzLiNvZmZzZXQgKz0gbjsKICAgICAgICBpZiAodGhpcy4jb2Zmc2V0ID4gdGhpcy4jZGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgZW5vdWdoIGRhdGEgaW4gZGVjb2RlciIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY3VycmVudDsKICAgIH07CiAgICAjdWludDg9KCk9PnRoaXMuI3ZpZXcuZ2V0VWludDgodGhpcy4jZm9yd2FyZCgxKSkKICAgIDsKICAgICN1aW50MTY9KCk9PnRoaXMuI3ZpZXcuZ2V0VWludDE2KHRoaXMuI2ZvcndhcmQoMikpCiAgICA7CiAgICAjdWludDMyPSgpPT50aGlzLiN2aWV3LmdldFVpbnQzMih0aGlzLiNmb3J3YXJkKDQpKQogICAgOwogICAgI3VpbnQ2ND0oKT0+ewogICAgICAgIGNvbnN0IHJlc3VsdCA9IE51bWJlcih0aGlzLiN2aWV3LmdldEJpZ1VpbnQ2NCh0aGlzLiNmb3J3YXJkKDgpKSk7CiAgICAgICAgaWYgKCFOdW1iZXIuaXNTYWZlSW50ZWdlcihyZXN1bHQpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVHJpZWQgdG8gZGVjb2RlIHVuc2FmZSBpbnRlZ2VyYCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogICAgI2ludDg9KCk9PnRoaXMuI3ZpZXcuZ2V0SW50OCh0aGlzLiNmb3J3YXJkKDEpKQogICAgOwogICAgI2ludDE2PSgpPT50aGlzLiN2aWV3LmdldEludDE2KHRoaXMuI2ZvcndhcmQoMikpCiAgICA7CiAgICAjaW50MzI9KCk9PnRoaXMuI3ZpZXcuZ2V0SW50MzIodGhpcy4jZm9yd2FyZCg0KSkKICAgIDsKICAgICNpbnQ2ND0oKT0+ewogICAgICAgIGNvbnN0IG51bSA9IE51bWJlcih0aGlzLiN2aWV3LmdldEJpZ0ludDY0KHRoaXMuI2ZvcndhcmQoOCkpKTsKICAgICAgICBpZiAoIU51bWJlci5pc1NhZmVJbnRlZ2VyKG51bSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZWNlaXZlZCB1bnNhZmUgaW50ZWdlcmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVtOwogICAgfTsKICAgICNmbG9hdDMyPSgpPT57CiAgICAgICAgcmV0dXJuIHRoaXMuI3ZpZXcuZ2V0RmxvYXQzMih0aGlzLiNmb3J3YXJkKDQpKTsKICAgIH07CiAgICAjZmxvYXQ2ND0oKT0+ewogICAgICAgIHJldHVybiB0aGlzLiN2aWV3LmdldEZsb2F0NjQodGhpcy4jZm9yd2FyZCg4KSk7CiAgICB9OwogICAgI2J5dGVzPShsZW5ndGgpPT57CiAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLiNmb3J3YXJkKGxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHRoaXMuI2RhdGEuc2xpY2Uoc3RhcnQsIHRoaXMuI29mZnNldCk7CiAgICB9OwogICAgI3RleHQ9KGxlbmd0aCk9PnsKICAgICAgICByZXR1cm4gdGhpcy4jdGV4dERlY29kZXIuZGVjb2RlKHRoaXMuI2J5dGVzKGxlbmd0aCkpOwogICAgfTsKICAgICNzaG9ydHN0cj0oKT0+ewogICAgICAgIGNvbnN0IHNpemU0ID0gdGhpcy4jdWludDgoKTsKICAgICAgICByZXR1cm4gdGhpcy4jdGV4dChzaXplNCk7CiAgICB9OwogICAgI2xvbmdzdHI9KCk9PnsKICAgICAgICBjb25zdCBzaXplNCA9IHRoaXMuI3VpbnQzMigpOwogICAgICAgIHJldHVybiB0aGlzLiN0ZXh0KHNpemU0KTsKICAgIH07CiAgICAjYml0PSgpPT57CiAgICAgICAgaWYgKHRoaXMuI2JpdEZpZWxkID09PSBudWxsIHx8IHRoaXMuI2JpdFBvaW50ZXIgPCAwKSB7CiAgICAgICAgICAgIHRoaXMuI2JpdEZpZWxkID0gdGhpcy4jdWludDgoKTsKICAgICAgICAgICAgdGhpcy4jYml0UG9pbnRlciA9IDc7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHZhbHVlID0gISEodGhpcy4jYml0RmllbGQgJiAxIDw8IHRoaXMuI2JpdFBvaW50ZXItLSk7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICAgICN0YWJsZT0oKT0+ewogICAgICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuI3VpbnQzMigpOwogICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuI29mZnNldCArIGxlbmd0aDsKICAgICAgICBjb25zdCByZXN1bHQgPSB7CiAgICAgICAgfTsKICAgICAgICB3aGlsZSh0aGlzLiNvZmZzZXQgPCB0YXJnZXQpewogICAgICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSB0aGlzLiNzaG9ydHN0cigpOwogICAgICAgICAgICBjb25zdCBmaWVsZFZhbHVlID0gdGhpcy4jdGFibGVGaWVsZCgpOwogICAgICAgICAgICByZXN1bHRbZmllbGROYW1lXSA9IGZpZWxkVmFsdWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogICAgI3RhYmxlRmllbGQ9KCk9PnsKICAgICAgICBjb25zdCB0eXBlID0gdGhpcy4jdWludDgoKTsKICAgICAgICBzd2l0Y2godHlwZSl7CiAgICAgICAgICAgIGNhc2UgVGFibGVGaWVsZFR5cGUuQm9vbGVhbjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN1aW50OCgpID4gMDsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5TaG9ydFNob3J0VUludDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN1aW50OCgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLlNob3J0U2hvcnRJbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jaW50OCgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLlNob3J0VUludDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN1aW50MTYoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5TaG9ydEludDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNpbnQxNigpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLkxvbmdVSW50OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3VpbnQzMigpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLkxvbmdJbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jaW50MzIoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5Mb25nTG9uZ0ludDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNpbnQ2NCgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLkZsb2F0OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2Zsb2F0MzIoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5Eb3VibGU6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jZmxvYXQ2NCgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLkRlY2ltYWw6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbnQgZGVjb2RlIGRlY2ltYWwiKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5Mb25nU3RyOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2xvbmdzdHIoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5GaWVsZEFycmF5OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3RhYmxlQXJyYXkoKTsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5UaW1lc3RhbXA6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDY0KCk7CiAgICAgICAgICAgIGNhc2UgVGFibGVGaWVsZFR5cGUuRmllbGRUYWJsZToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN0YWJsZSgpOwogICAgICAgICAgICBjYXNlIFRhYmxlRmllbGRUeXBlLk5vVmFsdWU6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgY2FzZSBUYWJsZUZpZWxkVHlwZS5CeXRlQXJyYXk6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdGFibGVCeXRlcygpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHRhYmxlIGZpZWxkIHR5cGUgJHtmcm9tQ2hhckNvZGUodHlwZSl9YCk7CiAgICAgICAgfQogICAgfTsKICAgICN0YWJsZUFycmF5PSgpPT57CiAgICAgICAgY29uc3QgbGVuZ3RoID0gdGhpcy4jdWludDMyKCk7CiAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy4jb2Zmc2V0ICsgbGVuZ3RoOwogICAgICAgIGNvbnN0IGFycmF5ID0gW107CiAgICAgICAgd2hpbGUodGhpcy4jb2Zmc2V0IDwgdGFyZ2V0KXsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLiN0YWJsZUZpZWxkKCk7CiAgICAgICAgICAgIGFycmF5LnB1c2godmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyYXk7CiAgICB9OwogICAgI3RhYmxlQnl0ZXM9KCk9PnsKICAgICAgICBjb25zdCBsZW5ndGggPSB0aGlzLiN1aW50MzIoKTsKICAgICAgICByZXR1cm4gdGhpcy4jYnl0ZXMobGVuZ3RoKTsKICAgIH07CiAgICAjZmxhZ3M9KCk9PnsKICAgICAgICBjb25zdCBmbGFncyA9IFtdOwogICAgICAgIGxldCBiaXRzID0gW107CiAgICAgICAgd2hpbGUoIWZsYWdzLmxlbmd0aCB8fCBiaXRzW2JpdHMubGVuZ3RoIC0gMV0pewogICAgICAgICAgICBjb25zdCBmaWVsZCA9IHRoaXMuI3VpbnQxNigpOwogICAgICAgICAgICBiaXRzID0gW107CiAgICAgICAgICAgIGZvcihsZXQgaSA9IDE1OyBpID49IDA7IC0taSl7CiAgICAgICAgICAgICAgICBiaXRzLnB1c2goISEoZmllbGQgJiAxIDw8IGkpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbGFncy5wdXNoKC4uLmJpdHMuc2xpY2UoMCwgMTUpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZsYWdzOwogICAgfTsKICAgIHJlYWQodHlwZSkgewogICAgICAgIHN3aXRjaCh0eXBlKXsKICAgICAgICAgICAgY2FzZSAidWludDgiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3VpbnQ4KCk7CiAgICAgICAgICAgIGNhc2UgInVpbnQxNiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDE2KCk7CiAgICAgICAgICAgIGNhc2UgInVpbnQzMiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDMyKCk7CiAgICAgICAgICAgIGNhc2UgInVpbnQ2NCI6CiAgICAgICAgICAgIGNhc2UgInRpbWVzdGFtcCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDY0KCk7CiAgICAgICAgICAgIGNhc2UgImludDgiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ludDgoKTsKICAgICAgICAgICAgY2FzZSAiaW50MTYiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ludDE2KCk7CiAgICAgICAgICAgIGNhc2UgImludDMyIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNpbnQzMigpOwogICAgICAgICAgICBjYXNlICJpbnQ2NCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jaW50NjQoKTsKICAgICAgICAgICAgY2FzZSAiZmxvYXQzMiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jZmxvYXQzMigpOwogICAgICAgICAgICBjYXNlICJmbG9hdDY0IjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNmbG9hdDY0KCk7CiAgICAgICAgICAgIGNhc2UgImJpdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jYml0KCk7CiAgICAgICAgICAgIGNhc2UgImZsYWdzIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNmbGFncygpOwogICAgICAgICAgICBjYXNlICJ0YWJsZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdGFibGUoKTsKICAgICAgICAgICAgY2FzZSAic2hvcnRzdHIiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3Nob3J0c3RyKCk7CiAgICAgICAgICAgIGNhc2UgImxvbmdzdHIiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2xvbmdzdHIoKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGFzc2VydFVucmVhY2hhYmxlKHR5cGUpOwogICAgICAgIH0KICAgIH0KfQpjb25zdCBDSEFSQ09ERV9BID0gY2hhckNvZGUxKCJBIik7CmNvbnN0IENIQVJDT0RFX1ogPSBjaGFyQ29kZTEoIloiKTsKY29uc3QgQ0hBUkNPREVfYSA9IGNoYXJDb2RlMSgiYSIpOwpjb25zdCBDSEFSQ09ERV96ID0gY2hhckNvZGUxKCJ6Iik7CmNvbnN0IENIQVJDT0RFX3VuZGVyc2NvcmUgPSBjaGFyQ29kZTEoIl8iKTsKY29uc3QgQ0hBUkNPREVfZG9sbGFyID0gY2hhckNvZGUxKCIkIik7CmNvbnN0IENIQVJDT0RFX2hhc2ggPSBjaGFyQ29kZTEoIiMiKTsKY29uc3QgdmFsaWRDaGFycyA9IFsKICAgIENIQVJDT0RFX2RvbGxhciwKICAgIENIQVJDT0RFX2hhc2gsCiAgICBDSEFSQ09ERV91bmRlcnNjb3JlCl07CmZ1bmN0aW9uIGlzQWxwaGEoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPj0gQ0hBUkNPREVfQSAmJiBjb2RlIDw9IENIQVJDT0RFX1ogfHwgY29kZSA+PSBDSEFSQ09ERV9hICYmIGNvZGUgPD0gQ0hBUkNPREVfejsKfQpmdW5jdGlvbiBpc051bWVyaWMoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPj0gNDcgJiYgY29kZSA8PSA1ODsKfQpmdW5jdGlvbiBpc0FsbG93ZWRDaGFyYXRhY3Rlcihjb2RlKSB7CiAgICByZXR1cm4gaXNBbHBoYShjb2RlKSB8fCBpc051bWVyaWMoY29kZSkgfHwgdmFsaWRDaGFycy5pbmNsdWRlcyhjb2RlKTsKfQpmdW5jdGlvbiBhc3NlcnRWYWxpZEZpZWxkTmFtZShuYW1lKSB7CiAgICBpZiAoIWlzQWxwaGEobmFtZS5jaGFyQ29kZUF0KDApKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBmaWVsZCBuYW1lICcke25hbWV9J2ApOwogICAgfQogICAgZm9yKGxldCBpID0gMTsgaSA8IG5hbWUubGVuZ3RoOyBpKyspewogICAgICAgIGlmICghaXNBbGxvd2VkQ2hhcmF0YWN0ZXIobmFtZS5jaGFyQ29kZUF0KGkpKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZmllbGQgbmFtZSAnJHtuYW1lfSdgKTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gc3BsaXRBcnJheShhcnIsIHNpemU0KSB7CiAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgIGxldCBpbmRleCA9IDA7CiAgICB3aGlsZShpbmRleCA8IGFyci5sZW5ndGgpewogICAgICAgIGNodW5rcy5wdXNoKGFyci5zbGljZShpbmRleCwgc2l6ZTQgKyBpbmRleCkpOwogICAgICAgIGluZGV4ICs9IHNpemU0OwogICAgfQogICAgcmV0dXJuIGNodW5rczsKfQpmdW5jdGlvbiB3cml0ZUJpdEZpZWxkKGJpdHMpIHsKICAgIGlmIChiaXRzLmxlbmd0aCA+IDgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvbyBtYW55IGJpdHMgdG8gZml0IGluIG9uZSBieXRlYCk7CiAgICB9CiAgICBjb25zdCBmaWVsZCA9IChiaXRzWzddID8gMTI4IDogMCkgfCAoYml0c1s2XSA/IDY0IDogMCkgfCAoYml0c1s1XSA/IDMyIDogMCkgfCAoYml0c1s0XSA/IDE2IDogMCkgfCAoYml0c1szXSA/IDggOiAwKSB8IChiaXRzWzJdID8gNCA6IDApIHwgKGJpdHNbMV0gPyAyIDogMCkgfCAoYml0c1swXSA/IDEgOiAwKTsKICAgIHJldHVybiBmaWVsZDsKfQpmdW5jdGlvbiBvdXRPZlJhbmdlKHR5cGUsIHZhbHVlKSB7CiAgICByZXR1cm4gYHZhbHVlICcke3ZhbHVlfScgaXMgb3V0IG9mIHJhbmdlIGZvciB0eXBlICcke3R5cGV9J2A7Cn0KY2xhc3MgQW1xcEVuY29kZXIgewogICAgI2J1ZjsKICAgICN2aWV3OwogICAgI29mZnNldD0wOwogICAgI2luY3JlbWVudDsKICAgICN0ZXh0RW5jb2Rlcj1uZXcgVGV4dEVuY29kZXIoKTsKICAgICNwZW5kaW5nQml0cz1bXTsKICAgIGNvbnN0cnVjdG9yKHNpemU0ID0gNDA5Nil7CiAgICAgICAgdGhpcy4jaW5jcmVtZW50ID0gc2l6ZTQ7CiAgICAgICAgdGhpcy4jYnVmID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZTQpOwogICAgICAgIHRoaXMuI3ZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy4jYnVmLmJ1ZmZlcik7CiAgICB9CiAgICAjZm9yd2FyZD0oc2l6ZTUpPT57CiAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLiNvZmZzZXQ7CiAgICAgICAgdGhpcy4jb2Zmc2V0ID0gdGhpcy4jb2Zmc2V0ICsgc2l6ZTU7CiAgICAgICAgaWYgKHRoaXMuI2J1Zi5sZW5ndGggPCB0aGlzLiNvZmZzZXQpIHsKICAgICAgICAgICAgY29uc3QgYnVmID0gbmV3IFVpbnQ4QXJyYXkodGhpcy4jYnVmLmxlbmd0aCArIHRoaXMuI2luY3JlbWVudCk7CiAgICAgICAgICAgIGJ1Zi5zZXQodGhpcy4jYnVmLCAwKTsKICAgICAgICAgICAgdGhpcy4jYnVmID0gYnVmOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RhcnQ7CiAgICB9OwogICAgI2ZsdXNoQml0cz0oKT0+ewogICAgICAgIGlmICh0aGlzLiNwZW5kaW5nQml0cy5sZW5ndGgpIHsKICAgICAgICAgICAgdGhpcy4jYml0cyh0aGlzLiNwZW5kaW5nQml0cyk7CiAgICAgICAgICAgIHRoaXMuI3BlbmRpbmdCaXRzLnNwbGljZSgwLCB0aGlzLiNwZW5kaW5nQml0cy5sZW5ndGgpOwogICAgICAgIH0KICAgIH07CiAgICAjdWludDg9KHZhbHVlKT0+ewogICAgICAgIGlmICh2YWx1ZSA8IDAgfHwgdmFsdWUgPiAyNTUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG91dE9mUmFuZ2UoInVpbnQ4IiwgdmFsdWUpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4jdmlldy5zZXRVaW50OCh0aGlzLiNmb3J3YXJkKDEpLCB2YWx1ZSk7CiAgICB9OwogICAgI3VpbnQxNj0odmFsdWUpPT57CiAgICAgICAgaWYgKHZhbHVlIDwgMCB8fCB2YWx1ZSA+IDY1NTM1KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvdXRPZlJhbmdlKCJ1aW50MTYiLCB2YWx1ZSkpOwogICAgICAgIH0KICAgICAgICB0aGlzLiN2aWV3LnNldFVpbnQxNih0aGlzLiNmb3J3YXJkKDIpLCB2YWx1ZSk7CiAgICB9OwogICAgI3VpbnQzMj0odmFsdWUpPT57CiAgICAgICAgaWYgKHZhbHVlIDwgMCB8fCB2YWx1ZSA+IDQyOTQ5NjcyOTUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG91dE9mUmFuZ2UoInVpbnQzMiIsIHZhbHVlKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuI3ZpZXcuc2V0VWludDMyKHRoaXMuI2ZvcndhcmQoNCksIHZhbHVlKTsKICAgIH07CiAgICAjdWludDY0PSh2YWx1ZSk9PnsKICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG91dE9mUmFuZ2UoInVpbnQzMiIsIHZhbHVlKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuI3ZpZXcuc2V0QmlnVWludDY0KHRoaXMuI2ZvcndhcmQoOCksIEJpZ0ludCh2YWx1ZSkpOwogICAgfTsKICAgICNpbnQ4PSh2YWx1ZSk9PnsKICAgICAgICB0aGlzLiN2aWV3LnNldEludDgodGhpcy4jZm9yd2FyZCgxKSwgdmFsdWUpOwogICAgfTsKICAgICNpbnQxNj0odmFsdWUpPT57CiAgICAgICAgdGhpcy4jdmlldy5zZXRJbnQxNih0aGlzLiNmb3J3YXJkKDIpLCB2YWx1ZSk7CiAgICB9OwogICAgI2ludDMyPSh2YWx1ZSk9PnsKICAgICAgICB0aGlzLiN2aWV3LnNldEludDMyKHRoaXMuI2ZvcndhcmQoNCksIHZhbHVlKTsKICAgIH07CiAgICAjaW50NjQ9KHZhbHVlKT0+ewogICAgICAgIHRoaXMuI3ZpZXcuc2V0QmlnSW50NjQodGhpcy4jZm9yd2FyZCg4KSwgQmlnSW50KHZhbHVlKSk7CiAgICB9OwogICAgI2Zsb2F0MzI9KHZhbHVlKT0+ewogICAgICAgIHRoaXMuI3ZpZXcuc2V0RmxvYXQzMih0aGlzLiNmb3J3YXJkKDQpLCB2YWx1ZSk7CiAgICB9OwogICAgI2Zsb2F0NjQ9KHZhbHVlKT0+ewogICAgICAgIHRoaXMuI3ZpZXcuc2V0RmxvYXQ2NCh0aGlzLiNmb3J3YXJkKDgpLCB2YWx1ZSk7CiAgICB9OwogICAgI2J5dGVzPShkYXRhMSk9PnsKICAgICAgICB0aGlzLiNidWYuc2V0KGRhdGExLCB0aGlzLiNmb3J3YXJkKGRhdGExLmxlbmd0aCkpOwogICAgfTsKICAgICNzaG9ydFN0cmluZz0odHh0KT0+ewogICAgICAgIGNvbnN0IGRhdGExID0gdGhpcy4jdGV4dEVuY29kZXIuZW5jb2RlKHR4dCk7CiAgICAgICAgaWYgKGRhdGExLmxlbmd0aCA+IDI1NSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFN0cmluZyB0b28gbG9uZyBmb3Igc2hvcnRzdHJpbmdgKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4jdWludDgoZGF0YTEubGVuZ3RoKTsKICAgICAgICB0aGlzLiNieXRlcyhkYXRhMSk7CiAgICB9OwogICAgI2xvbmdTdHJpbmc9KHR4dCk9PnsKICAgICAgICBjb25zdCBkYXRhMSA9IHRoaXMuI3RleHRFbmNvZGVyLmVuY29kZSh0eHQpOwogICAgICAgIHRoaXMuI3VpbnQzMihkYXRhMS5sZW5ndGgpOwogICAgICAgIHRoaXMuI2J5dGVzKGRhdGExKTsKICAgIH07CiAgICAjYml0cz0odmFsdWVzKT0+ewogICAgICAgIGNvbnN0IGJ5dGVzID0gc3BsaXRBcnJheSh2YWx1ZXMsIDgpLm1hcCgocyk9PnBhZEFycmF5KHMsIDgsIGZhbHNlKQogICAgICAgICkuZmxhdE1hcCh3cml0ZUJpdEZpZWxkKTsKICAgICAgICB0aGlzLiNieXRlcyhieXRlcyk7CiAgICB9OwogICAgI2JpdD0odmFsdWUpPT57CiAgICAgICAgdGhpcy4jcGVuZGluZ0JpdHMucHVzaCh2YWx1ZSk7CiAgICB9OwogICAgI3RhYmxlPSh0YWJsZSk9PnsKICAgICAgICBjb25zdCBzdGFydCA9IHRoaXMuI2ZvcndhcmQoNCk7CiAgICAgICAgZm9yIChjb25zdCBmaWVsZE5hbWUgb2YgT2JqZWN0LmtleXModGFibGUpKXsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0YWJsZVtmaWVsZE5hbWVdOwogICAgICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgYXNzZXJ0VmFsaWRGaWVsZE5hbWUoZmllbGROYW1lKTsKICAgICAgICAgICAgICAgIHRoaXMud3JpdGUoInNob3J0c3RyIiwgZmllbGROYW1lKTsKICAgICAgICAgICAgICAgIHRoaXMuI3R5cGVkRmllbGQodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuI3ZpZXcuc2V0VWludDMyKHN0YXJ0LCB0aGlzLiNvZmZzZXQgLSBzdGFydCAtIDQpOwogICAgfTsKICAgICN0eXBlZEZpZWxkPSh2YWx1ZSk9PnsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7CiAgICAgICAgICAgIHRoaXMuI3VpbnQ4KFRhYmxlRmllbGRUeXBlLkJ5dGVBcnJheSk7CiAgICAgICAgICAgIHRoaXMuI3VpbnQzMih2YWx1ZS5sZW5ndGgpOwogICAgICAgICAgICB0aGlzLiNieXRlcyh2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMuI3VpbnQ4KFRhYmxlRmllbGRUeXBlLk5vVmFsdWUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKHZhbHVlKSAhPT0gdmFsdWUgfHwgIU51bWJlci5pc1NhZmVJbnRlZ2VyKHZhbHVlKSkgewogICAgICAgICAgICAgICAgdGhpcy4jdWludDgoVGFibGVGaWVsZFR5cGUuRG91YmxlKTsKICAgICAgICAgICAgICAgIHRoaXMuI2Zsb2F0NjQodmFsdWUpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSAtMTI4ICYmIHZhbHVlIDwgMTI4KSB7CiAgICAgICAgICAgICAgICB0aGlzLiN1aW50OChUYWJsZUZpZWxkVHlwZS5TaG9ydFNob3J0SW50KTsKICAgICAgICAgICAgICAgIHRoaXMuI2ludDgodmFsdWUpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSAtMzI3NjggJiYgdmFsdWUgPCAzMjc2OCkgewogICAgICAgICAgICAgICAgdGhpcy4jdWludDgoVGFibGVGaWVsZFR5cGUuU2hvcnRJbnQpOwogICAgICAgICAgICAgICAgdGhpcy4jaW50MTYodmFsdWUpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSAtMjE0NzQ4MzY0OCAmJiB2YWx1ZSA8IDIxNDc0ODM2NDgpIHsKICAgICAgICAgICAgICAgIHRoaXMuI3VpbnQ4KFRhYmxlRmllbGRUeXBlLkxvbmdJbnQpOwogICAgICAgICAgICAgICAgdGhpcy4jaW50MzIodmFsdWUpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuI3VpbnQ4KFRhYmxlRmllbGRUeXBlLkxvbmdJbnQpOwogICAgICAgICAgICB0aGlzLiNpbnQ2NCh2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgdGhpcy4jdWludDgoVGFibGVGaWVsZFR5cGUuTG9uZ1N0cik7CiAgICAgICAgICAgIHRoaXMuI2xvbmdTdHJpbmcodmFsdWUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgICAgICB0aGlzLiN1aW50OChUYWJsZUZpZWxkVHlwZS5GaWVsZEFycmF5KTsKICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuI2ZvcndhcmQoNCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgdiBvZiB2YWx1ZSl7CiAgICAgICAgICAgICAgICB0aGlzLiN0eXBlZEZpZWxkKHYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuI3ZpZXcuc2V0VWludDMyKHMsIHRoaXMuI29mZnNldCAtIHMgLSA0KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAib2JqZWN0IikgewogICAgICAgICAgICB0aGlzLiN1aW50OChUYWJsZUZpZWxkVHlwZS5GaWVsZFRhYmxlKTsKICAgICAgICAgICAgdGhpcy4jdGFibGUodmFsdWUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJib29sZWFuIikgewogICAgICAgICAgICB0aGlzLiN1aW50OChUYWJsZUZpZWxkVHlwZS5Cb29sZWFuKTsKICAgICAgICAgICAgdGhpcy4jdWludDgoMSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBEb24ndCBrbm93IGhvdyB0byBlbmNvZGUgZmllbGQgb2YgdHlwZSAke3R5cGVvZiB2YWx1ZX0geWV0YCk7CiAgICB9OwogICAgI2ZsYWdzPShmbGFncyk9PnsKICAgICAgICBjb25zdCBjaHVua3MgPSBzcGxpdEFycmF5KGZsYWdzLCAxNSk7CiAgICAgICAgY2h1bmtzLmZvckVhY2goKGNodW5rLCBpbmRleCk9PnsKICAgICAgICAgICAgY29uc3QgYml0cyA9IFsKICAgICAgICAgICAgICAgIC4uLmNodW5rLAogICAgICAgICAgICAgICAgaW5kZXggPCBjaHVua3MubGVuZ3RoIC0gMQogICAgICAgICAgICBdOwogICAgICAgICAgICBjb25zdCBmaWVsZCA9IChiaXRzWzBdID8gMzI3NjggOiAwKSB8IChiaXRzWzFdID8gMTYzODQgOiAwKSB8IChiaXRzWzJdID8gODE5MiA6IDApIHwgKGJpdHNbM10gPyA0MDk2IDogMCkgfCAoYml0c1s0XSA/IDIwNDggOiAwKSB8IChiaXRzWzVdID8gMTAyNCA6IDApIHwgKGJpdHNbNl0gPyA1MTIgOiAwKSB8IChiaXRzWzddID8gMjU2IDogMCkgfCAoYml0c1s4XSA/IDEyOCA6IDApIHwgKGJpdHNbOV0gPyA2NCA6IDApIHwgKGJpdHNbMTBdID8gMzIgOiAwKSB8IChiaXRzWzExXSA/IDE2IDogMCkgfCAoYml0c1sxMl0gPyA4IDogMCkgfCAoYml0c1sxM10gPyA0IDogMCkgfCAoYml0c1sxNF0gPyAyIDogMCkgfCAoYml0c1sxNV0gPyAxIDogMCk7CiAgICAgICAgICAgIHRoaXMuI3VpbnQxNihmaWVsZCk7CiAgICAgICAgfSk7CiAgICB9OwogICAgd3JpdGUodHlwZSwgdmFsdWUpIHsKICAgICAgICBjb25zdCBmaWVsZCA9IHsKICAgICAgICAgICAgdHlwZSwKICAgICAgICAgICAgdmFsdWUKICAgICAgICB9OwogICAgICAgIGlmIChmaWVsZC50eXBlICE9PSAiYml0IikgewogICAgICAgICAgICB0aGlzLiNmbHVzaEJpdHMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBzd2l0Y2goZmllbGQudHlwZSl7CiAgICAgICAgICAgIGNhc2UgInVpbnQ4IjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN1aW50OChmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgInVpbnQxNiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jdWludDE2KGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAidWludDMyIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiN1aW50MzIoZmllbGQudmFsdWUpOwogICAgICAgICAgICBjYXNlICJ1aW50NjQiOgogICAgICAgICAgICBjYXNlICJ0aW1lc3RhbXAiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3VpbnQ2NChmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgImludDgiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ludDgoZmllbGQudmFsdWUpOwogICAgICAgICAgICBjYXNlICJpbnQxNiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jaW50MTYoZmllbGQudmFsdWUpOwogICAgICAgICAgICBjYXNlICJpbnQzMiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jaW50MzIoZmllbGQudmFsdWUpOwogICAgICAgICAgICBjYXNlICJpbnQ2NCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jaW50NjQoZmllbGQudmFsdWUpOwogICAgICAgICAgICBjYXNlICJmbG9hdDMyIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNmbG9hdDMyKGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAiZmxvYXQ2NCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jZmxvYXQ2NChmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgImJpdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jYml0KGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAiZmxhZ3MiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ZsYWdzKGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAidGFibGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3RhYmxlKGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAic2hvcnRzdHIiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuI3Nob3J0U3RyaW5nKGZpZWxkLnZhbHVlKTsKICAgICAgICAgICAgY2FzZSAibG9uZ3N0ciI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4jbG9uZ1N0cmluZyhmaWVsZC52YWx1ZSk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBhc3NlcnRVbnJlYWNoYWJsZShmaWVsZCk7CiAgICAgICAgfQogICAgfQogICAgcmVzdWx0KCkgewogICAgICAgIHRoaXMuI2ZsdXNoQml0cygpOwogICAgICAgIHJldHVybiB0aGlzLiNidWYuc2xpY2UoMCwgdGhpcy4jb2Zmc2V0KTsKICAgIH0KfQpjb25zdCBtZXRob2ROYW1lcyA9IHsKICAgIFsxMF06IHsKICAgICAgICBbMTBdOiAiY29ubmVjdGlvbi5zdGFydCIsCiAgICAgICAgWzExXTogImNvbm5lY3Rpb24uc3RhcnQtb2siLAogICAgICAgIFsyMF06ICJjb25uZWN0aW9uLnNlY3VyZSIsCiAgICAgICAgWzIxXTogImNvbm5lY3Rpb24uc2VjdXJlLW9rIiwKICAgICAgICBbMzBdOiAiY29ubmVjdGlvbi50dW5lIiwKICAgICAgICBbMzFdOiAiY29ubmVjdGlvbi50dW5lLW9rIiwKICAgICAgICBbNDBdOiAiY29ubmVjdGlvbi5vcGVuIiwKICAgICAgICBbNDFdOiAiY29ubmVjdGlvbi5vcGVuLW9rIiwKICAgICAgICBbNTBdOiAiY29ubmVjdGlvbi5jbG9zZSIsCiAgICAgICAgWzUxXTogImNvbm5lY3Rpb24uY2xvc2Utb2siLAogICAgICAgIFs2MF06ICJjb25uZWN0aW9uLmJsb2NrZWQiLAogICAgICAgIFs2MV06ICJjb25uZWN0aW9uLnVuYmxvY2tlZCIsCiAgICAgICAgWzcwXTogImNvbm5lY3Rpb24udXBkYXRlLXNlY3JldCIsCiAgICAgICAgWzcxXTogImNvbm5lY3Rpb24udXBkYXRlLXNlY3JldC1vayIKICAgIH0sCiAgICBbMjBdOiB7CiAgICAgICAgWzEwXTogImNoYW5uZWwub3BlbiIsCiAgICAgICAgWzExXTogImNoYW5uZWwub3Blbi1vayIsCiAgICAgICAgWzIwXTogImNoYW5uZWwuZmxvdyIsCiAgICAgICAgWzIxXTogImNoYW5uZWwuZmxvdy1vayIsCiAgICAgICAgWzQwXTogImNoYW5uZWwuY2xvc2UiLAogICAgICAgIFs0MV06ICJjaGFubmVsLmNsb3NlLW9rIgogICAgfSwKICAgIFszMF06IHsKICAgICAgICBbMTBdOiAiYWNjZXNzLnJlcXVlc3QiLAogICAgICAgIFsxMV06ICJhY2Nlc3MucmVxdWVzdC1vayIKICAgIH0sCiAgICBbNDBdOiB7CiAgICAgICAgWzEwXTogImV4Y2hhbmdlLmRlY2xhcmUiLAogICAgICAgIFsxMV06ICJleGNoYW5nZS5kZWNsYXJlLW9rIiwKICAgICAgICBbMjBdOiAiZXhjaGFuZ2UuZGVsZXRlIiwKICAgICAgICBbMjFdOiAiZXhjaGFuZ2UuZGVsZXRlLW9rIiwKICAgICAgICBbMzBdOiAiZXhjaGFuZ2UuYmluZCIsCiAgICAgICAgWzMxXTogImV4Y2hhbmdlLmJpbmQtb2siLAogICAgICAgIFs0MF06ICJleGNoYW5nZS51bmJpbmQiLAogICAgICAgIFs1MV06ICJleGNoYW5nZS51bmJpbmQtb2siCiAgICB9LAogICAgWzUwXTogewogICAgICAgIFsxMF06ICJxdWV1ZS5kZWNsYXJlIiwKICAgICAgICBbMTFdOiAicXVldWUuZGVjbGFyZS1vayIsCiAgICAgICAgWzIwXTogInF1ZXVlLmJpbmQiLAogICAgICAgIFsyMV06ICJxdWV1ZS5iaW5kLW9rIiwKICAgICAgICBbMzBdOiAicXVldWUucHVyZ2UiLAogICAgICAgIFszMV06ICJxdWV1ZS5wdXJnZS1vayIsCiAgICAgICAgWzQwXTogInF1ZXVlLmRlbGV0ZSIsCiAgICAgICAgWzQxXTogInF1ZXVlLmRlbGV0ZS1vayIsCiAgICAgICAgWzUwXTogInF1ZXVlLnVuYmluZCIsCiAgICAgICAgWzUxXTogInF1ZXVlLnVuYmluZC1vayIKICAgIH0sCiAgICBbNjBdOiB7CiAgICAgICAgWzEwXTogImJhc2ljLnFvcyIsCiAgICAgICAgWzExXTogImJhc2ljLnFvcy1vayIsCiAgICAgICAgWzIwXTogImJhc2ljLmNvbnN1bWUiLAogICAgICAgIFsyMV06ICJiYXNpYy5jb25zdW1lLW9rIiwKICAgICAgICBbMzBdOiAiYmFzaWMuY2FuY2VsIiwKICAgICAgICBbMzFdOiAiYmFzaWMuY2FuY2VsLW9rIiwKICAgICAgICBbNDBdOiAiYmFzaWMucHVibGlzaCIsCiAgICAgICAgWzUwXTogImJhc2ljLnJldHVybiIsCiAgICAgICAgWzYwXTogImJhc2ljLmRlbGl2ZXIiLAogICAgICAgIFs3MF06ICJiYXNpYy5nZXQiLAogICAgICAgIFs3MV06ICJiYXNpYy5nZXQtb2siLAogICAgICAgIFs3Ml06ICJiYXNpYy5nZXQtZW1wdHkiLAogICAgICAgIFs4MF06ICJiYXNpYy5hY2siLAogICAgICAgIFs5MF06ICJiYXNpYy5yZWplY3QiLAogICAgICAgIFsxMDBdOiAiYmFzaWMucmVjb3Zlci1hc3luYyIsCiAgICAgICAgWzExMF06ICJiYXNpYy5yZWNvdmVyIiwKICAgICAgICBbMTExXTogImJhc2ljLnJlY292ZXItb2siLAogICAgICAgIFsxMjBdOiAiYmFzaWMubmFjayIKICAgIH0sCiAgICBbOTBdOiB7CiAgICAgICAgWzEwXTogInR4LnNlbGVjdCIsCiAgICAgICAgWzExXTogInR4LnNlbGVjdC1vayIsCiAgICAgICAgWzIwXTogInR4LmNvbW1pdCIsCiAgICAgICAgWzIxXTogInR4LmNvbW1pdC1vayIsCiAgICAgICAgWzMwXTogInR4LnJvbGxiYWNrIiwKICAgICAgICBbMzFdOiAidHgucm9sbGJhY2stb2siCiAgICB9LAogICAgWzg1XTogewogICAgICAgIFsxMF06ICJjb25maXJtLnNlbGVjdCIsCiAgICAgICAgWzExXTogImNvbmZpcm0uc2VsZWN0LW9rIgogICAgfQp9OwpmdW5jdGlvbiBnZXRNZXRob2ROYW1lKGNsYXNzSWQsIG1ldGhvZElkKSB7CiAgICByZXR1cm4gbWV0aG9kTmFtZXNbY2xhc3NJZF0gJiYgbWV0aG9kTmFtZXNbY2xhc3NJZF1bbWV0aG9kSWRdOwp9CmZ1bmN0aW9uIGRlY29kZU1ldGhvZChkYXRhMSkgewogICAgY29uc3QgZGVjb2RlcjEgPSBuZXcgQW1xcERlY29kZXIoZGF0YTEpOwogICAgY29uc3QgY2xhc3NJZCA9IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpOwogICAgY29uc3QgbWV0aG9kSWQgPSBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKTsKICAgIHN3aXRjaChjbGFzc0lkKXsKICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbk1ham9yOiBkZWNvZGVyMS5yZWFkKCJ1aW50OCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb25NaW5vcjogZGVjb2RlcjEucmVhZCgidWludDgiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJQcm9wZXJ0aWVzOiBkZWNvZGVyMS5yZWFkKCJ0YWJsZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lY2hhbmlzbXM6IGRlY29kZXIxLnJlYWQoImxvbmdzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbGVzOiBkZWNvZGVyMS5yZWFkKCJsb25nc3RyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFByb3BlcnRpZXM6IGRlY29kZXIxLnJlYWQoInRhYmxlIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVjaGFuaXNtOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlOiBkZWNvZGVyMS5yZWFkKCJsb25nc3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFsbGVuZ2U6IGRlY29kZXIxLnJlYWQoImxvbmdzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2U6IGRlY29kZXIxLnJlYWQoImxvbmdzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbE1heDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWVNYXg6IGRlY29kZXIxLnJlYWQoInVpbnQzMiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYXJ0YmVhdDogZGVjb2RlcjEucmVhZCgidWludDE2IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5uZWxNYXg6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lTWF4OiBkZWNvZGVyMS5yZWFkKCJ1aW50MzIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFydGJlYXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsSG9zdDogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXBhYmlsaXRpZXM6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zaXN0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga25vd25Ib3N0czogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlDb2RlOiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBseVRleHQ6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDYwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYXNvbjogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTZWNyZXQ6IGRlY29kZXIxLnJlYWQoImxvbmdzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFzb246IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBtZXRob2QgIiArIG1ldGhvZElkICsgIiBmb3IgY2xhc3MgJ2Nvbm5lY3Rpb24nIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0T2ZCYW5kOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsSWQ6IGRlY29kZXIxLnJlYWQoImxvbmdzdHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlDb2RlOiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBseVRleHQ6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2RJZCArICIgZm9yIGNsYXNzICdjaGFubmVsJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxtOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1c2l2ZTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc2l2ZTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZTogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogZGVjb2RlcjEucmVhZCgiYml0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tldDogZGVjb2RlcjEucmVhZCgidWludDE2IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2RJZCArICIgZm9yIGNsYXNzICdhY2Nlc3MnIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3NpdmU6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmFibGU6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9EZWxldGU6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVybmFsOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dhaXQ6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogZGVjb2RlcjEucmVhZCgidGFibGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrZXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmVW51c2VkOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dhaXQ6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tldDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb246IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRpbmdLZXk6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93YWl0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGRlY29kZXIxLnJlYWQoInRhYmxlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGluZ0tleTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dhaXQ6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogZGVjb2RlcjEucmVhZCgidGFibGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kSWQgKyAiIGZvciBjbGFzcyAnZXhjaGFuZ2UnIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDUwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzaXZlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhYmxlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNsdXNpdmU6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9EZWxldGU6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vd2FpdDogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiBkZWNvZGVyMS5yZWFkKCJ0YWJsZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlQ291bnQ6IGRlY29kZXIxLnJlYWQoInVpbnQzMiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVyQ291bnQ6IGRlY29kZXIxLnJlYWQoInVpbnQzMiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrZXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRpbmdLZXk6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93YWl0OiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGRlY29kZXIxLnJlYWQoInRhYmxlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dhaXQ6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlQ291bnQ6IGRlY29kZXIxLnJlYWQoInVpbnQzMiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrZXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmVW51c2VkOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZkVtcHR5OiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dhaXQ6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlQ291bnQ6IGRlY29kZXIxLnJlYWQoInVpbnQzMiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrZXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRpbmdLZXk6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiBkZWNvZGVyMS5yZWFkKCJ0YWJsZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2RJZCArICIgZm9yIGNsYXNzICdxdWV1ZSciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIGNhc2UgNjA6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2RJZCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmZXRjaFNpemU6IGRlY29kZXIxLnJlYWQoInVpbnQzMiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWZldGNoQ291bnQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbDogZGVjb2RlcjEucmVhZCgiYml0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja2V0OiBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lclRhZzogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub0xvY2FsOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub0FjazogZGVjb2RlcjEucmVhZCgiYml0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjbHVzaXZlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dhaXQ6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogZGVjb2RlcjEucmVhZCgidGFibGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZXJUYWc6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVyVGFnOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vd2FpdDogZGVjb2RlcjEucmVhZCgiYml0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVyVGFnOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrZXQ6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRpbmdLZXk6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFuZGF0b3J5OiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbW1lZGlhdGU6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBseUNvZGU6IGRlY29kZXIxLnJlYWQoInVpbnQxNiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5VGV4dDogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZTogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0aW5nS2V5OiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lclRhZzogZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeVRhZzogZGVjb2RlcjEucmVhZCgidWludDY0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkZWxpdmVyZWQ6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRpbmdLZXk6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tldDogZGVjb2RlcjEucmVhZCgidWludDE2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9BY2s6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeVRhZzogZGVjb2RlcjEucmVhZCgidWludDY0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkZWxpdmVyZWQ6IGRlY29kZXIxLnJlYWQoImJpdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRpbmdLZXk6IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUNvdW50OiBkZWNvZGVyMS5yZWFkKCJ1aW50MzIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2x1c3RlcklkOiBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA4MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeVRhZzogZGVjb2RlcjEucmVhZCgidWludDY0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA5MDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeVRhZzogZGVjb2RlcjEucmVhZCgidWludDY0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWV1ZTogZGVjb2RlcjEucmVhZCgiYml0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXVlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTEwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVldWU6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlUYWc6IGRlY29kZXIxLnJlYWQoInVpbnQ2NCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXVlOiBkZWNvZGVyMS5yZWFkKCJiaXQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBtZXRob2QgIiArIG1ldGhvZElkICsgIiBmb3IgY2xhc3MgJ2Jhc2ljJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgY2FzZSA5MDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2RJZCArICIgZm9yIGNsYXNzICd0eCciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIGNhc2UgODU6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2RJZCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dhaXQ6IGRlY29kZXIxLnJlYWQoImJpdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2RJZCArICIgZm9yIGNsYXNzICdjb25maXJtJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGNsYXNzICIgKyBjbGFzc0lkKTsKICAgIH0KfQpmdW5jdGlvbiBlbmNvZGVNZXRob2QobWV0aG9kKSB7CiAgICBjb25zdCBlbmNvZGVyMSA9IG5ldyBBbXFwRW5jb2RlcigpOwogICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5jbGFzc0lkKTsKICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QubWV0aG9kSWQpOwogICAgc3dpdGNoKG1ldGhvZC5jbGFzc0lkKXsKICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kLm1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDgiLCBtZXRob2QuYXJncy52ZXJzaW9uTWFqb3IgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnZlcnNpb25NYWpvciA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDgiLCBtZXRob2QuYXJncy52ZXJzaW9uTWlub3IgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnZlcnNpb25NaW5vciA6IDkpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidGFibGUiLCBtZXRob2QuYXJncy5zZXJ2ZXJQcm9wZXJ0aWVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImxvbmdzdHIiLCBtZXRob2QuYXJncy5tZWNoYW5pc21zICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5tZWNoYW5pc21zIDogIlBMQUlOIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJsb25nc3RyIiwgbWV0aG9kLmFyZ3MubG9jYWxlcyAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MubG9jYWxlcyA6ICJlbl9VUyIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidGFibGUiLCBtZXRob2QuYXJncy5jbGllbnRQcm9wZXJ0aWVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MubWVjaGFuaXNtICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5tZWNoYW5pc20gOiAiUExBSU4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImxvbmdzdHIiLCBtZXRob2QuYXJncy5yZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmxvY2FsZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MubG9jYWxlIDogImVuX1VTIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJsb25nc3RyIiwgbWV0aG9kLmFyZ3MuY2hhbGxlbmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImxvbmdzdHIiLCBtZXRob2QuYXJncy5yZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy5jaGFubmVsTWF4ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5jaGFubmVsTWF4IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MzIiLCBtZXRob2QuYXJncy5mcmFtZU1heCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZnJhbWVNYXggOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLmhlYXJ0YmVhdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuaGVhcnRiZWF0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy5jaGFubmVsTWF4ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5jaGFubmVsTWF4IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MzIiLCBtZXRob2QuYXJncy5mcmFtZU1heCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZnJhbWVNYXggOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLmhlYXJ0YmVhdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuaGVhcnRiZWF0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnZpcnR1YWxIb3N0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy52aXJ0dWFsSG9zdCA6ICIvIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmNhcGFiaWxpdGllcyAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuY2FwYWJpbGl0aWVzIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuaW5zaXN0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5pbnNpc3QgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDE6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmtub3duSG9zdHMgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmtub3duSG9zdHMgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy5yZXBseUNvZGUpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yZXBseVRleHQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlcGx5VGV4dCA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLmNsYXNzSWQpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MubWV0aG9kSWQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDUxOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDYwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yZWFzb24gIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlYXNvbiA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2MTogYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImxvbmdzdHIiLCBtZXRob2QuYXJncy5uZXdTZWNyZXQpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yZWFzb24pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcxOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2QubWV0aG9kSWQgKyAiIGZvciBjbGFzcyAnY29ubmVjdGlvbiciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZC5tZXRob2RJZCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3Mub3V0T2ZCYW5kICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5vdXRPZkJhbmQgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJsb25nc3RyIiwgbWV0aG9kLmFyZ3MuY2hhbm5lbElkICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5jaGFubmVsSWQgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5hY3RpdmUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuYWN0aXZlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnJlcGx5Q29kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnJlcGx5VGV4dCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucmVwbHlUZXh0IDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MuY2xhc3NJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy5tZXRob2RJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBtZXRob2QgIiArIG1ldGhvZC5tZXRob2RJZCArICIgZm9yIGNsYXNzICdjaGFubmVsJyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobWV0aG9kLm1ldGhvZElkKXsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yZWFsbSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucmVhbG0gOiAiL2RhdGEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmV4Y2x1c2l2ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZXhjbHVzaXZlIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MucGFzc2l2ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucGFzc2l2ZSA6IHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuYWN0aXZlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5hY3RpdmUgOiB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLndyaXRlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy53cml0ZSA6IHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MucmVhZCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucmVhZCA6IHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MudGlja2V0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy50aWNrZXQgOiAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG1ldGhvZCAiICsgbWV0aG9kLm1ldGhvZElkICsgIiBmb3IgY2xhc3MgJ2FjY2VzcyciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZC5tZXRob2RJZCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnRpY2tldCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudGlja2V0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmV4Y2hhbmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MudHlwZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudHlwZSA6ICJkaXJlY3QiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLnBhc3NpdmUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnBhc3NpdmUgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5kdXJhYmxlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5kdXJhYmxlIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuYXV0b0RlbGV0ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuYXV0b0RlbGV0ZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmludGVybmFsICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5pbnRlcm5hbCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vd2FpdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mubm93YWl0IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidGFibGUiLCBtZXRob2QuYXJncy5hcmd1bWVudHMgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmFyZ3VtZW50cyA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5leGNoYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5pZlVudXNlZCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuaWZVbnVzZWQgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub3dhaXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vd2FpdCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMTogYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnRpY2tldCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudGlja2V0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmRlc3RpbmF0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3Muc291cmNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3Mucm91dGluZ0tleSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mucm91dGluZ0tleSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vd2FpdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mubm93YWl0IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidGFibGUiLCBtZXRob2QuYXJncy5hcmd1bWVudHMgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmFyZ3VtZW50cyA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5kZXN0aW5hdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnNvdXJjZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub3dhaXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vd2FpdCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInRhYmxlIiwgbWV0aG9kLmFyZ3MuYXJndW1lbnRzICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5hcmd1bWVudHMgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDUxOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2QubWV0aG9kSWQgKyAiIGZvciBjbGFzcyAnZXhjaGFuZ2UnIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2QubWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5xdWV1ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucXVldWUgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5wYXNzaXZlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5wYXNzaXZlIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuZHVyYWJsZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZHVyYWJsZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmV4Y2x1c2l2ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZXhjbHVzaXZlIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuYXV0b0RlbGV0ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuYXV0b0RlbGV0ZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vd2FpdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mubm93YWl0IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidGFibGUiLCBtZXRob2QuYXJncy5hcmd1bWVudHMgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmFyZ3VtZW50cyA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnF1ZXVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQzMiIsIG1ldGhvZC5hcmdzLm1lc3NhZ2VDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MzIiLCBtZXRob2QuYXJncy5jb25zdW1lckNvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnRpY2tldCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudGlja2V0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnF1ZXVlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5xdWV1ZSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MuZXhjaGFuZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yb3V0aW5nS2V5ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yb3V0aW5nS2V5IDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3Mubm93YWl0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5ub3dhaXQgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ0YWJsZSIsIG1ldGhvZC5hcmdzLmFyZ3VtZW50cyAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuYXJndW1lbnRzIDogewogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMTogYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnRpY2tldCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudGlja2V0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnF1ZXVlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5xdWV1ZSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vd2FpdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mubm93YWl0IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDMyIiwgbWV0aG9kLmFyZ3MubWVzc2FnZUNvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnRpY2tldCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudGlja2V0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnF1ZXVlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5xdWV1ZSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmlmVW51c2VkICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5pZlVudXNlZCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLmlmRW1wdHkgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmlmRW1wdHkgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub3dhaXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vd2FpdCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MToKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQzMiIsIG1ldGhvZC5hcmdzLm1lc3NhZ2VDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5xdWV1ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucXVldWUgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmV4Y2hhbmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3Mucm91dGluZ0tleSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mucm91dGluZ0tleSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInRhYmxlIiwgbWV0aG9kLmFyZ3MuYXJndW1lbnRzICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5hcmd1bWVudHMgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDUxOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2QubWV0aG9kSWQgKyAiIGZvciBjbGFzcyAncXVldWUnIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIGNhc2UgNjA6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2QubWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MzIiLCBtZXRob2QuYXJncy5wcmVmZXRjaFNpemUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnByZWZldGNoU2l6ZSA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MucHJlZmV0Y2hDb3VudCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucHJlZmV0Y2hDb3VudCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuZ2xvYmFsICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5nbG9iYWwgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy50aWNrZXQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnRpY2tldCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5xdWV1ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucXVldWUgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmNvbnN1bWVyVGFnICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5jb25zdW1lclRhZyA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vTG9jYWwgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vTG9jYWwgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5ub0FjayAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mubm9BY2sgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5leGNsdXNpdmUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmV4Y2x1c2l2ZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vd2FpdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mubm93YWl0IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidGFibGUiLCBtZXRob2QuYXJncy5hcmd1bWVudHMgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLmFyZ3VtZW50cyA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmNvbnN1bWVyVGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MuY29uc3VtZXJUYWcpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3Mubm93YWl0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5ub3dhaXQgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmNvbnN1bWVyVGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIG1ldGhvZC5hcmdzLnRpY2tldCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MudGlja2V0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLmV4Y2hhbmdlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5leGNoYW5nZSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3Mucm91dGluZ0tleSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mucm91dGluZ0tleSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm1hbmRhdG9yeSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MubWFuZGF0b3J5IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MuaW1tZWRpYXRlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5pbW1lZGlhdGUgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCBtZXRob2QuYXJncy5yZXBseUNvZGUpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yZXBseVRleHQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlcGx5VGV4dCA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MuZXhjaGFuZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5yb3V0aW5nS2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2MDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MuY29uc3VtZXJUYWcpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDY0IiwgbWV0aG9kLmFyZ3MuZGVsaXZlcnlUYWcpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MucmVkZWxpdmVyZWQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlZGVsaXZlcmVkIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5leGNoYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcwOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDE2IiwgbWV0aG9kLmFyZ3MudGlja2V0ICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy50aWNrZXQgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MucXVldWUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnF1ZXVlIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3Mubm9BY2sgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm5vQWNrIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcxOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDY0IiwgbWV0aG9kLmFyZ3MuZGVsaXZlcnlUYWcpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MucmVkZWxpdmVyZWQgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlZGVsaXZlcmVkIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBtZXRob2QuYXJncy5leGNoYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIG1ldGhvZC5hcmdzLnJvdXRpbmdLZXkpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDMyIiwgbWV0aG9kLmFyZ3MubWVzc2FnZUNvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MjoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgbWV0aG9kLmFyZ3MuY2x1c3RlcklkICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5jbHVzdGVySWQgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgODA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50NjQiLCBtZXRob2QuYXJncy5kZWxpdmVyeVRhZyAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MuZGVsaXZlcnlUYWcgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm11bHRpcGxlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5tdWx0aXBsZSA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA5MDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQ2NCIsIG1ldGhvZC5hcmdzLmRlbGl2ZXJ5VGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLnJlcXVldWUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlcXVldWUgOiB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJiaXQiLCBtZXRob2QuYXJncy5yZXF1ZXVlICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5yZXF1ZXVlIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLnJlcXVldWUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLnJlcXVldWUgOiBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTExOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEyMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQ2NCIsIG1ldGhvZC5hcmdzLmRlbGl2ZXJ5VGFnICE9PSB1bmRlZmluZWQgPyBtZXRob2QuYXJncy5kZWxpdmVyeVRhZyA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MubXVsdGlwbGUgIT09IHVuZGVmaW5lZCA/IG1ldGhvZC5hcmdzLm11bHRpcGxlIDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiYml0IiwgbWV0aG9kLmFyZ3MucmVxdWV1ZSAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3MucmVxdWV1ZSA6IHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2QubWV0aG9kSWQgKyAiIGZvciBjbGFzcyAnYmFzaWMnIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIGNhc2UgOTA6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN3aXRjaChtZXRob2QubWV0aG9kSWQpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzE6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBtZXRob2QgIiArIG1ldGhvZC5tZXRob2RJZCArICIgZm9yIGNsYXNzICd0eCciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgY2FzZSA4NToKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3dpdGNoKG1ldGhvZC5tZXRob2RJZCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImJpdCIsIG1ldGhvZC5hcmdzLm5vd2FpdCAhPT0gdW5kZWZpbmVkID8gbWV0aG9kLmFyZ3Mubm93YWl0IDogZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOiBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbWV0aG9kICIgKyBtZXRob2QubWV0aG9kSWQgKyAiIGZvciBjbGFzcyAnY29uZmlybSciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGNsYXNzICIgKyBtZXRob2QuY2xhc3NJZCk7CiAgICB9CiAgICByZXR1cm4gZW5jb2RlcjEucmVzdWx0KCk7Cn0KZnVuY3Rpb24gZGVjb2RlSGVhZGVyKGRhdGExKSB7CiAgICBjb25zdCBkZWNvZGVyMSA9IG5ldyBBbXFwRGVjb2RlcihkYXRhMSk7CiAgICBjb25zdCBjbGFzc0lkID0gZGVjb2RlcjEucmVhZCgidWludDE2Iik7CiAgICBkZWNvZGVyMS5yZWFkKCJ1aW50MTYiKTsKICAgIGNvbnN0IHNpemU1ID0gZGVjb2RlcjEucmVhZCgidWludDY0Iik7CiAgICBjb25zdCBmbGFncyA9IGRlY29kZXIxLnJlYWQoImZsYWdzIik7CiAgICBzd2l0Y2goY2xhc3NJZCl7CiAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICBzaXplOiBzaXplNSwKICAgICAgICAgICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICBzaXplOiBzaXplNSwKICAgICAgICAgICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICBzaXplOiBzaXplNSwKICAgICAgICAgICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICBzaXplOiBzaXplNSwKICAgICAgICAgICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICBzaXplOiBzaXplNSwKICAgICAgICAgICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgY2FzZSA2MDoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICBzaXplOiBzaXplNSwKICAgICAgICAgICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IGZsYWdzWzBdID8gZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBjb250ZW50RW5jb2Rpbmc6IGZsYWdzWzFdID8gZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBmbGFnc1syXSA/IGRlY29kZXIxLnJlYWQoInRhYmxlIikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlNb2RlOiBmbGFnc1szXSA/IGRlY29kZXIxLnJlYWQoInVpbnQ4IikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IGZsYWdzWzRdID8gZGVjb2RlcjEucmVhZCgidWludDgiKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBjb3JyZWxhdGlvbklkOiBmbGFnc1s1XSA/IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgcmVwbHlUbzogZmxhZ3NbNl0gPyBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb246IGZsYWdzWzddID8gZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlSWQ6IGZsYWdzWzhdID8gZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IGZsYWdzWzldID8gZGVjb2RlcjEucmVhZCgidWludDY0IikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogZmxhZ3NbMTBdID8gZGVjb2RlcjEucmVhZCgic2hvcnRzdHIiKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGZsYWdzWzExXSA/IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgYXBwSWQ6IGZsYWdzWzEyXSA/IGRlY29kZXIxLnJlYWQoInNob3J0c3RyIikgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgY2x1c3RlcklkOiBmbGFnc1sxM10gPyBkZWNvZGVyMS5yZWFkKCJzaG9ydHN0ciIpIDogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgY2FzZSA5MDoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICBzaXplOiBzaXplNSwKICAgICAgICAgICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgY2FzZSA4NToKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNsYXNzSWQsCiAgICAgICAgICAgICAgICBzaXplOiBzaXplNSwKICAgICAgICAgICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGNsYXNzICIgKyBjbGFzc0lkKTsKICAgIH0KfQpmdW5jdGlvbiBlbmNvZGVIZWFkZXIoaGVhZGVyKSB7CiAgICBjb25zdCBlbmNvZGVyMSA9IG5ldyBBbXFwRW5jb2RlcigpOwogICAgZW5jb2RlcjEud3JpdGUoInVpbnQxNiIsIGhlYWRlci5jbGFzc0lkKTsKICAgIGVuY29kZXIxLndyaXRlKCJ1aW50MTYiLCAwKTsKICAgIGVuY29kZXIxLndyaXRlKCJ1aW50NjQiLCBoZWFkZXIuc2l6ZSk7CiAgICBzd2l0Y2goaGVhZGVyLmNsYXNzSWQpewogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJmbGFncyIsIFtdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImZsYWdzIiwgW10pOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiZmxhZ3MiLCBbXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJmbGFncyIsIFtdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImZsYWdzIiwgW10pOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDYwOgogICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgiZmxhZ3MiLCBbCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMuY29udGVudFR5cGUgIT09IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGhlYWRlci5wcm9wcy5jb250ZW50RW5jb2RpbmcgIT09IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGhlYWRlci5wcm9wcy5oZWFkZXJzICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMuZGVsaXZlcnlNb2RlICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMucHJpb3JpdHkgIT09IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGhlYWRlci5wcm9wcy5jb3JyZWxhdGlvbklkICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMucmVwbHlUbyAhPT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLmV4cGlyYXRpb24gIT09IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGhlYWRlci5wcm9wcy5tZXNzYWdlSWQgIT09IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGhlYWRlci5wcm9wcy50aW1lc3RhbXAgIT09IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGhlYWRlci5wcm9wcy50eXBlICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMudXNlcklkICE9PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBoZWFkZXIucHJvcHMuYXBwSWQgIT09IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGhlYWRlci5wcm9wcy5jbHVzdGVySWQgIT09IHVuZGVmaW5lZCwgCiAgICAgICAgICAgIF0pOwogICAgICAgICAgICBpZiAoaGVhZGVyLnByb3BzLmNvbnRlbnRUeXBlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIGhlYWRlci5wcm9wcy5jb250ZW50VHlwZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy5jb250ZW50RW5jb2RpbmcgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgaGVhZGVyLnByb3BzLmNvbnRlbnRFbmNvZGluZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy5oZWFkZXJzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ0YWJsZSIsIGhlYWRlci5wcm9wcy5oZWFkZXJzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVhZGVyLnByb3BzLmRlbGl2ZXJ5TW9kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgidWludDgiLCBoZWFkZXIucHJvcHMuZGVsaXZlcnlNb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVhZGVyLnByb3BzLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJ1aW50OCIsIGhlYWRlci5wcm9wcy5wcmlvcml0eSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy5jb3JyZWxhdGlvbklkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIGhlYWRlci5wcm9wcy5jb3JyZWxhdGlvbklkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVhZGVyLnByb3BzLnJlcGx5VG8gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgaGVhZGVyLnByb3BzLnJlcGx5VG8pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMuZXhwaXJhdGlvbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBoZWFkZXIucHJvcHMuZXhwaXJhdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy5tZXNzYWdlSWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgaGVhZGVyLnByb3BzLm1lc3NhZ2VJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy50aW1lc3RhbXAgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInVpbnQ2NCIsIGhlYWRlci5wcm9wcy50aW1lc3RhbXApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMudHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBoZWFkZXIucHJvcHMudHlwZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy51c2VySWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoInNob3J0c3RyIiwgaGVhZGVyLnByb3BzLnVzZXJJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWRlci5wcm9wcy5hcHBJZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVyMS53cml0ZSgic2hvcnRzdHIiLCBoZWFkZXIucHJvcHMuYXBwSWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWFkZXIucHJvcHMuY2x1c3RlcklkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJzaG9ydHN0ciIsIGhlYWRlci5wcm9wcy5jbHVzdGVySWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgOTA6CiAgICAgICAgICAgIGVuY29kZXIxLndyaXRlKCJmbGFncyIsIFtdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA4NToKICAgICAgICAgICAgZW5jb2RlcjEud3JpdGUoImZsYWdzIiwgW10pOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gY2xhc3MgIiArIGhlYWRlci5jbGFzc0lkKTsKICAgIH0KICAgIHJldHVybiBlbmNvZGVyMS5yZXN1bHQoKTsKfQpmdW5jdGlvbiBjb3B5MShzcmMsIGRzdCwgb2ZmID0gMCkgewogICAgb2ZmID0gTWF0aC5tYXgoMCwgTWF0aC5taW4ob2ZmLCBkc3QuYnl0ZUxlbmd0aCkpOwogICAgY29uc3QgZHN0Qnl0ZXNBdmFpbGFibGUgPSBkc3QuYnl0ZUxlbmd0aCAtIG9mZjsKICAgIGlmIChzcmMuYnl0ZUxlbmd0aCA+IGRzdEJ5dGVzQXZhaWxhYmxlKSB7CiAgICAgICAgc3JjID0gc3JjLnN1YmFycmF5KDAsIGRzdEJ5dGVzQXZhaWxhYmxlKTsKICAgIH0KICAgIGRzdC5zZXQoc3JjLCBvZmYpOwogICAgcmV0dXJuIHNyYy5ieXRlTGVuZ3RoOwp9CmNsYXNzIERlbm9TdGRJbnRlcm5hbEVycm9yMSBleHRlbmRzIEVycm9yIHsKICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UxKXsKICAgICAgICBzdXBlcihtZXNzYWdlMSk7CiAgICAgICAgdGhpcy5uYW1lID0gIkRlbm9TdGRJbnRlcm5hbEVycm9yIjsKICAgIH0KfQpmdW5jdGlvbiBhc3NlcnQxKGV4cHIsIG1zZyA9ICIiKSB7CiAgICBpZiAoIWV4cHIpIHsKICAgICAgICB0aHJvdyBuZXcgRGVub1N0ZEludGVybmFsRXJyb3IxKG1zZyk7CiAgICB9Cn0KY29uc3QgREVGQVVMVF9CVUZfU0laRTEgPSA0MDk2Owpjb25zdCBNSU5fQlVGX1NJWkUxID0gMTY7CmNvbnN0IENSMSA9ICJcciIuY2hhckNvZGVBdCgwKTsKY29uc3QgTEYxID0gIlxuIi5jaGFyQ29kZUF0KDApOwpjbGFzcyBCdWZmZXJGdWxsRXJyb3IxIGV4dGVuZHMgRXJyb3IgewogICAgbmFtZSA9ICJCdWZmZXJGdWxsRXJyb3IiOwogICAgY29uc3RydWN0b3IocGFydGlhbDEpewogICAgICAgIHN1cGVyKCJCdWZmZXIgZnVsbCIpOwogICAgICAgIHRoaXMucGFydGlhbCA9IHBhcnRpYWwxOwogICAgfQp9CmNsYXNzIFBhcnRpYWxSZWFkRXJyb3IxIGV4dGVuZHMgRGVuby5lcnJvcnMuVW5leHBlY3RlZEVvZiB7CiAgICBuYW1lID0gIlBhcnRpYWxSZWFkRXJyb3IiOwogICAgY29uc3RydWN0b3IoKXsKICAgICAgICBzdXBlcigiRW5jb3VudGVyZWQgVW5leHBlY3RlZEVvZiwgZGF0YSBvbmx5IHBhcnRpYWxseSByZWFkIik7CiAgICB9Cn0KY2xhc3MgQnVmUmVhZGVyMSB7CiAgICByID0gMDsKICAgIHcgPSAwOwogICAgZW9mID0gZmFsc2U7CiAgICBzdGF0aWMgY3JlYXRlKHIsIHNpemUgPSA0MDk2KSB7CiAgICAgICAgcmV0dXJuIHIgaW5zdGFuY2VvZiBCdWZSZWFkZXIxID8gciA6IG5ldyBCdWZSZWFkZXIxKHIsIHNpemUpOwogICAgfQogICAgY29uc3RydWN0b3IocmQyLCBzaXplNSA9IDQwOTYpewogICAgICAgIGlmIChzaXplNSA8IDE2KSB7CiAgICAgICAgICAgIHNpemU1ID0gTUlOX0JVRl9TSVpFMTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fcmVzZXQobmV3IFVpbnQ4QXJyYXkoc2l6ZTUpLCByZDIpOwogICAgfQogICAgc2l6ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5idWYuYnl0ZUxlbmd0aDsKICAgIH0KICAgIGJ1ZmZlcmVkKCkgewogICAgICAgIHJldHVybiB0aGlzLncgLSB0aGlzLnI7CiAgICB9CiAgICBhc3luYyBfZmlsbCgpIHsKICAgICAgICBpZiAodGhpcy5yID4gMCkgewogICAgICAgICAgICB0aGlzLmJ1Zi5jb3B5V2l0aGluKDAsIHRoaXMuciwgdGhpcy53KTsKICAgICAgICAgICAgdGhpcy53IC09IHRoaXMucjsKICAgICAgICAgICAgdGhpcy5yID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMudyA+PSB0aGlzLmJ1Zi5ieXRlTGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCJidWZpbzogdHJpZWQgdG8gZmlsbCBmdWxsIGJ1ZmZlciIpOwogICAgICAgIH0KICAgICAgICBmb3IobGV0IGkgPSAxMDA7IGkgPiAwOyBpLS0pewogICAgICAgICAgICBjb25zdCByciA9IGF3YWl0IHRoaXMucmQucmVhZCh0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLncpKTsKICAgICAgICAgICAgaWYgKHJyID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNzZXJ0MShyciA+PSAwLCAibmVnYXRpdmUgcmVhZCIpOwogICAgICAgICAgICB0aGlzLncgKz0gcnI7CiAgICAgICAgICAgIGlmIChyciA+IDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHByb2dyZXNzIGFmdGVyICR7MTAwfSByZWFkKCkgY2FsbHNgKTsKICAgIH0KICAgIHJlc2V0KHIpIHsKICAgICAgICB0aGlzLl9yZXNldCh0aGlzLmJ1Ziwgcik7CiAgICB9CiAgICBfcmVzZXQoYnVmLCByZCkgewogICAgICAgIHRoaXMuYnVmID0gYnVmOwogICAgICAgIHRoaXMucmQgPSByZDsKICAgICAgICB0aGlzLmVvZiA9IGZhbHNlOwogICAgfQogICAgYXN5bmMgcmVhZChwKSB7CiAgICAgICAgbGV0IHJyID0gcC5ieXRlTGVuZ3RoOwogICAgICAgIGlmIChwLmJ5dGVMZW5ndGggPT09IDApIHJldHVybiBycjsKICAgICAgICBpZiAodGhpcy5yID09PSB0aGlzLncpIHsKICAgICAgICAgICAgaWYgKHAuYnl0ZUxlbmd0aCA+PSB0aGlzLmJ1Zi5ieXRlTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBycjEgPSBhd2FpdCB0aGlzLnJkLnJlYWQocCk7CiAgICAgICAgICAgICAgICBjb25zdCBucmVhZCA9IHJyMSA/PyAwOwogICAgICAgICAgICAgICAgYXNzZXJ0MShucmVhZCA+PSAwLCAibmVnYXRpdmUgcmVhZCIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJyMTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnIgPSAwOwogICAgICAgICAgICB0aGlzLncgPSAwOwogICAgICAgICAgICByciA9IGF3YWl0IHRoaXMucmQucmVhZCh0aGlzLmJ1Zik7CiAgICAgICAgICAgIGlmIChyciA9PT0gMCB8fCByciA9PT0gbnVsbCkgcmV0dXJuIHJyOwogICAgICAgICAgICBhc3NlcnQxKHJyID49IDAsICJuZWdhdGl2ZSByZWFkIik7CiAgICAgICAgICAgIHRoaXMudyArPSBycjsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29waWVkID0gY29weTEodGhpcy5idWYuc3ViYXJyYXkodGhpcy5yLCB0aGlzLncpLCBwLCAwKTsKICAgICAgICB0aGlzLnIgKz0gY29waWVkOwogICAgICAgIHJldHVybiBjb3BpZWQ7CiAgICB9CiAgICBhc3luYyByZWFkRnVsbChwKSB7CiAgICAgICAgbGV0IGJ5dGVzUmVhZCA9IDA7CiAgICAgICAgd2hpbGUoYnl0ZXNSZWFkIDwgcC5sZW5ndGgpewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgcnIgPSBhd2FpdCB0aGlzLnJlYWQocC5zdWJhcnJheShieXRlc1JlYWQpKTsKICAgICAgICAgICAgICAgIGlmIChyciA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChieXRlc1JlYWQgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBhcnRpYWxSZWFkRXJyb3IxKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnl0ZXNSZWFkICs9IHJyOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGVyci5wYXJ0aWFsID0gcC5zdWJhcnJheSgwLCBieXRlc1JlYWQpOwogICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBwOwogICAgfQogICAgYXN5bmMgcmVhZEJ5dGUoKSB7CiAgICAgICAgd2hpbGUodGhpcy5yID09PSB0aGlzLncpewogICAgICAgICAgICBpZiAodGhpcy5lb2YpIHJldHVybiBudWxsOwogICAgICAgICAgICBhd2FpdCB0aGlzLl9maWxsKCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGMgPSB0aGlzLmJ1Zlt0aGlzLnJdOwogICAgICAgIHRoaXMucisrOwogICAgICAgIHJldHVybiBjOwogICAgfQogICAgYXN5bmMgcmVhZFN0cmluZyhkZWxpbSkgewogICAgICAgIGlmIChkZWxpbS5sZW5ndGggIT09IDEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJEZWxpbWl0ZXIgc2hvdWxkIGJlIGEgc2luZ2xlIGNoYXJhY3RlciIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBidWZmZXIgPSBhd2FpdCB0aGlzLnJlYWRTbGljZShkZWxpbS5jaGFyQ29kZUF0KDApKTsKICAgICAgICBpZiAoYnVmZmVyID09PSBudWxsKSByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGJ1ZmZlcik7CiAgICB9CiAgICBhc3luYyByZWFkTGluZSgpIHsKICAgICAgICBsZXQgbGluZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBsaW5lID0gYXdhaXQgdGhpcy5yZWFkU2xpY2UoTEYxKTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgbGV0IHsgcGFydGlhbDogcGFydGlhbDIgIH0gPSBlcnI7CiAgICAgICAgICAgIGFzc2VydDEocGFydGlhbDIgaW5zdGFuY2VvZiBVaW50OEFycmF5LCAiYnVmaW86IGNhdWdodCBlcnJvciBmcm9tIGByZWFkU2xpY2UoKWAgd2l0aG91dCBgcGFydGlhbGAgcHJvcGVydHkiKTsKICAgICAgICAgICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgQnVmZmVyRnVsbEVycm9yMSkpIHsKICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXRoaXMuZW9mICYmIHBhcnRpYWwyLmJ5dGVMZW5ndGggPiAwICYmIHBhcnRpYWwyW3BhcnRpYWwyLmJ5dGVMZW5ndGggLSAxXSA9PT0gQ1IxKSB7CiAgICAgICAgICAgICAgICBhc3NlcnQxKHRoaXMuciA+IDAsICJidWZpbzogdHJpZWQgdG8gcmV3aW5kIHBhc3Qgc3RhcnQgb2YgYnVmZmVyIik7CiAgICAgICAgICAgICAgICB0aGlzLnItLTsKICAgICAgICAgICAgICAgIHBhcnRpYWwyID0gcGFydGlhbDIuc3ViYXJyYXkoMCwgcGFydGlhbDIuYnl0ZUxlbmd0aCAtIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBsaW5lOiBwYXJ0aWFsMiwKICAgICAgICAgICAgICAgIG1vcmU6ICF0aGlzLmVvZgogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAobGluZSA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKGxpbmUuYnl0ZUxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgbGluZSwKICAgICAgICAgICAgICAgIG1vcmU6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmIChsaW5lW2xpbmUuYnl0ZUxlbmd0aCAtIDFdID09IExGMSkgewogICAgICAgICAgICBsZXQgZHJvcCA9IDE7CiAgICAgICAgICAgIGlmIChsaW5lLmJ5dGVMZW5ndGggPiAxICYmIGxpbmVbbGluZS5ieXRlTGVuZ3RoIC0gMl0gPT09IENSMSkgewogICAgICAgICAgICAgICAgZHJvcCA9IDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZSA9IGxpbmUuc3ViYXJyYXkoMCwgbGluZS5ieXRlTGVuZ3RoIC0gZHJvcCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbmUsCiAgICAgICAgICAgIG1vcmU6IGZhbHNlCiAgICAgICAgfTsKICAgIH0KICAgIGFzeW5jIHJlYWRTbGljZShkZWxpbSkgewogICAgICAgIGxldCBzID0gMDsKICAgICAgICBsZXQgc2xpY2U7CiAgICAgICAgd2hpbGUodHJ1ZSl7CiAgICAgICAgICAgIGxldCBpID0gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yICsgcywgdGhpcy53KS5pbmRleE9mKGRlbGltKTsKICAgICAgICAgICAgaWYgKGkgPj0gMCkgewogICAgICAgICAgICAgICAgaSArPSBzOwogICAgICAgICAgICAgICAgc2xpY2UgPSB0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMuciArIGkgKyAxKTsKICAgICAgICAgICAgICAgIHRoaXMuciArPSBpICsgMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuciA9PT0gdGhpcy53KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzbGljZSA9IHRoaXMuYnVmLnN1YmFycmF5KHRoaXMuciwgdGhpcy53KTsKICAgICAgICAgICAgICAgIHRoaXMuciA9IHRoaXMudzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZlcmVkKCkgPj0gdGhpcy5idWYuYnl0ZUxlbmd0aCkgewogICAgICAgICAgICAgICAgdGhpcy5yID0gdGhpcy53OwogICAgICAgICAgICAgICAgY29uc3Qgb2xkYnVmID0gdGhpcy5idWY7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdidWYgPSB0aGlzLmJ1Zi5zbGljZSgwKTsKICAgICAgICAgICAgICAgIHRoaXMuYnVmID0gbmV3YnVmOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJ1ZmZlckZ1bGxFcnJvcjEob2xkYnVmKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzID0gdGhpcy53IC0gdGhpcy5yOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fZmlsbCgpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGVyci5wYXJ0aWFsID0gc2xpY2U7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNsaWNlOwogICAgfQogICAgYXN5bmMgcGVlayhuKSB7CiAgICAgICAgaWYgKG4gPCAwKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCJuZWdhdGl2ZSBjb3VudCIpOwogICAgICAgIH0KICAgICAgICBsZXQgYXZhaWwgPSB0aGlzLncgLSB0aGlzLnI7CiAgICAgICAgd2hpbGUoYXZhaWwgPCBuICYmIGF2YWlsIDwgdGhpcy5idWYuYnl0ZUxlbmd0aCAmJiAhdGhpcy5lb2YpewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fZmlsbCgpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGVyci5wYXJ0aWFsID0gdGhpcy5idWYuc3ViYXJyYXkodGhpcy5yLCB0aGlzLncpOwogICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGF2YWlsID0gdGhpcy53IC0gdGhpcy5yOwogICAgICAgIH0KICAgICAgICBpZiAoYXZhaWwgPT09IDAgJiYgdGhpcy5lb2YpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSBlbHNlIGlmIChhdmFpbCA8IG4gJiYgdGhpcy5lb2YpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVmLnN1YmFycmF5KHRoaXMuciwgdGhpcy5yICsgYXZhaWwpOwogICAgICAgIH0gZWxzZSBpZiAoYXZhaWwgPCBuKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBCdWZmZXJGdWxsRXJyb3IxKHRoaXMuYnVmLnN1YmFycmF5KHRoaXMuciwgdGhpcy53KSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmJ1Zi5zdWJhcnJheSh0aGlzLnIsIHRoaXMuciArIG4pOwogICAgfQp9CmNsYXNzIEFic3RyYWN0QnVmQmFzZTEgewogICAgdXNlZEJ1ZmZlckJ5dGVzID0gMDsKICAgIGVyciA9IG51bGw7CiAgICBzaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLmJ1Zi5ieXRlTGVuZ3RoOwogICAgfQogICAgYXZhaWxhYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLmJ1Zi5ieXRlTGVuZ3RoIC0gdGhpcy51c2VkQnVmZmVyQnl0ZXM7CiAgICB9CiAgICBidWZmZXJlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy51c2VkQnVmZmVyQnl0ZXM7CiAgICB9Cn0KY2xhc3MgQnVmV3JpdGVyMSBleHRlbmRzIEFic3RyYWN0QnVmQmFzZTEgewogICAgc3RhdGljIGNyZWF0ZSh3cml0ZXIsIHNpemUgPSA0MDk2KSB7CiAgICAgICAgcmV0dXJuIHdyaXRlciBpbnN0YW5jZW9mIEJ1ZldyaXRlcjEgPyB3cml0ZXIgOiBuZXcgQnVmV3JpdGVyMSh3cml0ZXIsIHNpemUpOwogICAgfQogICAgY29uc3RydWN0b3Iod3JpdGVyMywgc2l6ZTYgPSA0MDk2KXsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMud3JpdGVyID0gd3JpdGVyMzsKICAgICAgICBpZiAoc2l6ZTYgPD0gMCkgewogICAgICAgICAgICBzaXplNiA9IERFRkFVTFRfQlVGX1NJWkUxOwogICAgICAgIH0KICAgICAgICB0aGlzLmJ1ZiA9IG5ldyBVaW50OEFycmF5KHNpemU2KTsKICAgIH0KICAgIHJlc2V0KHcpIHsKICAgICAgICB0aGlzLmVyciA9IG51bGw7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgPSAwOwogICAgICAgIHRoaXMud3JpdGVyID0gdzsKICAgIH0KICAgIGFzeW5jIGZsdXNoKCkgewogICAgICAgIGlmICh0aGlzLmVyciAhPT0gbnVsbCkgdGhyb3cgdGhpcy5lcnI7CiAgICAgICAgaWYgKHRoaXMudXNlZEJ1ZmZlckJ5dGVzID09PSAwKSByZXR1cm47CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgRGVuby53cml0ZUFsbCh0aGlzLndyaXRlciwgdGhpcy5idWYuc3ViYXJyYXkoMCwgdGhpcy51c2VkQnVmZmVyQnl0ZXMpKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHRoaXMuZXJyID0gZTsKICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5idWYgPSBuZXcgVWludDhBcnJheSh0aGlzLmJ1Zi5sZW5ndGgpOwogICAgICAgIHRoaXMudXNlZEJ1ZmZlckJ5dGVzID0gMDsKICAgIH0KICAgIGFzeW5jIHdyaXRlKGRhdGEpIHsKICAgICAgICBpZiAodGhpcy5lcnIgIT09IG51bGwpIHRocm93IHRoaXMuZXJyOwogICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7CiAgICAgICAgbGV0IHRvdGFsQnl0ZXNXcml0dGVuID0gMDsKICAgICAgICBsZXQgbnVtQnl0ZXNXcml0dGVuID0gMDsKICAgICAgICB3aGlsZShkYXRhLmJ5dGVMZW5ndGggPiB0aGlzLmF2YWlsYWJsZSgpKXsKICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyZWQoKSA9PT0gMCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBhd2FpdCB0aGlzLndyaXRlci53cml0ZShkYXRhKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVyciA9IGU7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG51bUJ5dGVzV3JpdHRlbiA9IGNvcHkxKGRhdGEsIHRoaXMuYnVmLCB0aGlzLnVzZWRCdWZmZXJCeXRlcyk7CiAgICAgICAgICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmZsdXNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG90YWxCeXRlc1dyaXR0ZW4gKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgICAgICBkYXRhID0gZGF0YS5zdWJhcnJheShudW1CeXRlc1dyaXR0ZW4pOwogICAgICAgIH0KICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5MShkYXRhLCB0aGlzLmJ1ZiwgdGhpcy51c2VkQnVmZmVyQnl0ZXMpOwogICAgICAgIHRoaXMudXNlZEJ1ZmZlckJ5dGVzICs9IG51bUJ5dGVzV3JpdHRlbjsKICAgICAgICB0b3RhbEJ5dGVzV3JpdHRlbiArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgcmV0dXJuIHRvdGFsQnl0ZXNXcml0dGVuOwogICAgfQp9CmNsYXNzIEJ1ZldyaXRlclN5bmMxIGV4dGVuZHMgQWJzdHJhY3RCdWZCYXNlMSB7CiAgICBzdGF0aWMgY3JlYXRlKHdyaXRlciwgc2l6ZSA9IDQwOTYpIHsKICAgICAgICByZXR1cm4gd3JpdGVyIGluc3RhbmNlb2YgQnVmV3JpdGVyU3luYzEgPyB3cml0ZXIgOiBuZXcgQnVmV3JpdGVyU3luYzEod3JpdGVyLCBzaXplKTsKICAgIH0KICAgIGNvbnN0cnVjdG9yKHdyaXRlcjQsIHNpemU3ID0gNDA5Nil7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLndyaXRlciA9IHdyaXRlcjQ7CiAgICAgICAgaWYgKHNpemU3IDw9IDApIHsKICAgICAgICAgICAgc2l6ZTcgPSBERUZBVUxUX0JVRl9TSVpFMTsKICAgICAgICB9CiAgICAgICAgdGhpcy5idWYgPSBuZXcgVWludDhBcnJheShzaXplNyk7CiAgICB9CiAgICByZXNldCh3KSB7CiAgICAgICAgdGhpcy5lcnIgPSBudWxsOwogICAgICAgIHRoaXMudXNlZEJ1ZmZlckJ5dGVzID0gMDsKICAgICAgICB0aGlzLndyaXRlciA9IHc7CiAgICB9CiAgICBmbHVzaCgpIHsKICAgICAgICBpZiAodGhpcy5lcnIgIT09IG51bGwpIHRocm93IHRoaXMuZXJyOwogICAgICAgIGlmICh0aGlzLnVzZWRCdWZmZXJCeXRlcyA9PT0gMCkgcmV0dXJuOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIERlbm8ud3JpdGVBbGxTeW5jKHRoaXMud3JpdGVyLCB0aGlzLmJ1Zi5zdWJhcnJheSgwLCB0aGlzLnVzZWRCdWZmZXJCeXRlcykpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdGhpcy5lcnIgPSBlOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgICAgICB0aGlzLmJ1ZiA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmLmxlbmd0aCk7CiAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgPSAwOwogICAgfQogICAgd3JpdGVTeW5jKGRhdGEpIHsKICAgICAgICBpZiAodGhpcy5lcnIgIT09IG51bGwpIHRocm93IHRoaXMuZXJyOwogICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7CiAgICAgICAgbGV0IHRvdGFsQnl0ZXNXcml0dGVuID0gMDsKICAgICAgICBsZXQgbnVtQnl0ZXNXcml0dGVuID0gMDsKICAgICAgICB3aGlsZShkYXRhLmJ5dGVMZW5ndGggPiB0aGlzLmF2YWlsYWJsZSgpKXsKICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyZWQoKSA9PT0gMCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSB0aGlzLndyaXRlci53cml0ZVN5bmMoZGF0YSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnIgPSBlOwogICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBudW1CeXRlc1dyaXR0ZW4gPSBjb3B5MShkYXRhLCB0aGlzLmJ1ZiwgdGhpcy51c2VkQnVmZmVyQnl0ZXMpOwogICAgICAgICAgICAgICAgdGhpcy51c2VkQnVmZmVyQnl0ZXMgKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgICAgICAgICAgdGhpcy5mbHVzaCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvdGFsQnl0ZXNXcml0dGVuICs9IG51bUJ5dGVzV3JpdHRlbjsKICAgICAgICAgICAgZGF0YSA9IGRhdGEuc3ViYXJyYXkobnVtQnl0ZXNXcml0dGVuKTsKICAgICAgICB9CiAgICAgICAgbnVtQnl0ZXNXcml0dGVuID0gY29weTEoZGF0YSwgdGhpcy5idWYsIHRoaXMudXNlZEJ1ZmZlckJ5dGVzKTsKICAgICAgICB0aGlzLnVzZWRCdWZmZXJCeXRlcyArPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgICAgdG90YWxCeXRlc1dyaXR0ZW4gKz0gbnVtQnl0ZXNXcml0dGVuOwogICAgICAgIHJldHVybiB0b3RhbEJ5dGVzV3JpdHRlbjsKICAgIH0KfQpmdW5jdGlvbiBmb3JtYXQoY29kZSwgbXNnKSB7CiAgICBpZiAoIW1zZykgewogICAgICAgIHJldHVybiBjb2RlOwogICAgfQogICAgcmV0dXJuIGAke2NvZGV9IC0gJHttc2d9YDsKfQpjbGFzcyBGcmFtZUVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgY29uc3RydWN0b3IoY29kZSwgbXNnKXsKICAgICAgICBzdXBlcihmb3JtYXQoY29kZSwgbXNnKSk7CiAgICAgICAgdGhpcy5jb2RlID0gY29kZTsKICAgIH0KfQpjbGFzcyBBbXFwRnJhbWVSZWFkZXIgewogICAgI3RpbWVyPW51bGw7CiAgICAjcmVhZGVyOwogICAgY29uc3RydWN0b3Iocil7CiAgICAgICAgdGhpcy4jcmVhZGVyID0gQnVmUmVhZGVyMS5jcmVhdGUocik7CiAgICB9CiAgICAjcmVhZEJ5dGVzPWFzeW5jIChsZW5ndGgpPT57CiAgICAgICAgY29uc3QgbiA9IGF3YWl0IHRoaXMuI3JlYWRlci5yZWFkRnVsbChuZXcgVWludDhBcnJheShsZW5ndGgpKTsKICAgICAgICBpZiAobiA9PT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRnJhbWVFcnJvcigiRU9GIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuOwogICAgfTsKICAgICNyZWFkRnJhbWU9YXN5bmMgKCk9PnsKICAgICAgICBjb25zdCBwcmVmaXggPSBhd2FpdCB0aGlzLiNyZWFkQnl0ZXMoNyk7CiAgICAgICAgY29uc3QgcHJlZml4VmlldyA9IG5ldyBEYXRhVmlldyhwcmVmaXguYnVmZmVyKTsKICAgICAgICBjb25zdCB0eXBlID0gcHJlZml4Vmlldy5nZXRVaW50OCgwKTsKICAgICAgICBjb25zdCBjaGFubmVsID0gcHJlZml4Vmlldy5nZXRVaW50MTYoMSk7CiAgICAgICAgY29uc3QgbGVuZ3RoID0gcHJlZml4Vmlldy5nZXRVaW50MzIoMyk7CiAgICAgICAgY29uc3QgcmVzdCA9IGF3YWl0IHRoaXMuI3JlYWRCeXRlcyhsZW5ndGggKyAxKTsKICAgICAgICBjb25zdCBlbmRCeXRlID0gcmVzdFtyZXN0Lmxlbmd0aCAtIDFdOwogICAgICAgIGlmIChlbmRCeXRlICE9PSAyMDYpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZyYW1lRXJyb3IoIkJBRF9GUkFNRSIsIGB1bmV4cGVjdGVkIEZSQU1FX0VORCAnJHtlbmRCeXRlfSdgKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcGF5bG9hZCA9IHJlc3Quc2xpY2UoMCwgcmVzdC5sZW5ndGggLSAxKTsKICAgICAgICBpZiAodHlwZSA9PT0gMSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdHlwZTogIm1ldGhvZCIsCiAgICAgICAgICAgICAgICBjaGFubmVsOiBjaGFubmVsLAogICAgICAgICAgICAgICAgcGF5bG9hZDogZGVjb2RlTWV0aG9kKHBheWxvYWQpCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlID09PSAyKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiaGVhZGVyIiwKICAgICAgICAgICAgICAgIGNoYW5uZWwsCiAgICAgICAgICAgICAgICBwYXlsb2FkOiBkZWNvZGVIZWFkZXIocGF5bG9hZCkKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGUgPT09IDMpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6ICJjb250ZW50IiwKICAgICAgICAgICAgICAgIGNoYW5uZWwsCiAgICAgICAgICAgICAgICBwYXlsb2FkCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlID09PSA4KSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiaGVhcnRiZWF0IiwKICAgICAgICAgICAgICAgIGNoYW5uZWwsCiAgICAgICAgICAgICAgICBwYXlsb2FkCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBGcmFtZUVycm9yKCJCQURfRlJBTUUiLCBgdW5leHBlY3RlZCBmcmFtZSB0eXBlICcke3R5cGV9J2ApOwogICAgfTsKICAgIGFzeW5jIGFib3J0KCkgewogICAgICAgIGlmICh0aGlzLiN0aW1lciAhPT0gbnVsbCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy4jdGltZXIpOwogICAgICAgIH0KICAgIH0KICAgIHJlYWQodGltZW91dCkgewogICAgICAgIHRoaXMuYWJvcnQoKTsKICAgICAgICBpZiAodGltZW91dCA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiNyZWFkRnJhbWUoKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdGltZW91dE1lc3NhZ2UgPSBgc2VydmVyIGhlYXJ0YmVhdCB0aW1lb3V0ICR7dGltZW91dH1tc2A7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpPT57CiAgICAgICAgICAgIHRoaXMuI3RpbWVyID0gc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcih0aW1lb3V0TWVzc2FnZSkpOwogICAgICAgICAgICB9LCB0aW1lb3V0KTsKICAgICAgICAgICAgdGhpcy4jcmVhZEZyYW1lKCkudGhlbihyZXNvbHZlKS5jYXRjaChyZWplY3QpLmZpbmFsbHkoKCk9PnRoaXMuYWJvcnQoKQogICAgICAgICAgICApOwogICAgICAgIH0pOwogICAgfQp9CmNvbnN0IFRZUEVTID0gewogICAgbWV0aG9kOiAxLAogICAgaGVhZGVyOiAyLAogICAgY29udGVudDogMywKICAgIGhlYXJ0YmVhdDogOAp9OwpmdW5jdGlvbiBlbmNvZGVGcmFtZShmcmFtZSkgewogICAgbGV0IHBheWxvYWQ7CiAgICBzd2l0Y2goZnJhbWUudHlwZSl7CiAgICAgICAgY2FzZSAibWV0aG9kIjoKICAgICAgICAgICAgcGF5bG9hZCA9IGVuY29kZU1ldGhvZChmcmFtZS5wYXlsb2FkKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiaGVhZGVyIjoKICAgICAgICAgICAgcGF5bG9hZCA9IGVuY29kZUhlYWRlcihmcmFtZS5wYXlsb2FkKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcGF5bG9hZCA9IGZyYW1lLnBheWxvYWQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgfQogICAgY29uc3QgZGF0YTIgPSBuZXcgVWludDhBcnJheSg3ICsgcGF5bG9hZC5sZW5ndGggKyAxKTsKICAgIGNvbnN0IHZpZXcgPSBuZXcgRGF0YVZpZXcoZGF0YTIuYnVmZmVyKTsKICAgIGNvbnN0IHR5cGUgPSBUWVBFU1tmcmFtZS50eXBlXTsKICAgIHZpZXcuc2V0VWludDgoMCwgdHlwZSk7CiAgICB2aWV3LnNldFVpbnQxNigxLCBmcmFtZS5jaGFubmVsKTsKICAgIHZpZXcuc2V0VWludDMyKDMsIHBheWxvYWQubGVuZ3RoKTsKICAgIGRhdGEyLnNldChwYXlsb2FkLCA3KTsKICAgIHZpZXcuc2V0VWludDgoNyArIHBheWxvYWQubGVuZ3RoLCAyMDYpOwogICAgcmV0dXJuIGRhdGEyOwp9CmNvbnN0IEhFQVJUQkVBVF9GUkFNRSA9IG5ldyBVaW50OEFycmF5KFsKICAgIDgsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAyMDYsIApdKTsKZnVuY3Rpb24gc3BsaXRBcnJheTEoYXJyLCBzaXplOCkgewogICAgY29uc3QgY2h1bmtzID0gW107CiAgICBsZXQgaW5kZXggPSAwOwogICAgd2hpbGUoaW5kZXggPCBhcnIubGVuZ3RoKXsKICAgICAgICBjaHVua3MucHVzaChhcnIuc2xpY2UoaW5kZXgsIHNpemU4ICsgaW5kZXgpKTsKICAgICAgICBpbmRleCArPSBzaXplODsKICAgIH0KICAgIHJldHVybiBjaHVua3M7Cn0KY2xhc3MgQW1xcFNvY2tldCB7CiAgICAjY29ubjsKICAgICNyZWFkZXI7CiAgICAjc2VuZFRpbWVyPW51bGw7CiAgICAjc2VuZFRpbWVvdXQ9MDsKICAgICNyZWFkVGltZW91dD0wOwogICAgI2ZyYW1lTWF4PS0xOwogICAgY29uc3RydWN0b3IoY29ubil7CiAgICAgICAgdGhpcy4jY29ubiA9IGNvbm47CiAgICAgICAgdGhpcy4jcmVhZGVyID0gbmV3IEFtcXBGcmFtZVJlYWRlcihjb25uKTsKICAgIH0KICAgICNyZXNldFNlbmRUaW1lcj0oKT0+ewogICAgICAgIGlmICh0aGlzLiNzZW5kVGltZXIgIT09IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI3NlbmRUaW1lcik7CiAgICAgICAgICAgIHRoaXMuI3NlbmRUaW1lciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLiNzZW5kVGltZW91dCA+IDApIHsKICAgICAgICAgICAgdGhpcy4jc2VuZFRpbWVyID0gc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgdGhpcy4jY29ubi53cml0ZShIRUFSVEJFQVRfRlJBTUUpOwogICAgICAgICAgICAgICAgdGhpcy4jcmVzZXRTZW5kVGltZXIoKTsKICAgICAgICAgICAgfSwgdGhpcy4jc2VuZFRpbWVvdXQpOwogICAgICAgIH0KICAgIH07CiAgICB0dW5lKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLiNyZWFkVGltZW91dCA9IG9wdGlvbnMucmVhZFRpbWVvdXQgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucmVhZFRpbWVvdXQgOiB0aGlzLiNyZWFkVGltZW91dDsKICAgICAgICB0aGlzLiNzZW5kVGltZW91dCA9IG9wdGlvbnMuc2VuZFRpbWVvdXQgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc2VuZFRpbWVvdXQgOiB0aGlzLiNzZW5kVGltZW91dDsKICAgICAgICB0aGlzLiNmcmFtZU1heCA9IG9wdGlvbnMuZnJhbWVNYXggIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuZnJhbWVNYXggOiB0aGlzLiNmcmFtZU1heDsKICAgICAgICB0aGlzLiNyZXNldFNlbmRUaW1lcigpOwogICAgfQogICAgYXN5bmMgc3RhcnQoKSB7CiAgICAgICAgYXdhaXQgdGhpcy4jY29ubi53cml0ZShuZXcgVWludDhBcnJheShbCiAgICAgICAgICAgIC4uLm5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSgiQU1RUCIpLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICA5LAogICAgICAgICAgICAxCiAgICAgICAgXSkpOwogICAgfQogICAgYXN5bmMgd3JpdGUoZnJhbWUpIHsKICAgICAgICB0aGlzLiNyZXNldFNlbmRUaW1lcigpOwogICAgICAgIGlmIChmcmFtZS50eXBlID09PSAiY29udGVudCIgJiYgdGhpcy4jZnJhbWVNYXggPiA4ICYmIGZyYW1lLnBheWxvYWQubGVuZ3RoID4gdGhpcy4jZnJhbWVNYXggLSA4KSB7CiAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHNwbGl0QXJyYXkxKGZyYW1lLnBheWxvYWQsIHRoaXMuI2ZyYW1lTWF4IC0gOCkubWFwKChjaHVuayk9PnsKICAgICAgICAgICAgICAgIHRoaXMuI2Nvbm4ud3JpdGUoZW5jb2RlRnJhbWUoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJjb250ZW50IiwKICAgICAgICAgICAgICAgICAgICBjaGFubmVsOiBmcmFtZS5jaGFubmVsLAogICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IGNodW5rCiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBhd2FpdCB0aGlzLiNjb25uLndyaXRlKGVuY29kZUZyYW1lKGZyYW1lKSk7CiAgICB9CiAgICAjY2xlYXI9KCk9PnsKICAgICAgICB0aGlzLiNyZWFkVGltZW91dCA9IDA7CiAgICAgICAgdGhpcy4jc2VuZFRpbWVvdXQgPSAwOwogICAgICAgIHRoaXMuI3JlYWRlci5hYm9ydCgpOwogICAgICAgIHRoaXMuI3Jlc2V0U2VuZFRpbWVyKCk7CiAgICB9OwogICAgYXN5bmMgcmVhZCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy4jcmVhZGVyLnJlYWQodGhpcy4jcmVhZFRpbWVvdXQpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgfQogICAgfQogICAgY2xvc2UoKSB7CiAgICAgICAgdGhpcy4jY2xlYXIoKTsKICAgICAgICB0aGlzLiNjb25uLmNsb3NlKCk7CiAgICB9Cn0KZnVuY3Rpb24gY3JlYXRlUmVzb2x2YWJsZSgpIHsKICAgIGxldCByZXNvbHZlRnVuOwogICAgbGV0IHJlamVjdEZ1bjsKICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+ewogICAgICAgIHJlc29sdmVGdW4gPSByZXNvbHZlOwogICAgICAgIHJlamVjdEZ1biA9IHJlamVjdDsKICAgIH0pOwogICAgcHJvbWlzZS5jYXRjaCgoKT0+ewogICAgfSk7CiAgICByZXR1cm4gewogICAgICAgIHRoZW46IHByb21pc2UudGhlbi5iaW5kKHByb21pc2UpLAogICAgICAgIHJlc29sdmUgKHZhbHVlKSB7CiAgICAgICAgICAgIHJlc29sdmVGdW4odmFsdWUpOwogICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICB9LAogICAgICAgIHJlamVjdCAocmVhc29uKSB7CiAgICAgICAgICAgIHJlamVjdEZ1bihyZWFzb24pOwogICAgICAgIH0KICAgIH07Cn0KZnVuY3Rpb24gc2VyaWFsaXplQ2hhbm5lbEVycm9yKGNoYW5uZWwsIGFyZ3MpIHsKICAgIGNvbnN0IGNhdXNlZEJ5ID0gZ2V0TWV0aG9kTmFtZShhcmdzLmNsYXNzSWQsIGFyZ3MubWV0aG9kSWQpOwogICAgcmV0dXJuIGBDaGFubmVsICR7Y2hhbm5lbH0gY2xvc2VkIGJ5IHNlcnZlciAtICR7YXJncy5yZXBseUNvZGV9ICR7YXJncy5yZXBseVRleHQgfHwgIiJ9JHtjYXVzZWRCeSA/IGAgLSBjYXVzZWQgYnkgJyR7Y2F1c2VkQnl9J2AgOiAiIn1gOwp9CmZ1bmN0aW9uIHNlcmlhbGl6ZUNvbm5lY3Rpb25FcnJvcihhcmdzKSB7CiAgICBjb25zdCBjYXVzZWRCeSA9IGdldE1ldGhvZE5hbWUoYXJncy5jbGFzc0lkLCBhcmdzLm1ldGhvZElkKTsKICAgIHJldHVybiBgQ29ubmVjdGlvbiBjbG9zZWQgYnkgc2VydmVyIC0gJHthcmdzLnJlcGx5Q29kZX0gJHthcmdzLnJlcGx5VGV4dCB8fCAiIn0ke2NhdXNlZEJ5ID8gYCAtIGNhdXNlZCBieSAnJHtjYXVzZWRCeX0nYCA6ICIifWA7Cn0KY2xhc3MgQW1xcENoYW5uZWwgewogICAgI2NhbmNlbERlbGl2ZXJTdWJzY3JpcHRpb247CiAgICAjY2FuY2VsUmV0dXJuU3Vic2NyaXB0aW9uOwogICAgI3N1YnNjcmliZXJzPVtdOwogICAgI2NoYW5uZWxOdW1iZXI7CiAgICAjcHJvdG9jb2w7CiAgICAjY2xvc2VkUHJvbWlzZT1jcmVhdGVSZXNvbHZhYmxlKCk7CiAgICAjaXNPcGVuPXRydWU7CiAgICBjb25zdHJ1Y3RvcihjaGFubmVsTnVtYmVyLCBwcm90b2NvbCl7CiAgICAgICAgdGhpcy4jcHJvdG9jb2wgPSBwcm90b2NvbDsKICAgICAgICB0aGlzLiNjaGFubmVsTnVtYmVyID0gY2hhbm5lbE51bWJlcjsKICAgICAgICB0aGlzLiNjYW5jZWxEZWxpdmVyU3Vic2NyaXB0aW9uID0gcHJvdG9jb2wuc3Vic2NyaWJlQmFzaWNEZWxpdmVyKGNoYW5uZWxOdW1iZXIsIHRoaXMuI2hhbmRsZURlbGl2ZXIpOwogICAgICAgIHRoaXMuI2NhbmNlbFJldHVyblN1YnNjcmlwdGlvbiA9IHByb3RvY29sLnN1YnNjcmliZUJhc2ljUmV0dXJuKGNoYW5uZWxOdW1iZXIsIHRoaXMuI2hhbmRsZVJldHVybik7CiAgICAgICAgcHJvdG9jb2wucmVjZWl2ZUNoYW5uZWxDbG9zZShjaGFubmVsTnVtYmVyKS50aGVuKHRoaXMuI2hhbmRsZUNsb3NlKS5jYXRjaCh0aGlzLiNoYW5kbGVDbG9zZUVycm9yKS5maW5hbGx5KCgpPT57CiAgICAgICAgICAgIHRoaXMuI2lzT3BlbiA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICAgIHByb3RvY29sLnJlY2VpdmVDb25uZWN0aW9uQ2xvc2UoMCkudGhlbih0aGlzLiNoYW5kbGVDb25uZWN0aW9uQ2xvc2UpLmNhdGNoKHRoaXMuI2hhbmRsZUNsb3NlRXJyb3IpLmZpbmFsbHkoKCk9PnsKICAgICAgICAgICAgdGhpcy4jaXNPcGVuID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9CiAgICAjaGFuZGxlQ2xvc2VFcnJvcj1hc3luYyAoZXJyb3IpPT57CiAgICAgICAgdGhpcy4jY2xlYW51cCgpOwogICAgICAgIHRoaXMuI2Nsb3NlZFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgIH07CiAgICAjaGFuZGxlQ2xvc2U9YXN5bmMgKGFyZ3MpPT57CiAgICAgICAgaWYgKHRoaXMuI2lzT3BlbikgewogICAgICAgICAgICBhd2FpdCB0aGlzLiNwcm90b2NvbC5zZW5kQ2hhbm5lbENsb3NlT2sodGhpcy4jY2hhbm5lbE51bWJlciwgewogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy4jY2xlYW51cCgpOwogICAgICAgICAgICB0aGlzLiNjbG9zZWRQcm9taXNlLnJlamVjdChuZXcgRXJyb3Ioc2VyaWFsaXplQ2hhbm5lbEVycm9yKHRoaXMuI2NoYW5uZWxOdW1iZXIsIGFyZ3MpKSk7CiAgICAgICAgfQogICAgfTsKICAgICNoYW5kbGVDb25uZWN0aW9uQ2xvc2U9YXN5bmMgKGFyZ3MpPT57CiAgICAgICAgaWYgKHRoaXMuI2lzT3BlbikgewogICAgICAgICAgICB0aGlzLiNjbGVhbnVwKCk7CiAgICAgICAgICAgIHRoaXMuI2Nsb3NlZFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihzZXJpYWxpemVDb25uZWN0aW9uRXJyb3IoYXJncykpKTsKICAgICAgICB9CiAgICB9OwogICAgI2hhbmRsZURlbGl2ZXI9KGFyZ3MsIHByb3BzLCBkYXRhMik9PnsKICAgICAgICB0aGlzLiNzdWJzY3JpYmVycy5mb3JFYWNoKChzdWJzY3JpYmVyKT0+ewogICAgICAgICAgICBpZiAoc3Vic2NyaWJlci50eXBlID09PSAiZGVsaXZlciIgJiYgc3Vic2NyaWJlci50YWcgPT09IGFyZ3MuY29uc3VtZXJUYWcpIHsKICAgICAgICAgICAgICAgIHN1YnNjcmliZXIuaGFuZGxlcihhcmdzLCBwcm9wcywgZGF0YTIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwogICAgI2hhbmRsZVJldHVybj0oYXJncywgcHJvcHMsIGRhdGEyKT0+ewogICAgICAgIHRoaXMuI3N1YnNjcmliZXJzLmZvckVhY2goKHN1YnNjcmliZXIpPT57CiAgICAgICAgICAgIGlmIChzdWJzY3JpYmVyLnR5cGUgPT09ICJyZXR1cm4iKSB7CiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmhhbmRsZXIoYXJncywgcHJvcHMsIGRhdGEyKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKICAgICNjbGVhbnVwPSgpPT57CiAgICAgICAgdGhpcy4jY2FuY2VsRGVsaXZlclN1YnNjcmlwdGlvbigpOwogICAgICAgIHRoaXMuI2NhbmNlbFJldHVyblN1YnNjcmlwdGlvbigpOwogICAgICAgIHRoaXMuI3N1YnNjcmliZXJzLnNwbGljZSgwLCB0aGlzLiNzdWJzY3JpYmVycy5sZW5ndGgpOwogICAgfTsKICAgIGFzeW5jIGNsb3NlZCgpIHsKICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy4jY2xvc2VkUHJvbWlzZTsKICAgIH0KICAgIGFzeW5jIGNsb3NlKCkgewogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDaGFubmVsQ2xvc2UodGhpcy4jY2hhbm5lbE51bWJlciwgewogICAgICAgICAgICBjbGFzc0lkOiAwLAogICAgICAgICAgICBtZXRob2RJZDogMCwKICAgICAgICAgICAgcmVwbHlDb2RlOiAzMjAsCiAgICAgICAgICAgIHJlcGx5VGV4dDogIkNoYW5uZWwgY2xvc2VkIGJ5IGNsaWVudCIKICAgICAgICB9KTsKICAgICAgICB0aGlzLiNjbGVhbnVwKCk7CiAgICAgICAgdGhpcy4jY2xvc2VkUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgdGhpcy4jaXNPcGVuID0gZmFsc2U7CiAgICB9CiAgICBhc3luYyBxb3MoYXJncykgewogICAgICAgIHJldHVybiB0aGlzLiNwcm90b2NvbC5zZW5kQmFzaWNRb3ModGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyBhY2soYXJncykgewogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRCYXNpY0Fjayh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIG5hY2soYXJncykgewogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRCYXNpY05hY2sodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyBjb25zdW1lKGFyZ3MsIGhhbmRsZXIpIHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRCYXNpY0NvbnN1bWUodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICAgICAgdGhpcy4jc3Vic2NyaWJlcnMucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICJkZWxpdmVyIiwKICAgICAgICAgICAgdGFnOiByZXNwb25zZS5jb25zdW1lclRhZywKICAgICAgICAgICAgaGFuZGxlcgogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KICAgIGFzeW5jIGNhbmNlbChhcmdzKSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLiNwcm90b2NvbC5zZW5kQmFzaWNDYW5jZWwodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLiNzdWJzY3JpYmVycy5maW5kSW5kZXgoKHN1Yik9PnN1Yi50eXBlID09PSAiZGVsaXZlciIgJiYgc3ViLnRhZyA9PT0gYXJncy5jb25zdW1lclRhZwogICAgICAgICk7CiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgICB0aGlzLiNzdWJzY3JpYmVycy5zcGxpY2UoaW5kZXgsIGluZGV4ICsgMSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KICAgIGFzeW5jIHB1Ymxpc2goYXJncywgcHJvcHMsIGRhdGEpIHsKICAgICAgICBhd2FpdCB0aGlzLiNwcm90b2NvbC5zZW5kQmFzaWNQdWJsaXNoKHRoaXMuI2NoYW5uZWxOdW1iZXIsIGFyZ3MsIHByb3BzLCBkYXRhKTsKICAgIH0KICAgIGFzeW5jIGRlY2xhcmVRdWV1ZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRRdWV1ZURlY2xhcmUodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyBkZWxldGVRdWV1ZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRRdWV1ZURlbGV0ZSh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIGJpbmRRdWV1ZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRRdWV1ZUJpbmQodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyB1bmJpbmRRdWV1ZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRRdWV1ZVVuYmluZCh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHB1cmdlUXVldWUoYXJncykgewogICAgICAgIHJldHVybiB0aGlzLiNwcm90b2NvbC5zZW5kUXVldWVQdXJnZSh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIGRlbGV0ZUV4Y2hhbmdlKGFyZ3MpIHsKICAgICAgICByZXR1cm4gdGhpcy4jcHJvdG9jb2wuc2VuZEV4Y2hhbmdlRGVsZXRlKHRoaXMuI2NoYW5uZWxOdW1iZXIsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgZGVjbGFyZUV4Y2hhbmdlKGFyZ3MpIHsKICAgICAgICByZXR1cm4gdGhpcy4jcHJvdG9jb2wuc2VuZEV4Y2hhbmdlRGVjbGFyZSh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIGJpbmRFeGNoYW5nZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRFeGNoYW5nZUJpbmQodGhpcy4jY2hhbm5lbE51bWJlciwgYXJncyk7CiAgICB9CiAgICBhc3luYyB1bmJpbmRFeGNoYW5nZShhcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3Byb3RvY29sLnNlbmRFeGNoYW5nZVVuYmluZCh0aGlzLiNjaGFubmVsTnVtYmVyLCBhcmdzKTsKICAgIH0KICAgIG9uKGV2ZW50LCBoYW5kbGVyKSB7CiAgICAgICAgc3dpdGNoKGV2ZW50KXsKICAgICAgICAgICAgY2FzZSAicmV0dXJuIjoKICAgICAgICAgICAgICAgIHRoaXMuI3N1YnNjcmliZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImRlbGl2ZXIiOgogICAgICAgICAgICAgICAgdGhpcy4jc3Vic2NyaWJlcnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogImRlbGl2ZXIiLAogICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gZXZlbnQgJyR7ZXZlbnR9J2ApOwogICAgICAgIH0KICAgIH0KICAgIG9mZihldmVudCwgaGFuZGxlcikgewogICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy4jc3Vic2NyaWJlcnMuZmluZEluZGV4KChzdWIpPT5zdWIudHlwZSA9PT0gZXZlbnQgJiYgc3ViLmhhbmRsZXIgPT09IGhhbmRsZXIKICAgICAgICApOwogICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgdGhpcy4jc3Vic2NyaWJlcnMuc3BsaWNlKGluZGV4LCBpbmRleCArIDEpOwogICAgICAgIH0KICAgIH0KfQpjbGFzcyBBbXFwUHJvdG9jb2wgewogICAgY29uc3RydWN0b3IobXV4KXsKICAgICAgICB0aGlzLm11eCA9IG11eDsKICAgIH0KICAgIGFzeW5jIHNlbmRDb25uZWN0aW9uU3RhcnRPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAxMCwgMTEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZENvbm5lY3Rpb25TZWN1cmVPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAxMCwgMjEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZENvbm5lY3Rpb25UdW5lT2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgMTAsIDMxLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRDb25uZWN0aW9uT3BlbihjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAxMCwgNDAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDEwLCA0MSk7CiAgICB9CiAgICBhc3luYyBzZW5kQ29ubmVjdGlvbkNsb3NlKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDEwLCA1MCwgYXJncyk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgMTAsIDUxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRDb25uZWN0aW9uQ2xvc2VPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAxMCwgNTEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZENoYW5uZWxPcGVuKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDIwLCAxMCwgYXJncyk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgMjAsIDExKTsKICAgIH0KICAgIGFzeW5jIHNlbmRDaGFubmVsRmxvdyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAyMCwgMjAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDIwLCAyMSk7CiAgICB9CiAgICBhc3luYyBzZW5kQ2hhbm5lbENsb3NlKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDIwLCA0MCwgYXJncyk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgMjAsIDQxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRDaGFubmVsQ2xvc2VPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCAyMCwgNDEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlRGVjbGFyZUFzeW5jKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCAxMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IHRydWUKICAgICAgICB9KTsKICAgIH0KICAgIGFzeW5jIHNlbmRFeGNoYW5nZURlY2xhcmUoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNDAsIDEwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA0MCwgMTEpOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlRGVjbGFyZU9rKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCAxMSwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kRXhjaGFuZ2VEZWxldGVBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA0MCwgMjAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kRXhjaGFuZ2VEZWxldGUoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNDAsIDIwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA0MCwgMjEpOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlRGVsZXRlT2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNDAsIDIxLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRFeGNoYW5nZUJpbmRBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA0MCwgMzAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kRXhjaGFuZ2VCaW5kKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCAzMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNDAsIDMxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRFeGNoYW5nZUJpbmRPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA0MCwgMzEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlVW5iaW5kQXN5bmMoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNDAsIDQwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogdHJ1ZQogICAgICAgIH0pOwogICAgfQogICAgYXN5bmMgc2VuZEV4Y2hhbmdlVW5iaW5kKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCA0MCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNDAsIDUxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRFeGNoYW5nZVVuYmluZE9rKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDQwLCA1MSwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVEZWNsYXJlQXN5bmMoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNTAsIDEwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogdHJ1ZQogICAgICAgIH0pOwogICAgfQogICAgYXN5bmMgc2VuZFF1ZXVlRGVjbGFyZShjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMTAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDUwLCAxMSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVEZWNsYXJlT2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNTAsIDExLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRRdWV1ZUJpbmRBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMjAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVCaW5kKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDUwLCAyMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNTAsIDIxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRRdWV1ZUJpbmRPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMjEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZFF1ZXVlUHVyZ2VBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMzAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVQdXJnZShjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgMzAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDUwLCAzMSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVQdXJnZU9rKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDUwLCAzMSwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVEZWxldGVBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgNDAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVEZWxldGUoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNTAsIDQwLCB7CiAgICAgICAgICAgIC4uLmFyZ3MsCiAgICAgICAgICAgIG5vd2FpdDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA1MCwgNDEpOwogICAgfQogICAgYXN5bmMgc2VuZFF1ZXVlRGVsZXRlT2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNTAsIDQxLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRRdWV1ZVVuYmluZChjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgNTAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDUwLCA1MSk7CiAgICB9CiAgICBhc3luYyBzZW5kUXVldWVVbmJpbmRPayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA1MCwgNTEsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZEJhc2ljUW9zKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCAxMCwgYXJncyk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNjAsIDExKTsKICAgIH0KICAgIGFzeW5jIHNlbmRCYXNpY0NvbnN1bWVBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA2MCwgMjAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kQmFzaWNDb25zdW1lKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCAyMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNjAsIDIxKTsKICAgIH0KICAgIGFzeW5jIHNlbmRCYXNpY0NhbmNlbEFzeW5jKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCAzMCwgewogICAgICAgICAgICAuLi5hcmdzLAogICAgICAgICAgICBub3dhaXQ6IHRydWUKICAgICAgICB9KTsKICAgIH0KICAgIGFzeW5jIHNlbmRCYXNpY0NhbmNlbChjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA2MCwgMzAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDYwLCAzMSk7CiAgICB9CiAgICBhc3luYyBzZW5kQmFzaWNQdWJsaXNoKGNoYW5uZWwsIGFyZ3MsIHByb3BzLCBkYXRhKSB7CiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoWwogICAgICAgICAgICB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCA0MCwgYXJncyksCiAgICAgICAgICAgIHRoaXMubXV4LnNlbmRDb250ZW50KGNoYW5uZWwsIDYwLCBwcm9wcywgZGF0YSksIAogICAgICAgIF0pOwogICAgfQogICAgYXN5bmMgc2VuZEJhc2ljR2V0KGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCA3MCwgYXJncyk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmFjZShbCiAgICAgICAgICAgIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNjAsIDcxKSwKICAgICAgICAgICAgdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA2MCwgNzIpLCAKICAgICAgICBdKTsKICAgIH0KICAgIGFzeW5jIHNlbmRCYXNpY0FjayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA2MCwgODAsIGFyZ3MpOwogICAgfQogICAgYXN5bmMgc2VuZEJhc2ljUmVqZWN0KGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCA5MCwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kQmFzaWNSZWNvdmVyQXN5bmMoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgNjAsIDEwMCwgYXJncyk7CiAgICB9CiAgICBhc3luYyBzZW5kQmFzaWNSZWNvdmVyKGNoYW5uZWwsIGFyZ3MpIHsKICAgICAgICBhd2FpdCB0aGlzLm11eC5zZW5kKGNoYW5uZWwsIDYwLCAxMTAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDYwLCAxMTEpOwogICAgfQogICAgYXN5bmMgc2VuZEJhc2ljTmFjayhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA2MCwgMTIwLCBhcmdzKTsKICAgIH0KICAgIGFzeW5jIHNlbmRUeFNlbGVjdChjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA5MCwgMTAsIGFyZ3MpOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDkwLCAxMSk7CiAgICB9CiAgICBhc3luYyBzZW5kVHhDb21taXQoY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgOTAsIDIwLCBhcmdzKTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA5MCwgMjEpOwogICAgfQogICAgYXN5bmMgc2VuZFR4Um9sbGJhY2soY2hhbm5lbCwgYXJncykgewogICAgICAgIGF3YWl0IHRoaXMubXV4LnNlbmQoY2hhbm5lbCwgOTAsIDMwLCBhcmdzKTsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCA5MCwgMzEpOwogICAgfQogICAgYXN5bmMgc2VuZENvbmZpcm1TZWxlY3RBc3luYyhjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA4NSwgMTAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kQ29uZmlybVNlbGVjdChjaGFubmVsLCBhcmdzKSB7CiAgICAgICAgYXdhaXQgdGhpcy5tdXguc2VuZChjaGFubmVsLCA4NSwgMTAsIHsKICAgICAgICAgICAgLi4uYXJncywKICAgICAgICAgICAgbm93YWl0OiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDg1LCAxMSk7CiAgICB9CiAgICBhc3luYyByZWNlaXZlQ29ubmVjdGlvblN0YXJ0KGNoYW5uZWwpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCAxMCwgMTApOwogICAgfQogICAgYXN5bmMgcmVjZWl2ZUNvbm5lY3Rpb25TZWN1cmUoY2hhbm5lbCkgewogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDEwLCAyMCk7CiAgICB9CiAgICBhc3luYyByZWNlaXZlQ29ubmVjdGlvblR1bmUoY2hhbm5lbCkgewogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDEwLCAzMCk7CiAgICB9CiAgICBhc3luYyByZWNlaXZlQ29ubmVjdGlvbkNsb3NlKGNoYW5uZWwpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCAxMCwgNTApOwogICAgfQogICAgYXN5bmMgcmVjZWl2ZUNoYW5uZWxGbG93KGNoYW5uZWwpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXgucmVjZWl2ZShjaGFubmVsLCAyMCwgMjApOwogICAgfQogICAgYXN5bmMgcmVjZWl2ZUNoYW5uZWxDbG9zZShjaGFubmVsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgMjAsIDQwKTsKICAgIH0KICAgIGFzeW5jIHJlY2VpdmVCYXNpY0FjayhjaGFubmVsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnJlY2VpdmUoY2hhbm5lbCwgNjAsIDgwKTsKICAgIH0KICAgIGFzeW5jIHJlY2VpdmVCYXNpY05hY2soY2hhbm5lbCkgewogICAgICAgIHJldHVybiB0aGlzLm11eC5yZWNlaXZlKGNoYW5uZWwsIDYwLCAxMjApOwogICAgfQogICAgc3Vic2NyaWJlQ29ubmVjdGlvblN0YXJ0KGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDEwLCAxMCwgaGFuZGxlcik7CiAgICB9CiAgICBzdWJzY3JpYmVDb25uZWN0aW9uU2VjdXJlKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDEwLCAyMCwgaGFuZGxlcik7CiAgICB9CiAgICBzdWJzY3JpYmVDb25uZWN0aW9uVHVuZShjaGFubmVsLCBoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnN1YnNjcmliZShjaGFubmVsLCAxMCwgMzAsIGhhbmRsZXIpOwogICAgfQogICAgc3Vic2NyaWJlQ29ubmVjdGlvbkNsb3NlKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDEwLCA1MCwgaGFuZGxlcik7CiAgICB9CiAgICBzdWJzY3JpYmVDaGFubmVsRmxvdyhjaGFubmVsLCBoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnN1YnNjcmliZShjaGFubmVsLCAyMCwgMjAsIGhhbmRsZXIpOwogICAgfQogICAgc3Vic2NyaWJlQ2hhbm5lbENsb3NlKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDIwLCA0MCwgaGFuZGxlcik7CiAgICB9CiAgICBzdWJzY3JpYmVCYXNpY1JldHVybihjaGFubmVsLCBoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnN1YnNjcmliZShjaGFubmVsLCA2MCwgNTAsIGFzeW5jIChtZXRob2QpPT57CiAgICAgICAgICAgIGNvbnN0IFtwcm9wcywgY29udGVudF0gPSBhd2FpdCB0aGlzLm11eC5yZWNlaXZlQ29udGVudChjaGFubmVsLCA2MCk7CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVyKG1ldGhvZCwgcHJvcHMsIGNvbnRlbnQpOwogICAgICAgIH0pOwogICAgfQogICAgc3Vic2NyaWJlQmFzaWNEZWxpdmVyKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDYwLCA2MCwgYXN5bmMgKG1ldGhvZCk9PnsKICAgICAgICAgICAgY29uc3QgW3Byb3BzLCBjb250ZW50XSA9IGF3YWl0IHRoaXMubXV4LnJlY2VpdmVDb250ZW50KGNoYW5uZWwsIDYwKTsKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIobWV0aG9kLCBwcm9wcywgY29udGVudCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBzdWJzY3JpYmVCYXNpY0FjayhjaGFubmVsLCBoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXV4LnN1YnNjcmliZShjaGFubmVsLCA2MCwgODAsIGhhbmRsZXIpOwogICAgfQogICAgc3Vic2NyaWJlQmFzaWNOYWNrKGNoYW5uZWwsIGhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdXguc3Vic2NyaWJlKGNoYW5uZWwsIDYwLCAxMjAsIGhhbmRsZXIpOwogICAgfQp9CmZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmliZXIoaGFuZGxlLCBvbkVycm9yKSB7CiAgICByZXR1cm4gewogICAgICAgIGhhbmRsZSwKICAgICAgICBlcnJvcjogb25FcnJvcgogICAgfTsKfQpmdW5jdGlvbiBhc3NlcnROb3RDbG9zZWQoY2hhbm5lbCwgZnJhbWUpIHsKICAgIGlmIChmcmFtZS50eXBlID09PSAibWV0aG9kIikgewogICAgICAgIGlmIChmcmFtZS5jaGFubmVsID09PSBjaGFubmVsICYmIGZyYW1lLnBheWxvYWQuY2xhc3NJZCA9PT0gMjAgJiYgZnJhbWUucGF5bG9hZC5tZXRob2RJZCA9PT0gNDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHNlcmlhbGl6ZUNoYW5uZWxFcnJvcihjaGFubmVsLCBmcmFtZS5wYXlsb2FkLmFyZ3MpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGZyYW1lLnBheWxvYWQuY2xhc3NJZCA9PT0gMTAgJiYgZnJhbWUucGF5bG9hZC5tZXRob2RJZCA9PT0gNTApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHNlcmlhbGl6ZUNvbm5lY3Rpb25FcnJvcihmcmFtZS5wYXlsb2FkLmFyZ3MpKTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gY3JlYXRlU29ja2V0RGVtdXgocmVhZGVyLCBzdWJzY3JpYmVycykgewogICAgbGlzdGVuKCk7CiAgICBhc3luYyBmdW5jdGlvbiBsaXN0ZW4oKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2hpbGUodHJ1ZSl7CiAgICAgICAgICAgICAgICBjb25zdCBmcmFtZSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICBlbWl0KGZyYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGhhbmRsZUVycm9yKGVycm9yKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZW1vdmVTdWJzY3JpYmVyKHN1YnNjcmliZXIpIHsKICAgICAgICBjb25zdCBpbmRleCA9IHN1YnNjcmliZXJzLmluZGV4T2Yoc3Vic2NyaWJlcik7CiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgICBzdWJzY3JpYmVycy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGhhbmRsZUVycm9yKGVycm9yKSB7CiAgICAgICAgZm9yIChjb25zdCBzdWJzY3JpYmVyIG9mIFsKICAgICAgICAgICAgLi4uc3Vic2NyaWJlcnMKICAgICAgICBdKXsKICAgICAgICAgICAgc3Vic2NyaWJlci5lcnJvcihlcnJvcik7CiAgICAgICAgICAgIHJlbW92ZVN1YnNjcmliZXIoc3Vic2NyaWJlcik7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZW1pdChmcmFtZSkgewogICAgICAgIGZvciAoY29uc3Qgc3Vic2NyaWJlciBvZiBbCiAgICAgICAgICAgIC4uLnN1YnNjcmliZXJzCiAgICAgICAgXSl7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoc3Vic2NyaWJlci5oYW5kbGUoZnJhbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlU3Vic2NyaWJlcihzdWJzY3JpYmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIHN1YnNjcmliZXIuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICAgICAgcmVtb3ZlU3Vic2NyaWJlcihzdWJzY3JpYmVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGFkZFN1YnNjcmliZXIoc3Vic2NyaWJlcikgewogICAgICAgIHN1YnNjcmliZXJzLnB1c2goc3Vic2NyaWJlcik7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiByZWNlaXZlKGNoYW5uZWwsIGNsYXNzSWQsIG1ldGhvZElkKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57CiAgICAgICAgICAgIGFkZFN1YnNjcmliZXIoY3JlYXRlU3Vic2NyaWJlcigoZnJhbWUpPT57CiAgICAgICAgICAgICAgICBpZiAoZnJhbWUudHlwZSA9PT0gIm1ldGhvZCIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJhbWUuY2hhbm5lbCA9PT0gY2hhbm5lbCAmJiBmcmFtZS5wYXlsb2FkLmNsYXNzSWQgPT09IGNsYXNzSWQgJiYgZnJhbWUucGF5bG9hZC5tZXRob2RJZCA9PT0gbWV0aG9kSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmcmFtZS5wYXlsb2FkLmFyZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhc3NlcnROb3RDbG9zZWQoY2hhbm5lbCwgZnJhbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9LCByZWplY3QpKTsKICAgICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIHN1YnNjcmliZShjaGFubmVsLCBjbGFzc0lkLCBtZXRob2RJZCwgaGFuZGxlcikgewogICAgICAgIGNvbnN0IHN1YnNjcmliZXIgPSBjcmVhdGVTdWJzY3JpYmVyKChmcmFtZSk9PnsKICAgICAgICAgICAgaWYgKGZyYW1lLnR5cGUgPT09ICJtZXRob2QiKSB7CiAgICAgICAgICAgICAgICBpZiAoZnJhbWUuY2hhbm5lbCA9PT0gY2hhbm5lbCAmJiBmcmFtZS5wYXlsb2FkLmNsYXNzSWQgPT09IGNsYXNzSWQgJiYgZnJhbWUucGF5bG9hZC5tZXRob2RJZCA9PT0gbWV0aG9kSWQpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyKGZyYW1lLnBheWxvYWQuYXJncyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0sICgpPT57CiAgICAgICAgfSk7CiAgICAgICAgYWRkU3Vic2NyaWJlcihzdWJzY3JpYmVyKTsKICAgICAgICByZXR1cm4gKCk9PnJlbW92ZVN1YnNjcmliZXIoc3Vic2NyaWJlcikKICAgICAgICA7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiByZWNlaXZlSGVhZGVyKGNoYW5uZWwsIGNsYXNzSWQpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PnsKICAgICAgICAgICAgYWRkU3Vic2NyaWJlcihjcmVhdGVTdWJzY3JpYmVyKChmcmFtZSk9PnsKICAgICAgICAgICAgICAgIGlmIChmcmFtZS5jaGFubmVsID09PSBjaGFubmVsICYmIGZyYW1lLnR5cGUgPT09ICJoZWFkZXIiICYmIGZyYW1lLnBheWxvYWQuY2xhc3NJZCA9PT0gY2xhc3NJZCkgewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZnJhbWUucGF5bG9hZCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhc3NlcnROb3RDbG9zZWQoY2hhbm5lbCwgZnJhbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9LCByZWplY3QpKTsKICAgICAgICB9KTsKICAgIH0KICAgIGFzeW5jIGZ1bmN0aW9uIHJlY2VpdmVDb250ZW50KGNoYW5uZWwsIGNsYXNzSWQpIHsKICAgICAgICBjb25zdCBoZWFkZXIgPSBhd2FpdCByZWNlaXZlSGVhZGVyKGNoYW5uZWwsIGNsYXNzSWQpOwogICAgICAgIGlmIChoZWFkZXIuc2l6ZSA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLAogICAgICAgICAgICAgICAgbmV3IFVpbnQ4QXJyYXkoMCkKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYnVmZmVyID0gbmV3IERlbm8uQnVmZmVyKCk7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57CiAgICAgICAgICAgIGFkZFN1YnNjcmliZXIoY3JlYXRlU3Vic2NyaWJlcigoZnJhbWUpPT57CiAgICAgICAgICAgICAgICBpZiAoZnJhbWUuY2hhbm5lbCA9PT0gY2hhbm5lbCAmJiBmcmFtZS50eXBlID09PSAiY29udGVudCIpIHsKICAgICAgICAgICAgICAgICAgICBidWZmZXIud3JpdGVTeW5jKGZyYW1lLnBheWxvYWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChidWZmZXIubGVuZ3RoID49IGhlYWRlci5zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyLmJ5dGVzKCkKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZnJhbWUuY2hhbm5lbCA9PT0gY2hhbm5lbCAmJiBmcmFtZS50eXBlICE9PSAiY29udGVudCIpIHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFsKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnByb3BzLAogICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIuYnl0ZXMoKQogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYXNzZXJ0Tm90Q2xvc2VkKGNoYW5uZWwsIGZyYW1lKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSwgcmVqZWN0KSk7CiAgICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIHJlY2VpdmU6IHJlY2VpdmUsCiAgICAgICAgcmVjZWl2ZUNvbnRlbnQ6IHJlY2VpdmVDb250ZW50LAogICAgICAgIHN1YnNjcmliZTogc3Vic2NyaWJlCiAgICB9Owp9CmZ1bmN0aW9uIGNyZWF0ZVNvY2tldE11eCh3cml0ZXI1KSB7CiAgICBhc3luYyBmdW5jdGlvbiBzZW5kKGNoYW5uZWwsIGNsYXNzSWQsIG1ldGhvZElkLCBhcmdzKSB7CiAgICAgICAgcmV0dXJuIHdyaXRlcjUud3JpdGUoewogICAgICAgICAgICB0eXBlOiAibWV0aG9kIiwKICAgICAgICAgICAgY2hhbm5lbCwKICAgICAgICAgICAgcGF5bG9hZDogewogICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgIG1ldGhvZElkLAogICAgICAgICAgICAgICAgYXJncwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiBzZW5kQ29udGVudChjaGFubmVsLCBjbGFzc0lkLCBwcm9wcywgZGF0YTIpIHsKICAgICAgICBjb25zdCBzaXplOCA9IGRhdGEyLmxlbmd0aDsKICAgICAgICBpZiAoc2l6ZTggPT09IDApIHsKICAgICAgICAgICAgYXdhaXQgd3JpdGVyNS53cml0ZSh7CiAgICAgICAgICAgICAgICB0eXBlOiAiaGVhZGVyIiwKICAgICAgICAgICAgICAgIGNoYW5uZWwsCiAgICAgICAgICAgICAgICBwYXlsb2FkOiB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICBwcm9wcywKICAgICAgICAgICAgICAgICAgICBzaXplOiBzaXplOAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICAgICAgICB3cml0ZXI1LndyaXRlKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiaGVhZGVyIiwKICAgICAgICAgICAgICAgICAgICBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHMsCiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IHNpemU4CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB3cml0ZXI1LndyaXRlKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiY29udGVudCIsCiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiBkYXRhMgogICAgICAgICAgICAgICAgfSksIAogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIHNlbmQsCiAgICAgICAgc2VuZENvbnRlbnQKICAgIH07Cn0KZnVuY3Rpb24gY3JlYXRlQW1xcE11eChzb2NrZXQpIHsKICAgIGNvbnN0IHN1YnNjcmliZXJzID0gW107CiAgICBjb25zdCBkZW11eCA9IGNyZWF0ZVNvY2tldERlbXV4KHNvY2tldCwgc3Vic2NyaWJlcnMpOwogICAgY29uc3QgbXV4MSA9IGNyZWF0ZVNvY2tldE11eChzb2NrZXQpOwogICAgcmV0dXJuIHsKICAgICAgICAuLi5kZW11eCwKICAgICAgICAuLi5tdXgxCiAgICB9Owp9CmNvbnN0IE5VTExfQ0hBUiA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMCk7CmZ1bmN0aW9uIGNyZWRlbnRpYWxzKHVzZXJuYW1lLCBwYXNzd29yZCkgewogICAgcmV0dXJuIGAke05VTExfQ0hBUn0ke3VzZXJuYW1lfSR7TlVMTF9DSEFSfSR7cGFzc3dvcmR9YDsKfQpjb25zdCBjbGllbnRQcm9wZXJ0aWVzID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBwcm9kdWN0OiAiZGVuby1hbXFwIiwKICAgIHBsYXRmb3JtOiBgRGVubyAke0Rlbm8udmVyc2lvbi5kZW5vfSBodHRwczovL2Rlbm8ubGFuZGAsCiAgICB2ZXJzaW9uOiAiMCIsCiAgICBpbmZvcm1hdGlvbjogImh0dHBzOi8vZGVuby5sYW5kL3gvYW1xcC8iCn0pOwpmdW5jdGlvbiB0dW5lKG91cnMsIHRoZWlycykgewogICAgaWYgKG91cnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGVpcnM7CiAgICB9CiAgICBpZiAob3VycyA9PT0gMCkgewogICAgICAgIHJldHVybiBNYXRoLm1heChvdXJzLCB0aGVpcnMpOwogICAgfQogICAgcmV0dXJuIE1hdGgubWluKG91cnMsIHRoZWlycyk7Cn0KY2xhc3MgQW1xcENvbm5lY3Rpb24gewogICAgI2NoYW5uZWxNYXg9LTE7CiAgICAjaXNPcGVuPWZhbHNlOwogICAgI3Byb3RvY29sOwogICAgI2NoYW5uZWxOdW1iZXJzPVtdOwogICAgI3VzZXJuYW1lOwogICAgI3Bhc3N3b3JkOwogICAgI3Zob3N0OwogICAgI2Nsb3NlZFByb21pc2U7CiAgICAjb3B0aW9uczsKICAgICNzb2NrZXQ7CiAgICBjb25zdHJ1Y3Rvcihzb2NrZXQsIG9wdGlvbnMxKXsKICAgICAgICB0aGlzLiNvcHRpb25zID0gb3B0aW9uczE7CiAgICAgICAgdGhpcy4jc29ja2V0ID0gc29ja2V0OwogICAgICAgIHRoaXMuI3Byb3RvY29sID0gbmV3IEFtcXBQcm90b2NvbChjcmVhdGVBbXFwTXV4KHRoaXMuI3NvY2tldCkpOwogICAgICAgIHRoaXMuI3VzZXJuYW1lID0gb3B0aW9uczEudXNlcm5hbWU7CiAgICAgICAgdGhpcy4jcGFzc3dvcmQgPSBvcHRpb25zMS5wYXNzd29yZDsKICAgICAgICB0aGlzLiN2aG9zdCA9IG9wdGlvbnMxLnZob3N0IHx8ICIvIjsKICAgICAgICB0aGlzLiNjbG9zZWRQcm9taXNlID0gY3JlYXRlUmVzb2x2YWJsZSgpOwogICAgICAgIHRoaXMuI3Byb3RvY29sLnJlY2VpdmVDb25uZWN0aW9uQ2xvc2UoMCkudGhlbih0aGlzLiNoYW5kbGVDbG9zZSkuY2F0Y2godGhpcy4jY2xvc2VkUHJvbWlzZS5yZWplY3QpLmZpbmFsbHkoKCk9PnsKICAgICAgICAgICAgdGhpcy4jaXNPcGVuID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9CiAgICAjaGFuZGxlQ2xvc2U9YXN5bmMgKGFyZ3MpPT57CiAgICAgICAgdGhpcy4jaXNPcGVuID0gZmFsc2U7CiAgICAgICAgYXdhaXQgdGhpcy4jcHJvdG9jb2wuc2VuZENvbm5lY3Rpb25DbG9zZU9rKDAsIHsKICAgICAgICB9KTsKICAgICAgICB0aGlzLiNjbG9zZWRQcm9taXNlLnJlamVjdChuZXcgRXJyb3Ioc2VyaWFsaXplQ29ubmVjdGlvbkVycm9yKGFyZ3MpKSk7CiAgICAgICAgdGhpcy4jc29ja2V0LmNsb3NlKCk7CiAgICB9OwogICAgI2hhbmRsZVN0YXJ0PWFzeW5jIChhcmdzKT0+ewogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDb25uZWN0aW9uU3RhcnRPaygwLCB7CiAgICAgICAgICAgIGNsaWVudFByb3BlcnRpZXMsCiAgICAgICAgICAgIHJlc3BvbnNlOiBjcmVkZW50aWFscyh0aGlzLiN1c2VybmFtZSwgdGhpcy4jcGFzc3dvcmQpCiAgICAgICAgfSk7CiAgICB9OwogICAgI2hhbmRsZVR1bmU9YXN5bmMgKGFyZ3MpPT57CiAgICAgICAgY29uc3QgaGVhcnRiZWF0SW50ZXJ2YWwgPSB0dW5lKHRoaXMuI29wdGlvbnMuaGVhcnRiZWF0SW50ZXJ2YWwsIGFyZ3MuaGVhcnRiZWF0KTsKICAgICAgICB0aGlzLiNjaGFubmVsTWF4ID0gdHVuZSh1bmRlZmluZWQsIGFyZ3MuY2hhbm5lbE1heCk7CiAgICAgICAgY29uc3QgZnJhbWVNYXggPSB0dW5lKHRoaXMuI29wdGlvbnMuZnJhbWVNYXgsIGFyZ3MuZnJhbWVNYXgpOwogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDb25uZWN0aW9uVHVuZU9rKDAsIHsKICAgICAgICAgICAgaGVhcnRiZWF0OiBoZWFydGJlYXRJbnRlcnZhbCwKICAgICAgICAgICAgY2hhbm5lbE1heDogdGhpcy4jY2hhbm5lbE1heCwKICAgICAgICAgICAgZnJhbWVNYXgKICAgICAgICB9KTsKICAgICAgICB0aGlzLiNzb2NrZXQudHVuZSh7CiAgICAgICAgICAgIGZyYW1lTWF4LAogICAgICAgICAgICBzZW5kVGltZW91dDogaGVhcnRiZWF0SW50ZXJ2YWwgKiAxMDAwLAogICAgICAgICAgICByZWFkVGltZW91dDogaGVhcnRiZWF0SW50ZXJ2YWwgKiAxMDAwICogMgogICAgICAgIH0pOwogICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDb25uZWN0aW9uT3BlbigwLCB7CiAgICAgICAgICAgIHZpcnR1YWxIb3N0OiB0aGlzLiN2aG9zdAogICAgICAgIH0pOwogICAgfTsKICAgIGFzeW5jIG9wZW4oKSB7CiAgICAgICAgYXdhaXQgdGhpcy4jc29ja2V0LnN0YXJ0KCk7CiAgICAgICAgYXdhaXQgdGhpcy4jcHJvdG9jb2wucmVjZWl2ZUNvbm5lY3Rpb25TdGFydCgwKS50aGVuKHRoaXMuI2hhbmRsZVN0YXJ0KTsKICAgICAgICBhd2FpdCB0aGlzLiNwcm90b2NvbC5yZWNlaXZlQ29ubmVjdGlvblR1bmUoMCkudGhlbih0aGlzLiNoYW5kbGVUdW5lKTsKICAgICAgICB0aGlzLiNpc09wZW4gPSB0cnVlOwogICAgfQogICAgYXN5bmMgb3BlbkNoYW5uZWwoKSB7CiAgICAgICAgZm9yKGxldCBjaGFubmVsTnVtYmVyMSA9IDE7IGNoYW5uZWxOdW1iZXIxIDwgdGhpcy4jY2hhbm5lbE1heDsgKytjaGFubmVsTnVtYmVyMSl7CiAgICAgICAgICAgIGlmICghdGhpcy4jY2hhbm5lbE51bWJlcnMuZmluZCgobnVtKT0+bnVtID09PSBjaGFubmVsTnVtYmVyMQogICAgICAgICAgICApKSB7CiAgICAgICAgICAgICAgICB0aGlzLiNjaGFubmVsTnVtYmVycy5wdXNoKGNoYW5uZWxOdW1iZXIxKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDaGFubmVsT3BlbihjaGFubmVsTnVtYmVyMSwgewogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb25zdCBjaGFubmVsID0gbmV3IEFtcXBDaGFubmVsKGNoYW5uZWxOdW1iZXIxLCB0aGlzLiNwcm90b2NvbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2hhbm5lbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1heGltdW0gY2hhbm5lbHMgJHt0aGlzLiNjaGFubmVsTWF4fSByZWFjaGVkYCk7CiAgICB9CiAgICBhc3luYyBjbG9zZSgpIHsKICAgICAgICBpZiAodGhpcy4jaXNPcGVuKSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuI3Byb3RvY29sLnNlbmRDb25uZWN0aW9uQ2xvc2UoMCwgewogICAgICAgICAgICAgICAgY2xhc3NJZDogMCwKICAgICAgICAgICAgICAgIG1ldGhvZElkOiAwLAogICAgICAgICAgICAgICAgcmVwbHlDb2RlOiAzMjAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuI3NvY2tldC5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICB0aGlzLiNpc09wZW4gPSBmYWxzZTsKICAgICAgICB0aGlzLiNjbG9zZWRQcm9taXNlLnJlc29sdmUoKTsKICAgIH0KICAgIGFzeW5jIGNsb3NlZCgpIHsKICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy4jY2xvc2VkUHJvbWlzZTsKICAgIH0KfQpjbGFzcyBBbXFwQ2xpZW50IHsKICAgIGFzeW5jIGNvbm5lY3Qob3B0aW9ucykgewogICAgICAgIHRoaXMuZ2VuZXJhbE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsKICAgICAgICB9LCB7CiAgICAgICAgICAgIHRyYW5zcG9ydDogb3B0aW9ucy50cmFuc3BvcnQsCiAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgIGhvc3Q6IG9wdGlvbnMub3B0aW9ucy5ob3N0LAogICAgICAgICAgICAgICAgcG9ydDogb3B0aW9ucy5vcHRpb25zLnBvcnQsCiAgICAgICAgICAgICAgICByZXRyeUF0dGVtcHRzOiBvcHRpb25zLm9wdGlvbnMucmV0cnlBdHRlbXB0cywKICAgICAgICAgICAgICAgIHJldHJ5RGVsYXk6IG9wdGlvbnMub3B0aW9ucy5yZXRyeURlbGF5CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmZ1bGxDbGllbnRPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7CiAgICAgICAgfSwgb3B0aW9ucyk7CiAgICAgICAgdGhpcy5jb25uZWN0aW9uID0gYXdhaXQgRGVuby5jb25uZWN0KHsKICAgICAgICAgICAgcG9ydDogdGhpcy5nZW5lcmFsT3B0aW9ucy5vcHRpb25zLnBvcnQgfHwgQ2xpZW50VXRpbC5nZXREZWZhdWx0UG9ydCh0aGlzLmdlbmVyYWxPcHRpb25zLnRyYW5zcG9ydCksCiAgICAgICAgICAgIGhvc3RuYW1lOiB0aGlzLmdlbmVyYWxPcHRpb25zLm9wdGlvbnMuaG9zdAogICAgICAgIH0pOwogICAgICAgIHRoaXMucmVhZGVyID0gbmV3IEJ1ZlJlYWRlcih0aGlzLmNvbm5lY3Rpb24pOwogICAgICAgIHRoaXMud3JpdGVyID0gbmV3IEJ1ZldyaXRlcih0aGlzLmNvbm5lY3Rpb24pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXV0aGVudGljYXRlKG9wdGlvbnMub3B0aW9ucyk7CiAgICAgICAgICAgIHRoaXMuY29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgICAgICB0aGlzLmNsb3NlQ29ubmVjdGlvbigpOwogICAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9CiAgICB9CiAgICBhc3luYyBhdXRoZW50aWNhdGUoZGF0YSkgewogICAgICAgIGNvbnN0IHsgdXNlcm5hbWUgLCBwYXNzd29yZCAsIGhlYXJ0YmVhdEludGVydmFsICwgZnJhbWVNYXggLCBsb2dsZXZlbCAsIHZob3N0ICB9ID0gZGF0YTsKICAgICAgICBjb25zdCBzb2NrZXQxID0gbmV3IEFtcXBTb2NrZXQodGhpcy5nZXRDb25uZWN0aW9uKCkpOwogICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBuZXcgQW1xcENvbm5lY3Rpb24oc29ja2V0MSwgewogICAgICAgICAgICB1c2VybmFtZSwKICAgICAgICAgICAgcGFzc3dvcmQsCiAgICAgICAgICAgIGhlYXJ0YmVhdEludGVydmFsLAogICAgICAgICAgICBmcmFtZU1heCwKICAgICAgICAgICAgbG9nbGV2ZWwsCiAgICAgICAgICAgIHZob3N0CiAgICAgICAgfSk7CiAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5vcGVuKCk7CiAgICAgICAgdGhpcy5hbXFwQ29ubmVjdGlvbiA9IGNvbm5lY3Rpb247CiAgICB9CiAgICByZWNvbm5lY3QoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNZXRob2Qgbm90IGltcGxlbWVudGVkLiIpOwogICAgfQogICAgZ2V0Q29ubmVjdGlvbk9wdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZnVsbENsaWVudE9wdGlvbnM7CiAgICB9CiAgICBnZXRSZWFkZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVhZGVyOwogICAgfQogICAgZ2V0V3JpdGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLndyaXRlcjsKICAgIH0KICAgIGdldENvbm5lY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbjsKICAgIH0KICAgIGNsb3NlQ29ubmVjdGlvbigpIHsKICAgICAgICB0aGlzLmNsb3NlZCA9IHRydWU7CiAgICAgICAgdGhpcy5jb25uZWN0aW9uLmNsb3NlKCk7CiAgICB9CiAgICBnZXRSZXRyeUF0dGVtcHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29ubmVjdGlvbk9wdGlvbnMoKS5vcHRpb25zLnJldHJ5QXR0ZW1wdHMgfHwgMzsKICAgIH0KICAgIGdldFJldHJ5RGVsYXkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29ubmVjdGlvbk9wdGlvbnMoKS5vcHRpb25zLnJldHJ5RGVsYXkgfHwgMTAwMDsKICAgIH0KICAgIGlzQ29ubmVjdGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3RlZDsKICAgIH0KICAgIGlzQ2xvc2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLmNsb3NlZDsKICAgIH0KICAgIGdldEFzKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0U3Vic2NyaWJlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5hbXFwQ29ubmVjdGlvbjsKICAgIH0KICAgIGFzeW5jICpyZWNlaXZlKHF1ZXVlTmFtZSkgewogICAgICAgIGlmICghdGhpcy5jaGFubmVsKSB7CiAgICAgICAgICAgIHRoaXMuY2hhbm5lbCA9IGF3YWl0IHRoaXMuZ2V0U3Vic2NyaWJlcigpLm9wZW5DaGFubmVsKCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2hhbm5lbC5kZWNsYXJlUXVldWUoewogICAgICAgICAgICAgICAgcXVldWU6IHF1ZXVlTmFtZQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgd2hpbGUodGhpcy5pc0Nvbm5lY3RlZCgpKXsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc29sdmFibGUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+ewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhbm5lbC5jb25zdW1lKHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6IHF1ZXVlTmFtZQogICAgICAgICAgICAgICAgICAgIH0sIGFzeW5jIChhcmdzLCBwcm9wcywgZGF0YTIpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJncywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2hhbm5lbC5hY2soewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGl2ZXJ5VGFnOiBhcmdzLmRlbGl2ZXJ5VGFnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzb2x2YWJsZTsKICAgICAgICAgICAgICAgIHlpZWxkIHJlc3VsdDsKICAgICAgICAgICAgfSBjYXRjaCAgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZ2V0RGVmYXVsdFBvcnQoKSB7CiAgICAgICAgcmV0dXJuIDU2NzI7CiAgICB9Cn0KY2xhc3MgRU9GRXJyb3IgZXh0ZW5kcyBFcnJvciB7Cn0KY2xhc3MgRXJyb3JSZXBseUVycm9yIGV4dGVuZHMgRXJyb3Igewp9CmNsYXNzIEludmFsaWRTdGF0ZUVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgY29uc3RydWN0b3IoKXsKICAgICAgICBzdXBlcigiSW52YWxpZCBzdGF0ZSIpOwogICAgfQp9CmNvbnN0IEludGVnZXJSZXBseUNvZGUgPSAiOiIuY2hhckNvZGVBdCgwKTsKY29uc3QgQnVsa1JlcGx5Q29kZSA9ICIkIi5jaGFyQ29kZUF0KDApOwpjb25zdCBTaW1wbGVTdHJpbmdDb2RlID0gIisiLmNoYXJDb2RlQXQoMCk7CmNvbnN0IEFycmF5UmVwbHlDb2RlID0gIioiLmNoYXJDb2RlQXQoMCk7CmNvbnN0IEVycm9yUmVwbHlDb2RlID0gIi0iLmNoYXJDb2RlQXQoMCk7CmNsYXNzIFJlZGlzVXRpbCB7CiAgICBzdGF0aWMgYXN5bmMgcmVhZExpbmUocmVhZGVyKSB7CiAgICAgICAgY29uc3QgYnVmID0gbmV3IFVpbnQ4QXJyYXkoMTAyNCk7CiAgICAgICAgbGV0IGxvYyA9IDA7CiAgICAgICAgbGV0IGQgPSBudWxsOwogICAgICAgIHdoaWxlKChkID0gYXdhaXQgcmVhZGVyLnJlYWRCeXRlKCkpICYmIGQgIT09IG51bGwpewogICAgICAgICAgICBpZiAoZCA9PT0gIlxyIi5jaGFyQ29kZUF0KDApKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkMSA9IGF3YWl0IHJlYWRlci5yZWFkQnl0ZSgpOwogICAgICAgICAgICAgICAgaWYgKGQxID09PSAiXG4iLmNoYXJDb2RlQXQoMCkpIHsKICAgICAgICAgICAgICAgICAgICBidWZbbG9jKytdID0gZDsKICAgICAgICAgICAgICAgICAgICBidWZbbG9jKytdID0gZDE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZXIuZGVjb2RlKG5ldyBEZW5vLkJ1ZmZlcihidWYuc3ViYXJyYXkoMCwgbG9jKSkuYnl0ZXMoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnVmW2xvYysrXSA9IGQ7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcigpOwogICAgfQogICAgc3RhdGljIGFzeW5jIHJlYWRSZXBseShyZWFkZXIpIHsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZWFkZXIucGVlaygxKTsKICAgICAgICBpZiAocmVzID09PSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFT0ZFcnJvcigpOwogICAgICAgIH0KICAgICAgICBzd2l0Y2gocmVzWzBdKXsKICAgICAgICAgICAgY2FzZSBJbnRlZ2VyUmVwbHlDb2RlOgogICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAiaW50ZWdlciIsCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWFkSW50ZWdlclJlcGx5KHJlYWRlcikKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIGNhc2UgU2ltcGxlU3RyaW5nQ29kZToKICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyIsCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWFkU3RhdHVzUmVwbHkocmVhZGVyKQogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgY2FzZSBCdWxrUmVwbHlDb2RlOgogICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAiYnVsayIsCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWFkQnVsa1JlcGx5KHJlYWRlcikKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIGNhc2UgQXJyYXlSZXBseUNvZGU6CiAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICJhcnJheSIsCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWFkQXJyYXlSZXBseShyZWFkZXIpCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICBjYXNlIEVycm9yUmVwbHlDb2RlOgogICAgICAgICAgICAgICAgdGhpcy50cnlQYXJzZUVycm9yUmVwbHkoYXdhaXQgdGhpcy5yZWFkTGluZShyZWFkZXIpKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUVycm9yKCk7CiAgICB9CiAgICBzdGF0aWMgY3JlYXRlUmVxdWVzdChjb21tYW5kLCBhcmdzKSB7CiAgICAgICAgY29uc3QgX2FyZ3MgPSBhcmdzLmZpbHRlcigodik9PnYgIT09IHZvaWQgMCAmJiB2ICE9PSBudWxsCiAgICAgICAgKTsKICAgICAgICBsZXQgbXNnMSA9ICIiOwogICAgICAgIG1zZzEgKz0gYCokezEgKyBfYXJncy5sZW5ndGh9XHJcbmA7CiAgICAgICAgbXNnMSArPSBgJCR7Y29tbWFuZC5sZW5ndGh9XHJcbmA7CiAgICAgICAgbXNnMSArPSBgJHtjb21tYW5kfVxyXG5gOwogICAgICAgIGZvciAoY29uc3QgYXJnIG9mIF9hcmdzKXsKICAgICAgICAgICAgY29uc3QgdmFsID0gU3RyaW5nKGFyZyk7CiAgICAgICAgICAgIGNvbnN0IGJ5dGVzTGVuID0gZW5jb2Rlci5lbmNvZGUodmFsKS5ieXRlTGVuZ3RoOwogICAgICAgICAgICBtc2cxICs9IGAkJHtieXRlc0xlbn1cclxuYDsKICAgICAgICAgICAgbXNnMSArPSBgJHt2YWx9XHJcbmA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtc2cxOwogICAgfQogICAgc3RhdGljIGFzeW5jIHNlbmRDb21tYW5kKHdyaXRlciwgcmVhZGVyLCBjb21tYW5kLCAuLi5hcmdzKSB7CiAgICAgICAgY29uc3QgbXNnMSA9IHRoaXMuY3JlYXRlUmVxdWVzdChjb21tYW5kLCBhcmdzKTsKICAgICAgICBhd2FpdCB3cml0ZXIud3JpdGUoZW5jb2Rlci5lbmNvZGUobXNnMSkpOwogICAgICAgIGF3YWl0IHdyaXRlci5mbHVzaCgpOwogICAgICAgIHJldHVybiB0aGlzLnJlYWRSZXBseShyZWFkZXIpOwogICAgfQogICAgc3RhdGljIGFzeW5jIHJlYWRTdGF0dXNSZXBseShyZWFkZXIpIHsKICAgICAgICBjb25zdCBsaW5lID0gYXdhaXQgdGhpcy5yZWFkTGluZShyZWFkZXIpOwogICAgICAgIGlmIChsaW5lWzBdID09PSAiKyIpIHsKICAgICAgICAgICAgcmV0dXJuIGxpbmUuc3Vic3RyKDEsIGxpbmUubGVuZ3RoIC0gMyk7CiAgICAgICAgfQogICAgICAgIHRoaXMudHJ5UGFyc2VFcnJvclJlcGx5KGxpbmUpOwogICAgfQogICAgc3RhdGljIGFzeW5jIHJlYWRJbnRlZ2VyUmVwbHkocmVhZGVyKSB7CiAgICAgICAgY29uc3QgbGluZSA9IGF3YWl0IHRoaXMucmVhZExpbmUocmVhZGVyKTsKICAgICAgICBpZiAobGluZVswXSA9PT0gIjoiKSB7CiAgICAgICAgICAgIGNvbnN0IHN0ciA9IGxpbmUuc3Vic3RyKDEsIGxpbmUubGVuZ3RoIC0gMyk7CiAgICAgICAgICAgIHJldHVybiBwYXJzZUludChzdHIpOwogICAgICAgIH0KICAgICAgICB0aGlzLnRyeVBhcnNlRXJyb3JSZXBseShsaW5lKTsKICAgIH0KICAgIHN0YXRpYyBhc3luYyByZWFkQnVsa1JlcGx5KHJlYWRlcikgewogICAgICAgIGNvbnN0IGxpbmUgPSBhd2FpdCB0aGlzLnJlYWRMaW5lKHJlYWRlcik7CiAgICAgICAgaWYgKGxpbmVbMF0gIT09ICIkIikgewogICAgICAgICAgICB0aGlzLnRyeVBhcnNlRXJyb3JSZXBseShsaW5lKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc2l6ZVN0ciA9IGxpbmUuc3Vic3RyKDEsIGxpbmUubGVuZ3RoIC0gMyk7CiAgICAgICAgY29uc3Qgc2l6ZTggPSBwYXJzZUludChzaXplU3RyKTsKICAgICAgICBpZiAoc2l6ZTggPCAwKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRlc3QgPSBuZXcgVWludDhBcnJheShzaXplOCArIDIpOwogICAgICAgIGF3YWl0IHJlYWRlci5yZWFkRnVsbChkZXN0KTsKICAgICAgICByZXR1cm4gZGVjb2Rlci5kZWNvZGUobmV3IERlbm8uQnVmZmVyKGRlc3Quc3ViYXJyYXkoMCwgZGVzdC5sZW5ndGggLSAyKSkuYnl0ZXMoKSk7CiAgICB9CiAgICBzdGF0aWMgYXN5bmMgcmVhZEFycmF5UmVwbHkocmVhZGVyKSB7CiAgICAgICAgY29uc3QgbGluZSA9IGF3YWl0IHRoaXMucmVhZExpbmUocmVhZGVyKTsKICAgICAgICBjb25zdCBhcmdDb3VudCA9IHBhcnNlSW50KGxpbmUuc3Vic3RyKDEsIGxpbmUubGVuZ3RoIC0gMykpOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBhcmdDb3VudDsgaSsrKXsKICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVhZGVyLnBlZWsoMSk7CiAgICAgICAgICAgIGlmIChyZXMgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFT0ZFcnJvcigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN3aXRjaChyZXNbMF0pewogICAgICAgICAgICAgICAgY2FzZSBTaW1wbGVTdHJpbmdDb2RlOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGF3YWl0IHRoaXMucmVhZFN0YXR1c1JlcGx5KHJlYWRlcikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBCdWxrUmVwbHlDb2RlOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGF3YWl0IHRoaXMucmVhZEJ1bGtSZXBseShyZWFkZXIpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSW50ZWdlclJlcGx5Q29kZToKICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChhd2FpdCB0aGlzLnJlYWRJbnRlZ2VyUmVwbHkocmVhZGVyKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFycmF5UmVwbHlDb2RlOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGF3YWl0IHRoaXMucmVhZEFycmF5UmVwbHkocmVhZGVyKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIHN0YXRpYyB0cnlQYXJzZUVycm9yUmVwbHkobGluZSkgewogICAgICAgIGNvbnN0IGNvZGUxID0gbGluZVswXTsKICAgICAgICBpZiAoY29kZTEgPT09ICItIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3JSZXBseUVycm9yKGxpbmUpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgbGluZTogJHtsaW5lfWApOwogICAgfQp9CmNsYXNzIFJlZGlzU3Vic2NyaXB0aW9uIHsKICAgIHBhdHRlcm5zID0gewogICAgfTsKICAgIGNoYW5uZWxzID0gewogICAgfTsKICAgIGNvbnN0cnVjdG9yKHJlZGlzQ2xpZW50KXsKICAgICAgICB0aGlzLnJlZGlzQ2xpZW50ID0gcmVkaXNDbGllbnQ7CiAgICB9CiAgICBhc3luYyBwYXR0ZXJuU3Vic2NyaWJlKC4uLnBhdHRlcm5zKSB7CiAgICAgICAgYXdhaXQgUmVkaXNVdGlsLnNlbmRDb21tYW5kKHRoaXMucmVkaXNDbGllbnQuZ2V0V3JpdGVyKCksIHRoaXMucmVkaXNDbGllbnQuZ2V0UmVhZGVyKCksICJQU1VCU0NSSUJFIiwgLi4ucGF0dGVybnMpOwogICAgICAgIGZvciAoY29uc3QgcGF0IG9mIHBhdHRlcm5zKXsKICAgICAgICAgICAgdGhpcy5wYXR0ZXJuc1twYXRdID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CiAgICBhc3luYyBwYXR0ZXJuVW5zdWJzY3JpYmUoLi4ucGF0dGVybnMpIHsKICAgICAgICBhd2FpdCBSZWRpc1V0aWwuc2VuZENvbW1hbmQodGhpcy5yZWRpc0NsaWVudC5nZXRXcml0ZXIoKSwgdGhpcy5yZWRpc0NsaWVudC5nZXRSZWFkZXIoKSwgIlBVTlNVQlNDUklCRSIsIC4uLnBhdHRlcm5zKTsKICAgICAgICBmb3IgKGNvbnN0IHBhdCBvZiBwYXR0ZXJucyl7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBhdHRlcm5zW3BhdF07CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgY2hhbm5lbFN1YnNjcmliZSguLi5jaGFubmVscykgewogICAgICAgIGF3YWl0IFJlZGlzVXRpbC5zZW5kQ29tbWFuZCh0aGlzLnJlZGlzQ2xpZW50LmdldFdyaXRlcigpLCB0aGlzLnJlZGlzQ2xpZW50LmdldFJlYWRlcigpLCAiU1VCU0NSSUJFIiwgLi4uY2hhbm5lbHMpOwogICAgICAgIGZvciAoY29uc3QgY2hhbiBvZiBjaGFubmVscyl7CiAgICAgICAgICAgIHRoaXMuY2hhbm5lbHNbY2hhbl0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFzeW5jIGNoYW5uZWxVbnN1YnNjcmliZSguLi5jaGFubmVscykgewogICAgICAgIGF3YWl0IFJlZGlzVXRpbC5zZW5kQ29tbWFuZCh0aGlzLnJlZGlzQ2xpZW50LmdldFdyaXRlcigpLCB0aGlzLnJlZGlzQ2xpZW50LmdldFJlYWRlcigpLCAiVU5TVUJTQ1JJQkUiLCAuLi5jaGFubmVscyk7CiAgICAgICAgZm9yIChjb25zdCBjaGFuIG9mIGNoYW5uZWxzKXsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2hhbm5lbHNbY2hhbl07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYXN5bmMgKnJlY2VpdmUoKSB7CiAgICAgICAgbGV0IGZvcmNlUmVjb25uZWN0ID0gZmFsc2U7CiAgICAgICAgd2hpbGUodGhpcy5yZWRpc0NsaWVudC5pc0Nvbm5lY3RlZCgpKXsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxldCByZXA7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJlcCA9IGF3YWl0IFJlZGlzVXRpbC5yZWFkQXJyYXlSZXBseSh0aGlzLnJlZGlzQ2xpZW50LmdldFJlYWRlcigpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBEZW5vLmVycm9ycy5CYWRSZXNvdXJjZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZGlzQ2xpZW50LmNsb3NlQ29ubmVjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgZXYgPSByZXBbMF07CiAgICAgICAgICAgICAgICBpZiAoZXYgPT09ICJtZXNzYWdlIiAmJiByZXAubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgeWllbGQgewogICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsOiByZXBbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlcFsyXQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ID09PSAicG1lc3NhZ2UiICYmIHJlcC5sZW5ndGggPT09IDQpIHsKICAgICAgICAgICAgICAgICAgICB5aWVsZCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm46IHJlcFsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbDogcmVwWzJdLAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXBbM10KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgSW52YWxpZFN0YXRlRXJyb3IgfHwgZXJyb3IgaW5zdGFuY2VvZiBEZW5vLmVycm9ycy5CYWRSZXNvdXJjZSkgewogICAgICAgICAgICAgICAgICAgIGZvcmNlUmVjb25uZWN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB0aHJvdyBlcnJvcjsKICAgICAgICAgICAgfSBmaW5hbGx5ewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlZGlzQ2xpZW50LmlzQ2xvc2VkKCkgJiYgIXRoaXMucmVkaXNDbGllbnQuaXNDb25uZWN0ZWQoKSB8fCBmb3JjZVJlY29ubmVjdCkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucmVkaXNDbGllbnQucmVjb25uZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgZm9yY2VSZWNvbm5lY3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5jaGFubmVscykubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNoYW5uZWxTdWJzY3JpYmUoLi4uT2JqZWN0LmtleXModGhpcy5jaGFubmVscykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5wYXR0ZXJucykubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBhdHRlcm5TdWJzY3JpYmUoLi4uT2JqZWN0LmtleXModGhpcy5wYXR0ZXJucykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIGNsb3NlKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2hhbm5lbFVuc3Vic2NyaWJlKC4uLk9iamVjdC5rZXlzKHRoaXMuY2hhbm5lbHMpKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5wYXR0ZXJuVW5zdWJzY3JpYmUoLi4uT2JqZWN0LmtleXModGhpcy5wYXR0ZXJucykpOwogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgdGhpcy5yZWRpc0NsaWVudC5jbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICB9CiAgICB9Cn0KY2xhc3MgUmVkaXNDbGllbnQgewogICAgYXN5bmMgY29ubmVjdChvcHRpb25zKSB7CiAgICAgICAgdGhpcy5nZW5lcmFsT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oewogICAgICAgIH0sIHsKICAgICAgICAgICAgdHJhbnNwb3J0OiBvcHRpb25zLnRyYW5zcG9ydCwKICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgaG9zdDogb3B0aW9ucy5vcHRpb25zLmhvc3QsCiAgICAgICAgICAgICAgICBwb3J0OiBvcHRpb25zLm9wdGlvbnMucG9ydCwKICAgICAgICAgICAgICAgIHJldHJ5QXR0ZW1wdHM6IG9wdGlvbnMub3B0aW9ucy5yZXRyeUF0dGVtcHRzLAogICAgICAgICAgICAgICAgcmV0cnlEZWxheTogb3B0aW9ucy5vcHRpb25zLnJldHJ5RGVsYXkKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZnVsbENsaWVudE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsKICAgICAgICB9LCBvcHRpb25zKTsKICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBhd2FpdCBEZW5vLmNvbm5lY3QoewogICAgICAgICAgICBwb3J0OiB0aGlzLmdlbmVyYWxPcHRpb25zLm9wdGlvbnMucG9ydCB8fCBDbGllbnRVdGlsLmdldERlZmF1bHRQb3J0KHRoaXMuZ2VuZXJhbE9wdGlvbnMudHJhbnNwb3J0KSwKICAgICAgICAgICAgaG9zdG5hbWU6IHRoaXMuZ2VuZXJhbE9wdGlvbnMub3B0aW9ucy5ob3N0CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5yZWFkZXIgPSBuZXcgQnVmUmVhZGVyKHRoaXMuY29ubmVjdGlvbik7CiAgICAgICAgdGhpcy53cml0ZXIgPSBuZXcgQnVmV3JpdGVyKHRoaXMuY29ubmVjdGlvbik7CiAgICAgICAgY29uc3QgeyB1c2VybmFtZSAsIHBhc3N3b3JkICB9ID0gb3B0aW9ucy5vcHRpb25zOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXV0aGVudGljYXRlKHsKICAgICAgICAgICAgICAgIHVzZXJuYW1lLAogICAgICAgICAgICAgICAgcGFzc3dvcmQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuY29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgdGhpcy5jbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgYXV0aGVudGljYXRlKGRhdGEpIHsKICAgICAgICBjb25zdCB7IHVzZXJuYW1lICwgcGFzc3dvcmQgIH0gPSBkYXRhOwogICAgICAgIGlmIChwYXNzd29yZCAmJiAhdXNlcm5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIFJlZGlzVXRpbC5zZW5kQ29tbWFuZCh0aGlzLndyaXRlciwgdGhpcy5yZWFkZXIsICJBVVRIIiwgcGFzc3dvcmQpOwogICAgICAgIH0gZWxzZSBpZiAocGFzc3dvcmQgJiYgdXNlcm5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIFJlZGlzVXRpbC5zZW5kQ29tbWFuZCh0aGlzLndyaXRlciwgdGhpcy5yZWFkZXIsICJBVVRIIiwgdXNlcm5hbWUsIHBhc3N3b3JkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTsKICAgICAgICB9CiAgICB9CiAgICBhc3luYyByZWNvbm5lY3QoKSB7CiAgICAgICAgaWYgKCF0aGlzLnJlYWRlci5wZWVrKDEpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2xpZW50IGlzIGNsb3NlZC4iKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgUmVkaXNVdGlsLnNlbmRDb21tYW5kKHRoaXMud3JpdGVyLCB0aGlzLnJlYWRlciwgIlBJTkciKTsKICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGxldCByZXRyaWVzID0gMDsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc29sdmFibGUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+ewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlY29ubmVjdGlvbkludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCk9PnsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldHJpZXMgPiB0aGlzLmdldFJldHJ5QXR0ZW1wcygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlQ29ubmVjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChyZWNvbm5lY3Rpb25JbnRlcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJDb3VsZCBub3QgcmUtZXN0YWJsaXNoIGNvbm5lY3Rpb24iKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNvbm5lY3QodGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFJlZGlzVXRpbC5zZW5kQ29tbWFuZCh0aGlzLmdldFdyaXRlcigpLCB0aGlzLmdldFJlYWRlcigpLCAiUElORyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0cmllcyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHJlY29ubmVjdGlvbkludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHJpZXMgPSByZXRyaWVzICsgMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuZ2V0UmV0cnlEZWxheSgpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYXdhaXQgcmVzb2x2YWJsZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGdldENvbm5lY3Rpb25PcHRpb25zKCkgewogICAgICAgIHJldHVybiB0aGlzLmZ1bGxDbGllbnRPcHRpb25zOwogICAgfQogICAgZ2V0UmVhZGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLnJlYWRlcjsKICAgIH0KICAgIGdldFdyaXRlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy53cml0ZXI7CiAgICB9CiAgICBnZXRDb25uZWN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb247CiAgICB9CiAgICBjbG9zZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgdGhpcy5jbG9zZWQgPSB0cnVlOwogICAgICAgIHRoaXMuY29ubmVjdGlvbi5jbG9zZSgpOwogICAgfQogICAgZ2V0UmV0cnlBdHRlbXBzKCkgewogICAgICAgIHJldHVybiB0aGlzLmdldENvbm5lY3Rpb25PcHRpb25zKCkub3B0aW9ucy5yZXRyeUF0dGVtcHRzIHx8IDM7CiAgICB9CiAgICBnZXRSZXRyeURlbGF5KCkgewogICAgICAgIHJldHVybiB0aGlzLmdldENvbm5lY3Rpb25PcHRpb25zKCkub3B0aW9ucy5yZXRyeURlbGF5IHx8IDEwMDA7CiAgICB9CiAgICBpc0Nvbm5lY3RlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0ZWQ7CiAgICB9CiAgICBpc0Nsb3NlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jbG9zZWQ7CiAgICB9CiAgICBnZXRBcygpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFzeW5jICpyZWNlaXZlKCkgewogICAgICAgIHJldHVybiB0aGlzLmdldFN1YnNjcmliZXIoKS5yZWNlaXZlKCk7CiAgICB9CiAgICBnZXRTdWJzY3JpYmVyKCkgewogICAgICAgIGlmICh0aGlzLnJlZGlzU3Vic2NyaXB0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5yZWRpc1N1YnNjcmlwdGlvbiA9IG5ldyBSZWRpc1N1YnNjcmlwdGlvbih0aGlzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMucmVkaXNTdWJzY3JpcHRpb247CiAgICB9CiAgICBleGVjKGNvbW1hbmQsIC4uLmFyZ3MpIHsKICAgICAgICByZXR1cm4gUmVkaXNVdGlsLnNlbmRDb21tYW5kKHRoaXMuZ2V0V3JpdGVyKCksIHRoaXMuZ2V0UmVhZGVyKCksIGNvbW1hbmQsIC4uLmFyZ3MpOwogICAgfQogICAgZ2V0RGVmYXVsdFBvcnQoKSB7CiAgICAgICAgcmV0dXJuIDYzNzk7CiAgICB9Cn0KY2xhc3MgTkFUU2Vycm9yIGV4dGVuZHMgRXJyb3Igewp9CmNsYXNzIE5hdHNVdGlsIHsKICAgIHN0YXRpYyBhc3luYyB3cml0ZUluKHdyaXRlciwgbWVzc2FnZSkgewogICAgICAgIGF3YWl0IHdyaXRlci53cml0ZShlbmNvZGVyLmVuY29kZShtZXNzYWdlKSk7CiAgICAgICAgYXdhaXQgd3JpdGVyLmZsdXNoKCk7CiAgICB9CiAgICBzdGF0aWMgYXN5bmMgcmVhZExpbmUocmVhZGVyKSB7CiAgICAgICAgY29uc3QgYnVmID0gbmV3IFVpbnQ4QXJyYXkoMTAyNCk7CiAgICAgICAgbGV0IGxvYyA9IDA7CiAgICAgICAgbGV0IGQgPSBudWxsOwogICAgICAgIHdoaWxlKChkID0gYXdhaXQgcmVhZGVyLnJlYWRCeXRlKCkpICYmIGQgIT09IG51bGwpewogICAgICAgICAgICBpZiAoZCA9PT0gIlxyIi5jaGFyQ29kZUF0KDApKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkMSA9IGF3YWl0IHJlYWRlci5yZWFkQnl0ZSgpOwogICAgICAgICAgICAgICAgaWYgKGQxID09PSAiXG4iLmNoYXJDb2RlQXQoMCkpIHsKICAgICAgICAgICAgICAgICAgICBidWZbbG9jKytdID0gZDsKICAgICAgICAgICAgICAgICAgICBidWZbbG9jKytdID0gZDE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZXIuZGVjb2RlKG5ldyBEZW5vLkJ1ZmZlcihidWYuc3ViYXJyYXkoMCwgbG9jKSkuYnl0ZXMoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnVmW2xvYysrXSA9IGQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIHN0YXRpYyBjcmVhdGVSZXF1ZXN0KHBheWxvYWQpIHsKICAgICAgICByZXR1cm4gYCR7cGF5bG9hZH1cclxuYDsKICAgIH0KICAgIHN0YXRpYyBhc3luYyBzZW5kQ29tbWFuZCh3cml0ZXIsIHJlYWRlciwgcGF5bG9hZCkgewogICAgICAgIGF3YWl0IE5hdHNVdGlsLndyaXRlSW4od3JpdGVyLCBOYXRzVXRpbC5jcmVhdGVSZXF1ZXN0KHBheWxvYWQpKTsKICAgICAgICBjb25zdCBbbWVzc2FnZTMsIHN0YXR1c10gPSBbCiAgICAgICAgICAgIGF3YWl0IHRoaXMucmVhZExpbmUocmVhZGVyKSwKICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWFkTGluZShyZWFkZXIpCiAgICAgICAgXTsKICAgICAgICBjb25zdCBpc09rID0gTmF0c1V0aWwudmFsaWRhdGVTdGF0dXMoc3RhdHVzKTsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICBtZXNzYWdlMywKICAgICAgICAgICAgc3RhdHVzLAogICAgICAgICAgICBpc09rCiAgICAgICAgXTsKICAgIH0KICAgIHN0YXRpYyBwcm9jZXNzUmVzcG9uc2UocmVzcG9uc2UpIHsKICAgICAgICByZXR1cm4gcmVzcG9uc2UubGFzdEluZGV4T2YoIlxyXG4iKTsKICAgIH0KICAgIHN0YXRpYyBhc3luYyBjb25uZWN0KHdyaXRlciwgcmVhZGVyLCBkYXRhKSB7CiAgICAgICAgbGV0IGNvbW1hbmQgPSBgQ09OTkVDVGA7CiAgICAgICAgY29tbWFuZCArPSBgICR7SlNPTi5zdHJpbmdpZnkoZGF0YSl9YDsKICAgICAgICBsZXQgW3NlcnZlckRhdGFSZXNwb25zZSwgZXJyb3JTdGF0dXMsIGlzT2tdID0gYXdhaXQgdGhpcy5zZW5kQ29tbWFuZCh3cml0ZXIsIHJlYWRlciwgY29tbWFuZCk7CiAgICAgICAgaWYgKHNlcnZlckRhdGFSZXNwb25zZS5pbmNsdWRlcygiSU5GTyIpKSB7CiAgICAgICAgICAgIHNlcnZlckRhdGFSZXNwb25zZSA9IHNlcnZlckRhdGFSZXNwb25zZS5yZXBsYWNlKCJJTkZPICIsICIiKS50cmltKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIHNlcnZlckRhdGFSZXNwb25zZSwKICAgICAgICAgICAgZXJyb3JTdGF0dXMsCiAgICAgICAgICAgIGlzT2sKICAgICAgICBdOwogICAgfQogICAgc3RhdGljIHZhbGlkYXRlU3RhdHVzKG9rTGluZSkgewogICAgICAgIGNvbnN0IGlzRXJyb3IgPSBva0xpbmUuc3RhcnRzV2l0aCgiLUVSUiIpOwogICAgICAgIGlmIChpc0Vycm9yKSB7CiAgICAgICAgICAgIGxldCBbLCBlcnJvcl0gPSBva0xpbmUuc3Vic3RyKDEpLnNwbGl0KCJFUlIgIik7CiAgICAgICAgICAgIHRocm93IG5ldyBOQVRTZXJyb3IoYChOQVRTKSAke2Vycm9yfWApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHN0YXRpYyBhc3luYyBleGVjKHdyaXRlciwgcmVhZGVyLCBwYXlsb2FkKSB7CiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VuZENvbW1hbmQod3JpdGVyLCByZWFkZXIsIHBheWxvYWQpOwogICAgfQogICAgc3RhdGljIGdldE1lc3NhZ2VUeXBlRnJvbUhlYWRlcihoZWFkZXIpIHsKICAgICAgICBpZiAoaGVhZGVyLmluY2x1ZGVzKCJQSU5HIikpIHsKICAgICAgICAgICAgcmV0dXJuICJQSU5HIjsKICAgICAgICB9IGVsc2UgaWYgKGhlYWRlci5pbmNsdWRlcygiUE9ORyIpKSB7CiAgICAgICAgICAgIHJldHVybiAiUE9ORyI7CiAgICAgICAgfSBlbHNlIGlmIChoZWFkZXIuaW5jbHVkZXMoIk1TRyIpKSB7CiAgICAgICAgICAgIHJldHVybiAiTVNHIjsKICAgICAgICB9IGVsc2UgaWYgKGhlYWRlci5pbmNsdWRlcygiSU5GTyIpKSB7CiAgICAgICAgICAgIHJldHVybiAiSU5GTyI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICJPVEhFUiI7CiAgICAgICAgfQogICAgfQp9CmNvbnN0IHJlcGxhY2VMYXN0ID0gKHgsIHksIHopPT57CiAgICB2YXIgYSA9IHguc3BsaXQoIiIpOwogICAgYVt4Lmxhc3RJbmRleE9mKHkpXSA9IHo7CiAgICByZXR1cm4gYS5qb2luKCIiKTsKfTsKY2xhc3MgTmF0c1N1YnNjcmlwdGlvbiB7CiAgICBwYXR0ZXJucyA9IHsKICAgIH07CiAgICBjb25zdHJ1Y3RvcihuYXRzQ2xpZW50KXsKICAgICAgICB0aGlzLm5hdHNDbGllbnQgPSBuYXRzQ2xpZW50OwogICAgfQogICAgYXN5bmMgc3Vic2NyaWJlKHN1YmplY3QsIHF1ZXVlR3JvdXApIHsKICAgICAgICBpZiAoc3ViamVjdC5pbmNsdWRlcygiICIpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOQVRTZXJyb3IoIlRoZSBzdWJqZWN0IG9mIGEgc3Vic2NyaXB0aW9uIGNhbm5vdCBjb250YWluIHdoaXRlIHNwYWNlcyIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjbGllbnRJZCA9IHRoaXMubmF0c0NsaWVudC5nZXROYXRzU2VydmVyRGF0YSgpLmNsaWVudF9pZDsKICAgICAgICBpZiAoY2xpZW50SWQpIHsKICAgICAgICAgICAgaWYgKHF1ZXVlR3JvdXApIHsKICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLm5hdHNDbGllbnQuZXhlYyhgU1VCICR7c3ViamVjdH0gJHtxdWV1ZUdyb3VwfSAke2NsaWVudElkfWApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMubmF0c0NsaWVudC5leGVjKGBTVUIgJHtzdWJqZWN0fSAke2NsaWVudElkfWApOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5BVFNlcnJvcigiQSBzdWJzY3JpcHRpb24gcmVxdWlyZXMgYSB2YWxpZCBjbGllbnQgaWQsIG1ha2Ugc3VyZSB5b3VyIGNvbm5lY3Rpb24gaXMgZXN0YWJsaXNoZWQuIik7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgdW5TdWJzY3JpYmUobWF4TWVzc2FnZXMpIHsKICAgICAgICBjb25zdCBjbGllbnRJZCA9IHRoaXMubmF0c0NsaWVudC5nZXROYXRzU2VydmVyRGF0YSgpLmNsaWVudF9pZDsKICAgICAgICBpZiAoY2xpZW50SWQpIHsKICAgICAgICAgICAgaWYgKG1heE1lc3NhZ2VzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRzQ2xpZW50LmV4ZWMoYFVOU1VCICR7Y2xpZW50SWR9ICR7bWF4TWVzc2FnZXN9YCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRzQ2xpZW50LmV4ZWMoYFVOU1VCICR7Y2xpZW50SWR9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgTkFUU2Vycm9yKCJOQVRTIGNhbm5vdCB1bnN1YnNjcmliZSBhbiB1bmV4aXN0ZW50IGNsaWVudCIpOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIHB1Ymxpc2goc3ViamVjdCwgcGF5bG9hZCwgcmVwbHlUbykgewogICAgICAgIGNvbnN0IGZpbmFsUGF5bG9hZCA9IHR5cGVvZiBwYXlsb2FkID09PSAib2JqZWN0IiA/IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpIDogcGF5bG9hZDsKICAgICAgICBpZiAocmVwbHlUbykgewogICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRzQ2xpZW50LmV4ZWMoYFBVQiAke3N1YmplY3R9ICR7cmVwbHlUb30gJHtmaW5hbFBheWxvYWQubGVuZ3RofVxyXG4ke2ZpbmFsUGF5bG9hZH1gKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRzQ2xpZW50LmV4ZWMoYFBVQiAke3N1YmplY3R9ICR7ZmluYWxQYXlsb2FkLmxlbmd0aH1cclxuJHtmaW5hbFBheWxvYWR9YCk7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgKnJlY2VpdmUoKSB7CiAgICAgICAgbGV0IGZvcmNlUmVjb25uZWN0ID0gZmFsc2U7CiAgICAgICAgd2hpbGUodGhpcy5uYXRzQ2xpZW50LmlzQ29ubmVjdGVkKCkpewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbGV0IHN1YnNNZXNzYWdlOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBhc3luYyAoKT0+YXdhaXQgTmF0c1V0aWwucmVhZExpbmUodGhpcy5uYXRzQ2xpZW50LmdldFJlYWRlcigpKQogICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXIgPSBhd2FpdCByZWFkZXIoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gTmF0c1V0aWwuZ2V0TWVzc2FnZVR5cGVGcm9tSGVhZGVyKGhlYWRlcik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICJNU0ciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UzID0gYXdhaXQgcmVhZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZE1lc3NhZ2UgPSByZXBsYWNlTGFzdChyZXBsYWNlTGFzdChtZXNzYWdlMywgIlxyIiwgIiIpLCAiXG4iLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjbGVhbkhlYWRlciA9IHJlcGxhY2VMYXN0KHJlcGxhY2VMYXN0KGhlYWRlciwgIlxyIiwgIiIpLCAiXG4iLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBbLCBzdWJqZWN0LCBzaWQsIHJlc3BvbnNlTGVuZ3RoXSA9IGNsZWFuSGVhZGVyLnNwbGl0KCIgIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNNZXNzYWdlID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lkOiBwYXJzZUludChzaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlTGVuZ3RoOiBwYXJzZUludChyZXNwb25zZUxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBwcm9jZXNzZWRNZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3Vic01lc3NhZ2UgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiBoZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiIgogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBEZW5vLmVycm9ycy5CYWRSZXNvdXJjZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdHNDbGllbnQuY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB5aWVsZCBzdWJzTWVzc2FnZTsKICAgICAgICAgICAgfSBmaW5hbGx5ewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLm5hdHNDbGllbnQuaXNDbG9zZWQoKSAmJiAhdGhpcy5uYXRzQ2xpZW50LmlzQ29ubmVjdGVkKCkgfHwgZm9yY2VSZWNvbm5lY3QpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm5hdHNDbGllbnQucmVjb25uZWN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KY2xhc3MgTmF0c0NsaWVudCB7CiAgICBuYXRzU2VydmVyRGF0YSA9IHsKICAgIH07CiAgICBhc3luYyBjb25uZWN0KG9wdGlvbnMpIHsKICAgICAgICBvcHRpb25zLm9wdGlvbnNbInZlcmJvc2UiXSA9IHRydWU7CiAgICAgICAgdGhpcy5nZW5lcmFsT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oewogICAgICAgIH0sIHsKICAgICAgICAgICAgdHJhbnNwb3J0OiBvcHRpb25zLnRyYW5zcG9ydCwKICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgaG9zdDogb3B0aW9ucy5vcHRpb25zLmhvc3QsCiAgICAgICAgICAgICAgICBwb3J0OiBvcHRpb25zLm9wdGlvbnMucG9ydCwKICAgICAgICAgICAgICAgIHJldHJ5QXR0ZW1wdHM6IG9wdGlvbnMub3B0aW9ucy5yZXRyeUF0dGVtcHRzLAogICAgICAgICAgICAgICAgcmV0cnlEZWxheTogb3B0aW9ucy5vcHRpb25zLnJldHJ5RGVsYXkKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZnVsbENsaWVudE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsKICAgICAgICB9LCBvcHRpb25zKTsKICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBhd2FpdCBEZW5vLmNvbm5lY3QoewogICAgICAgICAgICBwb3J0OiB0aGlzLmdlbmVyYWxPcHRpb25zLm9wdGlvbnMucG9ydCB8fCBDbGllbnRVdGlsLmdldERlZmF1bHRQb3J0KHRoaXMuZ2VuZXJhbE9wdGlvbnMudHJhbnNwb3J0KSwKICAgICAgICAgICAgaG9zdG5hbWU6IHRoaXMuZ2VuZXJhbE9wdGlvbnMub3B0aW9ucy5ob3N0CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5yZWFkZXIgPSBuZXcgQnVmUmVhZGVyKHRoaXMuY29ubmVjdGlvbik7CiAgICAgICAgdGhpcy53cml0ZXIgPSBuZXcgQnVmV3JpdGVyKHRoaXMuY29ubmVjdGlvbik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRoZW50aWNhdGUob3B0aW9ucy5vcHRpb25zKTsKICAgICAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLmNsb3NlZCA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICB0aGlzLmNsb3NlQ29ubmVjdGlvbigpOwogICAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9CiAgICB9CiAgICBhc3luYyBhdXRoZW50aWNhdGUoZGF0YSkgewogICAgICAgIGNvbnN0IFtyZXNwb25zZSwgZXJyLCBpc09rXSA9IGF3YWl0IE5hdHNVdGlsLmNvbm5lY3QodGhpcy5nZXRXcml0ZXIoKSwgdGhpcy5nZXRSZWFkZXIoKSwgZGF0YSk7CiAgICAgICAgaWYgKGlzT2spIHsKICAgICAgICAgICAgdGhpcy5uYXRzU2VydmVyRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIHJlY29ubmVjdCgpIHsKICAgICAgICBpZiAoIXRoaXMucmVhZGVyLnBlZWsoMSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDbGllbnQgaXMgY2xvc2VkLiIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCBOYXRzVXRpbC5zZW5kQ29tbWFuZCh0aGlzLndyaXRlciwgdGhpcy5yZWFkZXIsICJQSU5HIik7CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IHRydWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBsZXQgcmV0cmllcyA9IDA7CiAgICAgICAgICAgICAgICBjb25zdCByZXNvbHZhYmxlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvbm5lY3Rpb25JbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRyaWVzID4gdGhpcy5nZXRSZXRyeUF0dGVtcHMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocmVjb25uZWN0aW9uSW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBOQVRTZXJyb3IoIkNvdWxkIG5vdCByZS1lc3RhYmxpc2ggY29ubmVjdGlvbiIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY29ubmVjdCh0aGlzLmdldENvbm5lY3Rpb25PcHRpb25zKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgTmF0c1V0aWwuc2VuZENvbW1hbmQodGhpcy5nZXRXcml0ZXIoKSwgdGhpcy5nZXRSZWFkZXIoKSwgIlBJTkciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHJpZXMgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChyZWNvbm5lY3Rpb25JbnRlcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yMSkgewogICAgICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRyaWVzID0gcmV0cmllcyArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmdldFJldHJ5RGVsYXkoKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGF3YWl0IHJlc29sdmFibGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBnZXRDb25uZWN0aW9uT3B0aW9ucygpIHsKICAgICAgICByZXR1cm4gdGhpcy5mdWxsQ2xpZW50T3B0aW9uczsKICAgIH0KICAgIGdldFJlYWRlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZWFkZXI7CiAgICB9CiAgICBnZXRXcml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMud3JpdGVyOwogICAgfQogICAgZ2V0Q29ubmVjdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0aW9uOwogICAgfQogICAgY2xvc2VDb25uZWN0aW9uKCkgewogICAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTsKICAgICAgICB0aGlzLmNvbm5lY3Rpb24uY2xvc2UoKTsKICAgIH0KICAgIGdldFJldHJ5QXR0ZW1wcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlBdHRlbXB0cyB8fCAzOwogICAgfQogICAgZ2V0UmV0cnlEZWxheSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlEZWxheSB8fCAxMDAwOwogICAgfQogICAgaXNDb25uZWN0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkOwogICAgfQogICAgaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VkOwogICAgfQogICAgZ2V0QXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXROYXRzU2VydmVyRGF0YSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5uYXRzU2VydmVyRGF0YTsKICAgIH0KICAgIGV4ZWMoZXhlY0RhdGEpIHsKICAgICAgICBpZiAoIXRoaXMuaXNDbG9zZWQoKSAmJiB0aGlzLmlzQ29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIE5hdHNVdGlsLmV4ZWModGhpcy5nZXRXcml0ZXIoKSwgdGhpcy5nZXRSZWFkZXIoKSwgZXhlY0RhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOQVRTZXJyb3IoIkNvbW1hbmQgY291bGQgbm90IGJlIGV4ZWN1dGVkIGJlY2F1c2UgY29ubmVjdGlvbiBpcyBlaXRoZXIgY2xvc2VkIG9yIG5vdCBlc3RhYmxpc2hlZCIpOwogICAgICAgIH0KICAgIH0KICAgIGdldFN1YnNjcmliZXIoKSB7CiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaWJlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlciA9IG5ldyBOYXRzU3Vic2NyaXB0aW9uKHRoaXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5zdWJzY3JpYmVyOwogICAgfQogICAgYXN5bmMgKnJlY2VpdmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3Vic2NyaWJlci5yZWNlaXZlKCk7CiAgICB9CiAgICBnZXREZWZhdWx0UG9ydCgpIHsKICAgICAgICByZXR1cm4gNDIyMjsKICAgIH0KfQp2YXIgVHJhbnNwb3J0ZXJzOwooZnVuY3Rpb24oVHJhbnNwb3J0ZXJzMSkgewogICAgVHJhbnNwb3J0ZXJzMVsiVENQIl0gPSAiVENQIjsKICAgIFRyYW5zcG9ydGVyczFbIkFNUVAiXSA9ICJBTVFQIjsKICAgIFRyYW5zcG9ydGVyczFbIlJFRElTIl0gPSAiUkVESVMiOwogICAgVHJhbnNwb3J0ZXJzMVsiTkFUUyJdID0gIk5BVFMiOwp9KShUcmFuc3BvcnRlcnMgfHwgKFRyYW5zcG9ydGVycyA9IHsKfSkpOwpjbGFzcyBUY3BDbGllbnQgewogICAgYXN5bmMgY29ubmVjdChvcHRpb25zKSB7CiAgICAgICAgdGhpcy5nZW5lcmFsT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oewogICAgICAgIH0sIHsKICAgICAgICAgICAgdHJhbnNwb3J0OiBvcHRpb25zLnRyYW5zcG9ydCwKICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgaG9zdDogb3B0aW9ucy5vcHRpb25zLmhvc3QsCiAgICAgICAgICAgICAgICBwb3J0OiBvcHRpb25zLm9wdGlvbnMucG9ydCwKICAgICAgICAgICAgICAgIHJldHJ5QXR0ZW1wdHM6IG9wdGlvbnMub3B0aW9ucy5yZXRyeUF0dGVtcHRzLAogICAgICAgICAgICAgICAgcmV0cnlEZWxheTogb3B0aW9ucy5vcHRpb25zLnJldHJ5RGVsYXkKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IGF3YWl0IERlbm8uY29ubmVjdCh7CiAgICAgICAgICAgIHBvcnQ6IHRoaXMuZ2VuZXJhbE9wdGlvbnMub3B0aW9ucy5wb3J0IHx8IENsaWVudFV0aWwuZ2V0RGVmYXVsdFBvcnQodGhpcy5nZW5lcmFsT3B0aW9ucy50cmFuc3BvcnQpLAogICAgICAgICAgICBob3N0bmFtZTogdGhpcy5nZW5lcmFsT3B0aW9ucy5vcHRpb25zLmhvc3QKICAgICAgICB9KTsKICAgICAgICB0aGlzLnJlYWRlciA9IG5ldyBCdWZSZWFkZXIodGhpcy5jb25uZWN0aW9uKTsKICAgICAgICB0aGlzLndyaXRlciA9IG5ldyBCdWZXcml0ZXIodGhpcy5jb25uZWN0aW9uKTsKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IHRydWU7CiAgICAgICAgdGhpcy5jbG9zZWQgPSBmYWxzZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGF1dGhlbnRpY2F0ZShkYXRhKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNZXRob2Qgbm90IGltcGxlbWVudGVkLiIpOwogICAgfQogICAgcmVjb25uZWN0KC4uLmFyZ3MpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuIik7CiAgICB9CiAgICBnZXRDb25uZWN0aW9uT3B0aW9ucygpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuIik7CiAgICB9CiAgICBnZXRSZWFkZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVhZGVyOwogICAgfQogICAgZ2V0V3JpdGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLndyaXRlcjsKICAgIH0KICAgIGdldENvbm5lY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbjsKICAgIH0KICAgIGNsb3NlQ29ubmVjdGlvbigpIHsKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTsKICAgICAgICB0aGlzLmNvbm5lY3Rpb24uY2xvc2UoKTsKICAgIH0KICAgIGdldFJldHJ5QXR0ZW1wcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlBdHRlbXB0cyB8fCAzOwogICAgfQogICAgZ2V0UmV0cnlEZWxheSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uT3B0aW9ucygpLm9wdGlvbnMucmV0cnlEZWxheSB8fCAxMDAwOwogICAgfQogICAgaXNDb25uZWN0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkOwogICAgfQogICAgaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VkOwogICAgfQogICAgZ2V0U3Vic2NyaWJlciguLi5hcmdzKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNZXRob2Qgbm90IGltcGxlbWVudGVkLiIpOwogICAgfQogICAgYXN5bmMgKnJlY2VpdmUoLi4uYXJncykgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4iKTsKICAgIH0KICAgIGdldERlZmF1bHRQb3J0KCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4iKTsKICAgIH0KfQpjbGFzcyBNaWNyb2xlbW9uSW50ZXJuYWwgewogICAgVkFMSURfVFJBTlNQT1JURVJTID0gbmV3IE1hcCgpOwogICAgY29uc3RydWN0b3IoKXsKICAgICAgICB0aGlzLnJlZ2lzdGVyVHJhbnNwb3J0ZXIoIlRDUCIsIFRjcENsaWVudCk7CiAgICAgICAgdGhpcy5yZWdpc3RlclRyYW5zcG9ydGVyKCJSRURJUyIsIFJlZGlzQ2xpZW50KTsKICAgICAgICB0aGlzLnJlZ2lzdGVyVHJhbnNwb3J0ZXIoIk5BVFMiLCBOYXRzQ2xpZW50KTsKICAgICAgICB0aGlzLnJlZ2lzdGVyVHJhbnNwb3J0ZXIoIkFNUVAiLCBBbXFwQ2xpZW50KTsKICAgIH0KICAgIHJlZ2lzdGVyVHJhbnNwb3J0ZXIodHJhbnNwb3J0ZXIsIGNsYXNzT2JqKSB7CiAgICAgICAgY29uc3QgdHJhbnNwb3J0ZXJOYW1lID0gdHJhbnNwb3J0ZXIudG9VcHBlckNhc2UoKTsKICAgICAgICBpZiAoIXRoaXMuVkFMSURfVFJBTlNQT1JURVJTLmhhcyh0cmFuc3BvcnRlck5hbWUpKSB7CiAgICAgICAgICAgIHRoaXMuVkFMSURfVFJBTlNQT1JURVJTLnNldCh0cmFuc3BvcnRlci50b1VwcGVyQ2FzZSgpLCBjbGFzc09iaik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUcmFuc3BvcnRlciBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQiKTsKICAgICAgICB9CiAgICB9CiAgICBnZXRUcmFuc3BvcnRlcih0cmFuc3BvcnRlcikgewogICAgICAgIGlmICh0aGlzLlZBTElEX1RSQU5TUE9SVEVSUy5oYXModHJhbnNwb3J0ZXIpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLlZBTElEX1RSQU5TUE9SVEVSUy5nZXQodHJhbnNwb3J0ZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVHJhbnNwb3J0ZXIgJHt0cmFuc3BvcnRlcn0gZG9lcyBub3QgZXhpc3RgKTsKICAgICAgICB9CiAgICB9CiAgICB0cmFuc3BvcnRlckV4aXN0cyh0cmFuc3BvcnRlcikgewogICAgICAgIHJldHVybiB0aGlzLlZBTElEX1RSQU5TUE9SVEVSUy5oYXModHJhbnNwb3J0ZXIpOwogICAgfQogICAgc3RhdGljIGdldEluc3RhbmNlKCkgewogICAgICAgIGlmICghTWljcm9sZW1vbkludGVybmFsLmluc3RhbmNlKSB7CiAgICAgICAgICAgIE1pY3JvbGVtb25JbnRlcm5hbC5pbnN0YW5jZSA9IG5ldyBNaWNyb2xlbW9uSW50ZXJuYWwoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIE1pY3JvbGVtb25JbnRlcm5hbC5pbnN0YW5jZTsKICAgIH0KfQpjbGFzcyBNaWNyb2xlbW9uIHsKICAgIGFzeW5jIGNvbm5lY3Qob3B0aW9ucykgewogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkQ2xpZW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29uc3QgdHJhbnNwb3J0ZXIgPSBvcHRpb25zLnRyYW5zcG9ydDsKICAgICAgICAgICAgY29uc3QgbWljcm9zZXJ2aWNlQ2xpZW50ID0gTWljcm9sZW1vbkludGVybmFsLmdldEluc3RhbmNlKCkuZ2V0VHJhbnNwb3J0ZXIodHJhbnNwb3J0ZXIpOwogICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2xpZW50ID0gbmV3IG1pY3Jvc2VydmljZUNsaWVudCgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudC5jb25uZWN0KG9wdGlvbnMpOwogICAgfQogICAgYXN5bmMgYXV0aGVudGljYXRlKGRhdGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudC5hdXRoZW50aWNhdGUoZGF0YSk7CiAgICB9CiAgICBhc3luYyByZWNvbm5lY3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQucmVjb25uZWN0KCk7CiAgICB9CiAgICBnZXRDb25uZWN0aW9uT3B0aW9ucygpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudC5nZXRDb25uZWN0aW9uT3B0aW9ucygpOwogICAgfQogICAgZ2V0UmVhZGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmdldFJlYWRlcigpOwogICAgfQogICAgZ2V0V3JpdGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmdldFdyaXRlcigpOwogICAgfQogICAgZ2V0Q29ubmVjdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudC5nZXRDb25uZWN0aW9uKCk7CiAgICB9CiAgICBjbG9zZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQuY2xvc2VDb25uZWN0aW9uKCk7CiAgICB9CiAgICBnZXRSZXRyeUF0dGVtcHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQuZ2V0UmV0cnlBdHRlbXBzKCk7CiAgICB9CiAgICBnZXRSZXRyeURlbGF5KCkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmdldFJldHJ5RGVsYXkoKTsKICAgIH0KICAgIGlzQ29ubmVjdGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmlzQ29ubmVjdGVkKCk7CiAgICB9CiAgICBpc0Nsb3NlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudC5pc0Nsb3NlZCgpOwogICAgfQogICAgZ2V0U3Vic2NyaWJlciguLi5hcmdzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDbGllbnQuZ2V0U3Vic2NyaWJlciguLi5hcmdzKTsKICAgIH0KICAgIGFzeW5jICpyZWNlaXZlKC4uLnBhcmFtcykgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LnJlY2VpdmUoLi4ucGFyYW1zKTsKICAgIH0KICAgIGdldERlZmF1bHRQb3J0KCkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkQ2xpZW50LmdldERlZmF1bHRQb3J0KCk7CiAgICB9CiAgICBnZXRTZWxlY3RlZENsaWVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZENsaWVudDsKICAgIH0KfQpsZXQgbWljcm9zZXJ2aWNlQ29ubmVjdGlvbiA9IHVuZGVmaW5lZDsKY29uc3QgYnVpbGRQb3N0TWVzc2FnZSA9IChkYXRhMik9PnsKICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhMik7Cn07CmNvbnN0IGluaXRpYWxpemVNaWNyb3NlcnZpY2UgPSBhc3luYyAoY29uZmlndXJhdGlvbik9PnsKICAgIGlmICghbWljcm9zZXJ2aWNlQ29ubmVjdGlvbikgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1pY3Jvc2VydmljZUNvbm5lY3Rpb24gPSBhd2FpdCBuZXcgTWljcm9sZW1vbigpLmNvbm5lY3QoY29uZmlndXJhdGlvbik7CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoYnVpbGRQb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBtZXNzYWdlOiAiTUFOREFSSU5FX01JQ1JPU0VSVklDRV9SRUFEWSIKICAgICAgICAgICAgfSkpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoYnVpbGRQb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBtZXNzYWdlOiAiTUFOREFSSU5FX01JQ1JPU0VSVklDRV9GQUlMVVJFIiwKICAgICAgICAgICAgICAgIGRhdGE6IGVycm9yCiAgICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICB9Cn07CmNvbnN0IHN1YnNjcmliZUFuZExpc3RlbiA9IGFzeW5jIChzdWJzY3JpcHRpb24pPT57CiAgICBpZiAobWljcm9zZXJ2aWNlQ29ubmVjdGlvbikgewogICAgICAgIHN3aXRjaChzdWJzY3JpcHRpb24udHJhbnNwb3J0ZXIudG9VcHBlckNhc2UoKSl7CiAgICAgICAgICAgIGNhc2UgVHJhbnNwb3J0ZXJzLkFNUVA6CiAgICAgICAgICAgICAgICAoYXN5bmMgKCk9PnsKICAgICAgICAgICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGRhdGEyIG9mIG1pY3Jvc2VydmljZUNvbm5lY3Rpb24ucmVjZWl2ZShzdWJzY3JpcHRpb24uY2hhbm5lbHNbMF0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShidWlsZFBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGRhdGEyCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVHJhbnNwb3J0ZXJzLlJFRElTOgogICAgICAgICAgICAgICAgY29uc3Qgc3Vic2NyaWJlciA9IGF3YWl0IG1pY3Jvc2VydmljZUNvbm5lY3Rpb24uZ2V0U3Vic2NyaWJlcigpLmNoYW5uZWxTdWJzY3JpYmUoLi4uc3Vic2NyaXB0aW9uLmNoYW5uZWxzKTsKICAgICAgICAgICAgICAgIChhc3luYyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHsgY2hhbm5lbCAsIG1lc3NhZ2U6IG1lc3NhZ2UzICB9IG9mIHN1YnNjcmliZXIucmVjZWl2ZSgpKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShidWlsZFBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsOiBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVHJhbnNwb3J0ZXJzLk5BVFM6CiAgICAgICAgICAgICAgICBjb25zdCBuYXRzU3Vic2NyaWJlciA9IG1pY3Jvc2VydmljZUNvbm5lY3Rpb24uZ2V0U3Vic2NyaWJlcigpOwogICAgICAgICAgICAgICAgY29uc3QgW2NoYW5uZWxUb1N1YnNjcmliZSwgcXVldWVHcm91cF0gPSBzdWJzY3JpcHRpb24uY2hhbm5lbHM7CiAgICAgICAgICAgICAgICBhd2FpdCBzdWJzY3JpYmVyLnN1YnNjcmliZShjaGFubmVsVG9TdWJzY3JpYmUsIHF1ZXVlR3JvdXApOwogICAgICAgICAgICAgICAgKGFzeW5jIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3QgZGF0YTIgb2YgbmF0c1N1YnNjcmliZXIucmVjZWl2ZSgpKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShidWlsZFBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGRhdGEyCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQp9OwpzZWxmLm9ubWVzc2FnZSA9IGFzeW5jICh7IGRhdGE6IGRhdGEyICB9KT0+ewogICAgY29uc3QgY21kT2JqZWN0ID0gZGF0YTI7CiAgICBzd2l0Y2goY21kT2JqZWN0LmNtZCl7CiAgICAgICAgY2FzZSAiSU5JVElBTElaRSI6CiAgICAgICAgICAgIGF3YWl0IGluaXRpYWxpemVNaWNyb3NlcnZpY2UoY21kT2JqZWN0LmNvbmZpZ3VyYXRpb24pOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJMSVNURU4iOgogICAgICAgICAgICBhd2FpdCBzdWJzY3JpYmVBbmRMaXN0ZW4oZGF0YTIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJIRUFMVEgiOgogICAgICAgICAgICBhd2FpdCBzZWxmLnBvc3RNZXNzYWdlKGJ1aWxkUG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgbWVzc2FnZTogIkFMSVZFIgogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgfQp9Owo=`;